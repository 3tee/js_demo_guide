/*! cn.tee3.avd-2.5.0.0 2017-08-01 02:03:16 */

function base64encode(e){var t,r,n,o,i,s;for(n=e.length,r=0,t="";r<n;){if(o=255&e.charCodeAt(r++),r==n){t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4),t+="==";break}if(i=e.charCodeAt(r++),r==n){t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2),t+="=";break}s=e.charCodeAt(r++),t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2|(192&s)>>6),t+=base64EncodeChars.charAt(63&s)}return t}function base64decode(e){var t,r,n,o,i,s,a;for(s=e.length,i=0,a="";i<s;){do{t=base64DecodeChars[255&e.charCodeAt(i++)]}while(i<s&&-1==t);if(-1==t)break;do{r=base64DecodeChars[255&e.charCodeAt(i++)]}while(i<s&&-1==r);if(-1==r)break;a+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(i++)))return a;n=base64DecodeChars[n]}while(i<s&&-1==n);if(-1==n)break;a+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(o=255&e.charCodeAt(i++)))return a;o=base64DecodeChars[o]}while(i<s&&-1==o);if(-1==o)break;a+=String.fromCharCode((3&n)<<6|o)}return a}function utf16to8(e){var t,r,n,o;for(t="",n=e.length,r=0;r<n;r++)(o=e.charCodeAt(r))>=1&&o<=127?t+=e.charAt(r):o>2047?(t+=String.fromCharCode(224|o>>12&15),t+=String.fromCharCode(128|o>>6&63),t+=String.fromCharCode(128|o>>0&63)):(t+=String.fromCharCode(192|o>>6&31),t+=String.fromCharCode(128|o>>0&63));return t}function utf8to16(e){var t,r,n,o,i,s;for(t="",n=e.length,r=0;r<n;)switch((o=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:i=e.charCodeAt(r++),t+=String.fromCharCode((31&o)<<6|63&i);break;case 14:i=e.charCodeAt(r++),s=e.charCodeAt(r++),t+=String.fromCharCode((15&o)<<12|(63&i)<<6|(63&s)<<0)}return t}function doit(){var e=document.f;e.output.value=base64encode(utf16to8(e.source.value)),e.decode.value=utf8to16(base64decode(e.output.value))}function trace(e){"\n"==e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+e)}function maybeFixConfiguration(e){if(e)for(var t=0;t<e.iceServers.length;t++)e.iceServers[t].hasOwnProperty("urls")&&(e.iceServers[t].url=e.iceServers[t].urls,delete e.iceServers[t].urls)}function getPlugin(){var e=document.getElementById(WebRTCPlugin.pluginInfo.pluginId);return e.logSeverity="info",e}function mergeConstraints(e,t){var r=e;for(var n in t){var o=n.substring(0,1).toUpperCase()+n.substring(1);"offerToReceiveAudio"==n||"offerToReceiveVideo"==n?r.mandatory[o]=t[n]:r.optional[o]=t[n]}return r}function SdpSerializer(e){function t(e){if(l[e])if(g=="a=mid:"+e){var t=h[m-1];t&&(l[e].direction=t.split("a=")[1],l[e].attributes.pop(1)),f=!0,l[e]["a=mid:"+e]={line:g,attributes:[]}}else if(f)if(0==g.indexOf("a=crypto:"))l[e].crypto[g.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=g;else if(0==g.indexOf("a=rtpmap:")){var r=g.split("a=rtpmap:")[1].split(" ");l[e].payload[r[0]]=r[1],function t(){(g=h[m+1])&&-1==g.indexOf("a=rtpmap:")&&-1==g.indexOf("m=")&&(-1==g.indexOf("a=ssrc")&&(l[e].payload[r[0]]+="\r\n"+g),-1!=g.indexOf("a=ssrc")&&l[e].ssrc.push(g),m++,t())}()}else l[e]["a=mid:"+e].attributes.push(g);else l[e].attributes.push(g);else if(l[e]={line:g,attributes:[],payload:{},ssrc:[],crypto:{}},-1!=g.indexOf("RTP/SAVPF"))for(var n=g.split("RTP/SAVPF ")[1].split(" "),o=0;o<n.length;o++)l[e].payload[n[o]]=""}function r(e){if(l[e]){for(var t=[],r="",n=0;n<l[e].ssrc.length;n++){var o=l[e].ssrc[n];""==r?r=o:r+="\r\n"+o,-1!=o.indexOf("cname:")&&t.push([]),t.length>0&&t[t.length-1].push(o)}l[e].ssrc=t,l[e].ssrcStr=r}}function n(e){l[e]&&delete l[e];for(var t=0;t<u.length;t++)if(-1!=u[t].indexOf("a=group")){var r=u[t].split("a=group:BUNDLE ")[1].split(" ");u[t]="a=group:BUNDLE";for(var n=0;n<r.length;n++)r[n]!=e&&(u[t]+=" "+r[n])}}function o(e,t){if(l[t]&&-1!=l[t].line.indexOf(e)&&(l[t].payload[e]&&delete l[t].payload[e],-1!=l[t].line.indexOf("RTP/SAVPF"))){for(var r=l[t].line.split("RTP/SAVPF ")[1].split(" "),n=0;n<r.length;n++)r[n]==e&&delete r[n];r=swap(r),l[t].line=l[t].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+r.join(" ")}}function i(e,t,r){if(l[r]&&-1!=l[r].line.indexOf(e)&&-1!=l[r].line.indexOf("RTP/SAVPF")){for(var n=l[r].line.split("RTP/SAVPF ")[1].split(" "),o=[],i=0;i<n.length;i++)n[i]==e&&(o[t]=n[i],delete n[i]);for(i=0;i<n.length;i++)i<t&&(o[i]=n[i]),i>=t&&(o[i+1]=n[i]);o=swap(o),l[r].line=l[r].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+o.join(" ")}}function s(e,t){if(!l[t])return e;e+=l[t].line+"\r\n";for(r=0;r<l[t].attributes.length;r++)e+=l[t].attributes[r]+"\r\n";l[t].direction&&(e+="a="+l[t].direction+"\r\n"),e+="a=mid:"+t+"\r\n";for(var r=0;r<l[t]["a=mid:"+t].attributes.length;r++)l[t]["a=mid:"+t].attributes[r]&&(e+=l[t]["a=mid:"+t].attributes[r]+"\r\n");for(var n in l[t].crypto)e+=l[t].crypto[n]+"\r\n";if(-1!=l[t].line.indexOf("RTP/SAVPF"))for(var o=l[t].line.split("RTP/SAVPF ")[1].split(" "),i=0;i<o.length;i++){var s=o[i];s&&(e+="a=rtpmap:"+s+" "+l[t].payload[s]+"\r\n")}for(var a=0;a<l[t].ssrc.length;a++)for(var u=l[t].ssrc[a],c=0;c<u.length;c++)e+=u[c]+"\r\n";return e}function a(e){return{mLine:e,payload:function(e){return l[this.mLine]&&l[this.mLine].payload[e]||log.error(e,"doesn'nt exits."),{payload:e,mLine:this.mLine,newLine:function(e){l[this.mLine].payload[this.payload]+="\r\n"+e},remove:function(){o(this.payload,this.mLine)},order:function(e){i(this.payload,e,this.mLine)}}},remove:function(){n(this.mLine)},isRejected:function(){var e=l[this.mLine].line.split("m="+this.mLine)[1];return 0==parseInt(e)},crypto:function(e){var t=l[this.mLine].crypto[e];return{mLine:this.mLine,remove:function(){t&&delete l[this.mLine].crypto[e]},newLine:function(e){l[this.mLine].crypto[e.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=e}}},track:function(t){var r=l[e].ssrc[t];return{ssrc:r,set:function(e){l[this.mLine].ssrc[t]=e},mLine:this.mLine,remove:function(){r&&(delete l[e].ssrc[t],l[e].ssrc=swap(l[e].ssrc))}}}}}for(var l={},u=[],c=!1,d=!1,p=!1,f=!1,h=e.split("\r\n"),m=0;m<h.length;m++){var g=h[m];c||0==g.indexOf("m=audio")?(c=!0,t("audio"),(g=h[m+1])&&0==g.indexOf("m=video")&&(f=c=!1)):d||0==g.indexOf("m=video")?(d=!0,t("video"),(g=h[m+1])&&0==g.indexOf("m=application")&&(f=d=!1)):p||0==g.indexOf("m=application")?(p=!0,t("data")):u.push(g)}r("audio"),r("video"),r("data"),this.deserialize=function(){for(var e="",t=0;t<u.length;t++)e+=u[t]+"\r\n";return e=s(e,"audio"),e=s(e,"video"),e=s(e,"data")},this.audio=a("audio"),this.video=a("video"),this.data=a("data"),this._inner=l}function swap(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t}function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}function getRandomNum(e,t){var r=t-e,n=Math.random();return e+Math.round(n*r)}function resizeVideo(e,t,r){doResizeVideo(e,t,r,!1)}function resizeRealVideo(e,t,r){doResizeVideo(e,t,r,!0)}function doResizeVideo(e,t,r,n){t||(t=window.innerWidth),r||(r=window.innerHeight),e.addEventListener("loadedmetadata",function(o){var i=this.videoWidth,s=this.videoHeight;positionLarge(e,i,s,t,r,n)})}function positionLarge(e,t,r,n,o,i){var s,a=(s=i?getCameraRealVideoSize(t,r,n,o):getCameraVideoSize(t,r,n,o))[0],l=s[1],u=getCameraVideoPosition(a,l,n,o),c=u[0],d=u[1];i?positionRealVideo(e,a,l,c,d):positionVideo(e,a,l,c,d)}function getCameraVideoSize(e,t,r,n){var o=e/t;return(r=Math.max(e,r))/o<(n=Math.max(t,n))&&(r=(n=n)*o),n*o<r&&(n=(r=r)/o),[r,n]}function getCameraRealVideoSize(e,t,r,n){var o=e/t,i=Math.max(e,r),s=Math.max(t,n);return i>=e&&s>=t?o>r/n?n=(r=r)/o:r=(n=n)*o:((r=i)/o>(n=s)&&(r=(n=n)*o),n*o>r&&(n=(r=r)/o)),[r,n]}function getCameraVideoPosition(e,t,r,n){return[(r-e)/2,(n-t)/2]}function positionVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r)}function positionRealVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r);var i=e.parentNode;i.style.top=o+"px",i.style.bottom=o+"px",i.style.left=n+"px",i.style.right=n+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus,displayFullScreenStatus()}function doFullScreen(e,t){e.requestFullScreen=e.webkitRequestFullScreen||e.mozRequestFullScreen||e.requestFullScreen,isFullScreen()&&t.target!==e||fullScreenElement()===e?document.cancelFullScreen():(t.target,e.requestFullScreen())}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(e){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var t=window.createPopup(),r=t.document.body;r.style.backgroundColor="lime",r.style.border="solid black 1px",r.innerHTML="在鼠标点击窗口以外区域时自动关闭";var n=t.document.createElement("object");if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){var o=t.document.createElement("param");o.setAttribute("name","windowless"),o.setAttribute("value",!0),n.appendChild(o),n.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else n.setAttribute("type","application/avd-plugin");n.setAttribute("id","fullScreen"),n.setAttribute("width",winWidth),n.setAttribute("height",winHeight),n.src=e,r.appendChild(n),t.show(0,0,winWidth,winHeight,document.body)}function getBrowserType(){return RTCBrowserType.RTC_BROWSER_CHROME}function PeerStats(){this.ssrc2Loss={},this.ssrc2resolution={},this.ssrc2bitrate={},this.ssrc2AudioLevel={}}function formatAudioLevel(e){return Math.min(Math.max(e,0),1)}function calculatePacketLoss(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function getStatValue(e,t){if(!keyMap[getBrowserType()][t])throw"The property isn't supported!";var r=keyMap[getBrowserType()][t];return getBrowserType()==RTCBrowserType.RTC_BROWSER_CHROME?e.stat(r):e[r]}function getIP(e){return e.substring(0,e.lastIndexOf(":"))}function getPort(e){return e.substring(e.lastIndexOf(":")+1,e.length)}function getStringFromArray(e){for(var t="",r=0;r<e.length;r++)t+=(0===r?"":", ")+e[r];return t}function ConnectionInfoCollector(e,t){this.peerconnection=e,this.statsInterval=t,this.currentStatsReport=null,this.baselineStatsReport=null,this.statsIntervalId=null,this.jid=1,this.jid2stats={},this.resolution}function AudioLevel(e,t){this.peerconnection=e,this.audioLevelsIntervalMilis=t,this.audioLevelsIntervalId=null,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null}function timeDomainDataToAudioLevel(e){for(var t=0,r=e.length,n=0;n<r;n++)t<e[n]&&(t=e[n]);return parseFloat(((t-127)/128).toFixed(3))}function animateLevel(e,t){var r=0,n=t-e;return r=n>.2?t-.2:n<-.4?t+.4:e,parseFloat(r.toFixed(3))}function LocalStatsCollector(e,t,r){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=r}function isAndroid(){return-1!=navigator.userAgent.indexOf("Android")}function getPreviousResolution(e){if(!Resolutions[e])return null;var t=Resolutions[e].order,r=null,n=null;for(var o in Resolutions){var i=Resolutions[o];(null==r||r.order<i.order&&i.order<t)&&(n=o,r=i)}return n}function getConstraints(e,t){var r={audio:!1,video:!1};return e&&(r.audio={mandatory:{},optional:[]}),t&&(r.video={mandatory:{},optional:[]}),r.audio&&(r.audio.optional.push({googEchoCancellation:!0},{googAutoGainControl:!0},{googNoiseSuppression:!0},{googHighpassFilter:!0},{googNoisesuppression2:!0},{googEchoCancellation2:!0},{googAutoGainControl2:!0}),e.id&&(r.audio.mandatory.sourceId=e.id)),r.video&&(r.video.optional.push({googNoiseReduction:!1}),t.id&&(r.video.mandatory.sourceId=t.id)),t&&(t.resolution&&setResolutionConstraints(r,t.resolution),t.frameRate&&setFrameRateConstraints(r,t.frameRate)),r}function setResolutionConstraints(e,t){t&&!e.video&&(e.video={mandatory:{},optional:[]}),t&&(e.video.mandatory.minWidth=t.width,e.video.mandatory.minHeight=t.height,currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height),e.video.mandatory.minWidth&&(e.video.mandatory.maxWidth=e.video.mandatory.minWidth),e.video.mandatory.minHeight&&(e.video.mandatory.maxHeight=e.video.mandatory.minHeight)}function setFrameRateConstraints(e,t){t&&!e.video&&(e.video={mandatory:{},optional:[]}),t&&(e.video.mandatory.minFrameRate=t,e.video.mandatory.maxFrameRate=t,currentVideoParameter.frameRate=t)}function obtainUserMedia(e,t,r,n){"firefox"==webrtcDetectedBrowser?null!=e&&null!=t?getUserMediaWithConstraints(e,!1,function(e){getUserMediaWithConstraints(!1,t,function(t){var n=handleLocalStream({audioStream:e,videoStream:t});r(n)},function(e){n(e)})},function(e){n(e)}):null!=e&&null==t?getUserMediaWithConstraints(e,!1,function(e){var t=handleLocalStream({audioStream:e,videoStream:null});r(t)},function(e){n(e)}):null==e&&null!=t&&getUserMediaWithConstraints(!1,t,function(e){var t=handleLocalStream({audioStream:null,videoStream:e});r(t)},function(e){n(e)}):getUserMediaWithConstraints(e,t,function(e){r(handleLocalStream(e))},function(e){n(e)})}function getUserMediaWithConstraints(e,t,r,n){var o=getConstraints(e,t);try{getUserMedia(o,function(e){r(e)},function(e){var t,r=ModuleBase.use(ModulesEnum.error);t=new r("PermissionDeniedError"==e.name?ErrorConstant.navigatorUserMediaError_permissionDenied:"ConstraintNotSatisfiedError"==e.name?ErrorConstant.navigatorUserMediaError_constraintNotSatisfied:"TrackStartError"==e.name?ErrorConstant.navigatorUserMediaError_trackStartError:ErrorConstant.navigatorUserMediaError_unknown),n&&n(t)})}catch(e){var i=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n&&n(i)}}function handleLocalStream(e){var t,r;if("chrome"==webrtcDetectedBrowser){if(t=new webkitMediaStream,r=new webkitMediaStream,e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);var i=e.getVideoTracks();for(o=0;o<i.length;o++)r.addTrack(i[o])}}else if("Internet Explorer"==webrtcDetectedBrowser){if(t=null,r=null,e)if((n=e.getAudioTracks()).length>0?((s=e.clone()).removeTrack(n[0]),r=s):r=e,(i=e.getVideoTracks()).length>0){var s=e.clone();s.removeTrack(i[0]),t=s}else t=e}else"firefox"==webrtcDetectedBrowser&&(t=e.audioStream,r=e.videoStream);return{audioStream:t,videoStream:r}}function getFakeVideoStream(e){navigator.getUserMedia(fakeVideoConstraints,function(t){e(t)},function(e){})}function getFakeAudioStream(e){navigator.getUserMedia(fakeAudioConstraints,function(t){e(t)},function(e){})}function getAllAudioVideoDevices(e,t){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),navigator.enumerateDevices){var r=[],n=[],o=[],i=[],s=[],a=[];navigator.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var l in e)t[l]=e[l];var u;r.forEach(function(e){e.id===t.id&&(u=!0)}),u||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label||(t.label="Please invoke getUserMedia once."),"audioinput"!==t.kind&&"audio"!==t.kind||i.push(t),"audiooutput"===t.kind&&s.push(t),"videoinput"!==t.kind&&"video"!==t.kind||a.push(t),-1!==t.kind.indexOf("audio")&&n.push(t),-1!==t.kind.indexOf("video")&&o.push(t),r.push(t))}),e&&e({allMdiaDevices:r,allVideoDevices:o,allAudioDevices:n,videoInputDevices:a,audioInputDevices:i,audioOutputDevices:s})})}else t(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.")}function captureUserMedia(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t)}function saveLog(e,t,r){var n=document.location.protocol+"//"+logAjax.server+"/write?db="+logAjax.db+"&u="+logAjax.userName+"&p="+logAjax.password,o="";"undefined"!=typeof returnCitySN&&(o=returnCitySN.cip);(new Date).getTime();var i="",s="",a="",l="",u=0;room&&(room.id&&(i=room.id),room.selfUser&&(room.selfUser.name&&(s=room.selfUser.name),room.selfUser.id&&(a=room.selfUser.id))),browserDetect&&browserDetect.detect&&browserDetect.detect.browser&&(browserDetect.detect.browser.name&&(l=browserDetect.detect.browser.name),browserDetect.detect.browser.fullVersion&&(u=browserDetect.detect.browser.fullVersion));var c='js_log host_ip="'+o+'",roomId="'+i+'",userName="'+s+'",userId="'+a+'",browserName="'+l+'",browserVersion="'+u+'",level="'+e+'",msg="'+t+'" ';$.ajax({type:"post",url:n,timeout:5e3,data:c,success:function(e){},error:function(e,t,r){}})}function getFingerPrint(e){var t=null;console.log(e);for(var r=e.split("\r\n"),n=0;n<r.length;n++)if(r[n].indexOf("a=fingerprint")>-1){t=r[n].split(" ")[1];break}return console.log(t),t}function updateSDPFingerPrint(e,t){var r=preferLineSdp(e,"a=","fingerprint");if(null!=r&&r.length>0)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=fingerprint:sha-1 "+t)}return e}function updateSDPIceUfrag(e,t){var r=preferLineSdp(e,"a=","ice-ufrag");if(null!=r&&r.length>0)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-ufrag:"+t)}return e}function updateSDPIcePwd(e,t){var r=preferLineSdp(e,"a=","ice-pwd");if(null!=r&&r.length>0)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-pwd:"+t)}return e}function updateSDPSetup(e,t){var r=preferLineSdp(e,"a=","setup");if(null!=r&&r.length>0)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=setup:"+t)}return e}function preferLineSdp(e,t,r){var n=[],o=e.split("\r\n"),i=findLine(o,t,r);if(null!=i&&i.length>0)for(var s=0;s<i.length;s++)n.push(o[i[s]]);return n}function findLine(e,t,r){return findLineInRange(e,0,-1,t,r)}function findLineInRange(e,t,r,n,o){for(var i=[],s=-1!==r?r:e.length,a=t;a<s;++a)0===e[a].indexOf(n)&&(o&&-1===e[a].toLowerCase().indexOf(o.toLowerCase())||i.push(a));return i}function findLine1(e,t,r){return findLineInRange1(e,0,-1,t,r)}function findLineInRange1(e,t,r,n,o){for(var i=-1!==r?r:e.length,s=t;s<i;++s)if(0===e[s].indexOf(n)&&(!o||-1!==e[s].toLowerCase().indexOf(o.toLowerCase())))return s;return null}function preferBitRate(e,t,r){var n=e.split("\r\n"),o=findLine1(n,"m=",r);if(null===o)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var i=findLineInRange1(n,o+1,-1,"m=");null===i&&(i=n.length);var s=findLineInRange1(n,o+1,i,"c=");if(null===s)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var a=findLineInRange1(n,s+1,i,"b=AS");a&&n.splice(a,1);var l="b=AS:"+t;return n.splice(s+1,0,l),e=n.join("\r\n")}function firefoxRemoveStream(e,t){t&&e.getSenders().forEach(function(r){t.getTracks().forEach(function(t){t==r.track&&e.removeTrack(r)})})}function checkSdpContents(e,t){var r=0,n=toSessionJSON(e,{});for(var o in n.contents)n.contents[o].description.media==t&&(r+=1);return r}function checkRemoteMsids(e,t){var r=[],n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];if(i.description.media==t){var s=i.description.sources;for(var a in s){var l=s[a].parameters;for(var u in l){var c=l[u];"msid"==c.key&&""!=c.value&&r.push(c.value)}}}}return unique(r).length}function checkLocalMsids(e,t){var r=[],n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];if(i.description.media==t){var s=i.description.msid;null!=s&&null!=s.msid&&null!=s.trackId&&r.push(s.streamId+" "+s.trackId)}}return unique(r).length}function unique(e){for(var t,r=[],n={},o=0;null!=(t=e[o]);o++)n[t]||(r.push(t),n[t]=!0);return r}function addGroupContents(e,t){if(t<=0)return e;for(var r=toSessionJSON(e,{}),n=r.groups[0],o=n.contents.length,i=0;i<t;i++){var s="sdparta_"+(o+i);n.contents.push(s)}return toSessionSDP(r,{})}function updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e,t,r,n,o){var i=toSessionJSON(e,{});for(var s in i.contents){var a=i.contents[s];t&&a.transport.fingerprints.length>0&&(a.transport.fingerprints[0].value=t),r&&a.transport.fingerprints.length>0&&(a.transport.fingerprints[0].setup=r),n&&(a.transport.ufrag=n),o&&(a.transport.pwd=o)}return toSessionSDP(i,{})}function updateSDPSenders(e,t,r){var n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];i.description.media==t&&(i.senders=r)}return toSessionSDP(n,{})}function getSdpSsrc(e,t,r){var n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];if(i.description.media==t){if("firefox"!=webrtcDetectedBrowser)return getSdpSsrcHandle(i.description);if(i.description.msid.streamId==r)return getSdpSsrcByFirefox2ChromeHandle(i.description)}}}function getSdpSsrcHandle(e){var t="",r=e.sourceGroups;for(var n in r){var o=r[n];t+="a=ssrc-group:"+o.semantics+" "+(i=o.sources).join(" ")+"\r\n"}var i=e.sources;for(var n in i){var s=i[n],a=s.ssrc,l=s.parameters;for(var u in l){var c=l[u];t+="a=ssrc:"+a+" "+c.key+":"+c.value+"\r\n"}}return t=t.replace(/^\n+|\n+$/g,"")}function getSdpSsrcByFirefox2ChromeHandle(e){var t,r=getSdpSsrcHandle(e),n=e.msid;if(r.length){var o=r.split(" "),i=o[0].split(":"),s=o[1].split(":");t=i[1],s[1]}var a=r+"\r\n";return a+="a=ssrc:"+t+" msid:"+n.streamId+" "+n.trackId+"\r\n",a+="a=ssrc:"+t+" mslabel:"+n.streamId+"\r\n",a+="a=ssrc:"+t+" label:"+n.trackId}function addSdpSsrc(e,t,r){var n=toSessionJSON(e,{}),o=0,i=0;for(var s in n.contents)(a=n.contents[s]).description.media==r&&(i+=1);for(var s in n.contents){var a=n.contents[s];if(a.description.media==r){var l=!1;(o+=1)==i&&(l=!0),a.description=addSdpSsrcByFirefoxHandle(n,a.description,t,r,l)}}return toSessionSDP(n,{})}function addSdpSsrcByFirefoxHandle(e,t,r,n,o){var i=sdpLines(r);if(toSessionSDP(e,{}).indexOf(i[0])>0)return t;if(1==o){if(null!=(d=t.sources)&&d.length>0){var s=e.groups[0],a="sdparta_"+s.contents.length;if(s.contents.push(a),"video"==n){var l=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(remoteSDPFirefox_video,room.fingerPrint,room.setup,room.iceUfragForFirefox,room.icePwd),u=toSessionJSON(l,{}).contents[0];u.name=a,u.description=addSdpSsrcHandle(u.description,r),e.contents.push(u)}else if("audio"==n){remoteSDPFirfox_audio=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(remoteSDPFirfox_audio,room.fingerPrint,room.setup,room.iceUfragForFirefox,room.icePwd);var c=toSessionJSON(remoteSDPFirfox_audio,{}).contents[0];c.name=a,c.description=addSdpSsrcHandle(c.description,r),e.contents.push(c)}return t}return addSdpSsrcHandle(t,r)}var d=t.sources;return null!=d&&d.length>0?t:addSdpSsrcHandle(t,r)}function addSdpSsrcHandle(e,t){for(var r=sdpLines(t),n=findLinesInFirefox("a=ssrc-group:",r),o=sourceGroups(n||[]),i=findLinesInFirefox("a=ssrc:",r),s=sources(i||[]),a=0;a<o.length;a++)e.sourceGroups.push(o[a]);for(a=0;a<s.length;a++)e.sources.push(s[a]);return e}function delRemoveSdp(e,t,r){var n,o=0,i=toSessionJSON(e,{}),s=i.groups[0].contents,a=s.length;for(var l in i.contents)(c=i.contents[l]).description.media==r&&(o+=1);var u=-1;for(var l in i.contents){var c=i.contents[l];if(c.description.media==r){var d=c.description.sources;for(var p in d){var f=d[p].parameters;for(var h in f){var m=f[h];if("msid"==m.key&&""!=m.value){var g=t.indexOf(m.value);if(g>=0){u=g;break}}}if(u>=0)break}if(o>1){if(u>=0){var v=c.name;arrayUtil.objectNameSplice(i.contents,v),arrayUtil.baseSplice(s,v);var y=v.split("_")[1];break}for(var b=t.split("\r\n"),h=0;h<b.length;h++){var S=b[h]+"\r\n";n=e=e.replace(S,"")}}}}if(n=toSessionSDP(i,{}),y)for(h=0;h<a;h++)if(y<h){var w=h-1;n=(n=n.replace("sdparta_"+h,"sdparta_"+w)).replace("sdparta_"+h,"sdparta_"+w)}return n}function getSDPSenders(e){var t=[],r=toSessionJSON(e,{});for(var n in r.contents){var o=r.contents[n],i=o.name,s=o.senders,a=SENDERS.initiator.outgoing[s];t[i]=a}return t}function setSDPSenders(e,t){var r=toSessionJSON(e,{});for(var n in r.contents){var o=r.contents[n],i=o.name,s=o.senders,a=(SENDERS.initiator.outgoing[s],t[i]);"sendonly"==a?o.senders="responder":"recvonly"==a?o.senders="initiator":"sendrecv"==a?o.senders="both":"inactive"==a&&(o.senders="none")}return toSessionSDP(r,{})}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);!function(e,t){function r(e){var t=fe[e]={};return J.each(e.split(ee),function(e,r){t[r]=!0}),t}function n(e,r,n){if(n===t&&1===e.nodeType){var o="data-"+r.replace(me,"-$1").toLowerCase();if("string"==typeof(n=e.getAttribute(o))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:he.test(n)?J.parseJSON(n):n)}catch(e){}J.data(e,r,n)}else n=t}return n}function o(e){var t;for(t in e)if(("data"!==t||!J.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function i(){return!1}function s(){return!0}function a(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function l(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}function u(e,t,r){if(t=t||0,J.isFunction(t))return J.grep(e,function(e,n){return!!t.call(e,n,e)===r});if(t.nodeType)return J.grep(e,function(e,n){return e===t===r});if("string"==typeof t){var n=J.grep(e,function(e){return 1===e.nodeType});if(De.test(t))return J.filter(t,n,!r);t=J.filter(t,n)}return J.grep(e,function(e,n){return J.inArray(e,t)>=0===r})}function c(e){var t=Fe.split("|"),r=e.createDocumentFragment();if(r.createElement)for(;t.length;)r.createElement(t.pop());return r}function d(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function p(e,t){if(1===t.nodeType&&J.hasData(e)){var r,n,o,i=J._data(e),s=J._data(t,i),a=i.events;if(a){delete s.handle,s.events={};for(r in a)for(n=0,o=a[r].length;n<o;n++)J.event.add(t,r,a[r][n])}s.data&&(s.data=J.extend({},s.data))}}function f(e,t){var r;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),"object"===(r=t.nodeName.toLowerCase())?(t.parentNode&&(t.outerHTML=e.outerHTML),J.support.html5Clone&&e.innerHTML&&!J.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===r&&$e.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===r?t.selected=e.defaultSelected:"input"===r||"textarea"===r?t.defaultValue=e.defaultValue:"script"===r&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(J.expando))}function h(e){return void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):void 0!==e.querySelectorAll?e.querySelectorAll("*"):[]}function m(e){$e.test(e.type)&&(e.defaultChecked=e.checked)}function g(e,t){if(t in e)return t;for(var r=t.charAt(0).toUpperCase()+t.slice(1),n=t,o=gt.length;o--;)if((t=gt[o]+r)in e)return t;return n}function v(e,t){return e=t||e,"none"===J.css(e,"display")||!J.contains(e.ownerDocument,e)}function y(e,t){for(var r,n,o=[],i=0,s=e.length;i<s;i++)(r=e[i]).style&&(o[i]=J._data(r,"olddisplay"),t?(!o[i]&&"none"===r.style.display&&(r.style.display=""),""===r.style.display&&v(r)&&(o[i]=J._data(r,"olddisplay",E(r.nodeName)))):(n=tt(r,"display"),!o[i]&&"none"!==n&&J._data(r,"olddisplay",n)));for(i=0;i<s;i++)(r=e[i]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[i]||"":"none"));return e}function b(e,t,r){var n=ut.exec(t);return n?Math.max(0,n[1]-(r||0))+(n[2]||"px"):t}function S(e,t,r,n){for(var o=r===(n?"border":"content")?4:"width"===t?1:0,i=0;o<4;o+=2)"margin"===r&&(i+=J.css(e,r+mt[o],!0)),n?("content"===r&&(i-=parseFloat(tt(e,"padding"+mt[o]))||0),"margin"!==r&&(i-=parseFloat(tt(e,"border"+mt[o]+"Width"))||0)):(i+=parseFloat(tt(e,"padding"+mt[o]))||0,"padding"!==r&&(i+=parseFloat(tt(e,"border"+mt[o]+"Width"))||0));return i}function w(e,t,r){var n="width"===t?e.offsetWidth:e.offsetHeight,o=!0,i=J.support.boxSizing&&"border-box"===J.css(e,"boxSizing");if(n<=0||null==n){if(((n=tt(e,t))<0||null==n)&&(n=e.style[t]),ct.test(n))return n;o=i&&(J.support.boxSizingReliable||n===e.style[t]),n=parseFloat(n)||0}return n+S(e,t,r||(i?"border":"content"),o)+"px"}function E(e){if(pt[e])return pt[e];var t=J("<"+e+">").appendTo(j.body),r=t.css("display");return t.remove(),"none"!==r&&""!==r||(rt=j.body.appendChild(rt||J.extend(j.createElement("iframe"),{frameBorder:0,width:0,height:0})),nt&&rt.createElement||((nt=(rt.contentWindow||rt.contentDocument).document).write("<!doctype html><html><body>"),nt.close()),t=nt.body.appendChild(nt.createElement(e)),r=tt(t,"display"),j.body.removeChild(rt)),pt[e]=r,r}function C(e,t,r,n){var o;if(J.isArray(t))J.each(t,function(t,o){r||bt.test(e)?n(e,o):C(e+"["+("object"==typeof o?t:"")+"]",o,r,n)});else if(r||"object"!==J.type(t))n(e,t);else for(o in t)C(e+"["+o+"]",t[o],r,n)}function P(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var n,o,i=t.toLowerCase().split(ee),s=0,a=i.length;if(J.isFunction(r))for(;s<a;s++)n=i[s],(o=/^\+/.test(n))&&(n=n.substr(1)||"*"),(e[n]=e[n]||[])[o?"unshift":"push"](r)}}function T(e,r,n,o,i,s){i=i||r.dataTypes[0],(s=s||{})[i]=!0;for(var a,l=e[i],u=0,c=l?l.length:0,d=e===Dt;u<c&&(d||!a);u++)"string"==typeof(a=l[u](r,n,o))&&(!d||s[a]?a=t:(r.dataTypes.unshift(a),a=T(e,r,n,o,a,s)));return(d||!a)&&!s["*"]&&(a=T(e,r,n,o,"*",s)),a}function I(e,r){var n,o,i=J.ajaxSettings.flatOptions||{};for(n in r)r[n]!==t&&((i[n]?e:o||(o={}))[n]=r[n]);o&&J.extend(!0,e,o)}function R(e,r,n){var o,i,s,a,l=e.contents,u=e.dataTypes,c=e.responseFields;for(i in c)i in n&&(r[c[i]]=n[i]);for(;"*"===u[0];)u.shift(),o===t&&(o=e.mimeType||r.getResponseHeader("content-type"));if(o)for(i in l)if(l[i]&&l[i].test(o)){u.unshift(i);break}if(u[0]in n)s=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){s=i;break}a||(a=i)}s=s||a}if(s)return s!==u[0]&&u.unshift(s),n[s]}function _(e,t){var r,n,o,i,s=e.dataTypes.slice(),a=s[0],l={},u=0;if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),s[1])for(r in e.converters)l[r.toLowerCase()]=e.converters[r];for(;o=s[++u];)if("*"!==o){if("*"!==a&&a!==o){if(!(r=l[a+" "+o]||l["* "+o]))for(n in l)if((i=n.split(" "))[1]===o&&(r=l[a+" "+i[0]]||l["* "+i[0]])){!0===r?r=l[n]:!0!==l[n]&&(o=i[0],s.splice(u--,0,o));break}if(!0!==r)if(r&&e.throws)t=r(t);else try{t=r(t)}catch(e){return{state:"parsererror",error:r?e:"No conversion from "+a+" to "+o}}}a=o}return{state:"success",data:t}}function x(){try{return new e.XMLHttpRequest}catch(e){}}function M(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function U(){return setTimeout(function(){Gt=t},0),Gt=J.now()}function A(e,t){J.each(t,function(t,r){for(var n=(Jt[t]||[]).concat(Jt["*"]),o=0,i=n.length;o<i;o++)if(n[o].call(e,t,r))return})}function L(e,t,r){var n,o=0,i=Kt.length,s=J.Deferred().always(function(){delete a.elem}),a=function(){for(var t=Gt||U(),r=Math.max(0,l.startTime+l.duration-t),n=1-(r/l.duration||0),o=0,i=l.tweens.length;o<i;o++)l.tweens[o].run(n);return s.notifyWith(e,[l,n,r]),n<1&&i?r:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:J.extend({},t),opts:J.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:Gt||U(),duration:r.duration,tweens:[],createTween:function(t,r,n){var o=J.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(o),o},stop:function(t){for(var r=0,n=t?l.tweens.length:0;r<n;r++)l.tweens[r].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),u=l.props;for(k(u,l.opts.specialEasing);o<i;o++)if(n=Kt[o].call(l,e,u,l.opts))return n;return A(l,u),J.isFunction(l.opts.start)&&l.opts.start.call(e,l),J.fx.timer(J.extend(a,{anim:l,queue:l.opts.queue,elem:e})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function k(e,t){var r,n,o,i,s;for(r in e)if(n=J.camelCase(r),o=t[n],i=e[r],J.isArray(i)&&(o=i[1],i=e[r]=i[0]),r!==n&&(e[n]=i,delete e[r]),(s=J.cssHooks[n])&&"expand"in s){i=s.expand(i),delete e[n];for(r in i)r in e||(e[r]=i[r],t[r]=o)}else t[n]=o}function D(e,t,r,n,o){return new D.prototype.init(e,t,r,n,o)}function O(e,t){var r,n={height:e},o=0;for(t=t?1:0;o<4;o+=2-t)r=mt[o],n["margin"+r]=n["padding"+r]=e;return t&&(n.opacity=n.width=e),n}function N(e){return J.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var F,B,j=e.document,V=e.location,W=e.navigator,q=e.jQuery,H=e.$,G=Array.prototype.push,Y=Array.prototype.slice,z=Array.prototype.indexOf,$=Object.prototype.toString,X=Object.prototype.hasOwnProperty,K=String.prototype.trim,J=function(e,t){return new J.fn.init(e,t,F)},Q=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,Z=/\S/,ee=/\s+/,te=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,re=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,ne=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,oe=/^[\],:{}\s]*$/,ie=/(?:^|:|,)(?:\s*\[)+/g,se=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ae=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,le=/^-ms-/,ue=/-([\da-z])/gi,ce=function(e,t){return(t+"").toUpperCase()},de=function(){j.addEventListener?(j.removeEventListener("DOMContentLoaded",de,!1),J.ready()):"complete"===j.readyState&&(j.detachEvent("onreadystatechange",de),J.ready())},pe={};J.fn=J.prototype={constructor:J,init:function(e,r,n){var o,i,s;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("string"==typeof e){if((o="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:re.exec(e))&&(o[1]||!r)){if(o[1])return r=r instanceof J?r[0]:r,s=r&&r.nodeType?r.ownerDocument||r:j,e=J.parseHTML(o[1],s,!0),ne.test(o[1])&&J.isPlainObject(r)&&this.attr.call(e,r,!0),J.merge(this,e);if((i=j.getElementById(o[2]))&&i.parentNode){if(i.id!==o[2])return n.find(e);this.length=1,this[0]=i}return this.context=j,this.selector=e,this}return!r||r.jquery?(r||n).find(e):this.constructor(r).find(e)}return J.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),J.makeArray(e,this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return Y.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,r){var n=J.merge(this.constructor(),e);return n.prevObject=this,n.context=this.context,"find"===t?n.selector=this.selector+(this.selector?" ":"")+r:t&&(n.selector=this.selector+"."+t+"("+r+")"),n},each:function(e,t){return J.each(this,e,t)},ready:function(e){return J.ready.promise().done(e),this},eq:function(e){return-1==(e=+e)?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(Y.apply(this,arguments),"slice",Y.call(arguments).join(","))},map:function(e){return this.pushStack(J.map(this,function(t,r){return e.call(t,r,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:G,sort:[].sort,splice:[].splice},J.fn.init.prototype=J.fn,J.extend=J.fn.extend=function(){var e,r,n,o,i,s,a=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},l=2),"object"!=typeof a&&!J.isFunction(a)&&(a={}),u===l&&(a=this,--l);l<u;l++)if(null!=(e=arguments[l]))for(r in e)n=a[r],a!==(o=e[r])&&(c&&o&&(J.isPlainObject(o)||(i=J.isArray(o)))?(i?(i=!1,s=n&&J.isArray(n)?n:[]):s=n&&J.isPlainObject(n)?n:{},a[r]=J.extend(c,s,o)):o!==t&&(a[r]=o));return a},J.extend({noConflict:function(t){return e.$===J&&(e.$=H),t&&e.jQuery===J&&(e.jQuery=q),J},isReady:!1,readyWait:1,holdReady:function(e){e?J.readyWait++:J.ready(!0)},ready:function(e){if(!0===e?!--J.readyWait:!J.isReady){if(!j.body)return setTimeout(J.ready,1);J.isReady=!0,!0!==e&&--J.readyWait>0||(B.resolveWith(j,[J]),J.fn.trigger&&J(j).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===J.type(e)},isArray:Array.isArray||function(e){return"array"===J.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):pe[$.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==J.type(e)||e.nodeType||J.isWindow(e))return!1;try{if(e.constructor&&!X.call(e,"constructor")&&!X.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var r;for(r in e);return r===t||X.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,r){var n;return e&&"string"==typeof e?("boolean"==typeof t&&(r=t,t=0),t=t||j,(n=ne.exec(e))?[t.createElement(n[1])]:(n=J.buildFragment([e],t,r?null:[]),J.merge([],(n.cacheable?J.clone(n.fragment):n.fragment).childNodes))):null},parseJSON:function(t){return t&&"string"==typeof t?(t=J.trim(t),e.JSON&&e.JSON.parse?e.JSON.parse(t):oe.test(t.replace(se,"@").replace(ae,"]").replace(ie,""))?new Function("return "+t)():void J.error("Invalid JSON: "+t)):null},parseXML:function(r){var n,o;if(!r||"string"!=typeof r)return null;try{e.DOMParser?(o=new DOMParser,n=o.parseFromString(r,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(r))}catch(e){n=t}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+r),n},noop:function(){},globalEval:function(t){t&&Z.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(le,"ms-").replace(ue,ce)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,r,n){var o,i=0,s=e.length,a=s===t||J.isFunction(e);if(n)if(a){for(o in e)if(!1===r.apply(e[o],n))break}else for(;i<s&&!1!==r.apply(e[i++],n););else if(a){for(o in e)if(!1===r.call(e[o],o,e[o]))break}else for(;i<s&&!1!==r.call(e[i],i,e[i++]););return e},trim:K&&!K.call("\ufeff ")?function(e){return null==e?"":K.call(e)}:function(e){return null==e?"":(e+"").replace(te,"")},makeArray:function(e,t){var r,n=t||[];return null!=e&&(r=J.type(e),null==e.length||"string"===r||"function"===r||"regexp"===r||J.isWindow(e)?G.call(n,e):J.merge(n,e)),n},inArray:function(e,t,r){var n;if(t){if(z)return z.call(t,e,r);for(n=t.length,r=r?r<0?Math.max(0,n+r):r:0;r<n;r++)if(r in t&&t[r]===e)return r}return-1},merge:function(e,r){var n=r.length,o=e.length,i=0;if("number"==typeof n)for(;i<n;i++)e[o++]=r[i];else for(;r[i]!==t;)e[o++]=r[i++];return e.length=o,e},grep:function(e,t,r){var n,o=[],i=0,s=e.length;for(r=!!r;i<s;i++)n=!!t(e[i],i),r!==n&&o.push(e[i]);return o},map:function(e,r,n){var o,i,s=[],a=0,l=e.length;if(e instanceof J||l!==t&&"number"==typeof l&&(l>0&&e[0]&&e[l-1]||0===l||J.isArray(e)))for(;a<l;a++)null!=(o=r(e[a],a,n))&&(s[s.length]=o);else for(i in e)null!=(o=r(e[i],i,n))&&(s[s.length]=o);return s.concat.apply([],s)},guid:1,proxy:function(e,r){var n,o,i;return"string"==typeof r&&(n=e[r],r=e,e=n),J.isFunction(e)?(o=Y.call(arguments,2),i=function(){return e.apply(r,o.concat(Y.call(arguments)))},i.guid=e.guid=e.guid||J.guid++,i):t},access:function(e,r,n,o,i,s,a){var l,u=null==n,c=0,d=e.length;if(n&&"object"==typeof n){for(c in n)J.access(e,r,c,n[c],1,s,o);i=1}else if(o!==t){if(l=a===t&&J.isFunction(o),u&&(l?(l=r,r=function(e,t,r){return l.call(J(e),r)}):(r.call(e,o),r=null)),r)for(;c<d;c++)r(e[c],n,l?o.call(e[c],c,r(e[c],n)):o,a);i=1}return i?e:u?r.call(e):d?r(e[0],n):s},now:function(){return(new Date).getTime()}}),J.ready.promise=function(t){if(!B)if(B=J.Deferred(),"complete"===j.readyState)setTimeout(J.ready,1);else if(j.addEventListener)j.addEventListener("DOMContentLoaded",de,!1),e.addEventListener("load",J.ready,!1);else{j.attachEvent("onreadystatechange",de),e.attachEvent("onload",J.ready);var r=!1;try{r=null==e.frameElement&&j.documentElement}catch(e){}r&&r.doScroll&&function e(){if(!J.isReady){try{r.doScroll("left")}catch(t){return setTimeout(e,50)}J.ready()}}()}return B.promise(t)},J.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){pe["[object "+t+"]"]=t.toLowerCase()}),F=J(j);var fe={};J.Callbacks=function(e){var n,o,i,s,a,l,u=[],c=!(e="string"==typeof e?fe[e]||r(e):J.extend({},e)).once&&[],d=function(t){for(n=e.memory&&t,o=!0,l=s||0,s=0,a=u.length,i=!0;u&&l<a;l++)if(!1===u[l].apply(t[0],t[1])&&e.stopOnFalse){n=!1;break}i=!1,u&&(c?c.length&&d(c.shift()):n?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function t(r){J.each(r,function(r,n){var o=J.type(n);"function"!==o||e.unique&&p.has(n)?n&&n.length&&"string"!==o&&t(n):u.push(n)})})(arguments),i?a=u.length:n&&(s=t,d(n))}return this},remove:function(){return u&&J.each(arguments,function(e,t){for(var r;(r=J.inArray(t,u,r))>-1;)u.splice(r,1),i&&(r<=a&&a--,r<=l&&l--)}),this},has:function(e){return J.inArray(e,u)>-1},empty:function(){return u=[],this},disable:function(){return u=c=n=t,this},disabled:function(){return!u},lock:function(){return c=t,n||p.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],u&&(!o||c)&&(i?c.push(t):d(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!o}};return p},J.extend({Deferred:function(e){var t=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],r="pending",n={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return J.Deferred(function(r){J.each(t,function(t,n){var i=n[0],s=e[t];o[n[1]](J.isFunction(s)?function(){var e=s.apply(this,arguments);e&&J.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[i+"With"](this===o?r:this,[e])}:r[i])}),e=null}).promise()},promise:function(e){return null!=e?J.extend(e,n):n}},o={};return n.pipe=n.then,J.each(t,function(e,i){var s=i[2],a=i[3];n[i[1]]=s.add,a&&s.add(function(){r=a},t[1^e][2].disable,t[2][2].lock),o[i[0]]=s.fire,o[i[0]+"With"]=s.fireWith}),n.promise(o),e&&e.call(o,o),o},when:function(e){var t,r,n,o=0,i=Y.call(arguments),s=i.length,a=1!==s||e&&J.isFunction(e.promise)?s:0,l=1===a?e:J.Deferred(),u=function(e,r,n){return function(o){r[e]=this,n[e]=arguments.length>1?Y.call(arguments):o,n===t?l.notifyWith(r,n):--a||l.resolveWith(r,n)}};if(s>1)for(t=new Array(s),r=new Array(s),n=new Array(s);o<s;o++)i[o]&&J.isFunction(i[o].promise)?i[o].promise().done(u(o,n,i)).fail(l.reject).progress(u(o,r,t)):--a;return a||l.resolveWith(n,i),l.promise()}}),J.support=function(){var t,r,n,o,i,s,a,l,u,c,d,p=j.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=p.getElementsByTagName("*"),n=p.getElementsByTagName("a")[0],n.style.cssText="top:1px;float:left;opacity:.5",!r||!r.length)return{};i=(o=j.createElement("select")).appendChild(j.createElement("option")),s=p.getElementsByTagName("input")[0],t={leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.5/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:"on"===s.value,optSelected:i.selected,getSetAttribute:"t"!==p.className,enctype:!!j.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==j.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===j.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},s.checked=!0,t.noCloneChecked=s.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!i.disabled;try{delete p.test}catch(e){t.deleteExpando=!1}if(!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",d=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",d)),s=j.createElement("input"),s.value="t",s.setAttribute("type","radio"),t.radioValue="t"===s.value,s.setAttribute("checked","checked"),s.setAttribute("name","t"),p.appendChild(s),(a=j.createDocumentFragment()).appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=s.checked,a.removeChild(s),a.appendChild(p),p.attachEvent)for(u in{submit:!0,change:!0,focusin:!0})l="on"+u,(c=l in p)||(p.setAttribute(l,"return;"),c="function"==typeof p[l]),t[u+"Bubbles"]=c;return J(function(){var r,n,o,i,s="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=j.getElementsByTagName("body")[0];a&&((r=j.createElement("div")).style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(r,a.firstChild),n=j.createElement("div"),r.appendChild(n),n.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(o=n.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=c&&0===o[0].offsetHeight,n.innerHTML="",n.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===n.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(n,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(n,null)||{width:"4px"}).width,i=j.createElement("div"),i.style.cssText=n.style.cssText=s,i.style.marginRight=i.style.width="0",n.style.width="1px",n.appendChild(i),t.reliableMarginRight=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight)),void 0!==n.style.zoom&&(n.innerHTML="",n.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===n.offsetWidth,n.style.display="block",n.style.overflow="visible",n.innerHTML="<div></div>",n.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==n.offsetWidth,r.style.zoom=1),a.removeChild(r),r=n=o=i=null)}),a.removeChild(p),r=n=o=i=s=a=p=null,t}();var he=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,me=/([A-Z])/g;J.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(J.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?J.cache[e[J.expando]]:e[J.expando])&&!o(e)},data:function(e,r,n,o){if(J.acceptData(e)){var i,s,a=J.expando,l="string"==typeof r,u=e.nodeType,c=u?J.cache:e,d=u?e[a]:e[a]&&a;if(d&&c[d]&&(o||c[d].data)||!l||n!==t)return d||(u?e[a]=d=J.deletedIds.pop()||J.guid++:d=a),c[d]||(c[d]={},u||(c[d].toJSON=J.noop)),"object"!=typeof r&&"function"!=typeof r||(o?c[d]=J.extend(c[d],r):c[d].data=J.extend(c[d].data,r)),i=c[d],o||(i.data||(i.data={}),i=i.data),n!==t&&(i[J.camelCase(r)]=n),l?null==(s=i[r])&&(s=i[J.camelCase(r)]):s=i,s}},removeData:function(e,t,r){if(J.acceptData(e)){var n,i,s,a=e.nodeType,l=a?J.cache:e,u=a?e[J.expando]:J.expando;if(l[u]){if(t&&(n=r?l[u]:l[u].data)){J.isArray(t)||(t in n?t=[t]:(t=J.camelCase(t),t=t in n?[t]:t.split(" ")));for(i=0,s=t.length;i<s;i++)delete n[t[i]];if(!(r?o:J.isEmptyObject)(n))return}(r||(delete l[u].data,o(l[u])))&&(a?J.cleanData([e],!0):J.support.deleteExpando||l!=l.window?delete l[u]:l[u]=null)}}},_data:function(e,t,r){return J.data(e,t,r,!0)},acceptData:function(e){var t=e.nodeName&&J.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),J.fn.extend({data:function(e,r){var o,i,s,a,l,u=this[0],c=0,d=null;if(e===t){if(this.length&&(d=J.data(u),1===u.nodeType&&!J._data(u,"parsedAttrs"))){for(l=(s=u.attributes).length;c<l;c++)(a=s[c].name).indexOf("data-")||(a=J.camelCase(a.substring(5)),n(u,a,d[a]));J._data(u,"parsedAttrs",!0)}return d}return"object"==typeof e?this.each(function(){J.data(this,e)}):(o=e.split(".",2),o[1]=o[1]?"."+o[1]:"",i=o[1]+"!",J.access(this,function(r){if(r===t)return(d=this.triggerHandler("getData"+i,[o[0]]))===t&&u&&(d=J.data(u,e),d=n(u,e,d)),d===t&&o[1]?this.data(o[0]):d;o[1]=r,this.each(function(){var t=J(this);t.triggerHandler("setData"+i,o),J.data(this,e,r),t.triggerHandler("changeData"+i,o)})},null,r,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){J.removeData(this,e)})}}),J.extend({queue:function(e,t,r){var n;if(e)return t=(t||"fx")+"queue",n=J._data(e,t),r&&(!n||J.isArray(r)?n=J._data(e,t,J.makeArray(r)):n.push(r)),n||[]},dequeue:function(e,t){t=t||"fx";var r=J.queue(e,t),n=r.length,o=r.shift(),i=J._queueHooks(e,t);"inprogress"===o&&(o=r.shift(),n--),o&&("fx"===t&&r.unshift("inprogress"),delete i.stop,o.call(e,function(){J.dequeue(e,t)},i)),!n&&i&&i.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return J._data(e,r)||J._data(e,r,{empty:J.Callbacks("once memory").add(function(){J.removeData(e,t+"queue",!0),J.removeData(e,r,!0)})})}}),J.fn.extend({queue:function(e,r){var n=2;return"string"!=typeof e&&(r=e,e="fx",n--),arguments.length<n?J.queue(this[0],e):r===t?this:this.each(function(){var t=J.queue(this,e,r);J._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&J.dequeue(this,e)})},dequeue:function(e){return this.each(function(){J.dequeue(this,e)})},delay:function(e,t){return e=J.fx?J.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var n=setTimeout(t,e);r.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,r){var n,o=1,i=J.Deferred(),s=this,a=this.length,l=function(){--o||i.resolveWith(s,[s])};for("string"!=typeof e&&(r=e,e=t),e=e||"fx";a--;)(n=J._data(s[a],e+"queueHooks"))&&n.empty&&(o++,n.empty.add(l));return l(),i.promise(r)}});var ge,ve,ye,be=/[\t\r\n]/g,Se=/\r/g,we=/^(?:button|input)$/i,Ee=/^(?:button|input|object|select|textarea)$/i,Ce=/^a(?:rea|)$/i,Pe=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Te=J.support.getSetAttribute;J.fn.extend({attr:function(e,t){return J.access(this,J.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){J.removeAttr(this,e)})},prop:function(e,t){return J.access(this,J.prop,e,t,arguments.length>1)},removeProp:function(e){return e=J.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(e){}})},addClass:function(e){var t,r,n,o,i,s,a;if(J.isFunction(e))return this.each(function(t){J(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(ee),r=0,n=this.length;r<n;r++)if(1===(o=this[r]).nodeType)if(o.className||1!==t.length){for(i=" "+o.className+" ",s=0,a=t.length;s<a;s++)i.indexOf(" "+t[s]+" ")<0&&(i+=t[s]+" ");o.className=J.trim(i)}else o.className=e;return this},removeClass:function(e){var r,n,o,i,s,a,l;if(J.isFunction(e))return this.each(function(t){J(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===t)for(r=(e||"").split(ee),a=0,l=this.length;a<l;a++)if(1===(o=this[a]).nodeType&&o.className){for(n=(" "+o.className+" ").replace(be," "),i=0,s=r.length;i<s;i++)for(;n.indexOf(" "+r[i]+" ")>=0;)n=n.replace(" "+r[i]+" "," ");o.className=e?J.trim(n):""}return this},toggleClass:function(e,t){var r=typeof e,n="boolean"==typeof t;return J.isFunction(e)?this.each(function(r){J(this).toggleClass(e.call(this,r,this.className,t),t)}):this.each(function(){if("string"===r)for(var o,i=0,s=J(this),a=t,l=e.split(ee);o=l[i++];)a=n?a:!s.hasClass(o),s[a?"addClass":"removeClass"](o);else"undefined"!==r&&"boolean"!==r||(this.className&&J._data(this,"__className__",this.className),this.className=this.className||!1===e?"":J._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",r=0,n=this.length;r<n;r++)if(1===this[r].nodeType&&(" "+this[r].className+" ").replace(be," ").indexOf(t)>=0)return!0;return!1},val:function(e){var r,n,o,i=this[0];{if(arguments.length)return o=J.isFunction(e),this.each(function(n){var i,s=J(this);1===this.nodeType&&(null==(i=o?e.call(this,n,s.val()):e)?i="":"number"==typeof i?i+="":J.isArray(i)&&(i=J.map(i,function(e){return null==e?"":e+""})),(r=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&r.set(this,i,"value")!==t||(this.value=i))});if(i)return(r=J.valHooks[i.type]||J.valHooks[i.nodeName.toLowerCase()])&&"get"in r&&(n=r.get(i,"value"))!==t?n:"string"==typeof(n=i.value)?n.replace(Se,""):null==n?"":n}}}),J.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,r,n,o,i=e.selectedIndex,s=[],a=e.options,l="select-one"===e.type;if(i<0)return null;for(r=l?i:0,n=l?i+1:a.length;r<n;r++)if((o=a[r]).selected&&(J.support.optDisabled?!o.disabled:null===o.getAttribute("disabled"))&&(!o.parentNode.disabled||!J.nodeName(o.parentNode,"optgroup"))){if(t=J(o).val(),l)return t;s.push(t)}return l&&!s.length&&a.length?J(a[i]).val():s},set:function(e,t){var r=J.makeArray(t);return J(e).find("option").each(function(){this.selected=J.inArray(J(this).val(),r)>=0}),r.length||(e.selectedIndex=-1),r}}},attrFn:{},attr:function(e,r,n,o){var i,s,a,l=e.nodeType;if(e&&3!==l&&8!==l&&2!==l)return o&&J.isFunction(J.fn[r])?J(e)[r](n):void 0===e.getAttribute?J.prop(e,r,n):((a=1!==l||!J.isXMLDoc(e))&&(r=r.toLowerCase(),s=J.attrHooks[r]||(Pe.test(r)?ve:ge)),n!==t?null===n?void J.removeAttr(e,r):s&&"set"in s&&a&&(i=s.set(e,n,r))!==t?i:(e.setAttribute(r,n+""),n):s&&"get"in s&&a&&null!==(i=s.get(e,r))?i:null===(i=e.getAttribute(r))?t:i)},removeAttr:function(e,t){var r,n,o,i,s=0;if(t&&1===e.nodeType)for(n=t.split(ee);s<n.length;s++)(o=n[s])&&(r=J.propFix[o]||o,(i=Pe.test(o))||J.attr(e,o,""),e.removeAttribute(Te?o:r),i&&r in e&&(e[r]=!1))},attrHooks:{type:{set:function(e,t){if(we.test(e.nodeName)&&e.parentNode)J.error("type property can't be changed");else if(!J.support.radioValue&&"radio"===t&&J.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}},value:{get:function(e,t){return ge&&J.nodeName(e,"button")?ge.get(e,t):t in e?e.value:null},set:function(e,t,r){if(ge&&J.nodeName(e,"button"))return ge.set(e,t,r);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,r,n){var o,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return(1!==s||!J.isXMLDoc(e))&&(r=J.propFix[r]||r,i=J.propHooks[r]),n!==t?i&&"set"in i&&(o=i.set(e,n,r))!==t?o:e[r]=n:i&&"get"in i&&null!==(o=i.get(e,r))?o:e[r]},propHooks:{tabIndex:{get:function(e){var r=e.getAttributeNode("tabindex");return r&&r.specified?parseInt(r.value,10):Ee.test(e.nodeName)||Ce.test(e.nodeName)&&e.href?0:t}}}}),ve={get:function(e,r){var n,o=J.prop(e,r);return!0===o||"boolean"!=typeof o&&(n=e.getAttributeNode(r))&&!1!==n.nodeValue?r.toLowerCase():t},set:function(e,t,r){var n;return!1===t?J.removeAttr(e,r):((n=J.propFix[r]||r)in e&&(e[n]=!0),e.setAttribute(r,r.toLowerCase())),r}},Te||(ye={name:!0,id:!0,coords:!0},ge=J.valHooks.button={get:function(e,r){var n;return(n=e.getAttributeNode(r))&&(ye[r]?""!==n.value:n.specified)?n.value:t},set:function(e,t,r){var n=e.getAttributeNode(r);return n||(n=j.createAttribute(r),e.setAttributeNode(n)),n.value=t+""}},J.each(["width","height"],function(e,t){J.attrHooks[t]=J.extend(J.attrHooks[t],{set:function(e,r){if(""===r)return e.setAttribute(t,"auto"),r}})}),J.attrHooks.contenteditable={get:ge.get,set:function(e,t,r){""===t&&(t="false"),ge.set(e,t,r)}}),J.support.hrefNormalized||J.each(["href","src","width","height"],function(e,r){J.attrHooks[r]=J.extend(J.attrHooks[r],{get:function(e){var n=e.getAttribute(r,2);return null===n?t:n}})}),J.support.style||(J.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),J.support.optSelected||(J.propHooks.selected=J.extend(J.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),J.support.enctype||(J.propFix.enctype="encoding"),J.support.checkOn||J.each(["radio","checkbox"],function(){J.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]=J.extend(J.valHooks[this],{set:function(e,t){if(J.isArray(t))return e.checked=J.inArray(J(e).val(),t)>=0}})});var Ie=/^(?:textarea|input|select)$/i,Re=/^([^\.]*|)(?:\.(.+)|)$/,_e=/(?:^|\s)hover(\.\S+|)\b/,xe=/^key/,Me=/^(?:mouse|contextmenu)|click/,Ue=/^(?:focusinfocus|focusoutblur)$/,Ae=function(e){return J.event.special.hover?e:e.replace(_e,"mouseenter$1 mouseleave$1")};J.event={add:function(e,r,n,o,i){var s,a,l,u,c,d,p,f,h,m,g;if(3!==e.nodeType&&8!==e.nodeType&&r&&n&&(s=J._data(e))){for(n.handler&&(h=n,n=h.handler,i=h.selector),n.guid||(n.guid=J.guid++),(l=s.events)||(s.events=l={}),(a=s.handle)||(s.handle=a=function(e){return void 0===J||e&&J.event.triggered===e.type?t:J.event.dispatch.apply(a.elem,arguments)},a.elem=e),r=J.trim(Ae(r)).split(" "),u=0;u<r.length;u++)d=(c=Re.exec(r[u])||[])[1],p=(c[2]||"").split(".").sort(),g=J.event.special[d]||{},d=(i?g.delegateType:g.bindType)||d,g=J.event.special[d]||{},f=J.extend({type:d,origType:c[1],data:o,handler:n,guid:n.guid,selector:i,needsContext:i&&J.expr.match.needsContext.test(i),namespace:p.join(".")},h),(m=l[d])||((m=l[d]=[]).delegateCount=0,g.setup&&!1!==g.setup.call(e,o,p,a)||(e.addEventListener?e.addEventListener(d,a,!1):e.attachEvent&&e.attachEvent("on"+d,a))),g.add&&(g.add.call(e,f),f.handler.guid||(f.handler.guid=n.guid)),i?m.splice(m.delegateCount++,0,f):m.push(f),J.event.global[d]=!0;e=null}},global:{},remove:function(e,t,r,n,o){var i,s,a,l,u,c,d,p,f,h,m,g=J.hasData(e)&&J._data(e);if(g&&(p=g.events)){for(t=J.trim(Ae(t||"")).split(" "),i=0;i<t.length;i++)if(s=Re.exec(t[i])||[],a=l=s[1],u=s[2],a){for(f=J.event.special[a]||{},c=(h=p[a=(n?f.delegateType:f.bindType)||a]||[]).length,u=u?new RegExp("(^|\\.)"+u.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d=0;d<h.length;d++)m=h[d],(o||l===m.origType)&&(!r||r.guid===m.guid)&&(!u||u.test(m.namespace))&&(!n||n===m.selector||"**"===n&&m.selector)&&(h.splice(d--,1),m.selector&&h.delegateCount--,f.remove&&f.remove.call(e,m));0===h.length&&c!==h.length&&((!f.teardown||!1===f.teardown.call(e,u,g.handle))&&J.removeEvent(e,a,g.handle),delete p[a])}else for(a in p)J.event.remove(e,a+t[i],r,n,!0);J.isEmptyObject(p)&&(delete g.handle,J.removeData(e,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(r,n,o,i){if(!o||3!==o.nodeType&&8!==o.nodeType){var s,a,l,u,c,d,p,f,h,m,g=r.type||r,v=[];if(Ue.test(g+J.event.triggered))return;if(g.indexOf("!")>=0&&(g=g.slice(0,-1),a=!0),g.indexOf(".")>=0&&(v=g.split("."),g=v.shift(),v.sort()),(!o||J.event.customEvent[g])&&!J.event.global[g])return;if(r="object"==typeof r?r[J.expando]?r:new J.Event(g,r):new J.Event(g),r.type=g,r.isTrigger=!0,r.exclusive=a,r.namespace=v.join("."),r.namespace_re=r.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d=g.indexOf(":")<0?"on"+g:"",!o){s=J.cache;for(l in s)s[l].events&&s[l].events[g]&&J.event.trigger(r,n,s[l].handle.elem,!0);return}if(r.result=t,r.target||(r.target=o),(n=null!=n?J.makeArray(n):[]).unshift(r),(p=J.event.special[g]||{}).trigger&&!1===p.trigger.apply(o,n))return;if(h=[[o,p.bindType||g]],!i&&!p.noBubble&&!J.isWindow(o)){for(m=p.delegateType||g,u=Ue.test(m+g)?o:o.parentNode,c=o;u;u=u.parentNode)h.push([u,m]),c=u;c===(o.ownerDocument||j)&&h.push([c.defaultView||c.parentWindow||e,m])}for(l=0;l<h.length&&!r.isPropagationStopped();l++)u=h[l][0],r.type=h[l][1],(f=(J._data(u,"events")||{})[r.type]&&J._data(u,"handle"))&&f.apply(u,n),(f=d&&u[d])&&J.acceptData(u)&&f.apply&&!1===f.apply(u,n)&&r.preventDefault();return r.type=g,!i&&!r.isDefaultPrevented()&&(!p._default||!1===p._default.apply(o.ownerDocument,n))&&("click"!==g||!J.nodeName(o,"a"))&&J.acceptData(o)&&d&&o[g]&&("focus"!==g&&"blur"!==g||0!==r.target.offsetWidth)&&!J.isWindow(o)&&((c=o[d])&&(o[d]=null),J.event.triggered=g,o[g](),J.event.triggered=t,c&&(o[d]=c)),r.result}},dispatch:function(r){r=J.event.fix(r||e.event);var n,o,i,s,a,l,u,c,d,p=(J._data(this,"events")||{})[r.type]||[],f=p.delegateCount,h=Y.call(arguments),m=!r.exclusive&&!r.namespace,g=J.event.special[r.type]||{},v=[];if(h[0]=r,r.delegateTarget=this,!g.preDispatch||!1!==g.preDispatch.call(this,r)){if(f&&(!r.button||"click"!==r.type))for(i=r.target;i!=this;i=i.parentNode||this)if(!0!==i.disabled||"click"!==r.type){for(a={},u=[],n=0;n<f;n++)c=p[n],d=c.selector,a[d]===t&&(a[d]=c.needsContext?J(d,this).index(i)>=0:J.find(d,this,null,[i]).length),a[d]&&u.push(c);u.length&&v.push({elem:i,matches:u})}for(p.length>f&&v.push({elem:this,matches:p.slice(f)}),n=0;n<v.length&&!r.isPropagationStopped();n++)for(l=v[n],r.currentTarget=l.elem,o=0;o<l.matches.length&&!r.isImmediatePropagationStopped();o++)c=l.matches[o],(m||!r.namespace&&!c.namespace||r.namespace_re&&r.namespace_re.test(c.namespace))&&(r.data=c.data,r.handleObj=c,(s=((J.event.special[c.origType]||{}).handle||c.handler).apply(l.elem,h))!==t&&(r.result=s,!1===s&&(r.preventDefault(),r.stopPropagation())));return g.postDispatch&&g.postDispatch.call(this,r),r.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var n,o,i,s=r.button,a=r.fromElement;return null==e.pageX&&null!=r.clientX&&(n=e.target.ownerDocument||j,o=n.documentElement,i=n.body,e.pageX=r.clientX+(o&&o.scrollLeft||i&&i.scrollLeft||0)-(o&&o.clientLeft||i&&i.clientLeft||0),e.pageY=r.clientY+(o&&o.scrollTop||i&&i.scrollTop||0)-(o&&o.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?r.toElement:a),!e.which&&s!==t&&(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[J.expando])return e;var t,r,n=e,o=J.event.fixHooks[e.type]||{},i=o.props?this.props.concat(o.props):this.props;for(e=J.Event(n),t=i.length;t;)r=i[--t],e[r]=n[r];return e.target||(e.target=n.srcElement||j),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,n):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,r){J.isWindow(this)&&(this.onbeforeunload=r)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,r,n){var o=J.extend(new J.Event,r,{type:e,isSimulated:!0,originalEvent:{}});n?J.event.trigger(o,null,t):J.event.dispatch.call(t,o),o.isDefaultPrevented()&&r.preventDefault()}},J.event.handle=J.event.dispatch,J.removeEvent=j.removeEventListener?function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r,!1)}:function(e,t,r){var n="on"+t;e.detachEvent&&(void 0===e[n]&&(e[n]=null),e.detachEvent(n,r))},J.Event=function(e,t){if(!(this instanceof J.Event))return new J.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?s:i):this.type=e,t&&J.extend(this,t),this.timeStamp=e&&e.timeStamp||J.now(),this[J.expando]=!0},J.Event.prototype={preventDefault:function(){this.isDefaultPrevented=s;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=s;var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=s,this.stopPropagation()},isDefaultPrevented:i,isPropagationStopped:i,isImmediatePropagationStopped:i},J.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){J.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,n=this,o=e.relatedTarget,i=e.handleObj;i.selector;return o&&(o===n||J.contains(n,o))||(e.type=i.origType,r=i.handler.apply(this,arguments),e.type=t),r}}}),J.support.submitBubbles||(J.event.special.submit={setup:function(){if(J.nodeName(this,"form"))return!1;J.event.add(this,"click._submit keypress._submit",function(e){var r=e.target,n=J.nodeName(r,"input")||J.nodeName(r,"button")?r.form:t;n&&!J._data(n,"_submit_attached")&&(J.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),J._data(n,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&J.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(J.nodeName(this,"form"))return!1;J.event.remove(this,"._submit")}}),J.support.changeBubbles||(J.event.special.change={setup:function(){if(Ie.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(J.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),J.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),J.event.simulate("change",this,e,!0)})),!1;J.event.add(this,"beforeactivate._change",function(e){var t=e.target;Ie.test(t.nodeName)&&!J._data(t,"_change_attached")&&(J.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&J.event.simulate("change",this.parentNode,e,!0)}),J._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return J.event.remove(this,"._change"),!Ie.test(this.nodeName)}}),J.support.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,n=function(e){J.event.simulate(t,e.target,J.event.fix(e),!0)};J.event.special[t]={setup:function(){0==r++&&j.addEventListener(e,n,!0)},teardown:function(){0==--r&&j.removeEventListener(e,n,!0)}}}),J.fn.extend({on:function(e,r,n,o,s){var a,l;if("object"==typeof e){"string"!=typeof r&&(n=n||r,r=t);for(l in e)this.on(l,r,n,e[l],s);return this}if(null==n&&null==o?(o=r,n=r=t):null==o&&("string"==typeof r?(o=n,n=t):(o=n,n=r,r=t)),!1===o)o=i;else if(!o)return this;return 1===s&&(a=o,o=function(e){return J().off(e),a.apply(this,arguments)},o.guid=a.guid||(a.guid=J.guid++)),this.each(function(){J.event.add(this,e,o,n,r)})},one:function(e,t,r,n){return this.on(e,t,r,n,1)},off:function(e,r,n){var o,s;if(e&&e.preventDefault&&e.handleObj)return o=e.handleObj,J(e.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"==typeof e){for(s in e)this.off(s,r,e[s]);return this}return!1!==r&&"function"!=typeof r||(n=r,r=t),!1===n&&(n=i),this.each(function(){J.event.remove(this,e,n,r)})},bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,r){return J(this.context).on(e,this.selector,t,r),this},die:function(e,t){return J(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,r,n){return this.on(t,e,r,n)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)},trigger:function(e,t){return this.each(function(){J.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return J.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,r=e.guid||J.guid++,n=0,o=function(r){var o=(J._data(this,"lastToggle"+e.guid)||0)%n;return J._data(this,"lastToggle"+e.guid,o+1),r.preventDefault(),t[o].apply(this,arguments)||!1};for(o.guid=r;n<t.length;)t[n++].guid=r;return this.click(o)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){J.fn[t]=function(e,r){return null==r&&(r=e,e=null),arguments.length>0?this.on(t,null,e,r):this.trigger(t)},xe.test(t)&&(J.event.fixHooks[t]=J.event.keyHooks),Me.test(t)&&(J.event.fixHooks[t]=J.event.mouseHooks)}),function(e,t){function r(e,t,r,n){r=r||[];var o,i,s,a,l=(t=t||U).nodeType;if(!e||"string"!=typeof e)return r;if(1!==l&&9!==l)return[];if(!(s=w(t))&&!n&&(o=te.exec(e)))if(a=o[1]){if(9===l){if(!(i=t.getElementById(a))||!i.parentNode)return r;if(i.id===a)return r.push(i),r}else if(t.ownerDocument&&(i=t.ownerDocument.getElementById(a))&&E(t,i)&&i.id===a)return r.push(i),r}else{if(o[2])return O.apply(r,N.call(t.getElementsByTagName(e),0)),r;if((a=o[3])&&de&&t.getElementsByClassName)return O.apply(r,N.call(t.getElementsByClassName(a),0)),r}return m(e.replace(K,"$1"),t,r,n,s)}function n(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function o(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function i(e){return B(function(t){return t=+t,B(function(r,n){for(var o,i=e([],r.length,t),s=i.length;s--;)r[o=i[s]]&&(r[o]=!(n[o]=r[o]))})})}function s(e,t,r){if(e===t)return r;for(var n=e.nextSibling;n;){if(n===t)return-1;n=n.nextSibling}return 1}function a(e,t){var n,o,i,s,a,l,u,c=W[x][e];if(c)return t?0:c.slice(0);for(a=e,l=[],u=b.preFilter;a;){n&&!(o=Q.exec(a))||(o&&(a=a.slice(o[0].length)),l.push(i=[])),n=!1,(o=Z.exec(a))&&(i.push(n=new M(o.shift())),a=a.slice(n.length),n.type=o[0].replace(K," "));for(s in b.filter)(o=se[s].exec(a))&&(!u[s]||(o=u[s](o,U,!0)))&&(i.push(n=new M(o.shift())),a=a.slice(n.length),n.type=s,n.matches=o);if(!n)break}return t?a.length:a?r.error(e):W(e,l).slice(0)}function l(e,t,r){var n=t.dir,o=r&&"parentNode"===t.dir,i=k++;return t.first?function(t,r,i){for(;t=t[n];)if(o||1===t.nodeType)return e(t,r,i)}:function(t,r,s){if(s){for(;t=t[n];)if((o||1===t.nodeType)&&e(t,r,s))return t}else for(var a,l=L+" "+i+" ",u=l+v;t=t[n];)if(o||1===t.nodeType){if((a=t[x])===u)return t.sizset;if("string"==typeof a&&0===a.indexOf(l)){if(t.sizset)return t}else{if(t[x]=u,e(t,r,s))return t.sizset=!0,t;t.sizset=!1}}}}function u(e){return e.length>1?function(t,r,n){for(var o=e.length;o--;)if(!e[o](t,r,n))return!1;return!0}:e[0]}function c(e,t,r,n,o){for(var i,s=[],a=0,l=e.length,u=null!=t;a<l;a++)(i=e[a])&&(r&&!r(i,n,o)||(s.push(i),u&&t.push(a)));return s}function d(e,t,r,n,o,i){return n&&!n[x]&&(n=d(n)),o&&!o[x]&&(o=d(o,i)),B(function(i,s,a,l){if(!i||!o){var u,d,p,f=[],m=[],g=s.length,v=i||h(t||"*",a.nodeType?[a]:a,[],i),y=!e||!i&&t?v:c(v,f,e,a,l),b=r?o||(i?e:g||n)?[]:s:y;if(r&&r(y,b,a,l),n)for(p=c(b,m),n(p,[],a,l),u=p.length;u--;)(d=p[u])&&(b[m[u]]=!(y[m[u]]=d));if(i)for(u=e&&b.length;u--;)(d=b[u])&&(i[f[u]]=!(s[f[u]]=d));else b=c(b===s?b.splice(g,b.length):b),o?o(null,s,b,l):O.apply(s,b)}})}function p(e){for(var t,r,n,o=e.length,i=b.relative[e[0].type],s=i||b.relative[" "],a=i?1:0,c=l(function(e){return e===t},s,!0),f=l(function(e){return F.call(t,e)>-1},s,!0),h=[function(e,r,n){return!i&&(n||r!==I)||((t=r).nodeType?c(e,r,n):f(e,r,n))}];a<o;a++)if(r=b.relative[e[a].type])h=[l(u(h),r)];else{if((r=b.filter[e[a].type].apply(null,e[a].matches))[x]){for(n=++a;n<o&&!b.relative[e[n].type];n++);return d(a>1&&u(h),a>1&&e.slice(0,a-1).join("").replace(K,"$1"),r,a<n&&p(e.slice(a,n)),n<o&&p(e=e.slice(n)),n<o&&e.join(""))}h.push(r)}return u(h)}function f(e,t){var n=t.length>0,o=e.length>0,i=function(s,a,l,u,d){var p,f,h,m=[],g=0,y="0",S=s&&[],w=null!=d,E=I,C=s||o&&b.find.TAG("*",d&&a.parentNode||a),P=L+=null==E?1:Math.E;for(w&&(I=a!==U&&a,v=i.el);null!=(p=C[y]);y++){if(o&&p){for(f=0;h=e[f];f++)if(h(p,a,l)){u.push(p);break}w&&(L=P,v=++i.el)}n&&((p=!h&&p)&&g--,s&&S.push(p))}if(g+=y,n&&y!==g){for(f=0;h=t[f];f++)h(S,m,a,l);if(s){if(g>0)for(;y--;)!S[y]&&!m[y]&&(m[y]=D.call(u));m=c(m)}O.apply(u,m),w&&!s&&m.length>0&&g+t.length>1&&r.uniqueSort(u)}return w&&(L=P,I=E),S};return i.el=0,n?B(i):i}function h(e,t,n,o){for(var i=0,s=t.length;i<s;i++)r(e,t[i],n,o);return n}function m(e,t,r,n,o){var i,s,l,u,c,d=a(e);d.length;if(!n&&1===d.length){if((s=d[0]=d[0].slice(0)).length>2&&"ID"===(l=s[0]).type&&9===t.nodeType&&!o&&b.relative[s[1].type]){if(!(t=b.find.ID(l.matches[0].replace(ie,""),t,o)[0]))return r;e=e.slice(s.shift().length)}for(i=se.POS.test(e)?-1:s.length-1;i>=0&&(l=s[i],!b.relative[u=l.type]);i--)if((c=b.find[u])&&(n=c(l.matches[0].replace(ie,""),re.test(s[0].type)&&t.parentNode||t,o))){if(s.splice(i,1),!(e=n.length&&s.join("")))return O.apply(r,N.call(n,0)),r;break}}return C(e,d)(n,t,o,r,re.test(e)),r}function g(){}var v,y,b,S,w,E,C,P,T,I,R=!0,_="undefined",x=("sizcache"+Math.random()).replace(".",""),M=String,U=e.document,A=U.documentElement,L=0,k=0,D=[].pop,O=[].push,N=[].slice,F=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(this[t]===e)return t;return-1},B=function(e,t){return e[x]=null==t||t,e},j=function(){var e={},t=[];return B(function(r,n){return t.push(r)>b.cacheLength&&delete e[t.shift()],e[r]=n},e)},V=j(),W=j(),q=j(),H="[\\x20\\t\\r\\n\\f]",G="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",Y=G.replace("w","w#"),z="\\["+H+"*("+G+")"+H+"*(?:([*^$|!~]?=)"+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+Y+")|)|)"+H+"*\\]",$=":("+G+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+z+")|[^:]|\\\\.)*|.*))\\)|)",X=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)",K=new RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),Q=new RegExp("^"+H+"*,"+H+"*"),Z=new RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),ee=new RegExp($),te=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,re=/[\x20\t\r\n\f]*[+~]/,ne=/h\d/i,oe=/input|select|textarea|button/i,ie=/\\(?!\\)/g,se={ID:new RegExp("^#("+G+")"),CLASS:new RegExp("^\\.("+G+")"),NAME:new RegExp("^\\[name=['\"]?("+G+")['\"]?\\]"),TAG:new RegExp("^("+G.replace("w","w*")+")"),ATTR:new RegExp("^"+z),PSEUDO:new RegExp("^"+$),POS:new RegExp(X,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:new RegExp("^"+H+"*[>+~]|"+X,"i")},ae=function(e){var t=U.createElement("div");try{return e(t)}catch(e){return!1}finally{t=null}},le=ae(function(e){return e.appendChild(U.createComment("")),!e.getElementsByTagName("*").length}),ue=ae(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==_&&"#"===e.firstChild.getAttribute("href")}),ce=ae(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),de=ae(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),pe=ae(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",A.insertBefore(e,A.firstChild);var t=U.getElementsByName&&U.getElementsByName(x).length===2+U.getElementsByName(x+0).length;return y=!U.getElementById(x),A.removeChild(e),t});try{N.call(A.childNodes,0)[0].nodeType}catch(e){N=function(e){for(var t,r=[];t=this[e];e++)r.push(t);return r}}r.matches=function(e,t){return r(e,null,null,t)},r.matchesSelector=function(e,t){return r(t,null,null,[e]).length>0},S=r.getText=function(e){var t,r="",n=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=S(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[n];n++)r+=S(t);return r},w=r.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},E=r.contains=A.contains?function(e,t){var r=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!!(n&&1===n.nodeType&&r.contains&&r.contains(n))}:A.compareDocumentPosition?function(e,t){return t&&!!(16&e.compareDocumentPosition(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},r.attr=function(e,t){var r,n=w(e);return n||(t=t.toLowerCase()),(r=b.attrHandle[t])?r(e):n||ce?e.getAttribute(t):(r=e.getAttributeNode(t))?"boolean"==typeof e[t]?e[t]?t:null:r.specified?r.value:null:null},b=r.selectors={cacheLength:50,createPseudo:B,match:se,attrHandle:ue?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:y?function(e,t,r){if(typeof t.getElementById!==_&&!r){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}}:function(e,t,r){if(typeof t.getElementById!==_&&!r){var n=t.getElementById(e);return n?n.id===e||typeof n.getAttributeNode!==_&&n.getAttributeNode("id").value===e?[n]:void 0:[]}},TAG:le?function(e,t){if(typeof t.getElementsByTagName!==_)return t.getElementsByTagName(e)}:function(e,t){var r=t.getElementsByTagName(e);if("*"===e){for(var n,o=[],i=0;n=r[i];i++)1===n.nodeType&&o.push(n);return o}return r},NAME:pe&&function(e,t){if(typeof t.getElementsByName!==_)return t.getElementsByName(name)},CLASS:de&&function(e,t,r){if(typeof t.getElementsByClassName!==_&&!r)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ie,""),e[3]=(e[4]||e[5]||"").replace(ie,""),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1]?(e[2]||r.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*("even"===e[2]||"odd"===e[2])),e[4]=+(e[6]+e[7]||"odd"===e[2])):e[2]&&r.error(e[0]),e},PSEUDO:function(e){var t,r;return se.CHILD.test(e[0])?null:(e[3]?e[2]=e[3]:(t=e[4])&&(ee.test(t)&&(r=a(t,!0))&&(r=t.indexOf(")",t.length-r)-t.length)&&(t=t.slice(0,r),e[0]=e[0].slice(0,r)),e[2]=t),e.slice(0,3))}},filter:{ID:y?function(e){return e=e.replace(ie,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace(ie,""),function(t){var r=typeof t.getAttributeNode!==_&&t.getAttributeNode("id");return r&&r.value===e}},TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(ie,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=V[x][e];return t||(t=V(e,new RegExp("(^|"+H+")"+e+"("+H+"|$)"))),function(e){return t.test(e.className||typeof e.getAttribute!==_&&e.getAttribute("class")||"")}},ATTR:function(e,t,n){return function(o,i){var s=r.attr(o,e);return null==s?"!="===t:!t||(s+="","="===t?s===n:"!="===t?s!==n:"^="===t?n&&0===s.indexOf(n):"*="===t?n&&s.indexOf(n)>-1:"$="===t?n&&s.substr(s.length-n.length)===n:"~="===t?(" "+s+" ").indexOf(n)>-1:"|="===t&&(s===n||s.substr(0,n.length+1)===n+"-"))}},CHILD:function(e,t,r,n){return"nth"===e?function(e){var t,o,i=e.parentNode;if(1===r&&0===n)return!0;if(i)for(o=0,t=i.firstChild;t&&(1!==t.nodeType||(o++,e!==t));t=t.nextSibling);return(o-=n)===r||o%r==0&&o/r>=0}:function(t){var r=t;switch(e){case"only":case"first":for(;r=r.previousSibling;)if(1===r.nodeType)return!1;if("first"===e)return!0;r=t;case"last":for(;r=r.nextSibling;)if(1===r.nodeType)return!1;return!0}}},PSEUDO:function(e,t){var n,o=b.pseudos[e]||b.setFilters[e.toLowerCase()]||r.error("unsupported pseudo: "+e);return o[x]?o(t):o.length>1?(n=[e,e,"",t],b.setFilters.hasOwnProperty(e.toLowerCase())?B(function(e,r){for(var n,i=o(e,t),s=i.length;s--;)n=F.call(e,i[s]),e[n]=!(r[n]=i[s])}):function(e){return o(e,0,n)}):o}},pseudos:{not:B(function(e){var t=[],r=[],n=C(e.replace(K,"$1"));return n[x]?B(function(e,t,r,o){for(var i,s=n(e,null,o,[]),a=e.length;a--;)(i=s[a])&&(e[a]=!(t[a]=i))}):function(e,o,i){return t[0]=e,n(t,null,i,r),!r.pop()}}),has:B(function(e){return function(t){return r(e,t).length>0}}),contains:B(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!b.pseudos.empty(e)},empty:function(e){var t;for(e=e.firstChild;e;){if(e.nodeName>"@"||3===(t=e.nodeType)||4===t)return!1;e=e.nextSibling}return!0},header:function(e){return ne.test(e.nodeName)},text:function(e){var t,r;return"input"===e.nodeName.toLowerCase()&&"text"===(t=e.type)&&(null==(r=e.getAttribute("type"))||r.toLowerCase()===t)},radio:n("radio"),checkbox:n("checkbox"),file:n("file"),password:n("password"),image:n("image"),submit:o("submit"),reset:o("reset"),button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return oe.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&(!!e.type||!!e.href)},active:function(e){return e===e.ownerDocument.activeElement},first:i(function(e,t,r){return[0]}),last:i(function(e,t,r){return[t-1]}),eq:i(function(e,t,r){return[r<0?r+t:r]}),even:i(function(e,t,r){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:i(function(e,t,r){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:i(function(e,t,r){for(var n=r<0?r+t:r;--n>=0;)e.push(n);return e}),gt:i(function(e,t,r){for(var n=r<0?r+t:r;++n<t;)e.push(n);return e})}},P=A.compareDocumentPosition?function(e,t){return e===t?(T=!0,0):(e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t):e.compareDocumentPosition)?-1:1}:function(e,t){if(e===t)return T=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var r,n,o=[],i=[],a=e.parentNode,l=t.parentNode,u=a;if(a===l)return s(e,t);if(!a)return-1;if(!l)return 1;for(;u;)o.unshift(u),u=u.parentNode;for(u=l;u;)i.unshift(u),u=u.parentNode;r=o.length,n=i.length;for(var c=0;c<r&&c<n;c++)if(o[c]!==i[c])return s(o[c],i[c]);return c===r?s(e,i[c],-1):s(o[c],t,1)},[0,0].sort(P),R=!T,r.uniqueSort=function(e){var t,r=1;if(T=R,e.sort(P),T)for(;t=e[r];r++)t===e[r-1]&&e.splice(r--,1);return e},r.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},C=r.compile=function(e,t){var r,n=[],o=[],i=q[x][e];if(!i){for(t||(t=a(e)),r=t.length;r--;)(i=p(t[r]))[x]?n.push(i):o.push(i);i=q(e,f(o,n))}return i},U.querySelectorAll&&function(){var e,t=m,n=/'|\\/g,o=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active",":focus"],l=A.matchesSelector||A.mozMatchesSelector||A.webkitMatchesSelector||A.oMatchesSelector||A.msMatchesSelector;ae(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),ae(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+H+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),m=function(e,r,o,s,l){if(!(s||l||i&&i.test(e))){var u,c,d=!0,p=x,f=r,h=9===r.nodeType&&e;if(1===r.nodeType&&"object"!==r.nodeName.toLowerCase()){for(u=a(e),(d=r.getAttribute("id"))?p=d.replace(n,"\\$&"):r.setAttribute("id",p),p="[id='"+p+"'] ",c=u.length;c--;)u[c]=p+u[c].join("");f=re.test(e)&&r.parentNode||r,h=u.join(",")}if(h)try{return O.apply(o,N.call(f.querySelectorAll(h),0)),o}catch(e){}finally{d||r.removeAttribute("id")}}return t(e,r,o,s,l)},l&&(ae(function(t){e=l.call(t,"div");try{l.call(t,"[test!='']:sizzle"),s.push("!=",$)}catch(e){}}),s=new RegExp(s.join("|")),r.matchesSelector=function(t,n){if(n=n.replace(o,"='$1']"),!(w(t)||s.test(n)||i&&i.test(n)))try{var a=l.call(t,n);if(a||e||t.document&&11!==t.document.nodeType)return a}catch(e){}return r(n,null,null,[t]).length>0})}(),b.pseudos.nth=b.pseudos.eq,b.filters=g.prototype=b.pseudos,b.setFilters=new g,r.attr=J.attr,J.find=r,J.expr=r.selectors,J.expr[":"]=J.expr.pseudos,J.unique=r.uniqueSort,J.text=r.getText,J.isXMLDoc=r.isXML,J.contains=r.contains}(e);var Le=/Until$/,ke=/^(?:parents|prev(?:Until|All))/,De=/^.[^:#\[\.,]*$/,Oe=J.expr.match.needsContext,Ne={children:!0,contents:!0,next:!0,prev:!0};J.fn.extend({find:function(e){var t,r,n,o,i,s,a=this;if("string"!=typeof e)return J(e).filter(function(){for(t=0,r=a.length;t<r;t++)if(J.contains(a[t],this))return!0});for(s=this.pushStack("","find",e),t=0,r=this.length;t<r;t++)if(n=s.length,J.find(e,this[t],s),t>0)for(o=n;o<s.length;o++)for(i=0;i<n;i++)if(s[i]===s[o]){s.splice(o--,1);break}return s},has:function(e){var t,r=J(e,this),n=r.length;return this.filter(function(){for(t=0;t<n;t++)if(J.contains(this,r[t]))return!0})},not:function(e){return this.pushStack(u(this,e,!1),"not",e)},filter:function(e){return this.pushStack(u(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?Oe.test(e)?J(e,this.context).index(this[0])>=0:J.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var r,n=0,o=this.length,i=[],s=Oe.test(e)||"string"!=typeof e?J(e,t||this.context):0;n<o;n++)for(r=this[n];r&&r.ownerDocument&&r!==t&&11!==r.nodeType;){if(s?s.index(r)>-1:J.find.matchesSelector(r,e)){i.push(r);break}r=r.parentNode}return i=i.length>1?J.unique(i):i,this.pushStack(i,"closest",e)},index:function(e){return e?"string"==typeof e?J.inArray(this[0],J(e)):J.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var r="string"==typeof e?J(e,t):J.makeArray(e&&e.nodeType?[e]:e),n=J.merge(this.get(),r);return this.pushStack(a(r[0])||a(n[0])?n:J.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),J.fn.andSelf=J.fn.addBack,J.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return J.dir(e,"parentNode")},parentsUntil:function(e,t,r){return J.dir(e,"parentNode",r)},next:function(e){return l(e,"nextSibling")},prev:function(e){return l(e,"previousSibling")},nextAll:function(e){return J.dir(e,"nextSibling")},prevAll:function(e){return J.dir(e,"previousSibling")},nextUntil:function(e,t,r){return J.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return J.dir(e,"previousSibling",r)},siblings:function(e){return J.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return J.sibling(e.firstChild)},contents:function(e){return J.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:J.merge([],e.childNodes)}},function(e,t){J.fn[e]=function(r,n){var o=J.map(this,t,r);return Le.test(e)||(n=r),n&&"string"==typeof n&&(o=J.filter(n,o)),o=this.length>1&&!Ne[e]?J.unique(o):o,this.length>1&&ke.test(e)&&(o=o.reverse()),this.pushStack(o,e,Y.call(arguments).join(","))}}),J.extend({filter:function(e,t,r){return r&&(e=":not("+e+")"),1===t.length?J.find.matchesSelector(t[0],e)?[t[0]]:[]:J.find.matches(e,t)},dir:function(e,r,n){for(var o=[],i=e[r];i&&9!==i.nodeType&&(n===t||1!==i.nodeType||!J(i).is(n));)1===i.nodeType&&o.push(i),i=i[r];return o},sibling:function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}});var Fe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Be=/ jQuery\d+="(?:null|\d+)"/g,je=/^\s+/,Ve=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,We=/<([\w:]+)/,qe=/<tbody/i,He=/<|&#?\w+;/,Ge=/<(?:script|style|link)/i,Ye=/<(?:script|object|embed|option|style)/i,ze=new RegExp("<(?:"+Fe+")[\\s/>]","i"),$e=/^(?:checkbox|radio)$/,Xe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ke=/\/(java|ecma)script/i,Je=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Qe={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ze=c(j),et=Ze.appendChild(j.createElement("div"));Qe.optgroup=Qe.option,Qe.tbody=Qe.tfoot=Qe.colgroup=Qe.caption=Qe.thead,Qe.th=Qe.td,J.support.htmlSerialize||(Qe._default=[1,"X<div>","</div>"]),J.fn.extend({text:function(e){return J.access(this,function(e){return e===t?J.text(this):this.empty().append((this[0]&&this[0].ownerDocument||j).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(J.isFunction(e))return this.each(function(t){J(this).wrapAll(e.call(this,t))});if(this[0]){var t=J(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return J.isFunction(e)?this.each(function(t){J(this).wrapInner(e.call(this,t))}):this.each(function(){var t=J(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=J.isFunction(e);return this.each(function(r){J(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!a(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=J.clean(arguments);return this.pushStack(J.merge(e,this),"before",this.selector)}},after:function(){if(!a(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=J.clean(arguments);return this.pushStack(J.merge(this,e),"after",this.selector)}},remove:function(e,t){for(var r,n=0;null!=(r=this[n]);n++)e&&!J.filter(e,[r]).length||(!t&&1===r.nodeType&&(J.cleanData(r.getElementsByTagName("*")),J.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&J.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return J.clone(this,e,t)})},html:function(e){return J.access(this,function(e){var r=this[0]||{},n=0,o=this.length;if(e===t)return 1===r.nodeType?r.innerHTML.replace(Be,""):t;if("string"==typeof e&&!Ge.test(e)&&(J.support.htmlSerialize||!ze.test(e))&&(J.support.leadingWhitespace||!je.test(e))&&!Qe[(We.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ve,"<$1></$2>");try{for(;n<o;n++)1===(r=this[n]||{}).nodeType&&(J.cleanData(r.getElementsByTagName("*")),r.innerHTML=e);r=0}catch(e){}}r&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return a(this[0])?this.length?this.pushStack(J(J.isFunction(e)?e():e),"replaceWith",e):this:J.isFunction(e)?this.each(function(t){var r=J(this),n=r.html();r.replaceWith(e.call(this,t,n))}):("string"!=typeof e&&(e=J(e).detach()),this.each(function(){var t=this.nextSibling,r=this.parentNode;J(this).remove(),t?J(t).before(e):J(r).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,r,n){var o,i,s,a,l=0,u=(e=[].concat.apply([],e))[0],c=[],p=this.length;if(!J.support.checkClone&&p>1&&"string"==typeof u&&Xe.test(u))return this.each(function(){J(this).domManip(e,r,n)});if(J.isFunction(u))return this.each(function(o){var i=J(this);e[0]=u.call(this,o,r?i.html():t),i.domManip(e,r,n)});if(this[0]){if(o=J.buildFragment(e,this,c),s=o.fragment,i=s.firstChild,1===s.childNodes.length&&(s=i),i)for(r=r&&J.nodeName(i,"tr"),a=o.cacheable||p-1;l<p;l++)n.call(r&&J.nodeName(this[l],"table")?d(this[l],"tbody"):this[l],l===a?s:J.clone(s,!0,!0));s=i=null,c.length&&J.each(c,function(e,t){t.src?J.ajax?J.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):J.error("no ajax"):J.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Je,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),J.buildFragment=function(e,r,n){var o,i,s,a=e[0];return r=r||j,r=!r.nodeType&&r[0]||r,r=r.ownerDocument||r,1===e.length&&"string"==typeof a&&a.length<512&&r===j&&"<"===a.charAt(0)&&!Ye.test(a)&&(J.support.checkClone||!Xe.test(a))&&(J.support.html5Clone||!ze.test(a))&&(i=!0,o=J.fragments[a],s=o!==t),o||(o=r.createDocumentFragment(),J.clean(e,r,o,n),i&&(J.fragments[a]=s&&o)),{fragment:o,cacheable:i}},J.fragments={},J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){J.fn[e]=function(r){var n,o=0,i=[],s=J(r),a=s.length,l=1===this.length&&this[0].parentNode;if((null==l||l&&11===l.nodeType&&1===l.childNodes.length)&&1===a)return s[t](this[0]),this;for(;o<a;o++)n=(o>0?this.clone(!0):this).get(),J(s[o])[t](n),i=i.concat(n);return this.pushStack(i,e,s.selector)}}),J.extend({clone:function(e,t,r){var n,o,i,s;if(J.support.html5Clone||J.isXMLDoc(e)||!ze.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(et.innerHTML=e.outerHTML,et.removeChild(s=et.firstChild)),!(J.support.noCloneEvent&&J.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||J.isXMLDoc(e)))for(f(e,s),n=h(e),o=h(s),i=0;n[i];++i)o[i]&&f(n[i],o[i]);if(t&&(p(e,s),r))for(n=h(e),o=h(s),i=0;n[i];++i)p(n[i],o[i]);return n=o=null,s},clean:function(e,t,r,n){var o,i,s,a,l,u,d,p,f,h,g,v=t===j&&Ze,y=[];for(t&&void 0!==t.createDocumentFragment||(t=j),o=0;null!=(s=e[o]);o++)if("number"==typeof s&&(s+=""),s){if("string"==typeof s)if(He.test(s)){for(v=v||c(t),d=t.createElement("div"),v.appendChild(d),s=s.replace(Ve,"<$1></$2>"),a=(We.exec(s)||["",""])[1].toLowerCase(),u=(l=Qe[a]||Qe._default)[0],d.innerHTML=l[1]+s+l[2];u--;)d=d.lastChild;if(!J.support.tbody)for(p=qe.test(s),i=(f="table"!==a||p?"<table>"!==l[1]||p?[]:d.childNodes:d.firstChild&&d.firstChild.childNodes).length-1;i>=0;--i)J.nodeName(f[i],"tbody")&&!f[i].childNodes.length&&f[i].parentNode.removeChild(f[i]);!J.support.leadingWhitespace&&je.test(s)&&d.insertBefore(t.createTextNode(je.exec(s)[0]),d.firstChild),s=d.childNodes,d.parentNode.removeChild(d)}else s=t.createTextNode(s);s.nodeType?y.push(s):J.merge(y,s)}if(d&&(s=d=v=null),!J.support.appendChecked)for(o=0;null!=(s=y[o]);o++)J.nodeName(s,"input")?m(s):void 0!==s.getElementsByTagName&&J.grep(s.getElementsByTagName("input"),m);if(r)for(h=function(e){if(!e.type||Ke.test(e.type))return n?n.push(e.parentNode?e.parentNode.removeChild(e):e):r.appendChild(e)},o=0;null!=(s=y[o]);o++)J.nodeName(s,"script")&&h(s)||(r.appendChild(s),void 0!==s.getElementsByTagName&&(g=J.grep(J.merge([],s.getElementsByTagName("script")),h),y.splice.apply(y,[o+1,0].concat(g)),o+=g.length));return y},cleanData:function(e,t){for(var r,n,o,i,s=0,a=J.expando,l=J.cache,u=J.support.deleteExpando,c=J.event.special;null!=(o=e[s]);s++)if((t||J.acceptData(o))&&(n=o[a],r=n&&l[n])){if(r.events)for(i in r.events)c[i]?J.event.remove(o,i):J.removeEvent(o,i,r.handle);l[n]&&(delete l[n],u?delete o[a]:o.removeAttribute?o.removeAttribute(a):o[a]=null,J.deletedIds.push(n))}}}),function(){var e,t;J.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},t={},(e=J.uaMatch(W.userAgent)).browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),J.browser=t,J.sub=function(){function e(t,r){return new e.fn.init(t,r)}J.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,n){return n&&n instanceof J&&!(n instanceof e)&&(n=e(n)),J.fn.init.call(this,r,n,t)},e.fn.init.prototype=e.fn;var t=e(j);return e}}();var tt,rt,nt,ot=/alpha\([^)]*\)/i,it=/opacity=([^)]*)/,st=/^(top|right|bottom|left)$/,at=/^(none|table(?!-c[ea]).+)/,lt=/^margin/,ut=new RegExp("^("+Q+")(.*)$","i"),ct=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),dt=new RegExp("^([-+])=("+Q+")","i"),pt={},ft={position:"absolute",visibility:"hidden",display:"block"},ht={letterSpacing:0,fontWeight:400},mt=["Top","Right","Bottom","Left"],gt=["Webkit","O","Moz","ms"],vt=J.fn.toggle;J.fn.extend({css:function(e,r){return J.access(this,function(e,r,n){return n!==t?J.style(e,r,n):J.css(e,r)},e,r,arguments.length>1)},show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(e,t){var r="boolean"==typeof e;return J.isFunction(e)&&J.isFunction(t)?vt.apply(this,arguments):this.each(function(){(r?e:v(this))?J(this).show():J(this).hide()})}}),J.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=tt(e,"opacity");return""===r?"1":r}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:J.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,r,n,o){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,a,l=J.camelCase(r),u=e.style;if(r=J.cssProps[l]||(J.cssProps[l]=g(u,l)),a=J.cssHooks[r]||J.cssHooks[l],n===t)return a&&"get"in a&&(i=a.get(e,!1,o))!==t?i:u[r];if("string"==(s=typeof n)&&(i=dt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(J.css(e,r)),s="number"),!(null==n||"number"===s&&isNaN(n)||("number"===s&&!J.cssNumber[l]&&(n+="px"),a&&"set"in a&&(n=a.set(e,n,o))===t)))try{u[r]=n}catch(e){}}},css:function(e,r,n,o){var i,s,a,l=J.camelCase(r);return r=J.cssProps[l]||(J.cssProps[l]=g(e.style,l)),(a=J.cssHooks[r]||J.cssHooks[l])&&"get"in a&&(i=a.get(e,!0,o)),i===t&&(i=tt(e,r)),"normal"===i&&r in ht&&(i=ht[r]),n||o!==t?(s=parseFloat(i),n||J.isNumeric(s)?s||0:i):i},swap:function(e,t,r){var n,o,i={};for(o in t)i[o]=e.style[o],e.style[o]=t[o];n=r.call(e);for(o in t)e.style[o]=i[o];return n}}),e.getComputedStyle?tt=function(t,r){var n,o,i,s,a=e.getComputedStyle(t,null),l=t.style;return a&&(""===(n=a[r])&&!J.contains(t.ownerDocument,t)&&(n=J.style(t,r)),ct.test(n)&&lt.test(r)&&(o=l.width,i=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=n,n=a.width,l.width=o,l.minWidth=i,l.maxWidth=s)),n}:j.documentElement.currentStyle&&(tt=function(e,t){var r,n,o=e.currentStyle&&e.currentStyle[t],i=e.style;return null==o&&i&&i[t]&&(o=i[t]),ct.test(o)&&!st.test(t)&&(r=i.left,(n=e.runtimeStyle&&e.runtimeStyle.left)&&(e.runtimeStyle.left=e.currentStyle.left),i.left="fontSize"===t?"1em":o,o=i.pixelLeft+"px",i.left=r,n&&(e.runtimeStyle.left=n)),""===o?"auto":o}),J.each(["height","width"],function(e,t){J.cssHooks[t]={get:function(e,r,n){if(r)return 0===e.offsetWidth&&at.test(tt(e,"display"))?J.swap(e,ft,function(){return w(e,t,n)}):w(e,t,n)},set:function(e,r,n){return b(0,r,n?S(e,t,n,J.support.boxSizing&&"border-box"===J.css(e,"boxSizing")):0)}}}),J.support.opacity||(J.cssHooks.opacity={get:function(e,t){return it.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var r=e.style,n=e.currentStyle,o=J.isNumeric(t)?"alpha(opacity="+100*t+")":"",i=n&&n.filter||r.filter||"";r.zoom=1,t>=1&&""===J.trim(i.replace(ot,""))&&r.removeAttribute&&(r.removeAttribute("filter"),n&&!n.filter)||(r.filter=ot.test(i)?i.replace(ot,o):i+" "+o)}}),J(function(){J.support.reliableMarginRight||(J.cssHooks.marginRight={get:function(e,t){return J.swap(e,{display:"inline-block"},function(){if(t)return tt(e,"marginRight")})}}),!J.support.pixelPosition&&J.fn.position&&J.each(["top","left"],function(e,t){J.cssHooks[t]={get:function(e,r){if(r){var n=tt(e,t);return ct.test(n)?J(e).position()[t]+"px":n}}}})}),J.expr&&J.expr.filters&&(J.expr.filters.hidden=function(e){return 0===e.offsetWidth&&0===e.offsetHeight||!J.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||tt(e,"display"))},J.expr.filters.visible=function(e){return!J.expr.filters.hidden(e)}),J.each({margin:"",padding:"",border:"Width"},function(e,t){J.cssHooks[e+t]={expand:function(r){var n,o="string"==typeof r?r.split(" "):[r],i={};for(n=0;n<4;n++)i[e+mt[n]+t]=o[n]||o[n-2]||o[0];return i}},lt.test(e)||(J.cssHooks[e+t].set=b)});var yt=/%20/g,bt=/\[\]$/,St=/\r?\n/g,wt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Et=/^(?:select|textarea)/i;J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?J.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Et.test(this.nodeName)||wt.test(this.type))}).map(function(e,t){var r=J(this).val();return null==r?null:J.isArray(r)?J.map(r,function(e,r){return{name:t.name,value:e.replace(St,"\r\n")}}):{name:t.name,value:r.replace(St,"\r\n")}}).get()}}),J.param=function(e,r){var n,o=[],i=function(e,t){t=J.isFunction(t)?t():null==t?"":t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(r===t&&(r=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(e)||e.jquery&&!J.isPlainObject(e))J.each(e,function(){i(this.name,this.value)});else for(n in e)C(n,e[n],r,i);return o.join("&").replace(yt,"+")};var Ct,Pt,Tt=/#.*$/,It=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Rt=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,_t=/^(?:GET|HEAD)$/,xt=/^\/\//,Mt=/\?/,Ut=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,At=/([?&])_=[^&]*/,Lt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kt=J.fn.load,Dt={},Ot={},Nt=["*/"]+["*"];try{Pt=V.href}catch(e){(Pt=j.createElement("a")).href="",Pt=Pt.href}Ct=Lt.exec(Pt.toLowerCase())||[],J.fn.load=function(e,r,n){if("string"!=typeof e&&kt)return kt.apply(this,arguments);if(!this.length)return this;var o,i,s,a=this,l=e.indexOf(" ");return l>=0&&(o=e.slice(l,e.length),e=e.slice(0,l)),J.isFunction(r)?(n=r,r=t):r&&"object"==typeof r&&(i="POST"),J.ajax({url:e,type:i,dataType:"html",data:r,complete:function(e,t){n&&a.each(n,s||[e.responseText,t,e])}}).done(function(e){s=arguments,a.html(o?J("<div>").append(e.replace(Ut,"")).find(o):e)}),this},J.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){J.fn[t]=function(e){return this.on(t,e)}}),J.each(["get","post"],function(e,r){J[r]=function(e,n,o,i){return J.isFunction(n)&&(i=i||o,o=n,n=t),J.ajax({type:r,url:e,data:n,success:o,dataType:i})}}),J.extend({getScript:function(e,r){return J.get(e,t,r,"script")},getJSON:function(e,t,r){return J.get(e,t,r,"json")},ajaxSetup:function(e,t){return t?I(e,J.ajaxSettings):(t=e,e=J.ajaxSettings),I(e,t),e},ajaxSettings:{url:Pt,isLocal:Rt.test(Ct[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Nt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:P(Dt),ajaxTransport:P(Ot),ajax:function(e,r){function n(e,r,n,s){var u,d,y,b,w,C=r;2!==S&&(S=2,l&&clearTimeout(l),a=t,i=s||"",E.readyState=e>0?4:0,n&&(b=R(p,E,n)),e>=200&&e<300||304===e?(p.ifModified&&((w=E.getResponseHeader("Last-Modified"))&&(J.lastModified[o]=w),(w=E.getResponseHeader("Etag"))&&(J.etag[o]=w)),304===e?(C="notmodified",u=!0):(u=_(p,b),C=u.state,d=u.data,y=u.error,u=!y)):(y=C,C&&!e||(C="error",e<0&&(e=0))),E.status=e,E.statusText=(r||C)+"",u?m.resolveWith(f,[d,C,E]):m.rejectWith(f,[E,C,y]),E.statusCode(v),v=t,c&&h.trigger("ajax"+(u?"Success":"Error"),[E,p,u?d:y]),g.fireWith(f,[E,C]),c&&(h.trigger("ajaxComplete",[E,p]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof e&&(r=e,e=t),r=r||{};var o,i,s,a,l,u,c,d,p=J.ajaxSetup({},r),f=p.context||p,h=f!==p&&(f.nodeType||f instanceof J)?J(f):J.event,m=J.Deferred(),g=J.Callbacks("once memory"),v=p.statusCode||{},y={},b={},S=0,w="canceled",E={readyState:0,setRequestHeader:function(e,t){if(!S){var r=e.toLowerCase();e=b[r]=b[r]||e,y[e]=t}return this},getAllResponseHeaders:function(){return 2===S?i:null},getResponseHeader:function(e){var r;if(2===S){if(!s)for(s={};r=It.exec(i);)s[r[1].toLowerCase()]=r[2];r=s[e.toLowerCase()]}return r===t?null:r},overrideMimeType:function(e){return S||(p.mimeType=e),this},abort:function(e){return e=e||w,a&&a.abort(e),n(0,e),this}};if(m.promise(E),E.success=E.done,E.error=E.fail,E.complete=g.add,E.statusCode=function(e){if(e){var t;if(S<2)for(t in e)v[t]=[v[t],e[t]];else t=e[E.status],E.always(t)}return this},p.url=((e||p.url)+"").replace(Tt,"").replace(xt,Ct[1]+"//"),p.dataTypes=J.trim(p.dataType||"*").toLowerCase().split(ee),null==p.crossDomain&&(u=Lt.exec(p.url.toLowerCase())||!1,p.crossDomain=u&&u.join(":")+(u[3]?"":"http:"===u[1]?80:443)!==Ct.join(":")+(Ct[3]?"":"http:"===Ct[1]?80:443)),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=J.param(p.data,p.traditional)),T(Dt,p,r,E),2===S)return E;if(c=p.global,p.type=p.type.toUpperCase(),p.hasContent=!_t.test(p.type),c&&0==J.active++&&J.event.trigger("ajaxStart"),!p.hasContent&&(p.data&&(p.url+=(Mt.test(p.url)?"&":"?")+p.data,delete p.data),o=p.url,!1===p.cache)){var C=J.now(),P=p.url.replace(At,"$1_="+C);p.url=P+(P===p.url?(Mt.test(p.url)?"&":"?")+"_="+C:"")}(p.data&&p.hasContent&&!1!==p.contentType||r.contentType)&&E.setRequestHeader("Content-Type",p.contentType),p.ifModified&&(o=o||p.url,J.lastModified[o]&&E.setRequestHeader("If-Modified-Since",J.lastModified[o]),J.etag[o]&&E.setRequestHeader("If-None-Match",J.etag[o])),E.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Nt+"; q=0.01":""):p.accepts["*"]);for(d in p.headers)E.setRequestHeader(d,p.headers[d]);if(!p.beforeSend||!1!==p.beforeSend.call(f,E,p)&&2!==S){w="abort";for(d in{success:1,error:1,complete:1})E[d](p[d]);if(a=T(Ot,p,r,E)){E.readyState=1,c&&h.trigger("ajaxSend",[E,p]),p.async&&p.timeout>0&&(l=setTimeout(function(){E.abort("timeout")},p.timeout));try{S=1,a.send(y,n)}catch(e){if(!(S<2))throw e;n(-1,e)}}else n(-1,"No Transport");return E}return E.abort()},active:0,lastModified:{},etag:{}});var Ft=[],Bt=/\?/,jt=/(=)\?(?=&|$)|\?\?/,Vt=J.now();J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ft.pop()||J.expando+"_"+Vt++;return this[e]=!0,e}}),J.ajaxPrefilter("json jsonp",function(r,n,o){var i,s,a,l=r.data,u=r.url,c=!1!==r.jsonp,d=c&&jt.test(u),p=c&&!d&&"string"==typeof l&&!(r.contentType||"").indexOf("application/x-www-form-urlencoded")&&jt.test(l);if("jsonp"===r.dataTypes[0]||d||p)return i=r.jsonpCallback=J.isFunction(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback,s=e[i],d?r.url=u.replace(jt,"$1"+i):p?r.data=l.replace(jt,"$1"+i):c&&(r.url+=(Bt.test(u)?"&":"?")+r.jsonp+"="+i),r.converters["script json"]=function(){return a||J.error(i+" was not called"),a[0]},r.dataTypes[0]="json",e[i]=function(){a=arguments},o.always(function(){e[i]=s,r[i]&&(r.jsonpCallback=n.jsonpCallback,Ft.push(i)),a&&J.isFunction(s)&&s(a[0]),a=s=t}),"script"}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return J.globalEval(e),e}}}),J.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),J.ajaxTransport("script",function(e){if(e.crossDomain){var r,n=j.head||j.getElementsByTagName("head")[0]||j.documentElement;return{send:function(o,i){(r=j.createElement("script")).async="async",e.scriptCharset&&(r.charset=e.scriptCharset),r.src=e.url,r.onload=r.onreadystatechange=function(e,o){(o||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),r=t,o||i(200,"success"))},n.insertBefore(r,n.firstChild)},abort:function(){r&&r.onload(0,1)}}}});var Wt,qt=!!e.ActiveXObject&&function(){for(var e in Wt)Wt[e](0,1)},Ht=0;J.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&x()||M()}:x,function(e){J.extend(J.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(J.ajaxSettings.xhr()),J.support.ajax&&J.ajaxTransport(function(r){if(!r.crossDomain||J.support.cors){var n;return{send:function(o,i){var s,a,l=r.xhr();if(r.username?l.open(r.type,r.url,r.async,r.username,r.password):l.open(r.type,r.url,r.async),r.xhrFields)for(a in r.xhrFields)l[a]=r.xhrFields[a];r.mimeType&&l.overrideMimeType&&l.overrideMimeType(r.mimeType),!r.crossDomain&&!o["X-Requested-With"]&&(o["X-Requested-With"]="XMLHttpRequest");try{for(a in o)l.setRequestHeader(a,o[a])}catch(e){}l.send(r.hasContent&&r.data||null),n=function(e,o){var a,u,c,d,p;try{if(n&&(o||4===l.readyState))if(n=t,s&&(l.onreadystatechange=J.noop,qt&&delete Wt[s]),o)4!==l.readyState&&l.abort();else{a=l.status,c=l.getAllResponseHeaders(),d={},(p=l.responseXML)&&p.documentElement&&(d.xml=p);try{d.text=l.responseText}catch(e){}try{u=l.statusText}catch(e){u=""}a||!r.isLocal||r.crossDomain?1223===a&&(a=204):a=d.text?200:404}}catch(e){o||i(-1,e)}d&&i(a,u,d,c)},r.async?4===l.readyState?setTimeout(n,0):(s=++Ht,qt&&(Wt||(Wt={},J(e).unload(qt)),Wt[s]=n),l.onreadystatechange=n):n()},abort:function(){n&&n(0,1)}}}});var Gt,Yt,zt=/^(?:toggle|show|hide)$/,$t=new RegExp("^(?:([-+])=|)("+Q+")([a-z%]*)$","i"),Xt=/queueHooks$/,Kt=[function(e,t,r){var n,o,i,s,a,l,u,c,d=this,p=e.style,f={},h=[],m=e.nodeType&&v(e);r.queue||(null==(u=J._queueHooks(e,"fx")).unqueued&&(u.unqueued=0,c=u.empty.fire,u.empty.fire=function(){u.unqueued||c()}),u.unqueued++,d.always(function(){d.always(function(){u.unqueued--,J.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===J.css(e,"display")&&"none"===J.css(e,"float")&&(J.support.inlineBlockNeedsLayout&&"inline"!==E(e.nodeName)?p.zoom=1:p.display="inline-block")),r.overflow&&(p.overflow="hidden",J.support.shrinkWrapBlocks||d.done(function(){p.overflow=r.overflow[0],p.overflowX=r.overflow[1],p.overflowY=r.overflow[2]}));for(n in t)if(i=t[n],zt.exec(i)){if(delete t[n],i===(m?"hide":"show"))continue;h.push(n)}if(s=h.length)for(a=J._data(e,"fxshow")||J._data(e,"fxshow",{}),m?J(e).show():d.done(function(){J(e).hide()}),d.done(function(){var t;J.removeData(e,"fxshow",!0);for(t in f)J.style(e,t,f[t])}),n=0;n<s;n++)o=h[n],l=d.createTween(o,m?a[o]:0),f[o]=a[o]||J.style(e,o),o in a||(a[o]=l.start,m&&(l.end=l.start,l.start="width"===o||"height"===o?1:0))}],Jt={"*":[function(e,t){var r,n,o=this.createTween(e,t),i=$t.exec(t),s=o.cur(),a=+s||0,l=1,u=20;if(i){if(r=+i[2],"px"!==(n=i[3]||(J.cssNumber[e]?"":"px"))&&a){a=J.css(o.elem,e,!0)||r||1;do{l=l||".5",a/=l,J.style(o.elem,e,a+n)}while(l!==(l=o.cur()/s)&&1!==l&&--u)}o.unit=n,o.start=a,o.end=i[1]?a+(i[1]+1)*r:r}return o}]};J.Animation=J.extend(L,{tweener:function(e,t){J.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,n=0,o=e.length;n<o;n++)r=e[n],Jt[r]=Jt[r]||[],Jt[r].unshift(t)},prefilter:function(e,t){t?Kt.unshift(e):Kt.push(e)}}),J.Tween=D,D.prototype={constructor:D,init:function(e,t,r,n,o,i){this.elem=e,this.prop=r,this.easing=o||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=i||(J.cssNumber[r]?"":"px")},cur:function(){var e=D.propHooks[this.prop];return e&&e.get?e.get(this):D.propHooks._default.get(this)},run:function(e){var t,r=D.propHooks[this.prop];return this.options.duration?this.pos=t=J.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):D.propHooks._default.set(this),this}},D.prototype.init.prototype=D.prototype,D.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=J.css(e.elem,e.prop,!1,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){J.fx.step[e.prop]?J.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[J.cssProps[e.prop]]||J.cssHooks[e.prop])?J.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},D.propHooks.scrollTop=D.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},J.each(["toggle","show","hide"],function(e,t){var r=J.fn[t];J.fn[t]=function(n,o,i){return null==n||"boolean"==typeof n||!e&&J.isFunction(n)&&J.isFunction(o)?r.apply(this,arguments):this.animate(O(t,!0),n,o,i)}}),J.fn.extend({fadeTo:function(e,t,r,n){return this.filter(v).css("opacity",0).show().end().animate({opacity:t},e,r,n)},animate:function(e,t,r,n){var o=J.isEmptyObject(e),i=J.speed(t,r,n),s=function(){var t=L(this,J.extend({},e),i);o&&t.stop(!0)};return o||!1===i.queue?this.each(s):this.queue(i.queue,s)},stop:function(e,r,n){var o=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=r,r=e,e=t),r&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",i=J.timers,s=J._data(this);if(r)s[r]&&s[r].stop&&o(s[r]);else for(r in s)s[r]&&s[r].stop&&Xt.test(r)&&o(s[r]);for(r=i.length;r--;)i[r].elem===this&&(null==e||i[r].queue===e)&&(i[r].anim.stop(n),t=!1,i.splice(r,1));(t||!n)&&J.dequeue(this,e)})}}),J.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){J.fn[e]=function(e,r,n){return this.animate(t,e,r,n)}}),J.speed=function(e,t,r){var n=e&&"object"==typeof e?J.extend({},e):{complete:r||!r&&t||J.isFunction(e)&&e,duration:e,easing:r&&t||t&&!J.isFunction(t)&&t};return n.duration=J.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in J.fx.speeds?J.fx.speeds[n.duration]:J.fx.speeds._default,null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){J.isFunction(n.old)&&n.old.call(this),n.queue&&J.dequeue(this,n.queue)},n},J.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},J.timers=[],J.fx=D.prototype.init,J.fx.tick=function(){for(var e,t=J.timers,r=0;r<t.length;r++)!(e=t[r])()&&t[r]===e&&t.splice(r--,1);t.length||J.fx.stop()},J.fx.timer=function(e){e()&&J.timers.push(e)&&!Yt&&(Yt=setInterval(J.fx.tick,J.fx.interval))},J.fx.interval=13,J.fx.stop=function(){clearInterval(Yt),Yt=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fx.step={},J.expr&&J.expr.filters&&(J.expr.filters.animated=function(e){return J.grep(J.timers,function(t){return e===t.elem}).length});var Qt=/^(?:body|html)$/i;J.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){J.offset.setOffset(this,e,t)});var r,n,o,i,s,a,l,u={top:0,left:0},c=this[0],d=c&&c.ownerDocument;if(d)return(n=d.body)===c?J.offset.bodyOffset(c):(r=d.documentElement,J.contains(r,c)?(void 0!==c.getBoundingClientRect&&(u=c.getBoundingClientRect()),o=N(d),i=r.clientTop||n.clientTop||0,s=r.clientLeft||n.clientLeft||0,a=o.pageYOffset||r.scrollTop,l=o.pageXOffset||r.scrollLeft,{top:u.top+a-i,left:u.left+l-s}):u)},J.offset={bodyOffset:function(e){var t=e.offsetTop,r=e.offsetLeft;return J.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(J.css(e,"marginTop"))||0,r+=parseFloat(J.css(e,"marginLeft"))||0),{top:t,left:r}},setOffset:function(e,t,r){var n=J.css(e,"position");"static"===n&&(e.style.position="relative");var o,i,s=J(e),a=s.offset(),l=J.css(e,"top"),u=J.css(e,"left"),c={},d={};("absolute"===n||"fixed"===n)&&J.inArray("auto",[l,u])>-1?(d=s.position(),o=d.top,i=d.left):(o=parseFloat(l)||0,i=parseFloat(u)||0),J.isFunction(t)&&(t=t.call(e,r,a)),null!=t.top&&(c.top=t.top-a.top+o),null!=t.left&&(c.left=t.left-a.left+i),"using"in t?t.using.call(e,c):s.css(c)}},J.fn.extend({position:function(){if(this[0]){var e=this[0],t=this.offsetParent(),r=this.offset(),n=Qt.test(t[0].nodeName)?{top:0,left:0}:t.offset();return r.top-=parseFloat(J.css(e,"marginTop"))||0,r.left-=parseFloat(J.css(e,"marginLeft"))||0,n.top+=parseFloat(J.css(t[0],"borderTopWidth"))||0,n.left+=parseFloat(J.css(t[0],"borderLeftWidth"))||0,{top:r.top-n.top,left:r.left-n.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||j.body;e&&!Qt.test(e.nodeName)&&"static"===J.css(e,"position");)e=e.offsetParent;return e||j.body})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,r){var n=/Y/.test(r);J.fn[e]=function(o){return J.access(this,function(e,o,i){var s=N(e);if(i===t)return s?r in s?s[r]:s.document.documentElement[o]:e[o];s?s.scrollTo(n?J(s).scrollLeft():i,n?i:J(s).scrollTop()):e[o]=i},e,o,arguments.length,null)}}),J.each({Height:"height",Width:"width"},function(e,r){J.each({padding:"inner"+e,content:r,"":"outer"+e},function(n,o){J.fn[o]=function(o,i){var s=arguments.length&&(n||"boolean"!=typeof o),a=n||(!0===o||!0===i?"margin":"border");return J.access(this,function(r,n,o){var i;return J.isWindow(r)?r.document.documentElement["client"+e]:9===r.nodeType?(i=r.documentElement,Math.max(r.body["scroll"+e],i["scroll"+e],r.body["offset"+e],i["offset"+e],i["client"+e])):o===t?J.css(r,n,o,a):J.style(r,n,o,a)},r,s?o:t,s,null)}})}),e.jQuery=e.$=J,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return J})}(window),function(e,t){"function"==typeof define&&define.amd?define([],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){"use strict";function e(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}try{Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}e.isLong=function(e){return!0===(e&&e.__isLong__)};var t={},r={};e.fromInt=function(n,o){var i,s;return o?0<=(n>>>=0)&&n<256&&(s=r[n])?s:(i=new e(n,(0|n)<0?-1:0,!0),0<=n&&n<256&&(r[n]=i),i):-128<=(n|=0)&&n<128&&(s=t[n])?s:(i=new e(n,n<0?-1:0,!1),-128<=n&&n<128&&(t[n]=i),i)},e.fromNumber=function(t,r){return r=!!r,isNaN(t)||!isFinite(t)?e.ZERO:!r&&t<=-i?e.MIN_VALUE:!r&&t+1>=i?e.MAX_VALUE:r&&t>=o?e.MAX_UNSIGNED_VALUE:t<0?e.fromNumber(-t,r).negate():new e(t%n|0,t/n|0,r)},e.fromBits=function(t,r,n){return new e(t,r,n)},e.fromString=function(t,r,n){if(0===t.length)throw Error("number format error: empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e.ZERO;if("number"==typeof r&&(n=r,r=!1),(n=n||10)<2||36<n)throw Error("radix out of range: "+n);var o;if((o=t.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+t);if(0===o)return e.fromString(t.substring(1),r,n).negate();for(var i=e.fromNumber(Math.pow(n,8)),s=e.ZERO,a=0;a<t.length;a+=8){var l=Math.min(8,t.length-a),u=parseInt(t.substring(a,a+l),n);if(l<8){var c=e.fromNumber(Math.pow(n,l));s=s.multiply(c).add(e.fromNumber(u))}else s=(s=s.multiply(i)).add(e.fromNumber(u))}return s.unsigned=r,s},e.fromValue=function(t){return t instanceof e?t:"number"==typeof t?e.fromNumber(t):"string"==typeof t?e.fromString(t):new e(t.low,t.high,t.unsigned)};var n=4294967296,o=n*n,i=o/2,s=e.fromInt(1<<24);return e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},e.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix out of range: "+t);if(this.isZero())return"0";var r;if(this.isNegative()){if(this.equals(e.MIN_VALUE)){var n=e.fromNumber(t),o=this.divide(n);return r=o.multiply(n).subtract(this),o.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}var i=e.fromNumber(Math.pow(t,6),this.unsigned);r=this;for(var s="";;){var a=r.divide(i),l=(r.subtract(a.multiply(i)).toInt()>>>0).toString(t);if((r=a).isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(e.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,r=31;r>0&&0==(t&1<<r);r--);return 0!=this.high?r+33:r+1},e.prototype.isZero=function(){return 0===this.high&&0===this.low},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isOdd=function(){return 1==(1&this.low)},e.prototype.isEven=function(){return 0==(1&this.low)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},e.eq=e.prototype.equals,e.prototype.notEquals=function(e){return!this.equals(e)},e.neq=e.prototype.notEquals,e.prototype.lessThan=function(e){return this.compare(e)<0},e.prototype.lt=e.prototype.lessThan,e.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},e.prototype.lte=e.prototype.lessThanOrEqual,e.prototype.greaterThan=function(e){return this.compare(e)>0},e.prototype.gt=e.prototype.greaterThan,e.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},e.prototype.gte=e.prototype.greaterThanOrEqual,e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.equals(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.subtract(t).isNegative()?-1:1},e.prototype.negate=function(){return!this.unsigned&&this.equals(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=e.prototype.negate,e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var r=this.high>>>16,n=65535&this.high,o=this.low>>>16,i=65535&this.low,s=t.high>>>16,a=65535&t.high,l=t.low>>>16,u=0,c=0,d=0,p=0;return p+=i+(65535&t.low),d+=p>>>16,p&=65535,d+=o+l,c+=d>>>16,d&=65535,c+=n+a,u+=c>>>16,c&=65535,u+=r+s,u&=65535,e.fromBits(d<<16|p,u<<16|c,this.unsigned)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.negate())},e.prototype.sub=e.prototype.subtract,e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())return e.ZERO;if(this.equals(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.equals(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(s)&&t.lessThan(s))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,o=this.low>>>16,i=65535&this.low,a=t.high>>>16,l=65535&t.high,u=t.low>>>16,c=65535&t.low,d=0,p=0,f=0,h=0;return h+=i*c,f+=h>>>16,h&=65535,f+=o*c,p+=f>>>16,f&=65535,f+=i*u,p+=f>>>16,f&=65535,p+=n*c,d+=p>>>16,p&=65535,p+=o*u,d+=p>>>16,p&=65535,p+=i*l,d+=p>>>16,p&=65535,d+=r*c+n*u+o*l+i*a,d&=65535,e.fromBits(f<<16|h,d<<16|p,this.unsigned)},e.prototype.mul=e.prototype.multiply,e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var r,n,o;if(this.equals(e.MIN_VALUE))return t.equals(e.ONE)||t.equals(e.NEG_ONE)?e.MIN_VALUE:t.equals(e.MIN_VALUE)?e.ONE:(r=this.shiftRight(1).divide(t).shiftLeft(1)).equals(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(n=this.subtract(t.multiply(r)),o=r.add(n.divide(t)));if(t.equals(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.negate().divide(t.negate()):this.negate().divide(t).negate();if(t.isNegative())return this.divide(t.negate()).negate();for(o=e.ZERO,n=this;n.greaterThanOrEqual(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(r)/Math.LN2),s=i<=48?1:Math.pow(2,i-48),a=e.fromNumber(r),l=a.multiply(t);l.isNegative()||l.greaterThan(n);)r-=s,l=(a=e.fromNumber(r,this.unsigned)).multiply(t);a.isZero()&&(a=e.ONE),o=o.add(a),n=n.subtract(l)}return o},e.prototype.div=e.prototype.divide,e.prototype.modulo=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.subtract(this.divide(t).multiply(t))},e.prototype.mod=e.prototype.modulo,e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=e.prototype.shiftLeft,e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=e.prototype.shiftRight,e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),0===(t&=63))return this;var r=this.high;if(t<32){var n=this.low;return e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}return 32===t?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)},e.prototype.shru=e.prototype.shiftRightUnsigned,e.prototype.toSigned=function(){return this.unsigned?new e(this.low,this.high,!1):this},e.prototype.toUnsigned=function(){return this.unsigned?this:new e(this.low,this.high,!0)},e}),function(e,t){"function"==typeof define&&define.amd?define(["long"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var e;try{e=require("long")}catch(e){}return t(e)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(e){"use strict";function t(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function r(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+l.apply(String,e);e.length+arguments.length>1024&&(t.push(l.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function n(e,t,r,n,o){var i,s,a=8*o-n-1,l=(1<<a)-1,u=l>>1,c=-7,d=r?o-1:0,p=r?-1:1,f=e[t+d];for(d+=p,i=f&(1<<-c)-1,f>>=-c,c+=a;c>0;i=256*i+e[t+d],d+=p,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=n;c>0;s=256*s+e[t+d],d+=p,c-=8);if(0===i)i=1-u;else{if(i===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),i-=u}return(f?-1:1)*s*Math.pow(2,i-n)}function o(e,t,r,n,o,i){var s,a,l,u=8*i-o-1,c=(1<<u)-1,d=c>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=c?(a=0,s=c):s+d>=1?(a=(t*l-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[r+f]=255&a,f+=h,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[r+f]=255&s,f+=h,s/=256,u-=8);e[r+f-h]|=128*m}var i=function(e,t,r){if(void 0===e&&(e=i.DEFAULT_CAPACITY),void 0===t&&(t=i.DEFAULT_ENDIAN),void 0===r&&(r=i.DEFAULT_NOASSERT),!r){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,r=!!r}this.buffer=0===e?a:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=r};i.VERSION="5.0.1",i.LITTLE_ENDIAN=!0,i.BIG_ENDIAN=!1,i.DEFAULT_CAPACITY=16,i.DEFAULT_ENDIAN=i.BIG_ENDIAN,i.DEFAULT_NOASSERT=!1,i.Long=e||null;var s=i.prototype;s.__isByteBuffer__;try{Object.defineProperty(s,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}try{a=new ArrayBuffer(0)}catch(e){var a=""}var l=String.fromCharCode;i.accessor=function(){return Uint8Array},i.allocate=function(e,t,r){return new i(e,t,r)},i.concat=function(e,t,r,n){"boolean"!=typeof t&&"string"==typeof t||(n=r,r=t,t=void 0);for(var o,s=0,a=0,l=e.length;a<l;++a)i.isByteBuffer(e[a])||(e[a]=i.wrap(e[a],t)),(o=e[a].limit-e[a].offset)>0&&(s+=o);if(0===s)return new i(0,r,n);var u,c=new i(s,r,n);for(a=0;a<l;)(o=(u=e[a++]).limit-u.offset)<=0||(c.view.set(u.view.subarray(u.offset,u.limit),c.offset),c.offset+=o);return c.limit=c.offset,c.offset=0,c},i.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},i.type=function(){return ArrayBuffer},i.wrap=function(e,t,r,n){if("string"!=typeof t&&(n=r,r=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return i.fromBase64(e,r);case"hex":return i.fromHex(e,r);case"binary":return i.fromBinary(e,r);case"utf8":return i.fromUTF8(e,r);case"debug":return i.fromDebug(e,r);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var o;if(i.isByteBuffer(e))return o=s.clone.call(e),o.markedOffset=-1,o;if(e instanceof Uint8Array)o=new i(0,r,n),e.length>0&&(o.buffer=e.buffer,o.offset=e.byteOffset,o.limit=e.byteOffset+e.byteLength,o.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)o=new i(0,r,n),e.byteLength>0&&(o.buffer=e,o.offset=0,o.limit=e.byteLength,o.view=e.byteLength>0?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(o=new i(e.length,r,n)).limit=e.length;for(var a=0;a<e.length;++a)o.view[a]=e[a]}return o},s.writeBitSet=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=t,i=e.length,s=i>>3,a=0;for(t+=this.writeVarint32(i,t);s--;)n=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(n,t++);if(a<i){var l=0;for(n=0;a<i;)n|=(1&!!e[a++])<<l++;this.writeByte(n,t++)}return r?(this.offset=t,this):t-o},s.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var r,n=this.readVarint32(e),o=n.value,i=o>>3,s=0,a=[];for(e+=n.length;i--;)r=this.readByte(e++),a[s++]=!!(1&r),a[s++]=!!(2&r),a[s++]=!!(4&r),a[s++]=!!(8&r),a[s++]=!!(16&r),a[s++]=!!(32&r),a[s++]=!!(64&r),a[s++]=!!(128&r);if(s<o){var l=0;for(r=this.readByte(e++);s<o;)a[s++]=!!(r>>l++&1)}return t&&(this.offset=e),a},s.readBytes=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var n=this.slice(t,t+e);return r&&(this.offset+=e),n},s.writeBytes=s.append,s.writeInt8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},s.writeByte=s.writeInt8,s.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return 128==(128&r)&&(r=-(255-r+1)),t&&(this.offset+=1),r},s.readByte=s.readInt8,s.writeUint8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},s.writeUInt8=s.writeUint8,s.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return t&&(this.offset+=1),r},s.readUInt8=s.readUint8,s.writeInt16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},s.writeShort=s.writeInt16,s.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),32768==(32768&r)&&(r=-(65535-r+1)),t&&(this.offset+=2),r},s.readShort=s.readInt16,s.writeUint16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},s.writeUInt16=s.writeUint16,s.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),t&&(this.offset+=2),r},s.readUInt16=s.readUint16,s.writeInt32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},s.writeInt=s.writeInt32,s.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),r|=0,t&&(this.offset+=4),r},s.readInt=s.readInt32,s.writeUint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},s.writeUInt32=s.writeUint32,s.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),t&&(this.offset+=4),r},s.readUInt32=s.readUint32,e&&(s.writeInt64=function(t,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),r+=8;var o=this.buffer.byteLength;r>o&&this.resize((o*=2)>r?o:r),r-=8;var i=t.low,s=t.high;return this.littleEndian?(this.view[r+3]=i>>>24&255,this.view[r+2]=i>>>16&255,this.view[r+1]=i>>>8&255,this.view[r]=255&i,r+=4,this.view[r+3]=s>>>24&255,this.view[r+2]=s>>>16&255,this.view[r+1]=s>>>8&255,this.view[r]=255&s):(this.view[r]=s>>>24&255,this.view[r+1]=s>>>16&255,this.view[r+2]=s>>>8&255,this.view[r+3]=255&s,r+=4,this.view[r]=i>>>24&255,this.view[r+1]=i>>>16&255,this.view[r+2]=i>>>8&255,this.view[r+3]=255&i),n&&(this.offset+=8),this},s.writeLong=s.writeInt64,s.readInt64=function(t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=0,o=0;this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,o=this.view[t+2]<<16,o|=this.view[t+1]<<8,o|=this.view[t],o+=this.view[t+3]<<24>>>0):(o=this.view[t+1]<<16,o|=this.view[t+2]<<8,o|=this.view[t+3],o+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0);var i=new e(n,o,!1);return r&&(this.offset+=8),i},s.readLong=s.readInt64,s.writeUint64=function(t,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),r+=8;var o=this.buffer.byteLength;r>o&&this.resize((o*=2)>r?o:r),r-=8;var i=t.low,s=t.high;return this.littleEndian?(this.view[r+3]=i>>>24&255,this.view[r+2]=i>>>16&255,this.view[r+1]=i>>>8&255,this.view[r]=255&i,r+=4,this.view[r+3]=s>>>24&255,this.view[r+2]=s>>>16&255,this.view[r+1]=s>>>8&255,this.view[r]=255&s):(this.view[r]=s>>>24&255,this.view[r+1]=s>>>16&255,this.view[r+2]=s>>>8&255,this.view[r+3]=255&s,r+=4,this.view[r]=i>>>24&255,this.view[r+1]=i>>>16&255,this.view[r+2]=i>>>8&255,this.view[r+3]=255&i),n&&(this.offset+=8),this},s.writeUInt64=s.writeUint64,s.readUint64=function(t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=0,o=0;this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,o=this.view[t+2]<<16,o|=this.view[t+1]<<8,o|=this.view[t],o+=this.view[t+3]<<24>>>0):(o=this.view[t+1]<<16,o|=this.view[t+2]<<8,o|=this.view[t+3],o+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0);var i=new e(n,o,!0);return r&&(this.offset+=8),i},s.readUInt64=s.readUint64),s.writeFloat32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,o(this.view,e,t,this.littleEndian,23,4),r&&(this.offset+=4),this},s.writeFloat=s.writeFloat32,s.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=n(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),r},s.readFloat=s.readFloat32,s.writeFloat64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=8,o(this.view,e,t,this.littleEndian,52,8),r&&(this.offset+=8),this},s.writeDouble=s.writeFloat64,s.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=n(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),r},s.readDouble=s.readFloat64,i.MAX_VARINT32_BYTES=5,i.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},i.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},i.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},s.writeVarint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=i.calculateVarint32(e);t+=o;var s=this.buffer.byteLength;for(t>s&&this.resize((s*=2)>t?s:t),t-=o,e>>>=0;e>=128;)n=127&e|128,this.view[t++]=n,e>>>=7;return this.view[t++]=e,r?(this.offset=t,this):o},s.writeVarint32ZigZag=function(e,t){return this.writeVarint32(i.zigZagEncode32(e),t)},s.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=0,o=0;do{if(!this.noAssert&&e>this.limit){var i=Error("Truncated");throw i.truncated=!0,i}r=this.view[e++],n<5&&(o|=(127&r)<<7*n),++n}while(0!=(128&r));return o|=0,t?(this.offset=e,o):{value:o,length:n}},s.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"==typeof t?t.value=i.zigZagDecode32(t.value):t=i.zigZagDecode32(t),t},e&&(i.MAX_VARINT64_BYTES=10,i.calculateVarint64=function(t){"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t));var r=t.toInt()>>>0,n=t.shiftRightUnsigned(28).toInt()>>>0,o=t.shiftRightUnsigned(56).toInt()>>>0;return 0==o?0==n?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:o<128?9:10},i.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},i.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},s.writeVarint64=function(t,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned());var o=i.calculateVarint64(t),s=t.toInt()>>>0,a=t.shiftRightUnsigned(28).toInt()>>>0,l=t.shiftRightUnsigned(56).toInt()>>>0;r+=o;var u=this.buffer.byteLength;switch(r>u&&this.resize((u*=2)>r?u:r),r-=o,o){case 10:this.view[r+9]=l>>>7&1;case 9:this.view[r+8]=9!==o?128|l:127&l;case 8:this.view[r+7]=8!==o?a>>>21|128:a>>>21&127;case 7:this.view[r+6]=7!==o?a>>>14|128:a>>>14&127;case 6:this.view[r+5]=6!==o?a>>>7|128:a>>>7&127;case 5:this.view[r+4]=5!==o?128|a:127&a;case 4:this.view[r+3]=4!==o?s>>>21|128:s>>>21&127;case 3:this.view[r+2]=3!==o?s>>>14|128:s>>>14&127;case 2:this.view[r+1]=2!==o?s>>>7|128:s>>>7&127;case 1:this.view[r]=1!==o?128|s:127&s}return n?(this.offset+=o,this):o},s.writeVarint64ZigZag=function(e,t){return this.writeVarint64(i.zigZagEncode64(e),t)},s.readVarint64=function(t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=t,o=0,i=0,s=0,a=0;if(a=this.view[t++],o=127&a,128&a&&(a=this.view[t++],o|=(127&a)<<7,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],o|=(127&a)<<14,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],o|=(127&a)<<21,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],i=127&a,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],i|=(127&a)<<7,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],i|=(127&a)<<14,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],i|=(127&a)<<21,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],s=127&a,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],s|=(127&a)<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var l=e.fromBits(o|i<<28,i>>>4|s<<24,!1);return r?(this.offset=t,l):{value:l,length:t-n}},s.readVarint64ZigZag=function(t){var r=this.readVarint64(t);return r&&r.value instanceof e?r.value=i.zigZagDecode64(r.value):r=i.zigZagDecode64(r),r}),s.writeCString=function(e,r){var n=void 0===r;n&&(r=this.offset);var o,i=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(o=0;o<i;++o)if(0===e.charCodeAt(o))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}i=c.calculateUTF16asUTF8(t(e))[1],r+=i+1;var s=this.buffer.byteLength;return r>s&&this.resize((s*=2)>r?s:r),r-=i+1,c.encodeUTF16toUTF8(t(e),function(e){this.view[r++]=e}.bind(this)),this.view[r++]=0,n?(this.offset=r,this):i},s.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var n,o=e,i=-1;return c.decodeUTF8toUTF16(function(){if(0===i)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(i=this.view[e++])?null:i}.bind(this),n=r(),!0),t?(this.offset=e,n()):{string:n(),length:e-o}},s.writeIString=function(e,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,i=r;o=c.calculateUTF16asUTF8(t(e),this.noAssert)[1],r+=4+o;var s=this.buffer.byteLength;if(r>s&&this.resize((s*=2)>r?s:r),r-=4+o,this.littleEndian?(this.view[r+3]=o>>>24&255,this.view[r+2]=o>>>16&255,this.view[r+1]=o>>>8&255,this.view[r]=255&o):(this.view[r]=o>>>24&255,this.view[r+1]=o>>>16&255,this.view[r+2]=o>>>8&255,this.view[r+3]=255&o),r+=4,c.encodeUTF16toUTF8(t(e),function(e){this.view[r++]=e}.bind(this)),r!==i+4+o)throw RangeError("Illegal range: Truncated data, "+r+" == "+(r+4+o));return n?(this.offset=r,this):r-i},s.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,n=this.readUint32(e),o=this.readUTF8String(n,i.METRICS_BYTES,e+=4);return e+=o.length,t?(this.offset=e,o.string):{string:o.string,length:e-r}},i.METRICS_CHARS="c",i.METRICS_BYTES="b",s.writeUTF8String=function(e,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,i=r;o=c.calculateUTF16asUTF8(t(e))[1],r+=o;var s=this.buffer.byteLength;return r>s&&this.resize((s*=2)>r?s:r),r-=o,c.encodeUTF16toUTF8(t(e),function(e){this.view[r++]=e}.bind(this)),n?(this.offset=r,this):r-i},s.writeString=s.writeUTF8String,i.calculateUTF8Chars=function(e){return c.calculateUTF16asUTF8(t(e))[0]},i.calculateUTF8Bytes=function(e){return c.calculateUTF16asUTF8(t(e))[1]},i.calculateString=i.calculateUTF8Bytes,s.readUTF8String=function(e,t,n){"number"==typeof t&&(n=t,t=void 0);var o=void 0===n;if(o&&(n=this.offset),void 0===t&&(t=i.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var s,a=0,l=n;if(t===i.METRICS_CHARS){if(s=r(),c.decodeUTF8(function(){return a<e&&n<this.limit?this.view[n++]:null}.bind(this),function(e){++a,c.UTF8toUTF16(e,s)}),a!==e)throw RangeError("Illegal range: Truncated data, "+a+" == "+e);return o?(this.offset=n,s()):{string:s(),length:n-l}}if(t===i.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+"+e+") <= "+this.buffer.byteLength)}var u=n+e;if(c.decodeUTF8toUTF16(function(){return n<u?this.view[n++]:null}.bind(this),s=r(),this.noAssert),n!==u)throw RangeError("Illegal range: Truncated data, "+n+" == "+u);return o?(this.offset=n,s()):{string:s(),length:n-l}}throw TypeError("Unsupported metrics: "+t)},s.readString=s.readUTF8String,s.writeVString=function(e,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,s,a=r;o=c.calculateUTF16asUTF8(t(e),this.noAssert)[1],s=i.calculateVarint32(o),r+=s+o;var l=this.buffer.byteLength;if(r>l&&this.resize((l*=2)>r?l:r),r-=s+o,r+=this.writeVarint32(o,r),c.encodeUTF16toUTF8(t(e),function(e){this.view[r++]=e}.bind(this)),r!==a+o+s)throw RangeError("Illegal range: Truncated data, "+r+" == "+(r+o+s));return n?(this.offset=r,this):r-a},s.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=this.readVarint32(e),o=this.readUTF8String(n.value,i.METRICS_BYTES,e+=n.length);return e+=o.length,t?(this.offset=e,o.string):{string:o.string,length:e-r}},s.append=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof i||(e=i.wrap(e,t));var o=e.limit-e.offset;if(o<=0)return this;r+=o;var s=this.buffer.byteLength;return r>s&&this.resize((s*=2)>r?s:r),r-=o,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=o,n&&(this.offset+=o),this},s.appendTo=function(e,t){return e.append(this,t),this},s.assert=function(e){return this.noAssert=!e,this},s.capacity=function(){return this.buffer.byteLength},s.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},s.clone=function(e){var t=new i(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},s.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var r=t-e;if(0===r)return this.buffer=a,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var n=new ArrayBuffer(r),o=new Uint8Array(n);return o.set(this.view.subarray(e,t)),this.buffer=n,this.view=o,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=r,this},s.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new i(0,this.littleEndian,this.noAssert);var r=t-e,n=new i(r,this.littleEndian,this.noAssert);return n.offset=0,n.limit=r,n.markedOffset>=0&&(n.markedOffset-=e),this.copyTo(n,0,e,t),n},s.copyTo=function(e,t,r,n){var o,s;if(!this.noAssert&&!i.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(s=void 0===t)?e.offset:0|t,r=(o=void 0===r)?this.offset:0|r,n=void 0===n?this.limit:0|n,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(r<0||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=n-r;return 0===a?e:(e.ensureCapacity(t+a),e.view.set(this.view.subarray(r,n),t),o&&(this.offset+=a),s&&(e.offset+=a),this)},s.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},s.fill=function(e,t,r){var n=void 0===t;if(n&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||t>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(t>=r)return this;for(;t<r;)this.view[t++]=e;return n&&(this.offset=t),this},s.flip=function(){return this.limit=this.offset,this.offset=0,this},s.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},s.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},s.LE=function(e){return this.littleEndian=void 0===e||!!e,this},s.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},s.prepend=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof i||(e=i.wrap(e,t));var o=e.limit-e.offset;if(o<=0)return this;var s=o-r;if(s>0){var a=new ArrayBuffer(this.buffer.byteLength+s),l=new Uint8Array(a);l.set(this.view.subarray(r,this.buffer.byteLength),o),this.buffer=a,this.view=l,this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,r+=s}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),r-o),e.offset=e.limit,n&&(this.offset-=o),this},s.prependTo=function(e,t){return e.prepend(this,t),this},s.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},s.remaining=function(){return this.limit-this.offset},s.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},s.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),r=new Uint8Array(t);r.set(this.view),this.buffer=t,this.view=r}return this},s.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t?this:(Array.prototype.reverse.call(this.view.subarray(e,t)),this)},s.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},s.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},s.toBuffer=function(e){var t=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,t<0||t>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(!e&&0===t&&r===this.buffer.byteLength)return this.buffer;if(t===r)return a;var n=new ArrayBuffer(r-t);return new Uint8Array(n).set(new Uint8Array(this.buffer).subarray(t,r),0),n},s.toArrayBuffer=s.toBuffer,s.toString=function(e,t,r){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(e="utf8",t=e,r=t),e){case"utf8":return this.toUTF8(t,r);case"base64":return this.toBase64(t,r);case"hex":return this.toHex(t,r);case"binary":return this.toBinary(t,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var u=function(){for(var e={},t=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],r=[],n=0,o=t.length;n<o;++n)r[t[n]]=n;return e.encode=function(e,r){for(var n,o;null!==(n=e());)r(t[n>>2&63]),o=(3&n)<<4,null!==(n=e())?(r(t[63&((o|=n>>4&15)|n>>4&15)]),o=(15&n)<<2,null!==(n=e())?(r(t[63&(o|n>>6&3)]),r(t[63&n])):(r(t[63&o]),r(61))):(r(t[63&o]),r(61),r(61))},e.decode=function(e,t){function n(e){throw Error("Illegal character code: "+e)}for(var o,i,s;null!==(o=e());)if(void 0===(i=r[o])&&n(o),null!==(o=e())&&(void 0===(s=r[o])&&n(o),t(i<<2>>>0|(48&s)>>4),null!==(o=e()))){if(void 0===(i=r[o])){if(61===o)break;n(o)}if(t((15&s)<<4>>>0|(60&i)>>2),null!==(o=e())){if(void 0===(s=r[o])){if(61===o)break;n(o)}t((3&i)<<6>>>0|s)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();s.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),e|=0,t|=0,e<0||t>this.capacity||e>t)throw RangeError("begin, end");var n;return u.encode(function(){return e<t?this.view[e++]:null}.bind(this),n=r()),n()},i.fromBase64=function(e,r){if("string"!=typeof e)throw TypeError("str");var n=new i(e.length/4*3,r),o=0;return u.decode(t(e),function(e){n.view[o++]=e}),n.limit=o,n},i.btoa=function(e){return i.fromBinary(e).toBase64()},i.atob=function(e){return i.fromBase64(e).toBinary()},s.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),e|=0,t|=0,e<0||t>this.capacity()||e>t)throw RangeError("begin, end");if(e===t)return"";for(var r=[],n=[];e<t;)r.push(this.view[e++]),r.length>=1024&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},i.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var r,n=0,o=e.length,s=new i(o,t);n<o;){if((r=e.charCodeAt(n))>255)throw RangeError("illegal char code: "+r);s.view[n++]=r}return s.limit=o,s},s.toDebug=function(e){for(var t,r=-1,n=this.buffer.byteLength,o="",i="",s="";r<n;){if(-1!==r&&(o+=(t=this.view[r])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(i+=t>32&&t<127?String.fromCharCode(t):".")),++r,e&&r>0&&r%16==0&&r!==n){for(;o.length<51;)o+=" ";s+=o+i+"\n",o=i=""}r===this.offset&&r===this.limit?o+=r===this.markedOffset?"!":"|":r===this.offset?o+=r===this.markedOffset?"[":"<":r===this.limit?o+=r===this.markedOffset?"]":">":o+=r===this.markedOffset?"'":e||0!==r&&r!==n?" ":""}if(e&&" "!==o){for(;o.length<51;)o+=" ";s+=o+i+"\n"}return e?s:o},i.fromDebug=function(e,t,r){for(var n,o,s=e.length,a=new i((s+1)/3|0,t,r),l=0,u=0,c=!1,d=!1,p=!1,f=!1,h=!1;l<s;){switch(n=e.charAt(l++)){case"!":if(!r){if(d||p||f){h=!0;break}d=p=f=!0}a.offset=a.markedOffset=a.limit=u,c=!1;break;case"|":if(!r){if(d||f){h=!0;break}d=f=!0}a.offset=a.limit=u,c=!1;break;case"[":if(!r){if(d||p){h=!0;break}d=p=!0}a.offset=a.markedOffset=u,c=!1;break;case"<":if(!r){if(d){h=!0;break}d=!0}a.offset=u,c=!1;break;case"]":if(!r){if(f||p){h=!0;break}f=p=!0}a.limit=a.markedOffset=u,c=!1;break;case">":if(!r){if(f){h=!0;break}f=!0}a.limit=u,c=!1;break;case"'":if(!r){if(p){h=!0;break}p=!0}a.markedOffset=u,c=!1;break;case" ":c=!1;break;default:if(!r&&c){h=!0;break}if(o=parseInt(n+e.charAt(l++),16),!r&&(isNaN(o)||o<0||o>255))throw TypeError("Illegal str: Not a debug encoded string");a.view[u++]=o,c=!0}if(h)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!r){if(!d||!f)throw TypeError("Illegal str: Missing offset or limit");if(u<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+u+" < "+s)}return a},s.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,n=new Array(t-e);e<t;)(r=this.view[e++])<16?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},i.fromHex=function(e,t,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var n,o=e.length,s=new i(o/2|0,t),a=0,l=0;a<o;a+=2){if(n=parseInt(e.substring(a,a+2),16),!r&&(!isFinite(n)||n<0||n>255))throw TypeError("Illegal str: Contains non-hex characters");s.view[l++]=n}return s.limit=l,s};var c=function(){var e={};return e.MAX_CODEPOINT=1114111,e.encodeUTF8=function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<128?t(127&r):r<2048?(t(r>>6&31|192),t(63&r|128)):r<65536?(t(r>>12&15|224),t(r>>6&63|128),t(63&r|128)):(t(r>>18&7|240),t(r>>12&63|128),t(r>>6&63|128),t(63&r|128)),r=null},e.decodeUTF8=function(e,t){for(var r,n,o,i,s=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0==(128&r))t(r);else if(192==(224&r))null===(n=e())&&s([r,n]),t((31&r)<<6|63&n);else if(224==(240&r))(null===(n=e())||null===(o=e()))&&s([r,n,o]),t((15&r)<<12|(63&n)<<6|63&o);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=e())||null===(o=e())||null===(i=e()))&&s([r,n,o,i]),t((7&r)<<18|(63&n)<<12|(63&o)<<6|63&i)}},e.UTF16toUTF8=function(e,t){for(var r,n=null;;){if(null===(r=null!==n?n:e()))break;r>=55296&&r<=57343&&null!==(n=e())&&n>=56320&&n<=57343?(t(1024*(r-55296)+n-56320+65536),n=null):t(r)}null!==n&&t(n)},e.UTF8toUTF16=function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<=65535?t(r):(r-=65536,t(55296+(r>>10)),t(r%1024+56320)),r=null},e.encodeUTF16toUTF8=function(t,r){e.UTF16toUTF8(t,function(t){e.encodeUTF8(t,r)})},e.decodeUTF8toUTF16=function(t,r){e.decodeUTF8(t,function(t){e.UTF8toUTF16(t,r)})},e.calculateCodePoint=function(e){return e<128?1:e<2048?2:e<65536?3:4},e.calculateUTF8=function(e){for(var t,r=0;null!==(t=e());)r+=t<128?1:t<2048?2:t<65536?3:4;return r},e.calculateUTF16asUTF8=function(t){var r=0,n=0;return e.UTF16toUTF8(t,function(e){++r,n+=e<128?1:e<2048?2:e<65536?3:4}),[r,n]},e}();return s.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var n;try{c.decodeUTF8toUTF16(function(){return e<t?this.view[e++]:null}.bind(this),n=r())}catch(r){if(e!==t)throw RangeError("Illegal range: Truncated data, "+e+" != "+t)}return n()},i.fromUTF8=function(e,r,n){if(!n&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var o=new i(c.calculateUTF16asUTF8(t(e),!0)[1],r,n),s=0;return c.encodeUTF16toUTF8(t(e),function(e){o.view[s++]=e}),o.limit=s,o},i}),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.log4javascript=e()}(function(){function isUndefined(e){return void 0===e}function EventSupport(){}function Log4JavaScript(){}function toStr(e){return e&&e.toString?e.toString():String(e)}function getExceptionMessage(e){return e.message?e.message:e.description?e.description:toStr(e)}function getUrlFileName(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function getExceptionStringRep(e){if(e){var t="Exception: "+getExceptionMessage(e);try{e.lineNumber&&(t+=" on line number "+e.lineNumber),e.fileName&&(t+=" in file "+getUrlFileName(e.fileName))}catch(e){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&e.stack&&(t+=newLine+"Stack trace:"+newLine+e.stack),t}return null}function bool(e){return Boolean(e)}function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}function array_remove(e,t){for(var r=-1,n=0,o=e.length;n<o;n++)if(e[n]===t){r=n;break}return r>=0&&(e.splice(r,1),!0)}function array_contains(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]==t)return!0;return!1}function extractBooleanFromParam(e,t){return isUndefined(e)?t:bool(e)}function extractStringFromParam(e,t){return isUndefined(e)?t:String(e)}function extractIntFromParam(e,t){if(isUndefined(e))return t;try{var r=parseInt(e,10);return isNaN(r)?t:r}catch(r){return logLog.warn("Invalid int param "+e,r),t}}function extractFunctionFromParam(e,t){return"function"==typeof e?e:t}function isError(e){return e instanceof Error}function handleError(e,t){logLog.error(e,t),log4javascript.dispatchEvent("error",{message:e,exception:t})}function Timer(e,t){this.name=e,this.level=isUndefined(t)?Level.INFO:t,this.start=new Date}function Logger(e){this.name=e,this.parent=null,this.children=[];var t=[],r=null,n=this.name===rootLoggerName,o=this.name===nullLoggerName,i=null,s=!1;this.addChild=function(e){this.children.push(e),e.parent=this,e.invalidateAppenderCache()};var a=!0;this.getAdditivity=function(){return a},this.setAdditivity=function(e){var t=a!=e;a=e,t&&this.invalidateAppenderCache()},this.addAppender=function(e){o?handleError("Logger.addAppender: you may not add an appender to the null logger"):e instanceof log4javascript.Appender?array_contains(t,e)||(t.push(e),e.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(e)+"') is not a subclass of Appender")},this.removeAppender=function(e){array_remove(t,e),e.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var e=t.length;if(e>0){for(var r=0;r<e;r++)t[r].setRemovedFromLogger(this);t.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===i||s){var e=n||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();i=e.concat(t),s=!1}return i},this.invalidateAppenderCache=function(){s=!0;for(var e=0,t=this.children.length;e<t;e++)this.children[e].invalidateAppenderCache()},this.log=function(e,t){if(enabled&&e.isGreaterOrEqual(this.getEffectiveLevel())){var r,n=t.length-1,o=t[n];t.length>1&&isError(o)&&(r=o,n--);for(var i=[],s=0;s<=n;s++)i[s]=t[s];var a=new LoggingEvent(this,new Date,e,i,r);this.callAppenders(a)}"undefined"!=typeof logAjax&&logAjax.enabled&&e.level>=logAjax.level&&saveLog(e.name,t[0],t[1])},this.callAppenders=function(e){for(var t=this.getEffectiveAppenders(),r=0,n=t.length;r<n;r++)t[r].doAppend(e)},this.setLevel=function(e){n&&null===e?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):e instanceof Level?r=e:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return r},this.getEffectiveLevel=function(){for(var e=this;null!==e;e=e.parent){var t=e.getLevel();if(null!==t)return t}},this.group=function(e,t){if(enabled)for(var r=this.getEffectiveAppenders(),n=0,o=r.length;n<o;n++)r[n].group(e,t)},this.groupEnd=function(){if(enabled)for(var e=this.getEffectiveAppenders(),t=0,r=e.length;t<r;t++)e[t].groupEnd()};var l={};this.time=function(e,t){enabled&&(isUndefined(e)?handleError("Logger.time: a name for the timer must be supplied"):!t||t instanceof Level?l[e]=new Timer(e,t):handleError("Logger.time: level supplied to timer "+e+" is not an instance of log4javascript.Level"))},this.timeEnd=function(e){if(enabled)if(isUndefined(e))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(l[e]){var t=l[e],r=t.getElapsedTime();this.log(t.level,["Timer "+toStr(e)+" completed in "+r+"ms"]),delete l[e]}else logLog.warn("Logger.timeEnd: no timer found with name "+e)},this.assert=function(e){if(enabled&&!e){for(var t=[],r=1,n=arguments.length;r<n;r++)t.push(arguments[r]);(t=t.length>0?t:["Assertion Failure"]).push(newLine),t.push(e),this.log(Level.ERROR,t)}},this.toString=function(){return"Logger["+this.name+"]"}}function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(e){this.combineMessages=extractBooleanFromParam(e,!0),this.customFields=[]}function escapeNewLines(e){return e.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(e,t){this.readable=extractBooleanFromParam(e,!1),this.combineMessages=extractBooleanFromParam(t,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(e,t,r){function n(e,t,r){function i(e){for(var t=splitIntoLines(e),n=1,o=t.length;n<o;n++)t[n]=r+t[n];return t.join(newLine)}var s,a,l,u,c,d,p;if(r||(r=""),null===e)return"null";if(void 0===e)return"undefined";if("string"==typeof e)return i(e);if("object"==typeof e&&array_contains(o,e)){try{d=toStr(e)}catch(e){d="Error formatting property. Details: "+getExceptionStringRep(e)}return d+" [already expanded]"}if(e instanceof Array&&t>0){for(o.push(e),d="["+newLine,l=t-1,u=r+"  ",c=[],s=0,a=e.length;s<a;s++)try{p=n(e[s],l,u),c.push(u+p)}catch(e){c.push(u+"Error formatting array member. Details: "+getExceptionStringRep(e))}return d+=c.join(","+newLine)+newLine+r+"]"}if("[object Date]"==Object.prototype.toString.call(e))return e.toString();if("object"==typeof e&&t>0){o.push(e),d="{"+newLine,l=t-1,u=r+"  ",c=[];for(s in e)try{p=n(e[s],l,u),c.push(u+s+": "+p)}catch(e){c.push(u+s+": Error formatting property. Details: "+getExceptionStringRep(e))}return d+=c.join(","+newLine)+newLine+r+"}"}return i(toStr(e))}var o=[];return n(e,t,r)}function PatternLayout(e){this.pattern=e||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}function isHttpRequestSuccessful(e){return isUndefined(e.status)||0===e.status||e.status>=200&&e.status<300||1223==e.status}function AjaxAppender(e,t){function r(e){return!I||(handleError("AjaxAppender: configuration option '"+e+"' may not be set after the appender has been initialized"),!1)}function n(){if(d&&enabled){T=!0;var e;if(f)C.length>0?l(i(e=C.shift()),n):(T=!1,p&&s());else{for(;e=C.shift();)l(i(e));T=!1,p&&s()}}}function o(){var e=!1;if(d&&enabled){for(var t,r=c.getLayout().allowBatching()?h:1,o=[];t=E.shift();)o.push(t),E.length>=r&&(C.push(o),o=[]);o.length>0&&C.push(o),e=C.length>0,f=!1,p=!1,n()}return e}function i(e){for(var t,r=[],n="";t=e.shift();)r.push(c.getLayout().formatWithException(t));return n=1==e.length?r.join(""):c.getLayout().batchHeader+r.join(c.getLayout().batchSeparator)+c.getLayout().batchFooter,S==c.defaults.contentType&&((n=c.getLayout().returnsPostData?n:urlEncode(y)+"="+urlEncode(n)).length>0&&(n+="&"),n+="layout="+urlEncode(c.getLayout().toString())),n}function s(){window.setTimeout(n,m)}function a(){var e="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(e),d=!1,v&&v(e)}function l(r,n){try{var o=getXmlHttp(a);if(d){o.onreadystatechange=function(){if(4==o.readyState){if(isHttpRequestSuccessful(o))g&&g(o),n&&n(o);else{var t="AjaxAppender.append: XMLHttpRequest request to URL "+e+" returned status code "+o.status;handleError(t),v&&v(t)}o.onreadystatechange=emptyFunction,o=null}},o.open("POST",e,!0),t&&withCredentialsSupported&&(o.withCredentials=!0);try{for(var i,s=0;i=P[s++];)o.setRequestHeader(i.name,i.value);o.setRequestHeader("Content-Type",S)}catch(e){var l="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(l),d=!1,void(v&&v(l))}o.send(r)}}catch(t){var u="AjaxAppender.append: error sending log message to "+e;handleError(u,t),d=!1,v&&v(u+". Details: "+getExceptionStringRep(t))}}function u(){if(I=!0,b){var e=window.onbeforeunload;window.onbeforeunload=function(){e&&e(),o()}}p&&s()}var c=this,d=!0;e||(handleError("AjaxAppender: URL must be specified in constructor"),d=!1);var p=this.defaults.timed,f=this.defaults.waitForResponse,h=this.defaults.batchSize,m=this.defaults.timerInterval,g=this.defaults.requestSuccessCallback,v=this.defaults.failCallback,y=this.defaults.postVarName,b=this.defaults.sendAllOnUnload,S=this.defaults.contentType,w=null,E=[],C=[],P=[],T=!1,I=!1;this.getSessionId=function(){return w},this.setSessionId=function(e){w=extractStringFromParam(e,null),this.layout.setCustomField("sessionid",w)},this.setLayout=function(e){r("layout")&&(this.layout=e,null!==w&&this.setSessionId(w))},this.isTimed=function(){return p},this.setTimed=function(e){r("timed")&&(p=bool(e))},this.getTimerInterval=function(){return m},this.setTimerInterval=function(e){r("timerInterval")&&(m=extractIntFromParam(e,m))},this.isWaitForResponse=function(){return f},this.setWaitForResponse=function(e){r("waitForResponse")&&(f=bool(e))},this.getBatchSize=function(){return h},this.setBatchSize=function(e){r("batchSize")&&(h=extractIntFromParam(e,h))},this.isSendAllOnUnload=function(){return b},this.setSendAllOnUnload=function(e){r("sendAllOnUnload")&&(b=extractBooleanFromParam(e,b))},this.setRequestSuccessCallback=function(e){g=extractFunctionFromParam(e,g)},this.setFailCallback=function(e){v=extractFunctionFromParam(e,v)},this.getPostVarName=function(){return y},this.setPostVarName=function(e){r("postVarName")&&(y=extractStringFromParam(e,y))},this.getHeaders=function(){return P},this.addHeader=function(e,t){"content-type"==e.toLowerCase()?S=t:P.push({name:e,value:t})},this.sendAll=n,this.sendAllRemaining=o,this.append=function(e){if(d){I||u(),E.push(e);var t=this.getLayout().allowBatching()?h:1;if(E.length>=t){for(var r,o=[];r=E.shift();)o.push(r);C.push(o),p||f&&(!f||T)||n()}}}}function setCookie(e,t,r,n){var o;if(n=n?"; path="+n:"",r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";document.cookie=escape(e)+"="+escape(t)+o+n}function getCookie(e){for(var t=escape(e)+"=",r=document.cookie.split(";"),n=0,o=r.length;n<o;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null}function getBaseUrl(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t)if(-1!=e[t].src.indexOf("log4javascript")){var n=e[t].src.lastIndexOf("/");return-1==n?"":e[t].src.substr(0,n+1)}return null}function isLoaded(e){try{return bool(e.loaded)}catch(e){return!1}}function padWithSpaces(e,t){if(e.length<t){for(var r=[],n=Math.max(0,t-e.length),o=0;o<n;o++)r[o]=" ";e+=r.join("")}return e}function createDefaultLogger(){var e=log4javascript.getLogger(defaultLoggerName),t=new log4javascript.PopUpAppender;return e.addAppender(t),e}Array.prototype.push||(Array.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(this.length>0){for(var e=this[0],t=0,r=this.length-1;t<r;t++)this[t]=this[t+1];return this.length=this.length-1,e}}),Array.prototype.splice||(Array.prototype.splice=function(e,t){var r=this.slice(e+t),n=this.slice(e,e+t);this.length=e;for(var o=[],i=0,s=arguments.length;i<s;i++)o[i]=arguments[i];var a=o.length>2?r=o.slice(2).concat(r):r;for(i=0,s=a.length;i<s;i++)this.push(a[i]);return n}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(e){if(e instanceof Array){this.eventTypes=e,this.eventListeners={};for(var t=0,r=this.eventTypes.length;t<r;t++)this.eventListeners[this.eventTypes[t]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+e+"'"),this.eventListeners[e].push(t)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+e+"'"),array_remove(this.eventListeners[e],t)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(e,t){if(array_contains(this.eventTypes,e))for(var r=this.eventListeners[e],n=0,o=r.length;n<o;n++)r[n](this,e,t);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+e+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(e){return encodeURIComponent(e)}:function(e){return escape(e).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=[],r=1,n=arguments.length;r<n;r++)t[r-1]=arguments[r];return this.apply(e,t)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(e){this.quietMode=bool(e)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(e){this.alertAllErrors=e},debug:function(e){this.debugMessages.push(e)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(e,t){},error:function(e,t){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var r="log4javascript error: "+e;t&&(r+=newLine+newLine+"Original error: "+getExceptionStringRep(t)),alert(r)}}};log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(e){enabled=bool(e)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(e){useTimeStampsInMilliseconds=bool(e)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(e){showStackTraces=bool(e)};var Level=function(e,t){this.level=e,this.name=t};Level.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(e){return e.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(e){if("string"!=typeof e&&(e=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(e)+" supplied, returning anonymous logger")),e==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[e]){var t=new Logger(e);loggers[e]=t,loggerNames.push(e);var r,n=e.lastIndexOf(".");if(n>-1){var o=e.substring(0,n);r=log4javascript.getLogger(o)}else r=rootLogger;r.addChild(t)}return loggers[e]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(e,t,r,n,o){this.logger=e,this.timeStamp=t,this.timeStampInMilliseconds=t.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=r,this.messages=n,this.exception=o};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(e){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(e)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(e){return this.isTimeStampsInMilliseconds()?e.timeStampInMilliseconds:e.timeStampInSeconds},getDataValues:function(e,t){var r=[[this.loggerKey,e.logger.name],[this.timeStampKey,this.getTimeStampValue(e)],[this.levelKey,e.level.name],[this.urlKey,window.location.href],[this.messageKey,t?e.getCombinedMessages():e.messages]];if(this.isTimeStampsInMilliseconds()||r.push([this.millisecondsKey,e.milliseconds]),e.exception&&r.push([this.exceptionKey,getExceptionStringRep(e.exception)]),this.hasCustomFields())for(var n=0,o=this.customFields.length;n<o;n++){var i=this.customFields[n].value;"function"==typeof i&&(i=i(this,e)),r.push([this.customFields[n].name,i])}return r},setKeys:function(e,t,r,n,o,i,s){this.loggerKey=extractStringFromParam(e,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(t,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(r,this.defaults.levelKey),this.messageKey=extractStringFromParam(n,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(o,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(i,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(s,this.defaults.millisecondsKey)},setCustomField:function(e,t){for(var r=!1,n=0,o=this.customFields.length;n<o;n++)this.customFields[n].name===e&&(this.customFields[n].value=t,r=!0);r||this.customFields.push({name:e,value:t})},hasCustomFields:function(){return this.customFields.length>0},formatWithException:function(e){var t=this.format(e);return e.exception&&this.ignoresThrowable()&&(t+=e.getThrowableStrRep()),t},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(e){enabled&&e.level.level>=this.threshold.level&&this.append(e)},Appender.prototype.append=function(e){},Appender.prototype.setLayout=function(e){e instanceof Layout?this.layout=e:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(e){e instanceof Level?this.threshold=e:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(e){this.loggers.push(e)},Appender.prototype.setRemovedFromLogger=function(e){array_remove(this.loggers,e)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(e){return e.level.name+" - "+e.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(e){return e.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(e){var t=e.messages,r=e.exception;return r?t.concat([r]):t},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(e){return e.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(e){function t(e){return e="string"==typeof e?e:toStr(e),"<log4javascript:message><![CDATA["+o.escapeCdata(e)+"]]></log4javascript:message>"}var r,n,o=this,i='<log4javascript:event logger="'+e.logger.name+'" timestamp="'+this.getTimeStampValue(e)+'"';if(this.isTimeStampsInMilliseconds()||(i+=' milliseconds="'+e.milliseconds+'"'),i+=' level="'+e.level.name+'">'+newLine,this.combineMessages)i+=t(e.getCombinedMessages());else{for(i+="<log4javascript:messages>"+newLine,r=0,n=e.messages.length;r<n;r++)i+=t(e.messages[r])+newLine;i+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(r=0,n=this.customFields.length;r<n;r++)i+='<log4javascript:customfield name="'+this.customFields[r].name+'"><![CDATA['+this.customFields[r].value.toString()+"]]></log4javascript:customfield>"+newLine;return e.exception&&(i+="<log4javascript:exception><![CDATA["+getExceptionStringRep(e.exception)+"]]></log4javascript:exception>"+newLine),i+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(e){function t(e,r,n){var i,s=typeof e;if(e instanceof Date)i=String(e.getTime());else if(n&&e instanceof Array){i="["+o.lineBreak;for(var a=0,l=e.length;a<l;a++){var u=r+o.tab;i+=u+t(e[a],u,!1),a<e.length-1&&(i+=","),i+=o.lineBreak}i+=r+"]"}else i="number"!==s&&"boolean"!==s?'"'+escapeNewLines(toStr(e).replace(/\"/g,'\\"'))+'"':e;return i}var r,n,o=this,i=this.getDataValues(e,this.combineMessages),s="{"+this.lineBreak;for(r=0,n=i.length-1;r<=n;r++)s+=this.tab+'"'+i[r][0]+'"'+this.colon+t(i[r][1],this.tab,!0),r<n&&(s+=","),s+=this.lineBreak;return s+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(e){for(var t=this.getDataValues(e),r=[],n=0,o=t.length;n<o;n++){var i=t[n][1]instanceof Date?String(t[n][1].getTime()):t[n][1];r.push(urlEncode(t[n][0])+"="+urlEncode(i))}return r.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(e){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout;var SimpleDateFormat;!function(){var e=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,t=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5},o=function(e,t,r){var n=new Date(e,t,r,0,0,0);return n.setMilliseconds(0),n};Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),t=new Date(e.getTime()-864e5*this.getDay());return o(t.getFullYear(),t.getMonth(),t.getDate())},Date.prototype.getWeekInYear=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=o(this.getFullYear(),0,1),n=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return 7-r.getDay()<e&&n--,n},Date.prototype.getWeekInMonth=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=o(this.getFullYear(),this.getMonth(),1),n=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return 7-r.getDay()>=e&&n++,n},Date.prototype.getDayInYear=function(){var e=o(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/864e5)},(SimpleDateFormat=function(e){this.formatString=e}).prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};var i=function(e,t){for(;e.length<t;)e="0"+e;return e},s=function(e,t,r){return t>=4?e:e.substr(0,Math.max(r,t))},a=function(e,t){return i(""+e,t)};SimpleDateFormat.prototype.format=function(o){for(var l,u="",c=this.formatString;l=e.exec(c);){var d=l[1],p=l[2],f=l[3],h=l[4];if(d)u+="''"==d?"'":d.substring(1,d.length-1);else if(f);else if(h)u+=h;else if(p){var m=p.charAt(0),g=p.length,v="";switch(m){case"G":v="AD";break;case"y":v=o.getFullYear();break;case"M":v=o.getMonth();break;case"w":v=o.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":v=o.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":v=o.getDayInYear();break;case"d":v=o.getDate();break;case"F":v=1+Math.floor((o.getDate()-1)/7);break;case"E":v=r[o.getDay()];break;case"a":v=o.getHours()>=12?"PM":"AM";break;case"H":v=o.getHours();break;case"k":v=o.getHours()||24;break;case"K":v=o.getHours()%12;break;case"h":v=o.getHours()%12||12;break;case"m":v=o.getMinutes();break;case"s":v=o.getSeconds();break;case"S":v=o.getMilliseconds();break;case"Z":v=o.getTimezoneOffset()}switch(n[m]){case 0:u+=s(v,g,2);break;case 1:u+=s(v,g,3);break;case 2:u+=a(v,g);break;case 3:u+=g<=3?(""+v).substr(2,2):a(v,g);break;case 4:u+=g>=3?s(t[v],g,g):a(v+1,g);break;case 5:var y=v>0?"-":"+",b=Math.abs(v),S=""+Math.floor(b/60),w=""+b%60;u+=y+(S=i(S,2))+(w=i(w,2))}}c=c.substr(l.index+l[0].length)}return u}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(e){for(var t,r=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,n="",o=this.pattern;t=r.exec(o);){var i=t[0],s=t[1],a=t[2],l=t[3],u=t[5],c=t[6];if(c)n+=""+c;else{var d="";switch(l){case"a":case"m":var p=0;u&&(p=parseInt(u,10),isNaN(p)&&(handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character '"+l+"' - should be a number"),p=0));for(var f="a"===l?e.messages[0]:e.messages,h=0,m=f.length;h<m;h++)h>0&&" "!==d.charAt(d.length-1)&&(d+=" "),d+=0===p?f[h]:formatObjectExpansion(f[h],p);break;case"c":var g=e.logger.name;if(u){var v=parseInt(u,10),y=e.logger.name.split(".");d=v>=y.length?g:y.slice(y.length-v).join(".")}else d=g;break;case"d":var b=PatternLayout.ISO8601_DATEFORMAT;u&&("ISO8601"==(b=u)?b=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==b?b=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==b&&(b=PatternLayout.DATETIME_DATEFORMAT)),d=new SimpleDateFormat(b).format(e.timeStamp);break;case"f":if(this.hasCustomFields()){var S=0;u&&(S=parseInt(u,10),isNaN(S)?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - should be a number"):0===S?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - must be greater than zero"):S>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - there aren't that many custom fields"):S-=1);var w=this.customFields[S].value;"function"==typeof w&&(w=w(this,e)),d=w}break;case"n":d=newLine;break;case"p":d=e.level.name;break;case"r":d=""+e.timeStamp.getDifference(applicationStartDate);break;case"%":d="%";break;default:d=i}var E;if(a){E=parseInt(a.substr(1),10);var C=d.length;E<C&&(d=d.substring(C-E,C))}if(s)if("-"==s.charAt(0))for(E=parseInt(s.substr(1),10);d.length<E;)d+=" ";else for(E=parseInt(s,10);d.length<E;)d=" "+d;n+=d}o=o.substr(t.index+t[0].length)}return n},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(e){alert(this.getLayout().formatWithException(e))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(e){var t,r=this,n=function(){var t=r.getLayout().formatWithException(e);return"string"==typeof t?[t]:t};if((t=window.console)&&t.log){var o,i=n();t[o=t.debug&&Level.DEBUG.isGreaterOrEqual(e.level)?"debug":t.info&&Level.INFO.equals(e.level)?"info":t.warn&&Level.WARN.equals(e.level)?"warn":t.error&&e.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?t[o].apply(t,i):t[o](i)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(n())},BrowserConsoleAppender.prototype.group=function(e){window.console&&window.console.group&&window.console.group(e)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(e){for(var t,r=null,n=0,o=xmlHttpFactories.length;n<o;n++){t=xmlHttpFactories[n];try{return r=t(),withCredentialsSupported=t==xhrFactory&&"withCredentials"in r,getXmlHttp=t,r}catch(e){}}e?e():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")};AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender;var ConsoleAppender;if(function(){function e(e,t,r,n,o){this.create(!1,null,e,t,r,n,o,this.defaults.focusPopUp)}function t(e,t,r,n,o,i){this.create(!0,e,t,r,n,o,i,!1)}var r=[],n=1;(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(e,t,o,i,s,a,l,u){function c(e,t){this.loggingEvent=e,this.levelName=e.level.name,this.formattedMessage=t}function d(e,t){this.name=e,this.initiallyExpanded=t}function p(){}var f=this,h=!1,m=!1,g=!1,v=!1,y=[],b=!0,S=n++;i=extractBooleanFromParam(i,this.defaults.initiallyMinimized),o=extractBooleanFromParam(o,this.defaults.lazyInit),s=extractBooleanFromParam(s,this.defaults.useDocumentWrite);var w=this.defaults.newestMessageAtTop,E=this.defaults.scrollToLatestMessage;a=a||this.defaults.width,l=l||this.defaults.height;var C=this.defaults.maxMessages,P=this.defaults.showCommandLine,T=this.defaults.commandLineObjectExpansionDepth,I=this.defaults.showHideButton,R=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var _,x,M,U,A,L=e?"InPageAppender":"PopUpAppender",k=function(e){return!m||(handleError(L+": configuration option '"+e+"' may not be set after the appender has been initialized"),!1)},D=function(){return g&&b&&!v};this.isNewestMessageAtTop=function(){return w},this.setNewestMessageAtTop=function(e){w=bool(e),D()&&U().setNewestAtTop(w)},this.isScrollToLatestMessage=function(){return E},this.setScrollToLatestMessage=function(e){E=bool(e),D()&&U().setScrollToLatest(E)},this.getWidth=function(){return a},this.setWidth=function(e){k("width")&&(a=extractStringFromParam(e,a))},this.getHeight=function(){return l},this.setHeight=function(e){k("height")&&(l=extractStringFromParam(e,l))},this.getMaxMessages=function(){return C},this.setMaxMessages=function(e){C=extractIntFromParam(e,C),D()&&U().setMaxMessages(C)},this.isShowCommandLine=function(){return P},this.setShowCommandLine=function(e){P=bool(e),D()&&U().setShowCommandLine(P)},this.isShowHideButton=function(){return I},this.setShowHideButton=function(e){I=bool(e),D()&&U().setShowHideButton(I)},this.isShowCloseButton=function(){return R},this.setShowCloseButton=function(e){R=bool(e),D()&&U().setShowCloseButton(R)},this.getCommandLineObjectExpansionDepth=function(){return T},this.setCommandLineObjectExpansionDepth=function(e){T=extractIntFromParam(e,T)};var O=i;this.isInitiallyMinimized=function(){return i},this.setInitiallyMinimized=function(e){k("initiallyMinimized")&&(i=bool(e),O=i)},this.isUseDocumentWrite=function(){return s},this.setUseDocumentWrite=function(e){k("useDocumentWrite")&&(s=bool(e))},c.prototype.append=function(){U().log(this.levelName,this.formattedMessage)},d.prototype.append=function(){U().group(this.name,this.initiallyExpanded)},p.prototype.append=function(){U().groupEnd()};var N=function(){M(),h?v&&Z&&x():_(),M()&&F()};this.append=function(e){if(b){var t=f.getLayout().formatWithException(e);y.push(new c(e,t)),N()}},this.group=function(e,t){b&&(y.push(new d(e,t)),N())},this.groupEnd=function(){b&&(y.push(new p),N())};var F=function(){for(;y.length>0;)y.shift().append();u&&U().focus()};this.setAddedToLogger=function(e){this.loggers.push(e),enabled&&!o&&_()},this.clear=function(){D()&&U().clearLog(),y.length=0},this.focus=function(){D()&&U().focus()},this.focusCommandLine=function(){D()&&U().focusCommandLine()},this.focusSearch=function(){D()&&U().focusSearch()};var B=window;this.getCommandWindow=function(){return B},this.setCommandWindow=function(e){B=e},this.executeLastCommand=function(){D()&&U().evalLastCommand()};var j=new PatternLayout("%m");this.getCommandLayout=function(){return j},this.setCommandLayout=function(e){j=e},this.evalCommandAndAppend=function(e){var t={appendResult:!0,isError:!1},r="";try{var n,o;!B.eval&&B.execScript&&B.execScript("null");var i={};for(o=0,len=V.length;o<len;o++)i[V[o][0]]=V[o][1];var s=[],a=function(e){s.push([e,B[e]])};a("appender"),B.appender=f,a("commandReturnValue"),B.commandReturnValue=t,a("commandLineFunctionsHash"),B.commandLineFunctionsHash=i;for(o=0,len=V.length;o<len;o++)!function(e){a(e),B[e]=function(){return this.commandLineFunctionsHash[e](f,arguments,t)}}(V[o][0]);for(B===window&&B.execScript?(a("evalExpr"),a("result"),window.evalExpr=e,B.execScript("window.result=eval(window.evalExpr);"),n=window.result):n=B.eval(e),r=isUndefined(n)?n:formatObjectExpansion(n,T),o=0,len=s.length;o<len;o++)B[s[o][0]]=s[o][1]}catch(e){r="Error evaluating command: "+getExceptionStringRep(e),t.isError=!0}if(t.appendResult){var l=">>> "+e;isUndefined(r)||(l+=newLine+r);var u=t.isError?Level.ERROR:Level.INFO,c=new LoggingEvent(null,new Date,u,[l],null),d=this.getLayout();this.setLayout(j),this.append(c),this.setLayout(d)}};var V=r.concat([]);this.addCommandLineFunction=function(e,t){V.push([e,t])};this.storeCommandHistory=function(e){setCookie("log4javascriptCommandHistory",e.join(","))};var W=function(e){var t=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\t\t\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\t\t\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t<\/script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];e.open();for(var r=0,n=t.length;r<n;r++)e.writeln(t[r]);e.close()};this.setEventTypes(["load","unload"]);var q=function(){var e=U();e.setAppender(f),e.setNewestAtTop(w),e.setScrollToLatest(E),e.setMaxMessages(C),e.setShowCommandLine(P),e.setShowHideButton(I),e.setShowCloseButton(R),e.setMainWindow(window);var t=getCookie("log4javascriptCommandHistory");t&&(e.commandHistory=t.split(","),e.currentCommandIndex=e.commandHistory.length),f.dispatchEvent("load",{win:e})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),v||(logLog.debug("really doing unload "+this),v=!0,g=!1,m=!1,f.dispatchEvent("unload",{}))};var H=function(e,t,r,n){var o=setInterval(function(){try{v&&clearInterval(o),e(U())&&(clearInterval(o),r())}catch(e){clearInterval(o),b=!1,handleError(n,e)}},t)},G=function(){var e=document.domain!=location.hostname;return s?"":getBaseUrl()+"console_uncompressed.html"+(e?"?log4javascript_domain="+escape(document.domain):"")};if(e){var Y=null,z=[];this.addCssProperty=function(e,t){k("cssProperties")&&z.push([e,t])};var $,X=!1,K=uniqueId+"_InPageAppender_"+S;this.hide=function(){h&&m&&(D()&&U().$("command").blur(),$.style.display="none",O=!0)},this.show=function(){h&&(m?($.style.display="block",this.setShowCommandLine(P),O=!1):X||x(!0))},this.isVisible=function(){return!O&&!v},this.close=function(e){v||e&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||($.parentNode.removeChild($),this.unload())},A=function(){function e(){try{i||f.show(),q(),g=!0,F()}catch(e){b=!1,handleError(r,e)}}function t(){try{var t=function(e){return isLoaded(e)};s&&W(U().document),t(U())?e():H(t,100,e,r)}catch(e){b=!1,handleError(r,e)}}var r="InPageAppender.open: unable to create console iframe";O=!1,($=Y.appendChild(document.createElement("div"))).style.width=a,$.style.height=l,$.style.border="solid gray 1px";for(var n=0,o=z.length;n<o;n++)$.style[z[n][0]]=z[n][1];var u=s?"":" src='"+G()+"'";$.innerHTML="<iframe id='"+K+"' name='"+K+"' width='100%' height='100%' frameborder='0'"+u+" scrolling='no'></iframe>",v=!1;var c=function(e){try{return bool(e)&&bool(e.document)}catch(e){return!1}};c(U())?t():H(c,100,t,r),m=!0},x=function(e){if(e||!i){var r=function(){if(t)try{var e=document.getElementById(t);1==e.nodeType&&(Y=e),A()}catch(e){handleError("InPageAppender.init: invalid container element '"+t+"' supplied",e)}else(Y=document.createElement("div")).style.position="fixed",Y.style.left="0",Y.style.right="0",Y.style.bottom="0",document.body.appendChild(Y),f.addCssProperty("borderWidth","1px 0 0 0"),f.addCssProperty("zIndex",1e6),A()};pageLoaded&&t&&t.appendChild?(Y=t,A()):pageLoaded?r():log4javascript.addEventListener("load",r),X=!0}},_=function(){x(),h=!0},U=function(){var e=window.frames[K];if(e)return e},M=function(){return!(!b||v)&&(m&&!g&&U()&&isLoaded(U())&&(g=!0),g)}}else{var J=f.defaults.useOldPopUp,Q=f.defaults.complainAboutPopUpBlocking,Z=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return J},this.setUseOldPopUp=function(e){k("useOldPopUp")&&(J=bool(e))},this.isComplainAboutPopUpBlocking=function(){return Q},this.setComplainAboutPopUpBlocking=function(e){k("complainAboutPopUpBlocking")&&(Q=bool(e))},this.isFocusPopUp=function(){return u},this.setFocusPopUp=function(e){u=bool(e)},this.isReopenWhenClosed=function(){return Z},this.setReopenWhenClosed=function(e){Z=bool(e)},this.close=function(){logLog.debug("close "+this);try{ee.close(),this.unload()}catch(e){}},this.hide=function(){logLog.debug("hide "+this),D()&&this.close()},this.show=function(){logLog.debug("show "+this),m||A()},this.isVisible=function(){return M()};var ee;A=function(){function e(){U().setCloseIfOpenerCloses(!J||!s),q(),g=!0,F(),H(i,500,u,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}var t="width="+a+",height="+l+",status,resizable",r="";try{var n=window.frameElement;n&&(r="_"+n.tagName+"_"+(n.name||n.id||""))}catch(e){r="_inaccessibleParentFrame"}var o="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+S+r;J&&s||(o=o+"_"+uniqueId);var i=function(e){if(v)return!0;try{return bool(e)&&e.closed}catch(e){}return!1},u=function(){v||f.unload()};try{if(ee=window.open(G(),o,t),v=!1,m=!0,ee&&ee.document)if(s&&J&&isLoaded(ee))ee.mainPageReloaded(),e();else{s&&W(ee.document);isLoaded(ee)?e():H(function(e){return bool(e)&&isLoaded(e)},100,e,"PopUpAppender.init: unable to create console window")}else b=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),Q&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(e){handleError("PopUpAppender.init: error creating pop-up",e)}},x=function(){i||A()},_=function(){x(),h=!0},U=function(){return ee},M=function(){if(b&&!isUndefined(ee)&&!v){if(ee.closed||g&&isUndefined(ee.closed))return f.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!g&&isLoaded(ee)&&(g=!0)}return b&&g&&!v}}this.getConsoleWindow=U},ConsoleAppender.addGlobalCommandLineFunction=function(e,t){r.push([e,t])},(e.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=e,(t.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=t,log4javascript.InlineAppender=t}(),function(){function e(e){var t=0;for(var r in e)t=Math.max(toStr(r).length,t);var n=[];for(r in e){var o,i="  "+padWithSpaces(toStr(r),t+2);try{o=splitIntoLines(toStr(e[r])).join(padWithSpaces(newLine,t+6))}catch(e){o="[Error obtaining property. Details: "+getExceptionMessage(e)+"]"}n.push(i+o)}return n.join(newLine)}function t(e,r,a,l,u){function c(e){for(var t=e.style.cssText.split(";"),r="",n=0,o=t.length;n<o;n++){var i=t[n].split(":"),s=[];/^\s*$/.test(i[0])||s.push(trim(i[0]).toLowerCase()+":"+trim(i[1])),r=s.join(";")}return r}r=void 0===r||!!r,"string"!=typeof a&&(a=""),l=!!l,u=!!u;var d,p,f;if(!r||e.nodeType==n.DOCUMENT_FRAGMENT_NODE){for(d="",p=0,f=e.childNodes.length;p<f;p++)d+=t(e.childNodes[p],!0,a+s);return d}switch(e.nodeType){case n.ELEMENT_NODE:var h=e.tagName.toLowerCase();d=l?newLine+a:"",d+="<";var m=function(e){return e.prefix?e.prefix:e.outerHTML&&new RegExp("<([^:]+):"+e.tagName+"[^>]*>","i").test(e.outerHTML)?RegExp.$1.toLowerCase():""}(e),g=!!m;for(g&&(d+=m+":"),d+=h,p=0,f=e.attributes.length;p<f;p++){var v=e.attributes[p];v.specified&&null!==v.nodeValue&&"style"!==v.nodeName.toLowerCase()&&"string"==typeof v.nodeValue&&0!==v.nodeName.indexOf("_moz")&&(d+=" "+v.nodeName.toLowerCase()+'="',d+=function(e){return e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}(v.nodeValue),d+='"')}if(e.style.cssText&&""!==c(e)&&(d+=' style="'+c(e)+'"'),array_contains(i,h)||g&&!e.hasChildNodes())d+="/>";else{d+=">";var y=!(1===e.childNodes.length&&e.childNodes[0].nodeType===n.TEXT_NODE),b=array_contains(o,h);for(p=0,f=e.childNodes.length;p<f;p++)d+=t(e.childNodes[p],!0,a+s,y,b);var S="</"+h+">";d+=y?newLine+a+S:S}return d;case n.TEXT_NODE:if(function(e){return e.nodeType==n.TEXT_NODE&&/^[ \t\r\n]*$/.test(e.nodeValue)}(e))d="";else{if(u)d=e.nodeValue;else{var w=splitIntoLines(trim(e.nodeValue)),E=[];for(p=0,f=w.length;p<f;p++)E[p]=trim(w[p]);d=E.join(newLine+a)}l&&(d=newLine+a+d)}return d;case n.CDATA_SECTION_NODE:return"<![CDATA["+e.nodeValue+"]]>"+newLine;case n.DOCUMENT_NODE:for(d="",p=0,f=e.childNodes.length;p<f;p++)d+=t(e.childNodes[p],!0,a);return d;default:return""}}function r(){ConsoleAppender.addGlobalCommandLineFunction("$",function(e,t,r){return document.getElementById(t[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(t,r,n){for(var o=[],i=0,s=r.length;i<s;i++)o[i]=e(r[i]);return o.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(e,r,n){for(var o=[],i=0,s=r.length;i<s;i++)o[i]=t(r[i]);return o.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(e,t,r){var n,o;return 0===t.length||""===t[0]?(n=window,o="Command line set to run in main window"):t[0].window==t[0]?(n=t[0],o="Command line set to run in frame '"+t[0].name+"'"):(n=window.frames[t[0]])?o="Command line set to run in frame '"+t[0]+"'":(r.isError=!0,o="Frame '"+t[0]+"' does not exist",n=e.getCommandWindow()),e.setCommandWindow(n),o}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(e,t,r){r.appendResult=!1,e.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(e,t,r){var n=[];for(var o in t[0])n.push(o);return n}),ConsoleAppender.addGlobalCommandLineFunction("values",function(e,t,r){var n=[];for(var o in t[0])try{n.push(t[0][o])}catch(e){logLog.warn("values(): Unable to obtain value for key "+o+". Details: "+getExceptionMessage(e))}return n}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(e,t,r){var n=parseInt(t[0],10);return isNaN(n)||n<0?(r.isError=!0,t[0]+" is not a valid expansion depth"):(e.setCommandLineObjectExpansionDepth(n),"Object expansion depth set to "+n)})}var n={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},o=["script","pre"],i=["br","img","hr","param","link","area","input","col","base","meta"],s="  ";r()}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(e){oldOnload&&oldOnload(e),log4javascript.setDocumentReady()}}return log4javascript},this),function(e,t){"function"==typeof define&&define.amd?define(["bytebuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(e,t){"use strict";var r={};return r.ByteBuffer=e,r.Long=e.Long||null,r.VERSION="5.0.1",r.WIRE_TYPES={},r.WIRE_TYPES.VARINT=0,r.WIRE_TYPES.BITS64=1,r.WIRE_TYPES.LDELIM=2,r.WIRE_TYPES.STARTGROUP=3,r.WIRE_TYPES.ENDGROUP=4,r.WIRE_TYPES.BITS32=5,r.PACKABLE_WIRE_TYPES=[r.WIRE_TYPES.VARINT,r.WIRE_TYPES.BITS64,r.WIRE_TYPES.BITS32],r.TYPES={int32:{name:"int32",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.ZERO:void 0},uint64:{name:"uint64",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.UZERO:void 0},sint64:{name:"sint64",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.ZERO:void 0},bool:{name:"bool",wireType:r.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:r.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:r.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:r.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:r.WIRE_TYPES.BITS64,defaultValue:r.Long?r.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:r.WIRE_TYPES.BITS64,defaultValue:r.Long?r.Long.ZERO:void 0},float:{name:"float",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:r.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:r.WIRE_TYPES.STARTGROUP,defaultValue:null}},r.MAP_KEY_TYPES=[r.TYPES.int32,r.TYPES.sint32,r.TYPES.sfixed32,r.TYPES.uint32,r.TYPES.fixed32,r.TYPES.int64,r.TYPES.sint64,r.TYPES.sfixed64,r.TYPES.uint64,r.TYPES.fixed64,r.TYPES.bool,r.TYPES.string,r.TYPES.bytes],r.ID_MIN=1,r.ID_MAX=536870911,r.convertFieldsToCamelCase=!1,r.populateAccessors=!0,r.populateDefaults=!0,r.Util=function(){var e={};return e.IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,r=0;r<e.length;r++){try{t=e[r]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,r){if(r&&"function"!=typeof r&&(r=null),e.IS_NODE){var n=require("fs");if(r)n.readFile(t,function(e,t){r(e?null:""+t)});else try{return n.readFileSync(t)}catch(e){return null}}else{var o=e.XHR();if(o.open("GET",t,!!r),o.setRequestHeader("Accept","text/plain"),"function"==typeof o.overrideMimeType&&o.overrideMimeType("text/plain"),!r)return o.send(null),200==o.status||0==o.status&&"string"==typeof o.responseText?o.responseText:null;if(o.onreadystatechange=function(){4==o.readyState&&r(200==o.status||0==o.status&&"string"==typeof o.responseText?o.responseText:null)},4==o.readyState)return;o.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},e}(),r.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},r.DotProto=function(e,t){function r(e,r){var n=-1,o=1;if("-"==e.charAt(0)&&(o=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))n=parseInt(e);else if(t.NUMBER_HEX.test(e))n=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(o<0?"-":"")+e);n=parseInt(e.substring(1),8)}if(n=o*n|0,!r&&n<0)throw Error("illegal id value: "+(o<0?"-":"")+e);return n}function n(e){var r=1;if("-"==e.charAt(0)&&(r=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return r*parseInt(e,10);if(t.NUMBER_HEX.test(e))return r*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return r*parseInt(e.substring(1),8);if("inf"===e)return r*(1/0);if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return r*parseFloat(e);throw Error("illegal number value: "+(r<0?"-":"")+e)}function o(e,t,r){void 0===e[t]?e[t]=r:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(r))}var i={},s=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},a=s.prototype;a._readString=function(){var e='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;e.lastIndex=this.index-1;var r=e.exec(this.source);if(!r)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,r[1]},a.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,r,n;do{for(e=!1;t.WHITESPACE.test(n=this.source.charAt(this.index));)if("\n"===n&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(n=this.source.charAt(this.index)))return"/";do{if("\n"===n&&++this.line,++this.index===this.source.length)return null;r=n,n=this.source.charAt(this.index)}while("*"!==r||"/"!==n);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;var o=this.index;if(t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(o++)))for(;o<this.source.length&&!t.DELIM.test(this.source.charAt(o));)++o;var i=this.source.substring(this.index,this.index=o);return'"'!==i&&"'"!==i||(this._stringOpen=i),i},a.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},a.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},a.omit=function(e){return this.peek()===e&&(this.next(),!0)},a.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},i.Tokenizer=s;var l=function(e){this.tn=new s(e),this.proto3=!1},u=l.prototype;return u.parse=function(){var e,r,n={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},o=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!o||null!==n.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),n.package=e;break;case"import":if(!o)throw Error("unexpected 'import'");("public"===(e=this.tn.peek())||(r="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),r||n.imports.push(e);break;case"syntax":if(!o)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(n.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(n,null),o=!1;break;case"enum":this._parseEnum(n),o=!1;break;case"option":this._parseOption(n);break;case"service":this._parseService(n);break;case"extend":this._parseExtend(n);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete n.name,n},l.parse=function(e){return new l(e).parse()},u._readString=function(){var e,t,r="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);r+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return r},u._readValue=function(e){var r=this.tn.peek();if('"'===r||"'"===r)return this._readString();if(this.tn.next(),t.NUMBER.test(r))return n(r);if(t.BOOL.test(r))return"true"===r.toLowerCase();if(e&&t.TYPEREF.test(r))return r;throw Error("illegal value: "+r)},u._parseOption=function(e,r){var n=this.tn.next(),o=!1;if("("===n&&(o=!0,n=this.tn.next()),!t.TYPEREF.test(n))throw Error("illegal option name: "+n);var i=n;o&&(this.tn.skip(")"),i="("+i+")",n=this.tn.peek(),t.FQTYPEREF.test(n)&&(i+=n,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,i),r||this.tn.skip(";")},u._parseOptionValue=function(e,r){var n=this.tn.peek();if("{"!==n)o(e.options,r,this._readValue(!0));else for(this.tn.skip("{");"}"!==(n=this.tn.next());){if(!t.NAME.test(n))throw Error("illegal option name: "+r+"."+n);this.tn.omit(":")?o(e.options,r+"."+n,this._readValue(!0)):this._parseOptionValue(e,r+"."+n)}},u._parseService=function(e){var r=this.tn.next();if(!t.NAME.test(r))throw Error("illegal service name at line "+this.tn.line+": "+r);var n={name:r,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(n);else{if("rpc"!==r)throw Error("illegal service token: "+r);this._parseServiceRPC(n)}this.tn.omit(";"),e.services.push(n)},u._parseServiceRPC=function(e){var r=this.tn.next();if(!t.NAME.test(r))throw Error("illegal rpc service method name: "+r);var n=r,o={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(r=this.tn.next()).toLowerCase()&&(o.request_stream=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error("illegal rpc service request type: "+r);if(o.request=r,this.tn.skip(")"),"returns"!==(r=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+r);if(this.tn.skip("("),"stream"===(r=this.tn.next()).toLowerCase()&&(o.response_stream=!0,r=this.tn.next()),o.response=r,this.tn.skip(")"),"{"===(r=this.tn.peek())){for(this.tn.next();"}"!==(r=this.tn.next());){if("option"!==r)throw Error("illegal rpc service token: "+r);this._parseOption(o)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[n]=o},u._parseMessage=function(e,n){var o=!!n,i=this.tn.next(),s={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(i))throw Error("illegal "+(o?"group":"message")+" name: "+i);for(s.name=i,o&&(this.tn.skip("="),n.id=r(this.tn.next()),s.isGroup=!0),"["===(i=this.tn.peek())&&n&&this._parseFieldOptions(n),this.tn.skip("{");"}"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(s,i);else if("oneof"===i)this._parseMessageOneOf(s);else if("enum"===i)this._parseEnum(s);else if("message"===i)this._parseMessage(s);else if("option"===i)this._parseOption(s);else if("service"===i)this._parseService(s);else if("extensions"===i)s.extensions=this._parseExtensionRanges();else if("reserved"===i)this._parseIgnored();else if("extend"===i)this._parseExtend(s);else{if(!t.TYPEREF.test(i))throw Error("illegal message token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(s,"optional",i)}return this.tn.omit(";"),e.messages.push(s),s},u._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},u._parseMessageField=function(e,n,o){if(!t.RULE.test(n))throw Error("illegal message field rule: "+n);var i,s={rule:n,type:"",name:"",options:{},id:0};if("map"===n){if(o)throw Error("illegal type: "+o);if(this.tn.skip("<"),i=this.tn.next(),!t.TYPE.test(i)&&!t.TYPEREF.test(i))throw Error("illegal message field type: "+i);if(s.keytype=i,this.tn.skip(","),i=this.tn.next(),!t.TYPE.test(i)&&!t.TYPEREF.test(i))throw Error("illegal message field: "+i);if(s.type=i,this.tn.skip(">"),i=this.tn.next(),!t.NAME.test(i))throw Error("illegal message field name: "+i);s.name=i,this.tn.skip("="),s.id=r(this.tn.next()),"["===(i=this.tn.peek())&&this._parseFieldOptions(s),this.tn.skip(";")}else if("group"===(o=void 0!==o?o:this.tn.next())){var a=this._parseMessage(e,s);if(!/^[A-Z]/.test(a.name))throw Error("illegal group name: "+a.name);s.type=a.name,s.name=a.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error("illegal message field type: "+o);if(s.type=o,i=this.tn.next(),!t.NAME.test(i))throw Error("illegal message field name: "+i);s.name=i,this.tn.skip("="),s.id=r(this.tn.next()),"["===(i=this.tn.peek())&&this._parseFieldOptions(s),this.tn.skip(";")}return e.fields.push(s),s},u._parseMessageOneOf=function(e){var r=this.tn.next();if(!t.NAME.test(r))throw Error("illegal oneof name: "+r);var n,o=r,i=[];for(this.tn.skip("{");"}"!==(r=this.tn.next());)(n=this._parseMessageField(e,"optional",r)).oneof=o,i.push(n.id);this.tn.omit(";"),e.oneofs[o]=i},u._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},u._parseEnum=function(e){var n={name:"",values:[],options:{}},o=this.tn.next();if(!t.NAME.test(o))throw Error("illegal name: "+o);for(n.name=o,this.tn.skip("{");"}"!==(o=this.tn.next());)if("option"===o)this._parseOption(n);else{if(!t.NAME.test(o))throw Error("illegal name: "+o);this.tn.skip("=");var i={name:o,id:r(this.tn.next(),!0)};"["===(o=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),n.values.push(i)}this.tn.omit(";"),e.enums.push(n)},u._parseExtensionRanges=function(){var t,r,o,i=[];do{for(r=[];;){switch(t=this.tn.next()){case"min":o=e.ID_MIN;break;case"max":o=e.ID_MAX;break;default:o=n(t)}if(r.push(o),2===r.length)break;if("to"!==this.tn.peek()){r.push(o);break}this.tn.next()}i.push(r)}while(this.tn.omit(","));return this.tn.skip(";"),i},u._parseExtend=function(e){var r=this.tn.next();if(!t.TYPEREF.test(r))throw Error("illegal extend reference: "+r);var n={ref:r,fields:[]};for(this.tn.skip("{");"}"!==(r=this.tn.next());)if(t.RULE.test(r))this._parseMessageField(n,r);else{if(!t.TYPEREF.test(r))throw Error("illegal extend token: "+r);if(!this.proto3)throw Error("illegal field rule: "+r);this._parseMessageField(n,"optional",r)}return this.tn.omit(";"),e.messages.push(n),n},u.toString=function(){return"Parser at line "+this.tn.line},i.Parser=l,i}(r,r.Lang),r.Reflect=function(t){function r(e,r){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,void 0===r?e.unsigned:r);if("string"==typeof e)return t.Long.fromString(e,r||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,r||!1);throw Error("not convertible to Long")}function n(e,r){var o=r.readVarint32(),i=7&o,s=o>>>3;switch(i){case t.WIRE_TYPES.VARINT:do{o=r.readUint8()}while(128==(128&o));break;case t.WIRE_TYPES.BITS64:r.offset+=8;break;case t.WIRE_TYPES.LDELIM:o=r.readVarint32(),r.offset+=o;break;case t.WIRE_TYPES.STARTGROUP:n(s,r);break;case t.WIRE_TYPES.ENDGROUP:if(s===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+s+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:r.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+i)}return!0}var o={},i=function(e,t,r){this.builder=e,this.parent=t,this.name=r,this.className},s=i.prototype;s.fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},s.toString=function(e){return(e?this.className+" ":"")+this.fqn()},s.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},o.T=i;var a=function(e,t,r,n,o){i.call(this,e,t,r),this.className="Namespace",this.children=[],this.options=n||{},this.syntax=o||"proto2"};try{l=a.prototype=Object.create(i.prototype)}catch(e){var l=""}l.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],r=0,n=this.children.length;r<n;++r)this.children[r]instanceof e&&t.push(this.children[r]);return t},l.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof d.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof d.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},l.getChild=function(e){for(var t="number"==typeof e?"id":"name",r=0,n=this.children.length;r<n;++r)if(this.children[r][t]===e)return this.children[r];return null},l.resolve=function(e,t){var r="string"==typeof e?e.split("."):e,n=this,i=0;if(""===r[i]){for(;null!==n.parent;)n=n.parent;i++}var s;do{do{if(!(n instanceof o.Namespace)){n=null;break}if(!(s=n.getChild(r[i]))||!(s instanceof o.T)||t&&!(s instanceof o.Namespace)){n=null;break}n=s,i++}while(i<r.length);if(null!=n)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=n);return n},l.qn=function(e){var t=[],r=e;do{t.unshift(r.name),r=r.parent}while(null!==r);for(var n=1;n<=t.length;n++){var i=t.slice(t.length-n);if(e===this.resolve(i,e instanceof o.Namespace))return i.join(".")}return e.fqn()},l.build=function(){for(var e,t={},r=this.children,n=0,o=r.length;n<o;++n)(e=r[n])instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},l.buildOpt=function(){for(var e={},t=Object.keys(this.options),r=0,n=t.length;r<n;++r){var o=t[r],i=this.options[t[r]];e[o]=i}return e},l.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},o.Namespace=a;var u=function(e,r,n,o){if(this.type=e,this.resolvedType=r,this.isMapKey=n,this.syntax=o,n&&t.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},c=u.prototype;u.defaultFieldValue=function(r){if("string"==typeof r&&(r=t.TYPES[r]),void 0===r.defaultValue)throw Error("default value for type "+r.name+" is not supported");return r==t.TYPES.bytes?new e(0):r.defaultValue},c.verifyValue=function(n){function o(e,t){throw Error("Illegal value for "+i.toString(!0)+" of type "+i.type.name+": "+e+" ("+t+")")}var i=this;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof n||n===n&&n%1!=0)&&o(typeof n,"not an integer"),n>4294967295?0|n:n;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof n||n===n&&n%1!=0)&&o(typeof n,"not an integer"),n<0?n>>>0:n;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return r(n,!1)}catch(e){o(typeof n,e.message)}else o(typeof n,"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return r(n,!0)}catch(e){o(typeof n,e.message)}else o(typeof n,"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof n&&o(typeof n,"not a boolean"),n;case t.TYPES.float:case t.TYPES.double:return"number"!=typeof n&&o(typeof n,"not a number"),n;case t.TYPES.string:return"string"==typeof n||n&&n instanceof String||o(typeof n,"not a string"),""+n;case t.TYPES.bytes:return e.isByteBuffer(n)?n:e.wrap(n,"base64");case t.TYPES.enum:var s=this.resolvedType.getChildren(t.Reflect.Enum.Value);for(l=0;l<s.length;l++){if(s[l].name==n)return s[l].id;if(s[l].id==n)return s[l].id}if("proto3"===this.syntax)return("number"!=typeof n||n===n&&n%1!=0)&&o(typeof n,"not an integer"),(n>4294967295||n<0)&&o(typeof n,"not in range for uint32"),n;o(n,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:if(n&&"object"==typeof n||o(typeof n,"object expected"),n instanceof this.resolvedType.clazz)return n;if(n instanceof t.Builder.Message){var a={};for(var l in n)n.hasOwnProperty(l)&&(a[l]=n[l]);n=a}return new this.resolvedType.clazz(n)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+n+" (undefined type "+this.type+")")},c.calculateLength=function(r,n){if(null===n)return 0;var o;switch(this.type){case t.TYPES.int32:return n<0?e.calculateVarint64(n):e.calculateVarint32(n);case t.TYPES.uint32:return e.calculateVarint32(n);case t.TYPES.sint32:return e.calculateVarint32(e.zigZagEncode32(n));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES.float:return 4;case t.TYPES.int64:case t.TYPES.uint64:return e.calculateVarint64(n);case t.TYPES.sint64:return e.calculateVarint64(e.zigZagEncode64(n));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES.enum:return e.calculateVarint32(n);case t.TYPES.double:return 8;case t.TYPES.string:return o=e.calculateUTF8Bytes(n),e.calculateVarint32(o)+o;case t.TYPES.bytes:if(n.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+n.remaining()+" bytes remaining");return e.calculateVarint32(n.remaining())+n.remaining();case t.TYPES.message:return o=this.resolvedType.calculate(n),e.calculateVarint32(o)+o;case t.TYPES.group:return(o=this.resolvedType.calculate(n))+e.calculateVarint32(r<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")},c.encodeValue=function(r,n,o){if(null===n)return o;switch(this.type){case t.TYPES.int32:n<0?o.writeVarint64(n):o.writeVarint32(n);break;case t.TYPES.uint32:o.writeVarint32(n);break;case t.TYPES.sint32:o.writeVarint32ZigZag(n);break;case t.TYPES.fixed32:o.writeUint32(n);break;case t.TYPES.sfixed32:o.writeInt32(n);break;case t.TYPES.int64:case t.TYPES.uint64:o.writeVarint64(n);break;case t.TYPES.sint64:o.writeVarint64ZigZag(n);break;case t.TYPES.fixed64:o.writeUint64(n);break;case t.TYPES.sfixed64:o.writeInt64(n);break;case t.TYPES.bool:"string"==typeof n?o.writeVarint32("false"===n.toLowerCase()?0:!!n):o.writeVarint32(n?1:0);break;case t.TYPES.enum:o.writeVarint32(n);break;case t.TYPES.float:o.writeFloat32(n);break;case t.TYPES.double:o.writeFloat64(n);break;case t.TYPES.string:o.writeVString(n);break;case t.TYPES.bytes:if(n.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+n.remaining()+" bytes remaining");var i=n.offset;o.writeVarint32(n.remaining()),o.append(n),n.offset=i;break;case t.TYPES.message:var s=(new e).LE();this.resolvedType.encode(n,s),o.writeVarint32(s.offset),o.append(s.flip());break;case t.TYPES.group:this.resolvedType.encode(n,o),o.writeVarint32(r<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")}return o},c.decode=function(e,r,n){if(r!=this.type.wireType)throw Error("Unexpected wire type for element");var o,i;switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES.enum:return e.readVarint32();case t.TYPES.float:return e.readFloat();case t.TYPES.double:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(i=e.readVarint32(),e.remaining()<i)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+i+" required but got only "+e.remaining());return o=e.clone(),o.limit=o.offset+i,e.offset+=i,o;case t.TYPES.message:return i=e.readVarint32(),this.resolvedType.decode(e,i);case t.TYPES.group:return this.resolvedType.decode(e,-1,n)}throw Error("[INTERNAL] Illegal decode type")},c.valueFromString=function(r){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(r));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(r);case t.TYPES.bool:return"true"===r;case t.TYPES.string:return this.verifyValue(r);case t.TYPES.bytes:return e.fromBinary(r)}},c.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===t.TYPES.bytes?e.toString("binary"):e.toString()},o.Element=u;var d=function(e,t,r,n,o,i){a.call(this,e,t,r,n,i),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!o,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{p=d.prototype=Object.create(a.prototype)}catch(e){var p=""}p.build=function(r){if(this.clazz&&!r)return this.clazz;var n=function(t,r){function n(r,o,i,s){if(null===r||"object"!=typeof r){if(s&&s instanceof t.Reflect.Enum){var a=t.Reflect.Enum.getName(s.object,r);if(null!==a)return a}return r}if(e.isByteBuffer(r))return o?r.toBase64():r.toBuffer();if(t.Long.isLong(r))return i?r.toString():t.Long.fromValue(r);var l;if(Array.isArray(r))return l=[],r.forEach(function(e,t){l[t]=n(e,o,i,s)}),l;if(l={},r instanceof t.Map){for(var u=r.entries(),c=u.next();!c.done;c=u.next())l[r.keyElem.valueToString(c.value[0])]=n(c.value[1],o,i,r.valueElem.resolvedType);return l}var d=r.$type,p=void 0;for(var f in r)r.hasOwnProperty(f)&&(d&&(p=d.getChild(f))?l[f]=n(r[f],o,i,p.resolvedType):l[f]=n(r[f],o,i));return l}var o=r.getChildren(t.Reflect.Message.Field),i=r.getChildren(t.Reflect.Message.OneOf),s=function(n,a){t.Builder.Message.call(this);for(var l=0,u=i.length;l<u;++l)this[i[l].name]=null;for(l=0,u=o.length;l<u;++l){var c=o[l];this[c.name]=c.repeated?[]:c.map?new t.Map(c):null,!c.required&&"proto3"!==r.syntax||null===c.defaultValue||(this[c.name]=c.defaultValue)}if(arguments.length>0){var d;if(1!==arguments.length||null===n||"object"!=typeof n||!("function"!=typeof n.encode||n instanceof s)||Array.isArray(n)||n instanceof t.Map||e.isByteBuffer(n)||n instanceof ArrayBuffer||t.Long&&n instanceof t.Long)for(l=0,u=arguments.length;l<u;++l)void 0!==(d=arguments[l])&&this.$set(o[l].name,d);else this.$set(n)}};try{a=s.prototype=Object.create(t.Builder.Message.prototype)}catch(e){var a=""}a.add=function(e,n,o){var i=r._fieldsByName[e];if(!o){if(!i)throw Error(this+"#"+e+" is undefined");if(!(i instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+i.toString(!0));if(!i.repeated)throw Error(this+"#"+e+" is not a repeated field");n=i.verifyValue(n,!0)}return null===this[e]&&(this[e]=[]),this[e].push(n),this},a.$add=a.add,a.set=function(e,n,o){if(e&&"object"==typeof e){o=n;for(var i in e)e.hasOwnProperty(i)&&void 0!==(n=e[i])&&this.$set(i,n,o);return this}var s=r._fieldsByName[e];if(o)this[e]=n;else{if(!s)throw Error(this+"#"+e+" is not a field: undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));this[s.name]=n=s.verifyValue(n)}if(s&&s.oneof){var a=this[s.oneof.name];null!==n?(null!==a&&a!==s.name&&(this[a]=null),this[s.oneof.name]=s.name):a===e&&(this[s.oneof.name]=null)}return this},a.$set=a.set,a.get=function(e,n){if(n)return this[e];var o=r._fieldsByName[e];if(!(o&&o instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(o instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));return this[o.name]},a.$get=a.get;for(var l=0;l<o.length;l++){var u=o[l];u instanceof t.Reflect.Message.ExtensionField||r.builder.options.populateAccessors&&function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});t=t.substring(0,1).toUpperCase()+t.substring(1);var n=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),o=function(t,r){return this[e.name]=r?t:e.verifyValue(t),this},i=function(){return this[e.name]};null===r.getChild("set"+t)&&(a["set"+t]=o),null===r.getChild("set_"+n)&&(a["set_"+n]=o),null===r.getChild("get"+t)&&(a["get"+t]=i),null===r.getChild("get_"+n)&&(a["get_"+n]=i)}(u)}a.encode=function(t,n){"boolean"==typeof t&&(n=t,t=void 0);var o=!1;t||(t=new e,o=!0);var i=t.littleEndian;try{return r.encode(this,t.LE(),n),(o?t.flip():t).LE(i)}catch(e){throw t.LE(i),e}},s.encode=function(e,t,r){return new s(e).encode(t,r)},a.calculate=function(){return r.calculate(this)},a.encodeDelimited=function(t,n){var o=!1;t||(t=new e,o=!0);var i=(new e).LE();return r.encode(this,i,n).flip(),t.writeVarint32(i.remaining()),t.append(i),o?t.flip():t},a.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},a.toArrayBuffer=a.encodeAB,a.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},a.toBuffer=a.encodeNB,a.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},a.toBase64=a.encode64,a.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},a.toHex=a.encodeHex,a.toRaw=function(e,t){return n(this,!!e,!!t,this.$type)},a.encodeJSON=function(){return JSON.stringify(n(this,!0,!0,this.$type))},s.decode=function(t,n,o){"string"==typeof n&&(o=n,n=-1),"string"==typeof t&&(t=e.wrap(t,o||"base64"));var i=(t=e.isByteBuffer(t)?t:e.wrap(t)).littleEndian;try{var s=r.decode(t.LE());return t.LE(i),s}catch(e){throw t.LE(i),e}},s.decodeDelimited=function(t,n){if("string"==typeof t&&(t=e.wrap(t,n||"base64")),(t=e.isByteBuffer(t)?t:e.wrap(t)).remaining()<1)return null;var o=t.offset,i=t.readVarint32();if(t.remaining()<i)return t.offset=o,null;try{var s=r.decode(t.slice(t.offset,t.offset+i).LE());return t.offset+=i,s}catch(e){throw t.offset+=i,e}},s.decode64=function(e){return s.decode(e,"base64")},s.decodeHex=function(e){return s.decode(e,"hex")},s.decodeJSON=function(e){return new s(JSON.parse(e))},a.toString=function(){return r.toString()};return Object.defineProperty&&(Object.defineProperty(s,"$options",{value:r.buildOpt()}),Object.defineProperty(a,"$options",{value:s.$options}),Object.defineProperty(s,"$type",{value:r}),Object.defineProperty(a,"$type",{value:r})),s}(t,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var o,i=0,s=this.children.length;i<s;i++)if((o=this.children[i])instanceof g||o instanceof d||o instanceof S){if(n.hasOwnProperty(o.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+o.toString(!0)+" cannot override static property '"+o.name+"'");n[o.name]=o.build()}else if(o instanceof d.Field)o.build(),this._fields.push(o),this._fieldsById[o.id]=o,this._fieldsByName[o.name]=o;else if(!(o instanceof d.OneOf||o instanceof b))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[i].toString(!0));return this.clazz=n},p.encode=function(e,t,r){for(var n,o,i=null,s=0,a=this._fields.length;s<a;++s)o=e[(n=this._fields[s]).name],n.required&&null===o?null===i&&(i=n):n.encode(r?o:n.verifyValue(o),t,e);if(null!==i){var l=Error("Missing at least one required field for "+this.toString(!0)+": "+i);throw l.encoded=t,l}return t},p.calculate=function(e){for(var t,r,n=0,o=0,i=this._fields.length;o<i;++o){if(t=this._fields[o],r=e[t.name],t.required&&null===r)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);n+=t.calculate(r,e)}return n},p.decode=function(e,r,o){r="number"==typeof r?r:-1;for(var i,s,a,l,u=e.offset,c=new this.clazz;e.offset<u+r||-1===r&&e.remaining()>0;){if(i=e.readVarint32(),s=7&i,a=i>>>3,s===t.WIRE_TYPES.ENDGROUP){if(a!==o)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(o?o+" expected":"not a group")+")");break}if(l=this._fieldsById[a]){if(l.repeated&&!l.options.packed)c[l.name].push(l.decode(s,e));else if(l.map){var d=l.decode(s,e);c[l.name].set(d[0],d[1])}else if(c[l.name]=l.decode(s,e),l.oneof){var p=c[l.oneof.name];null!==p&&p!==l.name&&(c[p]=null),c[l.oneof.name]=l.name}}else switch(s){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:var f=e.readVarint32();e.offset+=f;break;case t.WIRE_TYPES.STARTGROUP:for(;n(a,e););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+s)}}for(var h=0,m=this._fields.length;h<m;++h)if(l=this._fields[h],null===c[l.name])if("proto3"===this.syntax)c[l.name]=l.defaultValue;else{if(l.required){var g=Error("Missing at least one required field for "+this.toString(!0)+": "+l.name);throw g.decoded=c,g}t.populateDefaults&&null!==l.defaultValue&&(c[l.name]=l.defaultValue)}return c},o.Message=d;var f=function(e,r,n,o,s,a,l,u,c,p){i.call(this,e,r,a),this.className="Message.Field",this.required="required"===n,this.repeated="repeated"===n,this.map="map"===n,this.keyType=o||null,this.type=s,this.resolvedType=null,this.id=l,this.options=u||{},this.defaultValue=null,this.oneof=c||null,this.syntax=p||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof d.ExtensionField||(this.name=t.Util.toCamelCase(this.name))};try{h=f.prototype=Object.create(i.prototype)}catch(e){var h=""}h.build=function(){this.element=new u(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new u(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=u.defaultFieldValue(this.type)},h.verifyValue=function(e,r){function n(e,t){throw Error("Illegal value for "+o.toString(!0)+" of type "+o.type.name+": "+e+" ("+t+")")}r=r||!1;var o=this;if(null===e)return this.required&&n(typeof e,"required"),"proto3"===this.syntax&&this.type!==t.TYPES.message&&n(typeof e,"proto3 field without field presence cannot be null"),null;var i;if(this.repeated&&!r){Array.isArray(e)||(e=[e]);var s=[];for(i=0;i<e.length;i++)s.push(this.element.verifyValue(e[i]));return s}return this.map&&!r?e instanceof t.Map?e:(e instanceof Object||n(typeof e,"expected ProtoBuf.Map or raw object for map field"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&n(typeof e,"no array expected"),this.element.verifyValue(e))},h.hasWirePresence=function(e,r){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&r[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES.float:case t.TYPES.double:return 0!==e;case t.TYPES.string:return e.length>0;case t.TYPES.bytes:return e.remaining()>0;case t.TYPES.enum:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},h.encode=function(r,n,o){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===r||this.repeated&&0==r.length)return n;try{if(this.repeated){var i;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){n.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),n.ensureCapacity(n.offset+=1);var s=n.offset;for(i=0;i<r.length;i++)this.element.encodeValue(this.id,r[i],n);var a=n.offset-s,l=e.calculateVarint32(a);if(l>1){var u=n.slice(s,n.offset);s+=l-1,n.offset=s,n.append(u)}n.writeVarint32(a,s-l)}else for(i=0;i<r.length;i++)n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,r[i],n)}else this.map?r.forEach(function(r,o,i){var s=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,o)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,r);n.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),n.writeVarint32(s),n.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,o,n),n.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,r,n)},this):this.hasWirePresence(r,o)&&(n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,r,n))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+r+" ("+e+")")}return n},h.calculate=function(r,n){if(r=this.verifyValue(r),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===r||this.repeated&&0==r.length)return 0;var o=0;try{if(this.repeated){var i,s;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(o+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s=0,i=0;i<r.length;i++)s+=this.element.calculateLength(this.id,r[i]);o+=e.calculateVarint32(s),o+=s}else for(i=0;i<r.length;i++)o+=e.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,r[i])}else this.map?r.forEach(function(r,n,i){var s=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,n)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,r);o+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),o+=e.calculateVarint32(s),o+=s},this):this.hasWirePresence(r,n)&&(o+=e.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,r))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+r+" ("+e+")")}return o},h.decode=function(e,r,n){var o,i;if(!(!this.map&&e==this.type.wireType||!n&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!n){i=r.readVarint32(),i=r.offset+i;for(var s=[];r.offset<i;)s.push(this.decode(this.type.wireType,r,!0));return s}if(this.map){var a=u.defaultFieldValue(this.keyType);if(o=u.defaultFieldValue(this.type),i=r.readVarint32(),r.remaining()<i)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+i+" required but got only "+r.remaining());var l=r.clone();for(l.limit=l.offset+i,r.offset+=i;l.remaining()>0;){var c=l.readVarint32();e=7&c;var d=c>>>3;if(1===d)a=this.keyElement.decode(l,e,d);else{if(2!==d)throw Error("Unexpected tag in map field key/value submessage");o=this.element.decode(l,e,d)}}return[a,o]}return this.element.decode(r,e,this.id)},o.Message.Field=f;var m=function(e,t,r,n,o,i,s){f.call(this,e,t,r,null,n,o,i,s),this.extension};try{m.prototype=Object.create(f.prototype)}catch(e){m.prototype=null}o.Message.ExtensionField=m;o.Message.OneOf=function(e,t,r){i.call(this,e,t,r),this.fields=[]};var g=function(e,t,r,n,o){a.call(this,e,t,r,n,o),this.className="Enum",this.object=null};g.getName=function(e,t){for(var r,n=Object.keys(e),o=0;o<n.length;++o)if(e[r=n[o]]===t)return r;return null};try{v=g.prototype=Object.create(a.prototype)}catch(e){var v=g.prototype=null}v&&(v.build=function(e){if(this.object&&!e)return this.object;for(var r=new t.Builder.Enum,n=this.getChildren(g.Value),o=0,i=n.length;o<i;++o)r[n[o].name]=n[o].id;return Object.defineProperty&&Object.defineProperty(r,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=r}),o.Enum=g;var y=function(e,t,r,n){i.call(this,e,t,r),this.className="Enum.Value",this.id=n};try{y.prototype=Object.create(i.prototype)}catch(e){y.prototype=null}o.Enum.Value=y;var b=function(e,t,r,n){i.call(this,e,t,r),this.field=n};try{b.prototype=Object.create(i.prototype)}catch(e){b.prototype=null}o.Extension=b;var S=function(e,t,r,n){a.call(this,e,t,r,n),this.className="Service",this.clazz=null};try{w=S.prototype=Object.create(a.prototype)}catch(e){var w=null}w&&(w.build=function(r){return this.clazz&&!r?this.clazz:this.clazz=function(t,r){for(var n=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,r){setTimeout(r.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},o=n.prototype=Object.create(t.Builder.Service.prototype),i=r.getChildren(t.Reflect.Service.RPCMethod),s=0;s<i.length;s++)!function(t){o[t.name]=function(n,o){try{try{n=t.resolvedRequestType.clazz.decode(e.wrap(n))}catch(e){if(!(e instanceof TypeError))throw e}if(null===n||"object"!=typeof n)throw Error("Illegal arguments");n instanceof t.resolvedRequestType.clazz||(n=new t.resolvedRequestType.clazz(n)),this.rpcImpl(t.fqn(),n,function(e,n){if(e)o(e);else{null===n&&(n="");try{n=t.resolvedResponseType.clazz.decode(n)}catch(e){}n&&n instanceof t.resolvedResponseType.clazz?o(null,n):o(Error("Illegal response type received in service method "+r.name+"#"+t.name))}})}catch(e){setTimeout(o.bind(this,e),0)}},n[t.name]=function(e,r,o){new n(e)[t.name](r,o)},Object.defineProperty&&(Object.defineProperty(n[t.name],"$options",{value:t.buildOpt()}),Object.defineProperty(o[t.name],"$options",{value:n[t.name].$options}))}(i[s]);return Object.defineProperty&&(Object.defineProperty(n,"$options",{value:r.buildOpt()}),Object.defineProperty(o,"$options",{value:n.$options}),Object.defineProperty(n,"$type",{value:r}),Object.defineProperty(o,"$type",{value:r})),n}(t,this)}),o.Service=S;var E=function(e,t,r,n){i.call(this,e,t,r),this.className="Service.Method",this.options=n||{}};try{C=E.prototype=Object.create(i.prototype)}catch(e){var C=null}C&&(C.buildOpt=l.buildOpt),o.Service.Method=E;var P=function(e,t,r,n,o,i,s,a){E.call(this,e,t,r,a),this.className="Service.RPCMethod",this.requestName=n,this.responseName=o,this.requestStream=i,this.responseStream=s,this.resolvedRequestType=null,this.resolvedResponseType=null};try{P.prototype=Object.create(E.prototype)}catch(e){P.prototype=null}return o.Service.RPCMethod=P,o}(r),r.Builder=function(e,t,r){function n(e){e.messages&&e.messages.forEach(function(t){t.syntax=e.syntax,n(t)}),e.enums&&e.enums.forEach(function(t){t.syntax=e.syntax})}var o=function(e){this.ns=new r.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},i=o.prototype;return o.isMessage=function(e){return"string"==typeof e.name&&(void 0===e.values&&void 0===e.rpc)},o.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},o.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},o.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},o.isExtend=function(e){return"string"==typeof e.ref},i.reset=function(){return this.ptr=this.ns,this},i.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new r.Namespace(this,this.ptr,e)),this.ptr=t},this),this},i.create=function(t){if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var n=[t];n.length>0;){if(t=n.pop(),!Array.isArray(t))throw Error("not a valid namespace: "+JSON.stringify(t));for(;t.length>0;){var i=t.shift();if(o.isMessage(i)){var s=new r.Message(this,this.ptr,i.name,i.options,i.isGroup,i.syntax),a={};i.oneofs&&Object.keys(i.oneofs).forEach(function(e){s.addChild(a[e]=new r.Message.OneOf(this,s,e))},this),i.fields&&i.fields.forEach(function(e){if(null!==s.getChild(0|e.id))throw Error("duplicate or invalid field id in "+s.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+s.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=a[e.oneof]))throw Error("illegal oneof in "+s.name+"#"+e.name+": "+e.oneof);e=new r.Message.Field(this,s,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,i.syntax),t&&t.fields.push(e),s.addChild(e)},this);var l=[];if(i.enums&&i.enums.forEach(function(e){l.push(e)}),i.messages&&i.messages.forEach(function(e){l.push(e)}),i.services&&i.services.forEach(function(e){l.push(e)}),i.extensions&&("number"==typeof i.extensions[0]?s.extensions=[i.extensions]:s.extensions=i.extensions),this.ptr.addChild(s),l.length>0){n.push(t),t=l,l=null,this.ptr=s,s=null;continue}l=null}else if(o.isEnum(i))s=new r.Enum(this,this.ptr,i.name,i.options,i.syntax),i.values.forEach(function(e){s.addChild(new r.Enum.Value(this,s,e.name,e.id))},this),this.ptr.addChild(s);else if(o.isService(i))s=new r.Service(this,this.ptr,i.name,i.options),Object.keys(i.rpc).forEach(function(e){var t=i.rpc[e];s.addChild(new r.Service.RPCMethod(this,s,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(s);else{if(!o.isExtend(i))throw Error("not a valid definition: "+JSON.stringify(i));if(s=this.ptr.resolve(i.ref,!0))i.fields.forEach(function(t){if(null!==s.getChild(0|t.id))throw Error("duplicate extended field id in "+s.name+": "+t.id);if(s.extensions){var n=!1;if(s.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(n=!0)}),!n)throw Error("illegal extended field id in "+s.name+": "+t.id+" (not within valid ranges)")}var o=t.name;this.options.convertFieldsToCamelCase&&(o=e.Util.toCamelCase(o));var i=new r.Message.ExtensionField(this,s,t.rule,t.type,this.ptr.fqn()+"."+o,t.id,t.options),a=new r.Extension(this,this.ptr,t.name,i);i.extension=a,this.ptr.addChild(a),s.addChild(i)},this);else if(!/\.?google\.protobuf\./.test(i.ref))throw Error("extended message "+i.ref+" is not defined")}i=null,s=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},i.import=function(t,r){var o="/";if("string"==typeof r){if(e.Util.IS_NODE&&(r=require("path").resolve(r)),!0===this.files[r])return this.reset();this.files[r]=!0}else if("object"==typeof r){var i=r.root;e.Util.IS_NODE&&(i=require("path").resolve(i)),(i.indexOf("\\")>=0||r.file.indexOf("\\")>=0)&&(o="\\");var s=i+o+r.file;if(!0===this.files[s])return this.reset();this.files[s]=!0}if(t.imports&&t.imports.length>0){var a,l=!1;"object"==typeof r?(this.importRoot=r.root,l=!0,a=this.importRoot,r=r.file,(a.indexOf("\\")>=0||r.indexOf("\\")>=0)&&(o="\\")):"string"==typeof r?this.importRoot?a=this.importRoot:r.indexOf("/")>=0?""===(a=r.replace(/\/[^\/]*$/,""))&&(a="/"):r.indexOf("\\")>=0?(a=r.replace(/\\[^\\]*$/,""),o="\\"):a=".":a=null;for(var u=0;u<t.imports.length;u++)if("string"==typeof t.imports[u]){if(!a)throw Error("cannot determine import root");var c=t.imports[u];if("google/protobuf/descriptor.proto"===c)continue;if(c=a+o+c,!0===this.files[c])continue;/\.proto$/i.test(c)&&!e.DotProto&&(c=c.replace(/\.proto$/,".json"));var d=e.Util.fetch(c);if(null===d)throw Error("failed to import '"+c+"' in '"+r+"': file not found");/\.json$/i.test(c)?this.import(JSON.parse(d+""),c):this.import(e.DotProto.Parser.parse(d),c)}else r?/\.(\w+)$/.test(r)?this.import(t.imports[u],r.replace(/^(.+)\.(\w+)$/,function(e,t,r){return t+"_import"+u+"."+r})):this.import(t.imports[u],r+"_import"+u):this.import(t.imports[u]);l&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&n(t);var p=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){p.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=p),t.enums&&(this.create(t.enums),this.ptr=p),t.services&&(this.create(t.services),this.ptr=p),t.extends&&this.create(t.extends),this.reset()},i.resolveAll=function(){var n;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof r.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof r.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(n=(this.ptr instanceof r.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=n,n instanceof r.Enum){if(this.ptr.type=e.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==n.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(n instanceof r.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=n.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((n=this.ptr.parent.resolve(this.ptr.requestName,!0))&&n instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=n,!((n=this.ptr.parent.resolve(this.ptr.responseName,!0))&&n instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=n}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},i.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,r=this.result,n=0;n<t.length;n++){if(!r[t[n]]){r=null;break}r=r[t[n]]}return r},i.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},i.toString=function(){return"Builder"},o.Message=function(){},o.Enum=function(){},o.Service=function(){},o}(r,r.Lang,r.Reflect),r.Map=function(e,t){function r(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var n=function(e,r){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),r)for(var n=Object.keys(r),o=0;o<n.length;o++){var i=this.keyElem.valueFromString(n[o]),s=this.valueElem.verifyValue(r[n[o]]);this.map[this.keyElem.valueToString(i)]={key:i,value:s}}},o=n.prototype;return o.clear=function(){this.map={}},o.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),r=t in this.map;return delete this.map[t],r},o.entries=function(){for(var e,t=[],n=Object.keys(this.map),o=0;o<n.length;o++)t.push([(e=this.map[n[o]]).key,e.value]);return r(t)},o.keys=function(){for(var e=[],t=Object.keys(this.map),n=0;n<t.length;n++)e.push(this.map[t[n]].key);return r(e)},o.values=function(){for(var e=[],t=Object.keys(this.map),n=0;n<t.length;n++)e.push(this.map[t[n]].value);return r(e)},o.forEach=function(e,t){for(var r,n=Object.keys(this.map),o=0;o<n.length;o++)e.call(t,(r=this.map[n[o]]).value,r.key,this)},o.set=function(e,t){var r=this.keyElem.verifyValue(e),n=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(r)]={key:r,value:n},this},o.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(t in this.map)return this.map[t].value},o.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},n}(0,r.Reflect),r.loadProto=function(e,t,n){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(n=t,t=void 0),r.loadJson(r.DotProto.Parser.parse(e),t,n)},r.protoFromString=r.loadProto,r.loadProtoFile=function(e,t,n){if(t&&"object"==typeof t?(n=t,t=null):t&&"function"==typeof t||(t=null),t)return r.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(o){if(null!==o)try{t(null,r.loadProto(o,n,e))}catch(e){t(e)}else t(Error("Failed to fetch file"))});var o=r.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===o?null:r.loadProto(o,n,e)},r.protoFromFile=r.loadProtoFile,r.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=r.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=r.populateAccessors),new r.Builder(e)},r.loadJson=function(e,t,n){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(n=t,t=null),t&&"object"==typeof t||(t=r.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,n),t.resolveAll(),t},r.loadJsonFile=function(e,t,n){if(t&&"object"==typeof t?(n=t,t=null):t&&"function"==typeof t||(t=null),t)return r.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(o){if(null!==o)try{t(null,r.loadJson(JSON.parse(o),n,e))}catch(e){t(e)}else t(Error("Failed to fetch file"))});var o=r.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===o?null:r.loadJson(JSON.parse(o),n,e)},r});var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,drawImage=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;window.performance=window.performance||{},window.performance.now=window.performance.now||function(){var e=Date.now();return function(){return Date.now()-e}}(),window.URL=window.URL||window.webkitURL;var WebRTCPlugin=WebRTCPlugin||{};if(WebRTCPlugin.pluginInfo={prefix:"object_",plugName:"avd-plugin",classId:"CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53",pluginId:"plugin0",type:"application/avd-plugin",portalLink:"http://3tee.cn/dl.htm",downloadLink:null,companyName:null},"undefined"!=typeof IEPluginDownloadLink?WebRTCPlugin.pluginInfo.downloadLink=IEPluginDownloadLink:navigator.platform.match(/^Mac/i)?WebRTCPlugin.pluginInfo.downloadLink="http://3tee.cn/download/avd-plugin-safari.exe":navigator.platform.match(/^Win/i)&&(WebRTCPlugin.pluginInfo.downloadLink="http://3tee.cn/download/avd-plugin-ie.exe"),"undefined"!=typeof pluginCompanyName?WebRTCPlugin.pluginInfo.companyName=pluginCompanyName:WebRTCPlugin.pluginInfo.companyName="3Tee",WebRTCPlugin.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"本产品要求您安装一个插件,使在这个浏览器中支持WebRTC功能。",NOT_SUPPORTED:"您的浏览器不支持WebRTC.",BUTTON:"现在安装"},REFRESH:{REQUIRE_REFRESH:"插件已安装，请刷新页面。",BUTTON:"刷新页面"}},WebRTCPlugin.PLUGIN_STATES={NONE:0,READY:4},WebRTCPlugin.isPluginInstalled=null,WebRTCPlugin.pluginState=WebRTCPlugin.PLUGIN_STATES.NONE,WebRTCPlugin.callWhenPluginReady=function(e,t){if("complete"===document.readyState&&WebRTCPlugin.pluginState===WebRTCPlugin.PLUGIN_STATES.READY)e();else{console.log("readyState = "+document.readyState+", delaying "+t+"...");var r=setInterval(function(){"complete"===document.readyState&&WebRTCPlugin.pluginState===WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(r),e())},100)}},WebRTCPlugin.renderNotificationBar=function(e,t,r,n,o){if(document.getElementById("pluginNotificationBar"))return!1;var i=window,s=document.createElement("iframe");s.id="pluginNotificationBar",s.name="pluginNotificationBar",s.style.position="fixed",s.style.top="-41px",s.style.left=0,s.style.right=0,s.style.width="100%",s.style.height="40px",s.style.backgroundColor="#ffffe1",s.style.border="none",s.style.borderBottom="1px solid #888888",s.style.zIndex="9999999","string"==typeof s.style.webkitTransition?s.style.webkitTransition="all .5s ease-out":"string"==typeof s.style.transition&&(s.style.transition="all .5s ease-out"),document.body.appendChild(s);var a=s.contentWindow?s.contentWindow:s.contentDocument.document?s.contentDocument.document:s.contentDocument;if(a.document.open(),a.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+e+"</span>"),t&&r){a.document.write('<button id="okay">'+t+'</button><button id="cancel">取消</button>'),a.document.close();var l;attachEventListener(a.document.getElementById("okay"),"click",function(e){window.open(r,n?"_blank":"_top"),e.preventDefault();try{e.cancelBubble=!0}catch(e){}l=setInterval(function(){WebRTCPlugin.pluginState==WebRTCPlugin.PLUGIN_STATES.NONE&&installPlugin(),WebRTCPlugin.pluginState==WebRTCPlugin.PLUGIN_STATES.READY&&(s.parentNode.removeChild(s),clearInterval(l))},5e3)}),attachEventListener(a.document.getElementById("cancel"),"click",function(e){l&&clearInterval(l),i.document.body.removeChild(s)})}else a.document.close();setTimeout(function(){"string"==typeof s.style.webkitTransform?s.style.webkitTransform="translateY(40px)":"string"==typeof s.style.transform?s.style.transform="translateY(40px)":s.style.top="0px"},300)},drawImage=function(e,t,r,n,o,i){e.drawImage(t,r,n,o,i)},attachEventListener=function(e,t,r,n){e.addEventListener(t,r,n)},navigator.mozGetUserMedia){console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);var RTCPeerConnection=function(e,t){return maybeFixConfiguration(e),new mozRTCPeerConnection(e,t)};RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,createIceServer=function(e,t,r){var n=null,o=e.split(":");if(0===o[0].indexOf("stun"))n={url:e};else if(0===o[0].indexOf("turn"))if(webrtcDetectedVersion<27){var i=e.split("?");1!==i.length&&0!==i[1].indexOf("transport=udp")||(n={url:i[0],credential:r,username:t})}else n={url:e,credential:r,username:t};return n},createIceServers=function(e,t,r){var n=[];for(i=0;i<e.length;i++){var o=createIceServer(e[i],t,r);null!==o&&n.push(o)}return n},attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject,e.play()}}else if(navigator.webkitGetUserMedia){console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome";var result=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedVersion=null!==result?parseInt(result[2],10):999,createIceServer=function(e,t,r){var n=null,o=e.split(":");return 0===o[0].indexOf("stun")?n={url:e}:0===o[0].indexOf("turn")&&(n={url:e,credential:r,username:t}),n},createIceServers=function(e,t,r){var n=[];if(webrtcDetectedVersion>=34)n={urls:e,credential:r,username:t};else for(i=0;i<e.length;i++){var o=createIceServer(e[i],t,r);null!==o&&n.push(o)}return n};var RTCPeerConnection=function(e,t){return webrtcDetectedVersion<34&&maybeFixConfiguration(e),new webkitRTCPeerConnection(e,t)};getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(e,t){return void 0!==e.srcObject?e.srcObject=t:void 0!==e.mozSrcObject?e.mozSrcObject=t:void 0!==e.src?t?e.src=URL.createObjectURL(t):e.src&&void 0!==URL.revokeObjectURL&&(URL.revokeObjectURL(e.src),e.src=""):console.log("Error attaching stream to element."),e},reattachMediaStream=function(e,t){e.src=t.src}}else{var console=console||{log:function(e){}},createIceServer=function(e,t,r){var n=e.split(":");return 0===n[0].indexOf("stun")?{url:e}:0===n[0].indexOf("turn")?{url:e,credential:r,username:t}:null},extractPluginObj=function(e){return e.isWebRtcPlugin?e:e.pluginObj},attachEventListener=function(e,t,r,n){var o=extractPluginObj(e);o?o.bindEventListener(t,r,n):void 0!==e.addEventListener?e.addEventListener(t,r,n):void 0!==e.addEvent&&e.addEventListener("on"+t,r,n)},installPlugin=function(){if(!document.getElementById(WebRTCPlugin.pluginInfo.pluginId)){console.log("installPlugin() called");var e=!!(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window),t=!!navigator.userAgent.indexOf("Safari"),r=document.createElement("object");if(e?(r.setAttribute("classid",WebRTCPlugin.pluginInfo.classId),e=!0):r.setAttribute("type",WebRTCPlugin.pluginInfo.type),r.setAttribute("id",WebRTCPlugin.pluginInfo.pluginId),document.body.appendChild(r),r.setAttribute("width","0"),r.setAttribute("height","0"),r.isWebRtcPlugin||void 0!==navigator.plugins&&(navigator.plugins["avd-plugin"]||navigator.plugins["avd-plugin for Safari"]))console.log("Plugin version: "+r.versionName),WebRTCPlugin.pluginState=WebRTCPlugin.PLUGIN_STATES.READY,e?(console.log("This appears to be Internet Explorer"),webrtcDetectedBrowser="Internet Explorer"):t&&(console.log("This appears to be Safari"),webrtcDetectedBrowser="Safari");else{console.log("Browser does not appear to be WebRTC-capable"),WebRTCPlugin.pluginState=WebRTCPlugin.PLUGIN_STATES.NONE;var n=document.getElementById(WebRTCPlugin.pluginInfo.pluginId);n.parentNode.removeChild(n),pluginNeededButNotInstalled()}console.log("end of installPlugin()")}};pluginNeededButNotInstalled=function(){console.log("plugin Needed But Not Installed");var e=WebRTCPlugin.pluginInfo.downloadLink;if(e){var t;t=WebRTCPlugin.pluginInfo.portalLink?'本产品要求您安装一个插件 <a href="'+WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a> ,使在这个浏览器中支持WebRTC功能。":WebRTCPlugin.TEXT.PLUGIN.REQUIRE_INSTALLATION,WebRTCPlugin.renderNotificationBar(t,WebRTCPlugin.TEXT.PLUGIN.BUTTON,e)}else WebRTCPlugin.renderNotificationBar(WebRTCPlugin.TEXT.PLUGIN.NOT_SUPPORTED)},document.body?installPlugin():(attachEventListener(window,"load",function(){console.log("onload"),installPlugin()}),attachEventListener(document,"readystatechange",function(){console.log("onreadystatechange:"+document.readyState),"complete"==document.readyState&&installPlugin()})),getUserMedia=navigator.getUserMedia=function(e,t,r){WebRTCPlugin.callWhenPluginReady(function(){getPlugin().getUserMedia(e,t,r)},"getUserMedia")},attachMediaStream=function(e,t){if(console.log("Attaching media stream"),!e)return null;if(e.isWebRtcPlugin)return e.src=t,e;if("video"===e.nodeName.toLowerCase()){if(!e.pluginObj&&t){var r=document.createElement("object");if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){var n=document.createElement("param");n.setAttribute("name","windowless"),n.setAttribute("value",!0),r.appendChild(n),r.setAttribute("classid",WebRTCPlugin.pluginInfo.classId)}else r.setAttribute("type",WebRTCPlugin.pluginInfo.type);e.pluginObj=r,r.setAttribute("id",WebRTCPlugin.pluginInfo.prefix+e.id);var o=e.getAttribute("width"),i=e.getAttribute("height"),s=e.getBoundingClientRect();if(o||(o=s.right-s.left),i||(i=s.bottom-s.top),"getComputedStyle"in window){var a=window.getComputedStyle(e,null);o||"auto"==a.width||"0px"==a.width||(o=a.width),i||"auto"==a.height||"0px"==a.height||(i=a.height)}o?r.setAttribute("width",o):r.setAttribute("autowidth",!0),i?r.setAttribute("height",i):r.setAttribute("autoheight",!0),document.body.appendChild(r),e.parentNode&&(e.parentNode.replaceChild(r,e),document.body.appendChild(e),e.style.visibility="hidden")}else!e.pluginObj||null!=t&&""!=t||(e.style.visibility="",e.pluginObj.parentNode.replaceChild(e,e.pluginObj),e.pluginObj=null);return e.pluginObj&&(e.pluginObj.bindEventListener("play",function(t){e.pluginObj&&(e.pluginObj.getAttribute("autowidth")&&t.videoWidth&&e.pluginObj.setAttribute("width",t.videoWidth),e.pluginObj.getAttribute("autoheight")&&t.videoHeight&&e.pluginObj.setAttribute("height",t.videoHeight))}),e.pluginObj.src=t),e.pluginObj}return"audio"===e.nodeName.toLowerCase()?e:void 0},drawImage=function(e,t,r,n,o,i){var s=extractPluginObj(t);if(s&&s.isWebRtcPlugin&&s.videoWidth>0&&s.videoHeight>0)if(void 0!==s.getScreenShot){var a=s.getScreenShot();if(a){var l=new Image;l.onload=function(){e.drawImage(l,0,0,o,i)},l.src="data:image/png;base64,"+a}}else{var u=e.createImageData(s.videoWidth,s.videoHeight);u&&(s.fillImageData(u),e.putImageData(u,r,n))}},MediaStreamTrack={},MediaStreamTrack.getSources=function(e){WebRTCPlugin.callWhenPluginReady(function(){getPlugin().getSources(e)},"getSources")},RTCPeerConnection=function(e,t){var r=getPlugin().createPeerConnection(e,t),n=this;r.onIceCandidate=function(e){n.onicecandidate(e)},r.onaddstream=function(e){n.onaddstream(e)},r.onremovestream=function(e){n.onremovestream(e)},r.ondatachannel=function(e){n.ondatachannel(e)},r.oniceconnectionstatechange=function(){var e=r.iceConnectionState;n.iceConnectionState=e;var t={},o={};t.target=o,t.target.iceConnectionState=e,n.oniceconnectionstatechange(t)},r.onsignalingstatechange=function(){var e=r.signalingState;n.signalingState=e,n.remoteDescription=r.remoteDescription;var t={},o={};t.target=o,t.target.signalingState=e,n.onsignalingstatechange(t)},n.addStream=function(e){r.addStream(e)},n.removeStream=function(e){r.removeStream(e)},n.createOffer=function(e,t,n){n=mergeConstraints({optional:[],mandatory:{}},n),r.createOffer(e,t,n)},n.createAnswer=function(e,t,n){n=mergeConstraints({optional:[],mandatory:{}},n),r.createAnswer(e,t,n)},n.setLocalDescription=function(e,t,n){r.setLocalDescription(e,t,n)},n.setRemoteDescription=function(e,t,n){r.setRemoteDescription(e,t,n)},n.addIceCandidate=function(e,t,n){r.addIceCandidate(e,t,n)},n.close=function(){r.close()},n.onsignalingstatechange=function(e){return e},n.getStats=function(e,t){r.getStats(e,t)}},RTCIceCandidate=function(e){return getPlugin().createIceCandidate(e)},RTCSessionDescription=function(e){return getPlugin().createSessionDescription(e)}}SdpSerializer.SerializeASBandwidth=function(e,t){return t=t||{},e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+(t.audio||50)+"\r\n"),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t.video||256)+"\r\n"),e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+(t.data||1638400)+"\r\n")},SdpSerializer.SerializePTime=function(e,t){return t=t||{},e=e.replace("a=fmtp:111 minptime=10","a=fmtp:111 minptime="+(t.minptime||10)),e=e.replace("a=maxptime:60","a=maxptime:"+(t.maxptime||60))},SdpSerializer.SerializeGoogleMinBitrate=function(e,t){return e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\na=rtpmap:120 VP8/90000\r\na=fmtp:120 \t\t\t\t\t\t\tx-google-min-bitrate="+(t||10)+"\r\n")},SdpSerializer.RTPOverTCP=function(e){return e.replace(/a=candidate:.*udp.*\r\n/g,"")},function(e,t){"use strict";e(function(){function e(e,t,r,o){return n(e).then(t,r,o)}function r(e,t){this.then=e,this.inspect=t}function n(e){return o(function(t){t(e)})}function o(e){function t(e){c&&(s=i(e),u(c,s),c=_)}function n(e){t(a(e))}var s,c=[];try{e(t,n,function(e){c&&u(c,l(e))})}catch(e){n(e)}return new r(function(e,t,r){return o(function(n,o,i){c?c.push(function(s){s.then(e,t,r).then(n,o,i)}):m(function(){s.then(e,t,r).then(n,o,i)})})},function(){return s?s.inspect():{state:"pending"}})}function i(e){return e instanceof r?e:e===Object(e)&&"then"in e?o(function(t,r,n){m(function(){try{var o=e.then;"function"==typeof o?w(o,e,t,r,n):t(s(e))}catch(e){r(e)}})}):s(e)}function s(e){var t=new r(function(r){try{return"function"==typeof r?i(r(e)):t}catch(e){return a(e)}},function(){return f(e)});return t}function a(e){var t=new r(function(r,n){try{return"function"==typeof n?i(n(e)):t}catch(e){return a(e)}},function(){return h(e)});return t}function l(e){var t=new r(function(r,n,o){try{return"function"==typeof o?l(o(e)):t}catch(e){return l(e)}});return t}function u(e,t){m(function(){for(var r,n=0;r=e[n++];)r(t)})}function c(t,r,n,i,s){return e(t,function(t){return o(function(n,o,i){var s,a,l,u,c,d,p,f;if(p=t.length>>>0,s=Math.max(0,Math.min(r,p)),l=[],a=p-s+1,u=[],s)for(d=function(e){u.push(e),--a||(c=d=y,o(u))},c=function(e){l.push(e),--s||(c=d=y,n(l))},f=0;p>f;++f)f in t&&e(t[f],function(e){c(e)},function(e){d(e)},i);else n(l)}).then(n,i,s)})}function d(e,t,r,n){return p(e,y).then(t,r,n)}function p(t,r,n){return e(t,function(t){return o(function(o,i,s){var a,l,u,c,d;if(u=l=t.length>>>0,a=[],u)for(c=function(t,l){e(t,r,n).then(function(e){a[l]=e,--u||o(a)},i,s)},d=0;l>d;d++)d in t?c(t[d],d):--u;else o(a)})})}function f(e){return{state:"fulfilled",value:e}}function h(e){return{state:"rejected",reason:e}}function m(e){1===C.push(e)&&g()}function g(){E(v)}function v(){for(var e,t=0;e=C[t++];)e();C=[]}function y(e){return e}e.defer=function(){var e,t,r;return e={promise:_,resolve:_,reject:_,notify:_,resolver:{resolve:_,reject:_,notify:_}},e.promise=t=o(function(o,i,s){e.resolve=e.resolver.resolve=function(e){return r?n(e):(r=!0,o(e),t)},e.reject=e.resolver.reject=function(e){return r?n(a(e)):(r=!0,i(e),t)},e.notify=e.resolver.notify=function(e){return s(e),e}}),e},e.resolve=n,e.reject=function(t){return e(t,a)},e.join=function(){return p(arguments,y)},e.all=d,e.map=function(e,t){return p(e,t)},e.reduce=function(t,r){var n=w(S,arguments,1);return e(t,function(t){var o;return o=t.length,n[0]=function(t,n,i){return e(t,function(t){return e(n,function(e){return r(t,e,i,o)})})},b.apply(t,n)})},e.settle=function(e){return p(e,f,h)},e.any=function(e,t,r,n){return c(e,1,function(e){return t?t(e[0]):e[0]},r,n)},e.some=c,e.isPromise=function(e){return e&&"function"==typeof e.then},e.promise=o,r.prototype={otherwise:function(e){return this.then(_,e)},ensure:function(e){function t(){return n(e())}return this.then(t,t).yield2(this)},yield2:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return d(t,function(t){return e.apply(_,t)})})},always:function(e,t){return this.then(e,e,t)}};var b,S,w,E,C,P,T,I,R,_;return C=[],P=t.setTimeout,E="function"==typeof setImmediate?setImmediate.bind(t):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(e){P(e,0)},T=Function.prototype,I=T.call,w=T.bind?I.bind(I):function(e,t){return e.apply(t,S.call(arguments,2))},R=[],S=R.slice,b=R.reduce||function(e){var t,r,n,o,i;if(i=0,t=Object(this),o=t.length>>>0,(r=arguments).length<=1)for(;;){if(i in t){n=t[i++];break}if(++i>=o)throw new TypeError}else n=r[1];for(;o>i;++i)i in t&&(n=e(n,t[i],i,t));return n},e})}("function"==typeof define&&define.amd?define:function(e){window.when=e()},this),EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,r,n,o,i,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],isUndefined(r))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];r.apply(this,o)}else if(isObject(r)){for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];for(n=(s=r.slice()).length,i=0;i<n;i++)s[i].apply(this,o)}return!0},EventEmitter.prototype.addListener=function(e,t){if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var r;(r=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},EventEmitter.prototype.removeListener=function(e,t){var r,n,o,i;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(i=o;i-- >0;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],isFunction(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){return e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};var ErrorConstant={check_webrtc_supported:{code:2e3,message:"此浏览器不支持WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"此浏览器不支持MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:"屏幕共享插件找不到"},screen_sharing_response_is_null:{code:2004,message:"没有屏幕共享"},not_join_room:{code:2005,message:"还未加会"},navigatorUserMediaError_permissionDenied:{code:2010,message:"打开设备权限不足，原因是非https访问或主动拒绝了设备请求"},navigatorUserMediaError_constraintNotSatisfied:{code:2011,message:"设备打开失败，因为传入的参数格式不对"},navigatorUserMediaError_trackStartError:{code:2012,message:"设备打开失败，因为设备已被占用"},navigatorUserMediaError_unknown:{code:2015,message:"设备打开失败未知错误"},cameraId_does_not_exist:{code:2017,message:"摄像头ID不存在"},closeVideo_before_operation_warnings:{code:2018,message:"请关闭摄像头以后再进行此操作"},websock_create_error:{code:2020,message:"Websocket创建失败"},websock_catch_exception:{code:2021,message:"Websocket操作失败"},join_room_timeout:{code:1014,message:"加会超时"},oemname_notfound:{code:1017,message:"OEM名称没找到"},avdEngine_init_failed:{code:1018,message:"sdk引擎初始化失败"},userId_required:{code:1300,message:"userId是必须项，不能为空"},mulLanding_error:{code:1301,message:"同一个userId不能多次登录"},roomId_required:{code:1302,message:"roomId是必须项，不能为空"},params_require:{code:1303,message:"params是必须项，不能为空"},userAddress_require:{code:1304,message:"userAddress是必须项，不能为空"},ft_no_authorization:{code:1305,message:"模块无授权."}},FTConstant={datachannel:{name:"透明通道",value:"ft_datachannel"},chat:{name:"聊天",value:"ft_chat"},audio:{name:"语音",value:"ft_audio"},video:{name:"普通视频",value:"ft_video"},video_hd:{name:"高清视频",value:"ft_video_hd"},screen:{name:"屏幕共享",value:"ft_screen"},annotation:{name:"注释白板",value:"ft_annotation"},p2p:{name:"P2P房间",value:"ft_p2p"},avei:{name:"音视频导入导出",value:"ft_avei"},h265:{name:"H265模块",value:"ft_h265"},client_record_audio:{name:"客户端音频录制",value:"ft_client_record_audio"},client_record_video:{name:"客户端视频录制",value:"ft_client_record_video"},clinet_livebroadcast:{name:"客户端直播路数",value:"ft_clinet_livebroadcast"},record_audio:{name:"录制音频",value:"ft_record_audio"},record_video:{name:"录制视频",value:"ft_record_video"},outgoing:{name:"设备集成，如rtsp、h323、sip等",value:"ft_outgoing"},livebroadcast:{name:"旁路直播",value:"ft_livebroadcast"},platform_android:{name:"Android系统",value:"ft_platform_android"},platform_ios:{name:"ios系统",value:"ft_platform_ios"},platform_win:{name:"windows桌面系统",value:"ft_platform_win"},platform_mac:{name:"mac ox桌面系统",value:"ft_platform_mac"},platform_linux:{name:"linux桌面系统",value:"ft_platform_linux"},platform_web:{name:"web js系统",value:"ft_platform_web"},server_platform_linux:{name:"服务器平台linux",value:"ft_server_platform_linux"},server_platform_win:{name:"服务器平台windows",value:"ft_server_platform_win"},server_platform_linux_cluster:{name:"服务器平台linux集群",value:"ft_server_platform_linux_cluster"}},ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},EngineCallback={room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error"},VideoCodingType={VP8:0,VP9:1,H264:2},Resolution={1080:{width:1920,height:1080,order:14},720:{width:1280,height:720,order:13},960:{width:960,height:720,order:12},642:{width:640,height:1024,order:11},641:{width:640,height:960,order:10},640:{width:640,height:480,order:9},639:{width:640,height:360,order:8},508:{width:508,height:360,order:7},481:{width:480,height:854,order:6},480:{width:480,height:800,order:5},321:{width:320,height:480,order:4},320:{width:320,height:240,order:3},180:{width:320,height:180,order:2},160:{width:160,height:120,order:1}},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3};StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2};var RoomCallback={connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",public_data:"public.data",private_data:"private.data",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed"},UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result"},RecordEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}},LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={line:1,ellipse:2,rect:3,polyline:4,arrowline:5,undo:6,redo:7,clear:8,eraser:9,right:10,wrong:11},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},arrayUtil={intersection:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=e[n];for(var n=0,o=t.length;n<o;n++)r[t[n]]=t[n];var i=new Array,n=0;for(var s in r)i[n++]=r[s];return i},chaji:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(var n=0,o=t.length;n<o;n++)r[t[n]]=r[t[n]]?2:1;var i=new Array,n=0;for(var s in r)1==r[s]&&(i[n++]=s);return i},chajiObject:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n].nodeId]=1;for(var n=0,o=t.length;n<o;n++)r[t[n].nodeId]=r[t[n].nodeId]?2:1;var i=new Array,n=0;for(var s in r)1==r[s]&&(i[n++]=s);return i},inANotInB:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(var n=0,o=t.length;n<o;n++)r.hasOwnProperty(t[n])&&(r[t[n]]=void 0);var i=new Array,n=0;for(var s in r)r[s]&&(i[n++]=s);return i},baseSplice:function(e,t){for(var r,n=0;n<e.length;n++)if(e[n]==t){r=n;break}r>-1&&e.splice(r,1)},objectSplice:function(e,t){for(var r,n=0;n<e.length;n++)if(e[n].id==t){r=n;break}r>-1&&e.splice(r,1)}},typeConversionUtil={String2ArrayBuffer:function(e){for(var e=btoa(unescape(encodeURIComponent(e))),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,o=e.length;n<o;n++)r[n]=e.charCodeAt(n);return t},ArrayBuffer2String:function(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(atob(t)))}};!function(){var e={},t={},r=function(){},n={define:function(t,r,n){if(!e[t]){var o={name:t,dependencies:r,factory:n};e[t]=o}return e[t]},use:function(t){var n=e[t];if(!n)return null;if(!n.entity){for(var o=[],i=0;i<n.dependencies.length;i++)e[n.dependencies[i]].entity?o.push(e[n.dependencies[i]].entity):o.push(this.use(n.dependencies[i]));n.entity=n.factory.apply(r,o)}return n.entity},require:function(e,r){function n(){for(var n=!0,o=0;o<e.length;o++)if(!t[e[o]]){n=!1;break}n&&r()}for(var o=0;o<e.length;o++){var i=e[o];if(!t[i]){var s=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.async="true",a.src=i+".js",a.onload=function(){t[i]=!0,s.removeChild(a),n()},s.appendChild(a)}}}};window.ModuleBase=n}(),ModuleBase.define("Error",[],function(){var e=function(e,t){"object"==typeof e&&void 0===t?(this.code=e.code,this.message=e.message):(this.code=e,this.message=t)};return e.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},e});var cmdBuilder=dcodeIO.ProtoBuf.newBuilder({}).import({package:"room_pdu",messages:[{name:"Packet",fields:[{rule:"required",type:"RoomPduType",name:"type",id:1},{rule:"required",type:"int32",name:"priority",id:2,options:{default:0}},{rule:"required",type:"int32",name:"src",id:3},{rule:"required",type:"int32",name:"dst",id:4,options:{default:0}},{rule:"optional",type:"bytes",name:"body",id:5}]},{name:"MultiPacket",fields:[{rule:"repeated",type:"Packet",name:"packets",id:1}]},{name:"Webcam",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"CameraType",name:"ctype",id:7}]},{name:"Speaker",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"Desktop",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"DocFile",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"required",type:"string",name:"uri",id:5}]},{name:"AddWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Webcam",name:"webcam",id:2}]},{name:"RemoveWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Speaker",name:"speaker",id:2}]},{name:"RemoveSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"DocFile",name:"docfile",id:2}]},{name:"RemoveDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"RoomResourceInfo",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"int32",name:"owner_id",id:2},{rule:"optional",type:"MediaStream",name:"stream",id:3},{rule:"optional",type:"MediaStream",name:"stream_assist1",id:4},{rule:"optional",type:"MediaStream",name:"stream_assist2",id:5},{rule:"optional",type:"int32",name:"publishQualities",id:6}]},{name:"RoomInfo",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"required",type:"RoomStatus",name:"room_status",id:2,options:{default:"init_room"}}]},{name:"UserPolicy",fields:[{rule:"optional",type:"bool",name:"join_chat",id:1},{rule:"optional",type:"bool",name:"join_audio",id:2},{rule:"optional",type:"bool",name:"join_video",id:3}]},{name:"JoinInfo",fields:[{rule:"repeated",type:"Webcam",name:"webcams",id:1},{rule:"repeated",type:"Speaker",name:"speakers",id:2},{rule:"optional",type:"string",name:"user_agent",id:3},{rule:"required",type:"UserPolicy",name:"user_policy",id:4}]},{name:"UserInfo",fields:[{rule:"optional",type:"string",name:"user_id",id:1},{rule:"required",type:"string",name:"user_name",id:2},{rule:"required",type:"UserRole",name:"role",id:3},{rule:"required",type:"int32",name:"privileges",id:4},{rule:"required",type:"UserStatus",name:"status",id:5},{rule:"repeated",type:"Webcam",name:"webcams",id:6},{rule:"repeated",type:"Speaker",name:"speakers",id:7},{rule:"optional",type:"string",name:"user_agent",id:8},{rule:"required",type:"int32",name:"node_id",id:9},{rule:"optional",type:"UserPolicy",name:"user_policy",id:10},{rule:"repeated",type:"Desktop",name:"desktops",id:11},{rule:"optional",type:"string",name:"user_data",id:12}]},{name:"MediaStream",fields:[{rule:"required",type:"string",name:"stream_name",id:1},{rule:"required",type:"MediaType",name:"type",id:2},{rule:"optional",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"width",id:4},{rule:"optional",type:"int32",name:"height",id:5},{rule:"optional",type:"int32",name:"frame_rate",id:6},{rule:"optional",type:"int32",name:"payload",id:7}]},{name:"MediaStreamInfo",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"MediaStream",name:"stream",id:3}]},{name:"ResourceIndiction",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"ResourceOpt",name:"opt",id:2},{rule:"required",type:"int32",name:"owner_id",id:3},{rule:"required",type:"int32",name:"operator_id",id:4},{rule:"optional",type:"string",name:"host_tocken",id:5}]},{name:"AddDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Desktop",name:"desktop",id:2}]},{name:"UpdateSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Speaker",name:"speaker",id:3}]},{name:"UpdateWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Webcam",name:"webcam",id:3}]},{name:"UpdateDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Desktop",name:"desktop",id:3}]},{name:"JoinReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"version",id:2},{rule:"required",type:"string",name:"room_tocken",id:3},{rule:"optional",type:"string",name:"user_id",id:4},{rule:"required",type:"string",name:"user_name",id:5},{rule:"optional",type:"JoinInfo",name:"join_info",id:6},{rule:"optional",type:"string",name:"password",id:7}]},{name:"JoinRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomInfo",name:"room_info",id:4},{rule:"optional",type:"int32",name:"node_id",id:5},{rule:"optional",type:"UserInfo",name:"user_info",id:6}]},{name:"LeaveMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"reason",id:2}]},{name:"UpdateRoomStatusMsg",fields:[{rule:"required",type:"RoomStatus",name:"status",id:1}]},{name:"PubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"UnpubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"SubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3}]},{name:"UnsubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2}]},{name:"PubResourceReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2}]},{name:"PubResourceRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RepResultType",name:"type",id:2},{rule:"optional",type:"int32",name:"reason",id:3}]},{name:"RoomKV",fields:[{rule:"required",type:"string",name:"key",id:1},{rule:"required",type:"string",name:"value",id:2}]},{name:"RoomDataInfo",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"repeated",type:"RoomKV",name:"kvs",id:2}]},{name:"PubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"SubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"RoomResourceInfos",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"optional",type:"string",name:"room_id",id:2}]},{name:"UpdateStreamSsrcMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"uint32",name:"old_ssrc",id:3},{rule:"required",type:"uint32",name:"new_ssrc",id:4}]},{name:"TextMsg",fields:[{rule:"required",type:"string",name:"content",id:1},{rule:"optional",type:"int32",name:"timestamp",id:2}]},{name:"DATA",fields:[{rule:"required",type:"bytes",name:"content",id:1}]},{name:"UserInfoMsg",fields:[{rule:"repeated",type:"UserInfo",name:"user",id:1}]},{name:"UserMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserMsgOpt",name:"opt",id:2},{rule:"optional",type:"int32",name:"reason",id:3},{rule:"optional",type:"int32",name:"opt_node_id",id:4}]},{name:"UpdateUserRolePriviledgeMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"old",id:2},{rule:"required",type:"int32",name:"new",id:3}]},{name:"UpdateUserStatusMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserStatus",name:"old",id:2},{rule:"required",type:"UserStatus",name:"new",id:3}]},{name:"UpdateUserRoleMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserRole",name:"old",id:2},{rule:"required",type:"UserRole",name:"new",id:3}]},{name:"UserIndiction",fields:[{rule:"required",type:"int32",name:"operator_id",id:1},{rule:"required",type:"RoomPduType",name:"type",id:2},{rule:"optional",type:"bytes",name:"body",id:3}]},{name:"UpdateUserDataMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"user_data",id:2}]},{name:"RejoinRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"CloseRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"OfferReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"sdp",id:2},{rule:"required",type:"int32",name:"node_id",id:3}]},{name:"OfferRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"sdp",id:4},{rule:"optional",type:"int32",name:"node_id",id:5}]},{name:"CandidateMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"int32",name:"node_id",id:4}]},{name:"SubRoomResourceReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"required",type:"int32",name:"sub_node_id",id:3}]},{name:"SubRoomResourceRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomResourceInfo",name:"info",id:4}]},{name:"OpenReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"access_tocken",id:2},{rule:"optional",type:"string",name:"signal_tocken",id:3},{rule:"optional",type:"string",name:"version",id:4}]},{name:"OpenRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"signal_tocken",id:4},{rule:"optional",type:"int32",name:"ping_timeout",id:5},{rule:"optional",type:"int32",name:"ping_interval",id:6},{rule:"optional",type:"string",name:"version",id:7}]},{name:"InviteRoomReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"node_id",id:4}]},{name:"InviteRoomReq1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"version",id:3},{rule:"required",type:"string",name:"access_tocken",id:4},{rule:"optional",type:"string",name:"user_id",id:5},{rule:"required",type:"string",name:"user_name",id:6},{rule:"optional",type:"JoinInfo",name:"join_info",id:7},{rule:"optional",type:"string",name:"password",id:8},{rule:"optional",type:"int32",name:"node_id",id:9},{rule:"optional",type:"bool",name:"is_dtls",id:10},{rule:"optional",type:"string",name:"user_data",id:11},{rule:"optional",type:"string",name:"ice_ufrag",id:12},{rule:"optional",type:"string",name:"ice_pwd",id:13}]},{name:"RoomInfo1",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"topic",id:2},{rule:"optional",type:"string",name:"owner_id",id:3},{rule:"optional",type:"string",name:"host_id",id:4},{rule:"optional",type:"bool",name:"has_pwd",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"int32",name:"timezone",id:7},{rule:"optional",type:"int32",name:"start_time",id:8},{rule:"optional",type:"int32",name:"end_time",id:9},{rule:"optional",type:"RoomMode",name:"room_mode",id:10},{rule:"optional",type:"int32",name:"attendee_max",id:11},{rule:"optional",type:"int32",name:"bandwidth",id:12},{rule:"optional",type:"int32",name:"max_audio",id:13},{rule:"optional",type:"int32",name:"max_video",id:14},{rule:"optional",type:"string",name:"room_extend_id",id:15},{rule:"optional",type:"RoomStatus",name:"room_status",id:16,options:{default:"init_room"}}]},{name:"InviteRoomRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"string",name:"sdp",id:5},{rule:"optional",type:"RoomInfo1",name:"room_info",id:6}]},{name:"InviteRoomRep1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"RoomInfo1",name:"room_info",id:5},{rule:"optional",type:"string",name:"finger_print",id:6},{rule:"optional",type:"int32",name:"node_id",id:7},{rule:"optional",type:"int32",name:"ping_timeout",id:8},{rule:"optional",type:"int32",name:"ping_interval",id:9},{rule:"optional",type:"string",name:"ice_ufrag",id:10},{rule:"optional",type:"string",name:"ice_pwd",id:11},{rule:"optional",type:"UserRole",name:"role",id:12},{rule:"optional",type:"string",name:"setup",id:13,options:{default:"active"}}]},{name:"CandidateMsg1",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"CloseMsg",fields:[{rule:"required",type:"string",name:"room_tocken",id:1}]},{name:"Point",fields:[{rule:"required",type:"int32",name:"x",id:1},{rule:"required",type:"int32",name:"y",id:2}]},{name:"color",fields:[{rule:"required",type:"int32",name:"a",id:1},{rule:"required",type:"int32",name:"r",id:2},{rule:"required",type:"int32",name:"g",id:3},{rule:"required",type:"int32",name:"b",id:4}]},{name:"Rect",fields:[{rule:"required",type:"int32",name:"left",id:1},{rule:"required",type:"int32",name:"right",id:2},{rule:"required",type:"int32",name:"top",id:3},{rule:"required",type:"int32",name:"bottom",id:4}]},{name:"AnnotationObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"string",name:"annotationId",id:2},{rule:"required",type:"int32",name:"ownerNodeId",id:3},{rule:"required",type:"string",name:"ownerUserId",id:4},{rule:"required",type:"AnnotationType",name:"type",id:5},{rule:"required",type:"LineArrow",name:"arrow",id:6},{rule:"required",type:"int32",name:"lineWidth",id:7},{rule:"required",type:"color",name:"lineColor",id:8},{rule:"required",type:"color",name:"fillColor",id:9},{rule:"required",type:"Rect",name:"objectRect",id:10}]},{name:"Annotation2Point",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"Point",name:"start",id:2},{rule:"required",type:"Point",name:"end",id:3}]},{name:"AnnotationMultiPoint",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"Point",name:"points",id:2}]},{name:"AnnotationList",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"string",name:"eraserIds",id:2}]},{name:"AnnotationMsgInternal",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2},{rule:"optional",type:"string",name:"annotationId",id:3},{rule:"optional",type:"int32",name:"srcNodeId",id:4},{rule:"optional",type:"int32",name:"dstNodeId",id:5}]},{name:"AnnotationMsg",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2}]}],enums:[{name:"RoomPduType",values:[{name:"RoomPduType_Unkonw",id:0},{name:"PING",id:1},{name:"PONG",id:2},{name:"MULTI_PACKET",id:10},{name:"ADD_WEBCAM_MSG",id:1001},{name:"REMOVE_WEBCAM_MSG",id:1002},{name:"ADD_SPEAKER_MSG",id:1003},{name:"REMOVE_SPEAKER_MSG",id:1004},{name:"ADD_DOC_MSG",id:1005},{name:"REMOVE_DOC_MSG",id:1006},{name:"VIDEO_INDICTION",id:1007},{name:"AUDIO_INDICTION",id:1008},{name:"ADD_DESKTOP_MSG",id:1009},{name:"UPDATE_SPEAKER_MSG",id:1010},{name:"UPDATE_WEBCAM_MSG",id:1011},{name:"UPDATE_DESKTOP_MSG",id:1012},{name:"JOIN_REQ",id:2001},{name:"JOIN_REP",id:2002},{name:"LEAVE_MSG",id:2003},{name:"UPDATE_ROOM_STATUS_MSG",id:2004},{name:"PUB_ROOM_RESOURCE_MSG",id:2005},{name:"UNPUB_ROOM_RESOURCE_MSG",id:2006},{name:"SUB_ROOM_RESOURCE_MSG",id:2007},{name:"UNSUB_ROOM_RESOURCE_MSG",id:2008},{name:"PUB_VIDEO_REQ",id:2009},{name:"PUB_AUDIO_REQ",id:2010},{name:"PUB_VIDEO_REP",id:2011},{name:"PUB_AUDIO_REP",id:2012},{name:"ROOM_DATA_INFO",id:2013},{name:"PUB_ROOM_RESOURCE_MSG_REP",id:2014},{name:"SUB_ROOM_RESOURCE_MSG_REP",id:2015},{name:"ROOM_RESOURCE_INFOS",id:2016},{name:"UPDATE_STREAM_SSRC_MSG",id:2017},{name:"PUBLIC_TEXT_MSG",id:3001},{name:"PRIVATE_TEXT_MSG",id:3002},{name:"PUBLIC_DATA",id:3003},{name:"PRIVATE_DATA",id:3004},{name:"USER_INFO_MSG",id:2051},{name:"USER_MSG",id:2052},{name:"UPDATA_USER_ROLE_PRIVILEDGE_MSG",id:2053},{name:"UPDATE_USER_STATUS_MSG",id:2054},{name:"UPDATE_USER_ROLE_MSG",id:2055},{name:"USER_INDICTION",id:2056},{name:"UPDATE_USER_DATA_MSG",id:2057},{name:"REJOIN_ROOM_MSG",id:2058},{name:"CLOSE_ROOM_MSG",id:2059},{name:"OFFER_REQ",id:6001},{name:"OFFER_REP",id:6002},{name:"CANDIDATE_MSG",id:6003},{name:"SUB_ROOM_RESOURCE_REQ",id:6004},{name:"SUB_ROOM_RESOURCE_REP",id:6005},{name:"OPEN_REQ",id:7001},{name:"OPEN_REP",id:7002},{name:"INVITE_ROOM_REQ",id:7003},{name:"INVITE_ROOM_REQ1",id:7020},{name:"INVITE_ROOM_REP",id:7004},{name:"INVITE_ROOM_REP1",id:7021},{name:"CANDIDATE_MSG1",id:7005},{name:"CLOSE_MSG",id:7006},{name:"ANNOTATION_MSG",id:2100}]},{name:"RoomStatus",values:[{name:"init_room",id:1},{name:"open_room",id:2},{name:"locked_room",id:3},{name:"closed_room",id:4}]},{name:"ResourceOpt",values:[{name:"pub",id:1},{name:"unpub",id:2},{name:"sub",id:3},{name:"unsub",id:4},{name:"mute",id:5},{name:"unmute",id:6},{name:"forbid",id:7},{name:"unforbid",id:8}]},{name:"ResourceStatus",values:[{name:"init",id:1},{name:"published",id:2},{name:"muted",id:3},{name:"forbided",id:4},{name:"subed",id:5}]},{name:"CameraType",values:[{name:"unknown",id:0},{name:"front",id:1},{name:"back",id:2}]},{name:"UserStatus",values:[{name:"online",id:0},{name:"offline",id:1}]},{name:"UserRole",values:[{name:"host",id:1},{name:"presenter",id:2},{name:"attendee",id:3}]},{name:"MediaType",values:[{name:"video",id:1},{name:"audio",id:2},{name:"desktop",id:3}]},{name:"SessionType",values:[{name:"Chat",id:1},{name:"Audio",id:2},{name:"Video",id:3},{name:"ShareScreen",id:4},{name:"ShareDoc",id:5},{name:"WhiteBoard",id:6}]},{name:"RepResultType",values:[{name:"allowed",id:1},{name:"rejected",id:2}]},{name:"UserMsgOpt",values:[{name:"leave",id:1},{name:"kickoff",id:2},{name:"server_kickoff",id:3}]},{name:"RoomMode",values:[{name:"free",id:1},{name:"host1",id:2},{name:"p2pfree",id:3},{name:"p2phost",id:4}]},{name:"LineArrow",values:[{name:"none",id:1},{name:"begin",id:2},{name:"end",id:3},{name:"arrow2",id:4}]},{name:"AnnotationType",values:[{name:"annotation_tool_mouse",id:1},{name:"annotation_tool_line",id:2},{name:"annotation_tool_rectangle",id:3},{name:"annotation_tool_ellipse",id:4},{name:"annotation_tool_polyline",id:5},{name:"annotation_tool_polygon",id:6},{name:"annotation_tool_hlight_point",id:7},{name:"annotation_tool_hlight_texttag",id:8},{name:"annotation_tool_eraser_line",id:9},{name:"annotation_tool_eraser_rectangle",id:10},{name:"annotation_tool_rhomb",id:11},{name:"annotation_tool_arrow",id:12},{name:"annotation_tool_success",id:13},{name:"annotation_tool_failure",id:14},{name:"annotation_tool_undo",id:15},{name:"annotation_tool_redo",id:16}]}]}).build();ModuleBase.define("CmdProtobufCoded",[],function(){var e,t=function(){e=cmdBuilder.room_pdu};return t.prototype.getRoomPduTypeEnum=function(){return e.RoomPduType},t.prototype.getRoomStatusEnum=function(){return e.RoomStatus},t.prototype.getResourceOptEnum=function(){return e.ResourceOpt},t.prototype.getResourceStatusEnum=function(){return e.ResourceStatus},t.prototype.getCameraTypeEnum=function(){return e.CameraType},t.prototype.getUserStatusEnum=function(){return e.UserStatus},t.prototype.getUserRoleEnum=function(){return e.UserRole},t.prototype.getMediaTypeEnum=function(){return e.MediaType},t.prototype.getSessionTypeEnum=function(){return e.SessionType},t.prototype.getRepResultTypeEnum=function(){return e.RepResultType},t.prototype.getUserMsgOptEnum=function(){return e.UserMsgOpt},t.prototype.getRoomModeEnum=function(){return e.RoomMode},t.prototype.getLineArrowEnum=function(){return e.LineArrow},t.prototype.getAnnotationTypeEnum=function(){return e.AnnotationType},t.prototype.newWebcam=function(){return new(0,e.Webcam)},t.prototype.newWebcam=function(t,r,n,o){return new(0,e.Webcam)(t,r,n,o)},t.prototype.newSpeaker=function(){return new(0,e.Speaker)},t.prototype.newSpeaker=function(t,r,n,o){return new(0,e.Speaker)(t,r,n,o)},t.prototype.newDesktop=function(){return new(0,e.Desktop)},t.prototype.newDesktop=function(t,r,n,o){return new(0,e.Desktop)(t,r,n,o)},t.prototype.newDocFile=function(){return new(0,e.DocFile)},t.prototype.newDocFile=function(t,r,n,o,i){return new(0,e.DocFile)(t,r,n,o,i)},t.prototype.newAddWebcamMsg=function(){return new(0,e.AddWebcamMsg)},t.prototype.newAddWebcamMsg=function(t,r){return new(0,e.AddWebcamMsg)(t,r)},t.prototype.newRemoveWebcamMsg=function(){return new(0,e.RemoveWebcamMsg)},t.prototype.newRemoveWebcamMsg=function(t,r){return new(0,e.RemoveWebcamMsg)(t,r)},t.prototype.newAddSpeakerMsg=function(){return new(0,e.AddSpeakerMsg)},t.prototype.newAddSpeakerMsg=function(t,r){return new(0,e.AddSpeakerMsg)(t,r)},t.prototype.newRemoveSpeakerMsg=function(){return new(0,e.RemoveSpeakerMsg)},t.prototype.newRemoveSpeakerMsg=function(t,r){return new(0,e.RemoveSpeakerMsg)(t,r)},t.prototype.newAddDocFileMsg=function(){return new(0,e.AddDocFileMsg)},t.prototype.newAddDocFileMsg=function(t,r){return new(0,e.AddDocFileMsg)(t,r)},t.prototype.newRemoveDocFileMsg=function(){return new(0,e.RemoveDocFileMsg)},t.prototype.newRemoveDocFileMsg=function(t,r){return new(0,e.RemoveDocFileMsg)(t,r)},t.prototype.newRoomResourceInfo=function(){return new(0,e.RoomResourceInfo)},t.prototype.newRoomResourceInfo=function(t,r,n){return new(0,e.RoomResourceInfo)(t,r,n)},t.prototype.newRoomInfo=function(){return new(0,e.RoomInfo)},t.prototype.newRoomInfo=function(t,r){return new(0,e.RoomInfo)(t,r)},t.prototype.newUserPolicy=function(){return new(0,e.UserPolicy)},t.prototype.newUserPolicy=function(t,r,n){return new(0,e.UserPolicy)(t,r,n)},t.prototype.newJoinInfo=function(){return new(0,e.JoinInfo)},t.prototype.newJoinInfo=function(t,r,n,o){return new(0,e.JoinInfo)(t,r,n,o)},t.prototype.newUserInfo=function(){return new(0,e.UserInfo)},t.prototype.newUserInfo=function(t,r,n,o,i,s,a,l,u,c,d,p){return new(0,e.UserInfo)(t,r,n,o,i,s,a,l,u,c,d,p)},t.prototype.newMediaStream=function(){return new(0,e.MediaStream)},t.prototype.newMediaStream=function(t,r,n,o,i,s,a){var l=new(0,e.MediaStream);return l.stream_name=t,l.type=r,l.sdp=n,void 0!==o&&0!=o&&(l.width=o),void 0!==i&&0!=i&&(l.height=i),void 0!==s&&0!=s&&(l.frame_rate=s),void 0!==a&&(l.payload=a),l},t.prototype.newMediaStreamInfo=function(){return new(0,e.MediaStreamInfo)},t.prototype.newMediaStreamInfo=function(t,r,n){return new(0,e.MediaStreamInfo)(t,r,n)},t.prototype.newResourceIndiction=function(){return new(0,e.ResourceIndiction)},t.prototype.newResourceIndiction=function(t,r,n,o,i){return new(0,e.ResourceIndiction)(t,r,n,o,i)},t.prototype.newAddDesktopMsg=function(){return new(0,e.AddDesktopMsg)},t.prototype.newAddDesktopMsg=function(t,r){return new(0,e.AddDesktopMsg)(t,r)},t.prototype.newRemoveDesktopMsg=function(){return new(0,e.RemoveDesktopMsg)},t.prototype.newRemoveDesktopMsg=function(t,r){return new(0,e.RemoveDesktopMsg)},t.prototype.newUpdateWebcamMsg=function(){return new(0,e.UpdateWebcamMsg)},t.prototype.newUpdateWebcamMsg=function(t,r,n){return new(0,e.UpdateWebcamMsg)(t,r,n)},t.prototype.newUpdateSpeakerMsg=function(){return new(0,e.UpdateSpeakerMsg)},t.prototype.newUpdateSpeakerMsg=function(t,r,n){return new(0,e.UpdateSpeakerMsg)(t,r,n)},t.prototype.newUpdateDesktopMsg=function(){return new(0,e.UpdateDesktopMsg)},t.prototype.newUpdateDesktopMsg=function(t,r,n){return new(0,e.UpdateDesktopMsg)(t,r,n)},t.prototype.newLeaveMsg=function(){return new(0,e.LeaveMsg)},t.prototype.newLeaveMsg=function(t,r){return new(0,e.LeaveMsg)(t,r)},t.prototype.newUpdateRoomStatusMsg=function(){return new(0,e.UpdateRoomStatusMsg)},t.prototype.newUpdateRoomStatusMsg=function(t){return new(0,e.UpdateRoomStatusMsg)(t)},t.prototype.newPubRoomResourceMsg=function(){return new(0,e.PubRoomResourceMsg)},t.prototype.newPubRoomResourceMsg=function(t,r){return new(0,e.PubRoomResourceMsg)(t,r)},t.prototype.newUnpubRoomResourceMsg=function(){return new(0,e.UnpubRoomResourceMsg)},t.prototype.newUnpubRoomResourceMsg=function(t){return new(0,e.UnpubRoomResourceMsg)(t)},t.prototype.newSubRoomResourceMsg=function(){return new(0,e.SubRoomResourceMsg)},t.prototype.newSubRoomResourceMsg=function(t,r,n){return new(0,e.SubRoomResourceMsg)(t,r,n)},t.prototype.newUnsubRoomResourceMsg=function(){return new(0,e.UnsubRoomResourceMsg)},t.prototype.newUnsubRoomResourceMsg=function(t,r){return new(0,e.UnsubRoomResourceMsg)(t,r)},t.prototype.newPubResourceReq=function(){return new(0,e.PubResourceReq)},t.prototype.newPubResourceReq=function(t,r){return new(0,e.PubResourceReq)(t,r)},t.prototype.newPubResourceRep=function(){return new(0,e.PubResourceRep)},t.prototype.newPubResourceRep=function(t,r,n){return new(0,e.PubResourceRep)(t,r,n)},t.prototype.newRoomKV=function(){return new(0,e.RoomKV)},t.prototype.newRoomKV=function(t,r){return new(0,e.RoomKV)(t,r)},t.prototype.newRoomDataInfo=function(){return new(0,e.RoomDataInfo)},t.prototype.newRoomDataInfo=function(t,r){return new(0,e.RoomDataInfo)(t,r)},t.prototype.newTextMsg=function(){return new(0,e.TextMsg)},t.prototype.newTextMsg=function(t,r){return new(0,e.TextMsg)(t,r)},t.prototype.newData=function(){return new(0,e.DATA)},t.prototype.newData=function(t){return new(0,e.DATA)(t)},t.prototype.newUserInfoMsg=function(){return new(0,e.UserInfoMsg)},t.prototype.newUserInfoMsg=function(t){return new(0,e.UserInfoMsg)(t)},t.prototype.newUserMsg=function(){return new(0,e.UserMsg)},t.prototype.newUserMsg=function(t,r,n){return new(0,e.UserMsg)(t,r,n)},t.prototype.newUpdateUserRolePriviledgeMsg=function(){return new(0,e.UpdateUserRolePriviledgeMsg)},t.prototype.newUpdateUserRolePriviledgeMsg=function(t,r,n){return new(0,e.UpdateUserRolePriviledgeMsg)(t,r,n)},t.prototype.newUpdateUserStatusMsg=function(){return new(0,e.UpdateUserStatusMsg)},t.prototype.newUpdateUserStatusMsg=function(t,r,n){return new(0,e.UpdateUserStatusMsg)(t,r,n)},t.prototype.newUpdateUserRoleMsg=function(){return new(0,e.UpdateUserRoleMsg)},t.prototype.newUpdateUserRoleMsg=function(t,r,n){return new(0,e.UpdateUserRoleMsg)(t,r,n)},t.prototype.newUserIndiction=function(){return new(0,e.UserIndiction)},t.prototype.newUserIndiction=function(t,r,n){return new(0,e.UserIndiction)(t,r,n)},t.prototype.newUpdateUserDataMsg=function(){return new(0,e.UpdateUserDataMsg)},t.prototype.newUpdateUserDataMsg=function(t,r){return new(0,e.UpdateUserDataMsg)(t,r)},t.prototype.newOfferReq=function(){return new(0,e.OfferReq)},t.prototype.newOfferReq=function(t,r,n){return new(0,e.OfferReq)(t,r,n)},t.prototype.newOfferRep=function(){return new(0,e.OfferRep)},t.prototype.newOfferRep=function(t,r,n,o,i){return new(0,e.OfferRep)(t,r,n,o,i)},t.prototype.newCandidateMsg=function(){return new(0,e.CandidateMsg)},t.prototype.newCandidateMsg=function(t,r,n,o){return new(0,e.CandidateMsg)(t,r,n,o)},t.prototype.newSubRoomResourceReq=function(){return new(0,e.SubRoomResourceReq)},t.prototype.newSubRoomResourceReq=function(t,r,n){return new(0,e.SubRoomResourceReq)(t,r,n)},t.prototype.newSubRoomResourceRep=function(){return new(0,e.SubRoomResourceRep)},t.prototype.newSubRoomResourceRep=function(t,r,n,o){return new(0,e.SubRoomResourceRep)(t,r,n,o)},t.prototype.newOpenReq=function(){return new(0,e.OpenReq)},t.prototype.newOpenReq=function(t,r,n,o){return new(0,e.OpenReq)(t,r,n,o)},t.prototype.newInviteRoomReq=function(){return new(0,e.InviteRoomReq)},t.prototype.newInviteRoomReq=function(t,r,n,o){return new(0,e.InviteRoomReq)(t,r,n,o)},t.prototype.newInviteRoomReq1=function(){return new(0,e.InviteRoomReq1)},t.prototype.newInviteRoomReq1=function(t,r,n,o,i,s,a,l,u){var c=new(0,e.InviteRoomReq1)(t,r,n,o,i,s,a,l,u);return c.is_dtls=!0,c},t.prototype.newCandidateMsg1=function(){return new(0,e.CandidateMsg1)},t.prototype.newCandidateMsg1=function(t,r,n,o){return new(0,e.CandidateMsg1)(t,r,n,o)},t.prototype.newCloseMsg=function(){return new(0,e.CloseMsg)},t.prototype.newCloseMsg=function(t){return new(0,e.CloseMsg)(t)},t.prototype.newPoint=function(){return new(0,e.Point)},t.prototype.newPoint=function(t,r){return new(0,e.Point)(t,r)},t.prototype.newcolor=function(){return new(0,e.color)},t.prototype.newcolor=function(t,r,n,o){return new(0,e.color)(t,r,n,o)},t.prototype.newRect=function(){return new(0,e.Rect)},t.prototype.newRect=function(t,r,n,o){return new(0,e.Rect)(t,r,n,o)},t.prototype.newAnnotationObject=function(){return new(0,e.AnnotationObject)},t.prototype.newAnnotationObject=function(t,r,n,o,i,s,a,l,u,c){return new(0,e.AnnotationObject)(t,r,n,o,i,s,a,l,u,c)},t.prototype.newAnnotation2Point=function(){return new(0,e.Annotation2Point)},t.prototype.newAnnotation2Point=function(t,r,n){return new(0,e.Annotation2Point)(t,r,n)},t.prototype.newAnnotationMultiPoint=function(){return new(0,e.AnnotationMultiPoint)},t.prototype.newAnnotationMultiPoint=function(t,r){return new(0,e.AnnotationMultiPoint)(t,r)},t.prototype.newAnnotationList=function(){return new(0,e.AnnotationList)},t.prototype.newAnnotationList=function(t,r){return new(0,e.AnnotationList)(t,r)},t.prototype.newAnnotationMsgInternal=function(){return new(0,e.AnnotationMsgInternal)},t.prototype.newAnnotationMsgInternal=function(t,r,n,o,i){return new(0,e.AnnotationMsgInternal)(t,r,n,o,i)},t.prototype.newAnnotationMsg=function(){return new(0,e.AnnotationMsg)},t.prototype.newAnnotationMsg=function(t,r){return new(0,e.AnnotationMsg)(t,r)},t.prototype.serverVersionCompatible=function(e){var t=new ArrayBuffer(10),r=new Int8Array(t);r[0]=88,r[1]="3".charCodeAt(),r[2]="t".charCodeAt(),r[3]="e".charCodeAt(),r[4]="e".charCodeAt(),r[5]="a".charCodeAt(),r[6]="v".charCodeAt(),r[7]="d".charCodeAt(),r[8]=2,r[9]=1;for(var n=new Int8Array(e),o=10+n.length,i=new ArrayBuffer(o),s=new Int8Array(i),a=0;a<10;a++)s[a]=r[a];for(var l=0;l<n.length;l++)s[l+10]=n[l];return i},t.prototype.encodedPacket=function(t,r,n,o,i){var s=e.Packet,a=null;null!=i&&(a=i.toArrayBuffer());var l=new s(t,r,n,o,a).toArrayBuffer();return t==this.getRoomPduTypeEnum().OPEN_REQ&&(l=this.serverVersionCompatible(l)),l},t.prototype.decodePacket=function(t){return e.Packet.decode(t)},t.prototype.decodeUserMsg=function(t){return e.UserMsg.decode(t)},t.prototype.decodeBody=function(t){var r=e.RoomPduType,n=e.Packet.decode(t),o=n.type;if(o==r.OPEN_REP)return e.OpenRep.decode(n.body);if(o==r.INVITE_ROOM_REP1)return e.InviteRoomRep1.decode(n.body);if(o==r.ROOM_RESOURCE_INFOS)return e.RoomResourceInfos.decode(n.body);if(o==r.CANDIDATE_MSG1)return e.CandidateMsg1.decode(n.body);if(o==r.PUB_RESOURCE_REP)return c=(u=e.PubResourceRep).decode(n.body);if(o==r.PRIVATE_TEXT_MSG)return s=(i=e.TextMsg).decode(n.body);if(o==r.PUBLIC_TEXT_MSG){var i=e.TextMsg,s=i.decode(n.body);return s}if(o==r.PRIVATE_DATA)return t=(a=e.DATA).decode(n.body);if(o==r.PUBLIC_DATA){var a=e.DATA;return t=a.decode(n.body)}if(o==r.ROOM_DATA_INFO)return e.RoomDataInfo.decode(n.body);if(o==r.UPDATE_USER_DATA_MSG)return e.UpdateUserDataMsg.decode(n.body);if(o==r.USER_INFO_MSG){var l=e.UserInfoMsg;return null!=n.body?l.decode(n.body):null}if(o==r.USER_MSG)return e.UserMsg.decode(n.body);if(o==r.USER_INDICTION)return e.UserIndiction.decode(n.body);if(o==r.UPDATA_USER_ROLE_PRIVILEDGE_MSG)return e.UpdateUserRolePriviledgeMsg.decode(n.body);if(o==r.ADD_WEBCAM_MSG)return e.AddWebcamMsg.decode(n.body);if(o==r.ADD_SPEAKER_MSG)return e.AddSpeakerMsg.decode(n.body);if(o==r.ADD_DESKTOP_MSG)return e.AddDesktopMsg.decode(n.body);if(o==r.REMOVE_WEBCAM_MSG)return e.RemoveWebcamMsg.decode(n.body);if(o==r.REMOVE_SPEAKER_MSG)return e.RemoveSpeakerMsg.decode(n.body);if(o==r.UPDATE_SPEAKER_MSG)return e.UpdateSpeakerMsg.decode(n.body);if(o==r.UPDATE_WEBCAM_MSG)return e.UpdateWebcamMsg.decode(n.body);if(o==r.UPDATE_DESKTOP_MSG)return e.UpdateDesktopMsg.decode(n.body);if(o==r.PUB_ROOM_RESOURCE_MSG)return e.PubRoomResourceMsg.decode(n.body);if(o==r.PUB_ROOM_RESOURCE_MSG_REP)return e.PubRoomResourceMsgRep.decode(n.body);if(o==r.UNPUB_ROOM_RESOURCE_MSG)return e.UnpubRoomResourceMsg.decode(n.body);if(o==r.PUB_VIDEO_REQ||o==r.PUB_AUDIO_REQ)return e.PubResourceReq.decode(n.body);if(o==r.PUB_VIDEO_REP||o==r.PUB_AUDIO_REP){var u=e.PubResourceRep,c=u.decode(n.body);return c}if(o==r.VIDEO_INDICTION)return p=(d=e.ResourceIndiction).decode(n.body);if(o==r.AUDIO_INDICTION){var d=e.ResourceIndiction,p=d.decode(n.body);return p}return o==r.OFFER_REQ?e.OfferReq.decode(n.body):o==r.OFFER_REP?e.OfferRep.decode(n.body):o==r.CANDIDATE_MSG?e.CandidateMsg.decode(n.body):o==r.SUB_ROOM_RESOURCE_REQ?e.SubRoomResourceReq.decode(n.body):o==r.SUB_ROOM_RESOURCE_REP?e.SubRoomResourceRep.decode(n.body):o==r.SUB_ROOM_RESOURCE_MSG?e.SubRoomResourceMsg.decode(n.body):o==r.UNSUB_ROOM_RESOURCE_MSG?e.UnsubRoomResourceMsg.decode(n.body):void 0},t});var RTCBrowserType={RTC_BROWSER_CHROME:"rtc_browser.chrome",RTC_BROWSER_FIREFOX:"rtc_browser.firefox"},keyMap={};keyMap[RTCBrowserType.RTC_BROWSER_FIREFOX]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent"},keyMap[RTCBrowserType.RTC_BROWSER_CHROME]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent",receiveBandwidth:"googAvailableReceiveBandwidth",sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"googRemoteAddress",transportType:"googTransportType",localAddress:"googLocalAddress",activeConnection:"googActiveConnection",googFrameHeightReceived:"googFrameHeightReceived",googFrameWidthReceived:"googFrameWidthReceived",googFrameHeightSent:"googFrameHeightSent",googFrameWidthSent:"googFrameWidthSent",audioInputLevel:"audioInputLevel",audioOutputLevel:"audioOutputLevel"};var connectionQualityValues={98:"18px",81:"15px",64:"11px",47:"7px",30:"3px",0:"0px"};PeerStats.bandwidth={},PeerStats.bitrate={},PeerStats.packetLoss=null,PeerStats.transport=[],PeerStats.resolutions=[],PeerStats.prototype.setSsrcLoss=function(e,t){this.ssrc2Loss[e]=t},PeerStats.prototype.setSsrcResolution=function(e,t){null===t&&this.ssrc2resolution[e]?delete this.ssrc2resolution[e]:null!==t&&(this.ssrc2resolution[e]=t)},PeerStats.prototype.setSsrcBitrate=function(e,t){this.ssrc2bitrate[e]?(this.ssrc2bitrate[e].download+=t.download,this.ssrc2bitrate[e].upload+=t.upload):this.ssrc2bitrate[e]=t},PeerStats.prototype.setSsrcAudioLevel=function(e,t){this.ssrc2AudioLevel[e]=formatAudioLevel(t)},ConnectionInfoCollector.prototype.start=function(){var e=this;this.statsIntervalId=setInterval(function(){e.peerconnection.getStats(function(t){var r=null;t&&t.result&&"function"==typeof t.result?r=t.result():"firefox"==webrtcDetectedBrowser?r=t:"Internet Explorer"==webrtcDetectedBrowser&&(r=t.result()),e.currentStatsReport=r;try{e.processStatsReport()}catch(e){log.error("Unsupported key:"+e,e)}e.baselineStatsReport=e.currentStatsReport},e.errorCallback)},this.statsInterval)},ConnectionInfoCollector.prototype.processStatsReport=function(){if(this.baselineStatsReport){PeerStats.transport=[],PeerStats.resolutions=[];for(var e in this.currentStatsReport){var t=this.currentStatsReport[e];try{(getStatValue(t,"receiveBandwidth")||getStatValue(t,"sendBandwidth"))&&(PeerStats.bandwidth={download:Math.round(getStatValue(t,"receiveBandwidth")/1e3),upload:Math.round(getStatValue(t,"sendBandwidth")/1e3)})}catch(e){}if("googCandidatePair"!=t.type){if("candidatepair"==t.type){if("succeeded"==t.state)continue;var r=this.currentStatsReport[t.localCandidateId],n=this.currentStatsReport[t.remoteCandidateId];PeerStats.transport.push({localip:r.ipAddress+":"+r.portNumber,ip:n.ipAddress+":"+n.portNumber,type:r.transport})}if("ssrc"==t.type||"outboundrtp"==t.type||"inboundrtp"==t.type){var o=this.baselineStatsReport[e];if(o){var i=getStatValue(t,"ssrc");if(i&&(this.jid||!(Date.now()-t.timestamp<3e3))){var s=this.jid2stats[this.jid];s||(s=new PeerStats,this.jid2stats[this.jid]=s);var a=!0,l="packetsReceived";if(getStatValue(t,l)||(a=!1,l="packetsSent",getStatValue(t,l))){var u=getStatValue(t,l);(!u||u<0)&&(u=0);var c=getStatValue(o,l);(!c||c<0)&&(c=0);var d=u-c;(!d||d<0)&&(d=0);var p=getStatValue(t,"packetsLost");(!p||p<0)&&(p=0);var f=getStatValue(o,"packetsLost");(!f||f<0)&&(f=0);var h=p-f;(!h||h<0)&&(h=0);var m=d+h;s.setSsrcLoss(i,{packetsTotal:m,packetsLost:h,isDownloadStream:a});var g=0,v=0;getStatValue(t,"bytesReceived")&&(g=getStatValue(t,"bytesReceived")-getStatValue(o,"bytesReceived")),getStatValue(t,"bytesSent")&&(v=getStatValue(t,"bytesSent")-getStatValue(o,"bytesSent"));var y=Math.round((t.timestamp-o.timestamp)/1e3);g=g<=0||y<=0?0:Math.round(8*g/y/1e3),v=v<=0||y<=0?0:Math.round(8*v/y/1e3),s.setSsrcBitrate(i,{download:g,upload:v});var b={height:null,width:null};try{getStatValue(t,"googFrameHeightSent")&&getStatValue(t,"googFrameWidthSent")&&(b.height=getStatValue(t,"googFrameHeightSent"),b.width=getStatValue(t,"googFrameWidthSent"))}catch(e){}b.height&&b.width?s.setSsrcResolution(i,b):s.setSsrcResolution(i,null)}}}}}else{var S,w,E,C;try{S=getStatValue(t,"remoteAddress"),w=getStatValue(t,"transportType"),E=getStatValue(t,"localAddress"),C=getStatValue(t,"activeConnection")}catch(e){}if(!S||!w||!E||"true"!=C)continue;for(var P=!1,T=0;T<PeerStats.transport.length;T++)PeerStats.transport[T].ip==S&&PeerStats.transport[T].type==w&&PeerStats.transport[T].localip==E&&(P=!0);if(P)continue;PeerStats.transport.push({localip:E,ip:S,type:w})}}var I=this,R={download:0,upload:0},_={download:0,upload:0},x=0,M=0,U={};Object.keys(this.jid2stats).forEach(function(e){Object.keys(I.jid2stats[e].ssrc2Loss).forEach(function(t){var r="upload";I.jid2stats[e].ssrc2Loss[t].isDownloadStream&&(r="download"),R[r]+=I.jid2stats[e].ssrc2Loss[t].packetsTotal,_[r]+=I.jid2stats[e].ssrc2Loss[t].packetsLost}),Object.keys(I.jid2stats[e].ssrc2bitrate).forEach(function(t){x+=I.jid2stats[e].ssrc2bitrate[t].download,M+=I.jid2stats[e].ssrc2bitrate[t].upload,delete I.jid2stats[e].ssrc2bitrate[t]}),U[e]=I.jid2stats[e].ssrc2resolution}),PeerStats.bitrate={upload:M,download:x},PeerStats.packetLoss={total:calculatePacketLoss(_.download+_.upload,R.download+R.upload),download:calculatePacketLoss(_.download,R.download),upload:calculatePacketLoss(_.upload,R.upload)},PeerStats.resolutions=U,this.generateText()}},ConnectionInfoCollector.prototype.generateText=function(){var e,t,r,n,o,s,a,l,u,c,d,p,f;null===PeerStats.bitrate?(t="N/A",r="N/A"):(t=PeerStats.bitrate.download?PeerStats.bitrate.download+" Kbps":"N/A",r=PeerStats.bitrate.upload?PeerStats.bitrate.upload+" Kbps":"N/A"),null===PeerStats.packetLoss?(n="N/A",o="N/A"):(n=(null!==PeerStats.packetLoss.download?PeerStats.packetLoss.download:"N/A")+"%",o=(null!==PeerStats.packetLoss.upload?PeerStats.packetLoss.upload:"N/A")+"%");var h=null;if(PeerStats.resolutions&&null!=this.jid){Object.keys(PeerStats.resolutions);for(var m in PeerStats.resolutions)h=PeerStats.resolutions[m]}if(s="N/A",h){var g=0,v=0;for(i in h){var y=h[i];y&&y.height&&y.width&&(g+=parseInt(y.width),v+=parseInt(y.height))}0!=g&&0!=v&&(s=g+"x"+v)}if(null===PeerStats.bandwidth?(a="N/A",l="N/A"):(a=PeerStats.bandwidth.download?PeerStats.bandwidth.download+" Kbps":"N/A",l=PeerStats.bandwidth.upload?PeerStats.bandwidth.upload+" Kbps":"N/A"),PeerStats.transport&&0!==PeerStats.transport.length){var b={remoteIP:[],localIP:[],remotePort:[],localPort:[]};for(i=0;i<PeerStats.transport.length;i++){var S=getIP(PeerStats.transport[i].ip),w=getPort(PeerStats.transport[i].ip),E=getIP(PeerStats.transport[i].localip),C=getPort(PeerStats.transport[i].localip);-1==b.remoteIP.indexOf(S)&&b.remoteIP.push(S),-1==b.remotePort.indexOf(w)&&b.remotePort.push(w),-1==b.localIP.indexOf(E)&&b.localIP.push(E),-1==b.localPort.indexOf(C)&&b.localPort.push(C)}d=getStringFromArray(b.localIP),p=getStringFromArray(b.localPort),u=getStringFromArray(b.remoteIP),c=getStringFromArray(b.remotePort)}else;var P=100-PeerStats.packetLoss.total;for(var T in connectionQualityValues)P>=T&&(e=connectionQualityValues[T]);var I={};I.downloadBitrate=t,I.uploadBitrate=r;var R={};R.downloaPacketLoss=n,R.uploadPacketLoss=o;var _={};_.downloadBandwidth=a,_.uploadBandwidth=l,PeerStats.transport[0]&&(f=PeerStats.transport[0].type);var x={};x.connectionQuality=e,x.bitrate=I,x.packetLoss=R,x.resolution=s,x.bandwidth=_,x.localaddress=d,x.localport=p,x.remoteaddress=u,x.remoteport=c,x.transport=f,null!=room?room.eventEmitter.emit(RoomCallback.connection_indicator,x):this.stop()},ConnectionInfoCollector.prototype.errorCallback=function(e){log.error("StatsCollector.errorCallback().Get stats error",e),this.stop()},ConnectionInfoCollector.prototype.stop=function(){this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},AudioLevel.prototype.start=function(e){var t=when.defer(),r=this;return e&&(r.audioLevelsIntervalMilis=e),this.audioLevelsIntervalId=setInterval(function(){r.peerconnection.getStats(function(e){var n=null;e&&e.result&&"function"==typeof e.result?n=e.result():"firefox"==webrtcDetectedBrowser?n=e:"Internet Explorer"==webrtcDetectedBrowser&&(n=e.result()),r.currentAudioLevelsReport=n,r.processAudioLevelReport(),r.baselineAudioLevelsReport=r.currentAudioLevelsReport,t.resolve()},function(e){log.error("StatsCollector.errorCallback().Get stats error",e),t.reject(e)})},r.audioLevelsIntervalMilis),t.promise},AudioLevel.prototype.stop=function(){var e=when.defer();return this.audioLevelsIntervalId?(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null,e.resolve()):e.reject(),e.promise},AudioLevel.prototype.processAudioLevelReport=function(){if(this.baselineAudioLevelsReport)for(var e in this.currentAudioLevelsReport){var t=this.currentAudioLevelsReport[e];if("ssrc"==t.type){var r=this.baselineAudioLevelsReport[e],n=getStatValue(t,"ssrc");if(r)if(n){var o=!getStatValue(t,"packetsReceived");try{var i=getStatValue(r,"audioInputLevel"),s=getStatValue(r,"audioOutputLevel"),a=getStatValue(t,"audioInputLevel"),l=getStatValue(t,"audioOutputLevel")}catch(e){return loger.error("Audio Levels are not available in the statistics."),void clearInterval(this.audioLevelsIntervalId)}if(a&&a>0&&i!=a&&o&&room.selfUser.audio.setAudioLevel(a),l&&l>0&&s!=l){var u=room.audioSsrc2user[n];!o&&u&&u.audio&&u.audio.setAudioLevel(l)}}else Date.now()-t.timestamp<3e3&&log.error("No ssrc: ");else log.debug(n+" not enough data")}}};var WEBAUDIO_ANALYZER_FFT_SIZE=2048,WEBAUDIO_ANALYZER_SMOOTING_TIME=.8;window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=null;LocalStatsCollector.prototype.start=function(){if(window.AudioContext&&!context&&(context=new AudioContext).suspend(),context){context.resume();var e=context.createAnalyser();e.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,e.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(this.stream).connect(e);var t=this;this.intervalId=setInterval(function(){var r=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(r);var n=timeDomainDataToAudioLevel(r);n!=t.audioLevel&&(t.audioLevel=animateLevel(n,t.audioLevel),t.callback(t.audioLevel))},this.intervalMilis)}},LocalStatsCollector.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},ModuleBase.define("BrowserInfo",[],function(e){return(e=function(){}).prototype.getBrowserInfo=function(){navigator.appVersion;var e,t,r,n=navigator.userAgent,o=navigator.appName,i=""+parseFloat(navigator.appVersion),s="",a="";-1!=(t=n.indexOf("OPR/"))?(o="Opera",i=n.substring(t+4)):-1!==(t=n.indexOf("Opera"))?(o="Opera",i=n.substring(t+6),-1!==(t=n.indexOf("Version"))&&(i=n.substring(t+8))):-1!==(t=n.indexOf("MSIE"))?(o="IE",i=n.substring(t+5)):-1!==(t=n.indexOf("Chrome"))?(o="Chrome",i=n.substring(t+7)):-1!==(t=n.indexOf("Safari"))?(o="Safari",i=n.substring(t+7),-1!==(t=n.indexOf("Version"))&&(i=n.substring(t+8))):-1!==(t=n.indexOf("Firefox"))?(o="Firefox",i=n.substring(t+8)):(e=n.lastIndexOf(" ")+1)<(t=n.lastIndexOf("/"))&&(o=n.substring(e,t),i=n.substring(t+1),o.toLowerCase()===o.toUpperCase()&&(o=navigator.appName));var l=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob);/rv:([^\)]+)\) like Gecko/.test(navigator.userAgent)&&(o="IE",i=RegExp.$1);var u=/QQBrowser/.test(navigator.userAgent),c=/MetaSr/.test(navigator.userAgent),d=/BIDUBrowser/.test(navigator.userAgent),p=function(e,t){var r=window.external||{};for(var n in r)if(e.test(t?r[n]:n))return!0;return!1}(/^liebao/i,0);return l&&(o="Edge",i=parseInt(navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),u&&(s="QQ",a=parseInt(navigator.userAgent.match(/QQBrowser\/(\d+).(\d+)/)[2],10).toString()),c&&(s="Sougou",a=parseInt(navigator.userAgent.match(/MetaSr (\d+).(\d+)/)[2],10).toString()),d&&(s="Baidu",a=parseInt(navigator.userAgent.match(/BIDUBrowser\/(\d+).(\d+)/)[1],10).toString()),p&&(s="Liebao",a=""),-1!==(r=i.indexOf(";"))&&(i=i.substring(0,r)),-1!==(r=i.indexOf(" "))&&(i=i.substring(0,r)),{name:o,fullVersion:i,shellName:s,shellFullVersion:a}},e}),ModuleBase.define("OSInfo",[],function(e){return(e=function(){}).prototype.getOSInfo=function(){var e="Unknown OS",t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()},getOsName:function(){var e="Unknown OS";return t.Android()&&(e="Android"),t.BlackBerry()&&(e="BlackBerry"),t.iOS()&&(e="iOS"),t.Opera()&&(e="Opera Mini"),t.Windows()&&(e="Windows"),e}};return t.any()?e=t.getOsName():(-1!==navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!==navigator.appVersion.indexOf("Mac")&&(e="OSX"),-1!==navigator.appVersion.indexOf("X11")&&(e="UNIX"),-1!==navigator.appVersion.indexOf("Linux")&&(e="Linux")),e},e}),ModuleBase.define("CheckGetUserMedia",[],function(e){return(e=function(){}).prototype.getUserMediaSupport=function(){var e=!1;return void 0!==navigator.webkitGetUserMedia||void 0!==navigator.mozGetUserMedia?e=!0:navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(e=!0),e},e}),ModuleBase.define("CheckRTCPeerConnection",[],function(e){return(e=function(){}).prototype.RTCPeerConnectionSupport=function(){var e=!1;try{e=["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].some(function(e){return e in window})}catch(e){}return e},e}),ModuleBase.define("CheckDataChannelSupport",[],function(e){return(e=function(){}).prototype.dataChannelSupport=function(){var e=!1;try{var t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(t){var r=new t({iceServers:[{url:"stun:0"}]});e="createDataChannel"in r}}catch(t){e=!1}return e},e}),ModuleBase.define("BrowserDetect",["BrowserInfo","OSInfo","CheckGetUserMedia","CheckRTCPeerConnection","CheckDataChannelSupport"],function(e,t,r,n,o){var i=function(){this.detect={};var i="https:"===location.protocol,s=new e;this.detect.browser=s.getBrowserInfo(),this.detect.browser["is"+this.detect.browser.name]=!0;var a=new t;this.detect.osName=a.getOSInfo();var l=this.detect.browser.fullVersion.split(".")[0],u=new r;this.detect.getUserMediaSupport=u.getUserMediaSupport();var c=new n;this.detect.RTCPeerConnectionSupport=c.RTCPeerConnectionSupport();var d=new o;this.detect.dataChannelSupport=d.dataChannelSupport(),this.detect.WebSocketSupport="WebSocket"in window&&2===window.WebSocket.CLOSING,this.detect.screenSharingSupport=!1,this.detect.browser.isChrome&&l>=42&&(this.detect.screenSharingSupport=!0),i||(this.detect.screenSharingSupport=!1),this.detect.h264Support=!1,this.detect.browser.isChrome&&l>=52&&(this.detect.h264Support=!0),this.detect.browser.isFirefox&&l>=52&&(this.detect.h264Support=!0),this.detect.ORTCSupport="undefined"!=typeof RTCIceGatherer};return i.prototype.checkBrowserSupport=function(){var e=!1,t=this.detect.browser.isChrome,r=this.detect.browser.isOpera,n=(this.detect.browser.isIE,this.detect.browser.isFirefox),o=(this.detect.browser.isSafari,this.detect.browser.fullVersion.split(".")[0]),i=1==t&&Number(o)>=42||1==r&&Number(o)>=30;return"Android"==this.detect.osName&&(i=1==t&&Number(o)>=37),1==i&&1==this.detect.getUserMediaSupport&&1==this.detect.RTCPeerConnectionSupport&&1==this.detect.WebSocketSupport?e=!0:1==n&&Number(o)>=52&&(e=!0),e},i.prototype.checkBrowserPluginSupport=function(){var e=!1,t=(this.detect.browser.isChrome,this.detect.browser.isOpera,this.detect.browser.isIE),r=(this.detect.browser.isFirefox,this.detect.browser.isSafari,this.detect.browser.fullVersion.split(".")[0]);return 1==t&&Number(r)>=10&&(e=!0),e},i.prototype.checkChromeSupportH264=function(){var e=!1,t=this.detect.browser.isChrome,r=(this.detect.browser.name,this.detect.browser.fullVersion.split(".")[0]);return 1==(1==t&&Number(r)>=52)&&(e=!0),e},i}),ModuleBase.define("Stream",[],function(){return function(e,t){this.id=e,this.name=t,this.status=StreamStatus.init,this.stream=null,this.element=null,this.resourceInfo=null,this.ownerId=null}}),ModuleBase.define("Video",["Stream","Error"],function(e,t){var r=function(t,r){e.call(this,t,r),this.level,this.description,this.resolution,this.resolutionSelect,this.frameRate,this.cameraType};return r.prototype=new e,r.prototype.setLevel=function(e){this.level=e},r.prototype.setDescription=function(e){this.description=e},r.prototype.setResolution=function(e){this.resolutionSelect=e,this.resolution=Resolution[e]},r.prototype.setResolutionWH=function(e,t){this.resolutionSelect=e;var r={};r.order=1,r.width=e,r.height=t,this.resolution=r},r.prototype.setFrameRate=function(e){"string"==typeof e&&(e=Number(e)),this.frameRate=e},r.prototype.preview=function(e){var r=when.defer(),n=doFsCheck(FTConstant.video,t);if(null!=n)return r.reject(n),r.promise;if(parseInt(this.resolutionSelect)>640&&null!=(n=doFsCheck(FTConstant.video_hd,t)))return r.reject(n),r.promise;if(null!=this.stream)this.status!=StreamStatus.published&&(this.status=StreamStatus.opened),this.element=e,attachMediaStream(e,this.stream),r.resolve();else{var o=this;obtainUserMedia(null,this,function(t){o.status=StreamStatus.opened,o.stream=t.videoStream,o.element=e,attachMediaStream(e,t.videoStream),r.resolve()},function(e){r.reject(e)})}return r.promise},r.prototype.unpreview=function(){null!=this.element&&(attachMediaStream(this.element,null),this.status=StreamStatus.init,this.element=null)},r.prototype.publish=function(){var e=when.defer();return this.publishHandle().then(function(){e.resolve()}).otherwise(function(t){e.reject(t)}),e.promise},r.prototype.previewAndPublish=function(e){var r=when.defer(),n=doFsCheck(FTConstant.video,t);return null!=n?(r.reject(n),r.promise):parseInt(this.resolutionSelect)>640&&null!=(n=doFsCheck(FTConstant.video_hd,t))?(r.reject(n),r.promise):(this.publishHandle(e).then(function(){r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise)},r.prototype.publishHandle=function(e){var t=when.defer(),r=getRandomNum(1,3e3),n=this;if(n.status==StreamStatus.init)if(null!=n.stream){o=room.composePDUDeviceId(room.selfUser.id,n.id);room.masterServer.videoPublishHandle(o,n.stream,r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(o){o==r&&(void 0!=e&&(n.status=StreamStatus.opened,n.element=e,attachMediaStream(e,n.stream)),n.status=StreamStatus.published,room.pubVideos.push(n),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,n.status,n.id,n.name,room.selfUser.id),t.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,n){n==r&&t.reject(e)})}else obtainUserMedia(null,this,function(o){n.status=StreamStatus.opened,n.stream=o.videoStream;var i=room.composePDUDeviceId(room.selfUser.id,n.id);room.masterServer.videoPublishHandle(i,n.stream,r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(o){o==r&&(void 0!=e&&(n.status=StreamStatus.opened,n.element=e,attachMediaStream(e,n.stream)),n.status=StreamStatus.published,room.pubVideos.push(n),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,n.status,n.id,n.name,room.selfUser.id),t.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,n){n==r&&t.reject(e)})},function(e){t.reject(e)});else if(n.status==StreamStatus.opened){o=room.composePDUDeviceId(room.selfUser.id,n.id);room.masterServer.videoPublishHandle(o,n.stream,r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==r&&(n.status=StreamStatus.published,room.pubVideos.push(n),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,n.status,n.id,n.name,room.selfUser.id),t.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,n){n==r&&t.reject(e)})}else if(n.status==StreamStatus.published&&room.reconnectionCount>0){var o=room.composePDUDeviceId(room.selfUser.id,n.id);room.masterServer.videoPublishHandle(o,n.stream,r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==r&&(room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,n.status,n.id,n.name,room.selfUser.id),t.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,n){n==r&&t.reject(e)})}return t.promise},r.prototype.unpublish=function(){if(this.status==StreamStatus.published||this.status==StreamStatus.init&&(null!=this.stream||void 0!=this.stream)){arrayUtil.objectSplice(room.pubVideos,this.id),this.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,room.selfUser.id);var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.videoUnpublishHandle(e,this.stream),this.stream&&this.stream.getTracks().forEach(function(e){e.stop()}),this.stream=null}},r.prototype.subscrible=function(){room.selfUser.subVideoStream2ResourceInfo[this.resourceInfo.stream.stream_name]=this.resourceInfo,room.selfUser.subVideoIds.push(this.id),room.masterServer.videoSubscribleHandle(this.resourceInfo)},r.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subVideoIds,this.id),room.masterServer.videoUnsubscribleHandle(this.resourceInfo)},r.prototype.updateCameraData=function(e,t){var r=room.composePDUDeviceId(room.selfUser.id,this.id);this.level=e,this.description=t,room.masterServer.updateWebcamMsg(room.selfUser.nodeId,r,this)},r}),ModuleBase.define("Audio",["Stream","Error"],function(e,t){var r=function(t,r){e.call(this,t,r),this.oldAudioLevel=0,this.audioLevel=0};return r.prototype=new e,r.prototype.openMicrophone=function(e){var r=when.defer(),n=doFsCheck(FTConstant.audio,t);if(null!=n)return r.reject(n),r.promise;var o=getRandomNum(30001,6e3),i=this;if(null!=this.stream){var s=room.composePDUDeviceId(room.selfUser.id,i.id);room.masterServer.audioPublishHandle(s,i.stream,o),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(t){t==o&&(i.state=StreamStatus.opened,void 0!==e&&null!=e&&""!=e&&(i.element=e,attachMediaStream(e,i.stream)),i.status=StreamStatus.published,room.pubAudios.push(i),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,room.selfUser.id),r.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&r.reject(e)})}else obtainUserMedia(this,null,function(t){i.state=StreamStatus.opened,i.stream=t.audioStream;var n=room.composePDUDeviceId(room.selfUser.id,i.id);room.masterServer.audioPublishHandle(n,i.stream,o),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(n){n==o&&(void 0!==e&&null!=e&&""!=e&&(i.element=e,attachMediaStream(e,t.audioStream)),i.status=StreamStatus.published,room.pubAudios.push(i),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,room.selfUser.id),r.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&r.reject(e)})},function(e){r.reject(e)});return r.promise},r.prototype.closeMicrophone=function(){if(this.status==StreamStatus.published||this.status==StreamStatus.muted){null!=this.element&&(attachMediaStream(this.element,null),this.element=null),arrayUtil.objectSplice(room.pubAudios,this.id),this.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id);var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.audioUnpublishHandle(e,this.stream),this.setAudioLevel(0),this.stream&&this.stream.getTracks().forEach(function(e){e.stop()}),this.stream=null}},r.prototype.muteMicrophone=function(){if(this.status==StreamStatus.published){this.status=StreamStatus.muted,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id);var e=this.stream.getAudioTracks();for(i=0;i<e.length;i++)e[i].enabled=!1;var t=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,t,this)}},r.prototype.unmuteMicrophone=function(){if(this.status==StreamStatus.muted){this.status=StreamStatus.published,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id);var e=this.stream.getAudioTracks();for(i=0;i<e.length;i++)e[i].enabled=!0;var t=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,t,this)}},r.prototype.ismuteMicrophone=function(){var e=!1;return this.status==StreamStatus.muted&&(e=!0),e},r.prototype.setAudioLevel=function(e){this.audioLevel=e},r.prototype.getAudioLevel=function(){return this.audioLevel>0&&this.audioLevel==this.oldAudioLevel&&this.setAudioLevel(0),this.oldAudioLevel=this.audioLevel,this.audioLevel},r}),ModuleBase.define("Screen",["Stream","Error"],function(e,t){var r=function(t,r){e.call(this,t,r),this.level,this.description,this.resolution,this.frameRate};return r.prototype=new e,r.prototype.setLevel=function(e){this.level=e},r.prototype.setDescription=function(e){this.description=e},r.prototype.setResolution=function(e){this.resolution=EngineEnum.Resolution[e]},r.prototype.setFrameRate=function(e){this.frameRate=e},r.prototype.preview=function(e){self.element=e,attachMediaStream(e,this.stream)},r.prototype.publish=function(e){var r=when.defer();if(null!=(o=doFsCheck(FTConstant.screen,t)))return r.reject(o),r.promise;if(this.status==StreamStatus.published)r.resolve();else try{var n=this;chrome.runtime.sendMessage(e,{getStream:!0},function(e){if(void 0!=e&&null!=e&&""!=e){var o=e.streamId;if(log.debug("pending Request Id:"+o),""!=o&&null!=o)navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxWidth:screen.width,maxHeight:screen.height,minFrameRate:1,maxFrameRate:5}}},function(e){log.debug("gotShareStream. stream:"+e),void 0!==e.onended?e.onended=function(){log.debug("stream.onended"),log.debug("Share stream ended"),log.debug("OpenMyDesktop(),stream.onended,user.unpubDesktop"),null!=n.stream&&(n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:e.oninactive=function(){log.debug("stream.oninactive"),log.debug("Share stream ended"),log.debug("OpenMyDesktop(),stream.oninactive,user.unpubDesktop"),null!=n.stream&&(n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)};var t=getRandomNum(6001,9e3),i=room.composePDUDeviceId(room.selfUser.id,n.id);room.masterServer.screenPublishHandle(i,e,t),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(i){i==t&&(n.stream=e,n.status=StreamStatus.published,room.pubScreens.push(n),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id),r.resolve(o))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,n){n==t&&r.reject(e)})},function(e){log.debug("An error occurred: "+e);var e=new t(ErrorConstant.screen_sharing_plugin_not_accessible);r.reject(e)});else{log.debug("Access rejected.");i=new t(ErrorConstant.screen_sharing_response_is_null);r.reject(i)}}else{log.debug("Access to screen denied");var i=new t(ErrorConstant.screen_sharing_plugin_not_accessible);r.reject(i)}})}catch(e){log.debug("Screen sharing plugin is not accessible ");var o=new t(ErrorConstant.screen_sharing_plugin_not_accessible);return void r.reject(o)}return r.promise},r.prototype.unpublish=function(){if(this.status==StreamStatus.published){this.status=StreamStatus.init;var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.screenUnpublishHandle(e,this.stream),room.isMcu()||(this.stream=null)}},r.prototype.subscrible=function(){room.selfUser.subScreenStream2ResourceInfo[this.resourceInfo.stream.stream_name]=this.resourceInfo,room.selfUser.subScreenIds.push(this.id),room.masterServer.screenSubscribleHandle(this.resourceInfo)},r.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subScreenIds,this.id),room.masterServer.screenUnsubscribleHandle(this.resourceInfo)},r.prototype.updateScreenData=function(e,t){var r=room.composePDUDeviceId(room.selfUser.id,this.id);this.level=e,this.description=t,room.masterServer.updateScreenIdMsg(room.selfUser.nodeId,r,this)},r});var currentVideoParameter={videoWidth:!1,videoHeight:!1,frameRate:!1},fakeVideoConstraints={video:!0,fake:!0},fakeAudioConstraints={audio:!0,fake:!0};navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var mcuRestServerUrl,roomServerUrl,iceServers,stunUrl,trunUrl,iceusername,iceCredential,is_cluster=!1,protocolStr=document.location.protocol;"http:"!=protocolStr&&"https:"!=protocolStr&&(protocolStr="http:");var fsCheck={isCheck:!1,content:{}},doFsCheck=function(e,t){var r=null;return 1==fsCheck.isCheck&&1!=fsCheck.content[e.value]&&(r=new t(ErrorConstant.ft_no_authorization.code,e.name+ErrorConstant.ft_no_authorization.message)),r};ModuleBase.define("RestServer",["Error"],function(Error){var RestServer=function(){};return RestServer.prototype.getServerinfo=function(serverURI,accessToken){var deferred=when.defer();mcuRestServerUrl=serverURI;var tjson={access_tocken:accessToken};tjson=JSON.stringify(tjson);var base64token=encodeURI(tjson),serverinfoUrl=protocolStr+"//"+serverURI+"/sdk/config/serverinfo?uri_encode=yes&client_info="+base64token;return $.ajax({type:"get",url:serverinfoUrl,dataType:"jsonp",jsonpCallback:"test",timeout:5e3,success:function(serverinfo){var fuValue=serverinfo.ft_value;fuValue&&(fsCheck.isCheck=!0,"object"==typeof fuValue?fsCheck.content=fuValue:"string"==typeof fuValue&&(fsCheck.content=eval("("+fuValue+")")));var error=doFsCheck(FTConstant.platform_web,Error);if(null!=error)return deferred.reject(error),deferred.promise;roomServerUrl=serverinfo.room_server.uri,null!=(iceServers=serverinfo.ice_servers)&&iceServers.length>0&&(stunUrl=iceServers[0].url,trunUrl=iceServers[1].url,iceusername=iceServers[1].username,iceCredential=iceServers[1].credential),serverinfo.is_cluster&&("true"!=serverinfo.is_cluster&&1!=serverinfo.is_cluster||(is_cluster=!0)),deferred.resolve()},error:function(e,t,r){log.info("ajax (/sdk/config/serverinfo) serverinfoUrl:"+serverinfoUrl),log.info("ajax (/sdk/config/serverinfo) errorThrown:"+r.stack),log.info("ajax (/sdk/config/serverinfo) XMLHttpRequest.status:"+e.status+",XMLHttpRequest.statusText:"+e.statusText);var n=new Error(e.status,e.statusText);deferred.reject(n)}}),deferred.promise},RestServer.prototype.getMcu=function(e,t){var r=when.defer(),n=protocolStr+"//"+mcuRestServerUrl+"/sdk/get_mcu?room_id="+e+"&token="+t;return avdEngine.mcuClusterRouteParams&&(n=n+"&options="+avdEngine.mcuClusterRouteParams,log.info("ajax (/sdk/getMcu) getMcuUrl(带mcuClusterRouteParams):"+n)),$.ajax({type:"get",url:n,dataType:"jsonp",jsonpCallback:"test",timeout:5e3,success:function(e){var t=e.ret;if(0==t)roomServerUrl=e.addr,r.resolve();else{var n=new Error(t,e.msg);r.reject(n)}},error:function(e,t,o){log.info("ajax (/sdk/getMcu) getMcuUrl:"+n),log.info("ajax (/sdk/getMcu) errorThrown:"+o.stack),log.info("ajax (/sdk/getMcu) XMLHttpRequest.status:"+e.status+",XMLHttpRequest.statusText:"+e.statusText);var i=new Error(e.status,e.statusText);r.reject(i)}}),r.promise},RestServer.prototype.getMcuWithOEM=function(e,t){var r=when.defer(),n=protocolStr+"//"+mcuRestServerUrl+"/sdk/get_mcu?room_id="+e+"&access_token="+t;return $.ajax({type:"get",url:n,dataType:"jsonp",jsonpCallback:"test",timeout:5e3,success:function(e){var t=e.ret;if(0==t)roomServerUrl=e.addr,room.avdEngine.accessToken=e.access_token,log.info("ajax (/sdk/getMcuWithOEM)  roomServerUrl:"+e.addr+"；accessToken："+e.access_token),r.resolve();else{var n=new Error(t,e.msg);r.reject(n)}},error:function(e,t,o){log.info("ajax (/sdk/getMcuWithOEM) getMcuUrl:"+n),log.info("ajax (/sdk/getMcuWithOEM) errorThrown:"+o.stack),log.info("ajax (/sdk/getMcuWithOEM) XMLHttpRequest.status:"+e.status+",XMLHttpRequest.statusText:"+e.statusText);var i=new Error(e.status,e.statusText);401==e.status||400==e.status?i=new Error(401,"unauthorized"):404==e.status||602==e.status?i=new Error(404,"room not found"):409==e.status&&(i=new Error(409,"http query server timeout")),r.reject(i)}}),r.promise},RestServer}),ModuleBase.define("MasterServer",["CmdProtobufCoded","TraceablePeerConnection"],function(e,t){function r(e){var t=e.split("(")[1].split(")")[0].split(",");return t.length>=4?t[3]=parseInt(255*t[3]):t[3]=255,t}function n(){var e="js_v2.5.0.0";return e+="firefox"==webrtcDetectedBrowser?" vp8:120,vp9:121,h264:126":webrtcDetectedVersion<57?" vp8:100,vp9:101,h264:107":" vp8:96,vp9:98,h264:100"}var o=function(r){this.signalingChannel=r,this.cmdProtobufCoded=new e,this.roomPduType=this.cmdProtobufCoded.getRoomPduTypeEnum(),this.mediaType=this.cmdProtobufCoded.getMediaTypeEnum(),this.sessionType=this.cmdProtobufCoded.getSessionTypeEnum(),this.resourceStatus=this.cmdProtobufCoded.getResourceStatusEnum(),this.resourceOpt=this.cmdProtobufCoded.getResourceOptEnum(),this.userMsgOpt=this.cmdProtobufCoded.getUserMsgOptEnum(),this.cameraType=this.cmdProtobufCoded.getCameraTypeEnum(),this.lineArrow=this.cmdProtobufCoded.getLineArrowEnum(),this.annotationType=this.cmdProtobufCoded.getAnnotationTypeEnum(),this.traceablePeerConnection=new t,room.traceablePeerConnection=this.traceablePeerConnection,this.traceablePeerConnection.getToMCUPeerConnection(),"firefox"==webrtcDetectedBrowser&&this.traceablePeerConnection.getToMCUPeerConnectionForFirefox()};return o.prototype.openReqSend=function(){var e=n();log.debug("====openReqSend,version:"+e);var t=this.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,"",e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,t);log.info("====openReqSend,OPEN_REQ====="),this.signalingChannel.send(r)},o.prototype.openReqReconnectionSend=function(){var e=n();log.debug("====openReqReconnectionSend,version:"+e);var t=this.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,room.signalTocken,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,t);log.info("====openReqReconnectionSend,OPEN_REQ====="),this.signalingChannel.send(r)},o.prototype.pingIntervalHandle=function(){var e=this;room.pingIntervalId=setInterval(function(){room.pingCountTime+=room.pingInterval,packetArray=e.cmdProtobufCoded.encodedPacket(e.roomPduType.PING,0,0,0,null),e.signalingChannel.send(packetArray)},room.pingInterval)},o.prototype.pingTimeoutHandle=function(){var e=this;room.pingTimeoutId=setInterval(function(){room.pingCountTime>=1e4&&(room.reconnectionState||(log.debug("=========Ping Timeout,开始重连...==========="),e.pingInit(),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.reconnectionHandle()))},1e3)},o.prototype.pingInit=function(){clearInterval(room.pingIntervalId),clearInterval(room.pingTimeoutId),room.pingIntervalId=null,room.pingTimeoutId=null,room.pingCountTime=0},o.prototype.inviteRoomReqSend=function(){var e=null;room.reconnectionCount>0&&(e=room.selfUser.nodeId);var t=[],r=[],n=this.cmdProtobufCoded.newUserPolicy(!0,!0,!0),o=this.cmdProtobufCoded.newJoinInfo(t,r,new String("user_agent"),n),i=this.cmdProtobufCoded.newInviteRoomReq1(20,room.id,"",room.avdEngine.accessToken,room.selfUser.id,room.selfUser.name,o,room.selfUser.password,e);if(i.user_data=room.selfUser.data,"firefox"==webrtcDetectedBrowser){var s=this;this.traceablePeerConnection.getInviteRoomReq1ByFirefox().then(function(){void 0!=room.iceUfragLocal&&(i.ice_ufrag=room.iceUfragLocal),void 0!=room.icePwdLocal&&(i.ice_pwd=room.icePwdLocal),void 0!=room.iceUfragLocal2&&(i.ice_ufrag=i.ice_ufrag+":"+room.iceUfragLocal2),void 0!=room.icePwdLocal2&&(i.ice_pwd=i.ice_pwd+":"+room.icePwdLocal2);var e=s.cmdProtobufCoded.encodedPacket(s.roomPduType.INVITE_ROOM_REQ1,0,0,0,i);s.signalingChannel.send(e)})}else{var a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.INVITE_ROOM_REQ1,0,0,0,i);this.signalingChannel.send(a)}},o.prototype.sendOffer=function(){var e=this;this.traceablePeerConnection.doSetLocalDescription().then(function(){e.traceablePeerConnection.doSetRemoteDescription()}),"firefox"==webrtcDetectedBrowser&&this.traceablePeerConnection.doSetLocalDescriptionForFirefox().then(function(){e.traceablePeerConnection.doSetRemoteDescriptionForFirefox()})},o.prototype.setAddIcecandidate=function(e){if(roomServerUrl){var t=roomServerUrl.split("/")[0];if(t){var r=t.split(":");r.size>0&&(t=r[0])}e.candidate=e.candidate.replace("127.0.0.1",t)}log.info("setAddIcecandidate(),mcu server send candidate:"+e.candidate),this.traceablePeerConnection.doAddIceCandidate(e)},o.prototype.addWebcamMsg=function(e,t){var r=this.cmdProtobufCoded.newWebcam(e,t.name,t.status,this.sessionType.Video);r.ctype=this.cameraType.unknown,r.level=t.level,r.description=t.description;var n=this.cmdProtobufCoded.newAddWebcamMsg(room.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_WEBCAM_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},o.prototype.removeWebcamMsg=function(e){var t=this.cmdProtobufCoded.newRemoveWebcamMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_WEBCAM_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},o.prototype.addScreenMsg=function(e,t){var r=this.cmdProtobufCoded.newDesktop(e,t.name,t.status,this.sessionType.ShareScreen);r.level=t.level,r.description=t.description;var n=this.cmdProtobufCoded.newAddDesktopMsg(room.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_DESKTOP_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},o.prototype.addSpeakerMsg=function(e,t){var r=this.cmdProtobufCoded.newSpeaker(e,t.name,t.status,this.sessionType.Audio),n=this.cmdProtobufCoded.newAddSpeakerMsg(room.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_SPEAKER_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},o.prototype.removeSpeakerMsg=function(e){var t=this.cmdProtobufCoded.newRemoveSpeakerMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_SPEAKER_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},o.prototype.updateUserDataMsg=function(e){var t=this.cmdProtobufCoded.newUpdateUserDataMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_DATA_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},o.prototype.roomDataInfo=function(e,t){var r=this.cmdProtobufCoded.newRoomKV(e,t),n=[];n.push(r);var o=this.cmdProtobufCoded.newRoomDataInfo(room.id,n),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_DATA_INFO,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(i)},o.prototype.pubRoomResourceMsg=function(e,t,r,n,o){var i;if("video"==e){var s=100;videoCoding==VideoCodingType.VP8?s=100:videoCoding==VideoCodingType.VP9?s=101:videoCoding==VideoCodingType.H264&&(s=107),i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,r,currentVideoParameter.videoWidth,currentVideoParameter.videoHeight,currentVideoParameter.frameRate,s)}else"audio"==e?i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,r):"screen"==e&&(i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,r));if(null!=i){var a=this.cmdProtobufCoded.newRoomResourceInfo(n,room.selfUser.nodeId,i),l=this.cmdProtobufCoded.newPubRoomResourceMsg(a,o),u=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,l);this.signalingChannel.send(u),this.signalingChannel.send("")}},o.prototype.subRoomResourceMsg=function(e,t){var r;if(1==e){var n=this.cmdProtobufCoded.newSubRoomResourceMsg(t,room.selfUser.nodeId);r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,n)}else if(0==e){var o=this.cmdProtobufCoded.newUnsubRoomResourceMsg(t,room.selfUser.nodeId);r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNSUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,o)}this.signalingChannel.send(r),this.signalingChannel.send("")},o.prototype.unpubRoomResourceMsg=function(e,t,r){var n,o;"video"==e?(n=room.selfUser.videoSdpSsrc,o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,n)):"audio"==e?(n=room.selfUser.audioSdpSsrc,o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,n)):"screen"==e&&(n=room.selfUser.screenSdpSsrc,o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,n));var i=this.cmdProtobufCoded.newRoomResourceInfo(r,room.selfUser.nodeId,o),s=this.cmdProtobufCoded.newUnpubRoomResourceMsg(i),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,s);this.signalingChannel.send(a),this.signalingChannel.send("")},o.prototype.updateSpeakerMsg=function(e,t,r){var n=room.composePDUDeviceId(room.selfUser.id,r.id),o=this.cmdProtobufCoded.newSpeaker(n,r.name,r.status,this.sessionType.Audio),i=this.cmdProtobufCoded.newUpdateSpeakerMsg(e,t,o),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_SPEAKER_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("")},o.prototype.updateWebcamMsg=function(e,t,r){var n=room.composePDUDeviceId(room.selfUser.id,r.id),o=r.status;r.status!=StreamStatus.none&&r.status!=StreamStatus.opened||(o=1);var i=this.cmdProtobufCoded.newWebcam(n,r.name,o,this.sessionType.Video);i.level=r.level,i.description=r.description;var s=this.cmdProtobufCoded.newUpdateWebcamMsg(e,t,i),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_WEBCAM_MSG,0,room.selfUser.nodeId,0,s);this.signalingChannel.send(a),this.signalingChannel.send("")},o.prototype.updateScreenIdMsg=function(e,t,r){var n=room.composePDUDeviceId(room.selfUser.id,r.id),o=this.cmdProtobufCoded.newDesktop(n,r.name,r.status,this.sessionType.ShareScreen);o.level=r.level,o.description=r.description;var i=this.cmdProtobufCoded.newUpdateDesktopMsg(e,t,o),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_DESKTOP_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("")},o.prototype.videoIndiction=function(e,t,r){var n=this.resourceOpt.pub;e||(n=this.resourceOpt.unpub);var o=this.cmdProtobufCoded.newResourceIndiction(t,n,r,room.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_INDICTION,0,room.selfUser.nodeId,r,o);this.signalingChannel.send(i)},o.prototype.audioIndiction=function(e,t,r){var n=this.resourceOpt.pub;e||(n=this.resourceOpt.unpub);var o=this.cmdProtobufCoded.newResourceIndiction(t,n,r,room.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.AUDIO_INDICTION,0,room.selfUser.nodeId,r,o);this.signalingChannel.send(i)},o.prototype.sendMessage=function(e,t){var r=new Date;r.setMinutes(r.getMinutes()+r.getTimezoneOffset());var n=r.getTime();n=Math.round(n/1e3);var o=this.cmdProtobufCoded.newTextMsg(e,n),i=this.roomPduType.PUBLIC_TEXT_MSG,s=0;if(void 0!==t&&null!=t&&""!=t){var a=room.getNodeId(t);if(null==a)return;s=a,i=this.roomPduType.PRIVATE_TEXT_MSG}var l=this.cmdProtobufCoded.encodedPacket(i,0,room.selfUser.nodeId,s,o);this.signalingChannel.send(l)},o.prototype.sendData=function(e,t){var r=this.cmdProtobufCoded.newData(e),n=this.roomPduType.PUBLIC_DATA,o=0;if(void 0!==t&&null!=t&&""!=t){var i=room.getNodeId(t);null!=i&&(o=i,n=this.roomPduType.PRIVATE_DATA)}var s=this.cmdProtobufCoded.encodedPacket(n,0,room.selfUser.nodeId,o,r);this.signalingChannel.send(s)},o.prototype.userIndiction=function(e,t){var r=room.getNodeId(t),n=this.cmdProtobufCoded.newUserMsg(r,this.userMsgOpt.kickoff,e),o=this.cmdProtobufCoded.newUserIndiction(room.selfUser.nodeId,this.roomPduType.USER_MSG,n.toArrayBuffer()),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_INDICTION,0,room.selfUser.nodeId,r,o);this.signalingChannel.send(i)},o.prototype.userMsg=function(e,t){var r=this.userMsgOpt.leave;t&&(r=this.userMsgOpt.kickoff);var n=this.cmdProtobufCoded.newUserMsg(room.selfUser.nodeId,r,e),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},o.prototype.videoPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("video",e,t,r):this.pubRoomResourceMsg("video",t.id,null,e,r)},o.prototype.videoUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("video",e,t):this.unpublishHandleP2P("video",room.selfUser.subMyVideosP2P,t,e)},o.prototype.videoSubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("video",1,e):this.subscribleHandleP2P(e)},o.prototype.videoUnsubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("video",0,e):this.unsubscribleHandleP2P("video",e)},o.prototype.screenPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("screen",e,t,r):this.pubRoomResourceMsg("screen",t.id,null,e,r)},o.prototype.screenUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("screen",e,t):this.unpublishHandleP2P("screen",room.selfUser.subMyScreensP2P,t,e)},o.prototype.screenSubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",1,e):this.subscribleHandleP2P(e)},o.prototype.screenUnsubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",0,e):this.unsubscribleHandleP2P("screen",e)},o.prototype.audioPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},o.prototype.audioUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("audio",e,t):this.unpublishHandleP2P("audio",room.selfUser.subMyAudiosP2P,t,e)},o.prototype.audioSubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",1,e):this.subscribleHandleP2P(e)},o.prototype.audioUnsubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",0,e):this.unsubscribleHandleP2P("audio",e)},o.prototype.sendOfferP2P=function(e,t){log.debug("=========sendOfferP2P()========OFFER_REQ======");var r=this.cmdProtobufCoded.newOfferReq(0,e,room.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REQ,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(n)},o.prototype.setRemoteP2P=function(e,t){log.debug("=========setRemoteP2P()========OFFER_REP======");var r=this.cmdProtobufCoded.newOfferRep(0,1,"",e,room.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REP,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(n)},o.prototype.sendCandidateMsgP2P=function(e,t){var r=this.cmdProtobufCoded.newCandidateMsg(e.candidate,e.sdpMLineIndex,e.sdpMid,room.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CANDIDATE_MSG,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(n)},o.prototype.sendSubSdpOfferP2P=function(e,t,r){var n=e.info;n.stream.sdp=t;var o;if("offerSub"==r)log.debug("send P2P SUB_ROOM_RESOURCE_REQ: "+room.selfUser.nodeId+"------\x3e"+n.owner_id),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,n.owner_id,e);else if("answerSub"==r){log.debug("send P2P SUB_ROOM_RESOURCE_REP: "+room.selfUser.nodeId+"------\x3e"+e.sub_node_id);var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",n);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,e.sub_node_id,i)}this.signalingChannel.send(o),this.signalingChannel.send("")},o.prototype.sendSubSdpAnswerP2P=function(e,t,r,n){t.stream.sdp=r;var o;if("offerSub"==e){var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",t);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,n,i)}else if("answerSub"==e){var s=this.cmdProtobufCoded.newSubRoomResourceMsg(t,room.selfUser.nodeId);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,n,s)}this.signalingChannel.send(o),this.signalingChannel.send("")},o.prototype.subscribleHandleP2P=function(e){if(room.selfUser.nodeId>e.owner_id){e.stream.sdp="";r=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,room.selfUser.nodeId);log.info("=========subscribleHandleP2P() =======SUB_ROOM_RESOURCE_REQ====");var t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,e.owner_id,r);this.signalingChannel.send(t),this.signalingChannel.send("")}else{var r=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,room.selfUser.nodeId);room.traceableP2PPeerConnection.sendSubSdpOfferP2P("offerSub",r)}},o.prototype.unpublishHandleP2P=function(e,t,r,n){if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o];room.traceableP2PPeerConnection.removeStreamP2P(e,i,r),room.selfUser.nodeId>i?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unpubAnswer",e,i,null):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unpubOffer",e,i,null)}var s;"video"==e?(s=this.mediaType.video,log.debug("===unPubWebcam() p2p=== send  video  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice")):"audio"==e?(s=this.mediaType.audio,log.debug("===unPubWebcam() p2p=== send  audio  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice")):"screen"==e&&(s=this.mediaType.desktop,log.debug("===unPubWebcam() p2p=== send  screen  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice"));var a=this.cmdProtobufCoded.newMediaStream(r.id,s,null),l=this.cmdProtobufCoded.newRoomResourceInfo(n,room.selfUser.nodeId,a),u=this.cmdProtobufCoded.newUnpubRoomResourceMsg(l),c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,u);this.signalingChannel.send(c),this.signalingChannel.send("")},o.prototype.unsubscribleHandleP2P=function(e,t){room.selfUser.nodeId>t.owner_id?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unsubAnswer",e,t.owner_id,t):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unsubOffer",e,t.owner_id,t)},o.prototype.sendAnnotationMessage=function(e,t,n,o,i,s,a,l,u){for(var t=t+"",c=[],d=n[0].x,p=n[0].x,f=n[0].y,h=n[0].y,m=0;m<n.length;m++){var g=this.cmdProtobufCoded.newPoint(n[m].x,n[m].y);c.push(g),n[m].x>d&&(d=n[m].x),n[m].x<p&&(p=n[m].x),n[m].y>f&&(f=n[m].y),n[m].y<f&&(f=n[m].y)}var v=this.lineArrow.none,y=this.annotationType.annotation_tool_mouse;o==canvasTypeEnum.line?y=this.annotationType.annotation_tool_line:o==canvasTypeEnum.rect?y=this.annotationType.annotation_tool_rectangle:o==canvasTypeEnum.polyline?y=this.annotationType.annotation_tool_polyline:o==canvasTypeEnum.ellipse?y=this.annotationType.annotation_tool_ellipse:o==canvasTypeEnum.arrowline?(y=this.annotationType.annotation_tool_line,v=a||this.lineArrow.none):o==canvasTypeEnum.undo?y=this.annotationType.annotation_tool_undo:o==canvasTypeEnum.redo?y=this.annotationType.annotation_tool_redo:o==canvasTypeEnum.eraser?y=this.annotationType.annotation_tool_eraser_line:o==canvasTypeEnum.right?y=this.annotationType.annotation_tool_success:o==canvasTypeEnum.wrong&&(y=this.annotationType.annotation_tool_failure);var b=r(i),S=this.cmdProtobufCoded.newcolor(parseInt(b[3]),parseInt(b[0]),parseInt(b[1]),parseInt(b[2])),w=null;l==fillTypeEnum.none?w=this.cmdProtobufCoded.newcolor(0,255,255,255):l==fillTypeEnum.full&&(w=S);var E=this.cmdProtobufCoded.newRect(h,f,p,d),C=this.cmdProtobufCoded.newAnnotationObject(t,"1",room.selfUser.nodeId,room.selfUser.id,y,v,s,S,w,E),P=null;if(2==c.length){var T=c[0],I=c[1];P=this.cmdProtobufCoded.newAnnotation2Point(C,T,I)}else P=c.length>2?this.cmdProtobufCoded.newAnnotationMultiPoint(C,c):this.cmdProtobufCoded.newAnnotationList(C,u);var R=this.cmdProtobufCoded.newAnnotationMsgInternal(y,P.toArrayBuffer(),"1",room.selfUser.nodeId,0),_=this.cmdProtobufCoded.newAnnotationMsg(y,R.toArrayBuffer()),x=this.roomPduType.ANNOTATION_MSG,M=this.cmdProtobufCoded.encodedPacket(x,0,room.selfUser.nodeId,0,_);this.signalingChannel.send(M)},o}),ModuleBase.define("P2PServer",["TraceableP2PPeerConnection"],function(e){function t(e){room.selfUser.nodeId<e&&(null!=this.selfNodeIntervalId&&(clearInterval(this.selfNodeIntervalId),this.selfNodeIntervalId=null),room.traceableP2PPeerConnection.getToP2PPeerConnection(e))}var r=function(){this.selfNodeIntervalId=null,this.traceableP2PPeerConnection=new e,room.traceableP2PPeerConnection=this.traceableP2PPeerConnection};return r.prototype.createP2PPeerConnection=function(e){null!=room.selfUser&&null!=room.selfUser.nodeId?t(e):this.selfNodeIntervalId=setInterval(function(){null!=room.selfUser&&null!=room.selfUser.nodeId&&t(e)},200)},r});var log=log4javascript.getLogger(),room,rooms=[],browserDetect,videoCoding=VideoCodingType.VP8,setRemoteDescriptionSuccess=!1,setRemoteDescriptionSuccessForFirefox=!1,addIcecandidateList=[];ModuleBase.define("AVDEngine",["Room","RestServer","Error","BrowserDetect","Record","Live","Outgoing"],function(e,t,r,n,o,i,s){function a(e){for(var t=null,r=0;r<rooms.length;r++){var n=rooms[r];if(n.roomId==e){t=n;break}}return t}function l(e){var t=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss} %-5p - %m{1}%n");e.setLayout(t),log.addAppender(e)}function u(e,t,r,n){var o=[];for(var i in t)o.push(i);var s=arrayUtil.inANotInB(o,e),a=arrayUtil.inANotInB(e,o);if(0==a.length&&0==s.length)return!1;for(var l=0;l<this.rooms.length;l++){var u=r[l];if(null!=u.selfUser){if(s.length>0)for(c=0;c<s.length;c++){d=t[s[c]];n[s[c]]=d}if(a.length>0)for(var c=0;c<a.length;c++){var d=n[a[c]];a[c]==self.checkMicrophoneId&&u.selfUser.deleteAudio(a[c]),delete n[a[c]]}}}}function c(e,t,r,n){var o=[];for(var i in t)o.push(i);var s=arrayUtil.inANotInB(o,e),a=arrayUtil.inANotInB(e,o);if(0==a.length&&0==s.length)return!1;for(var l=0;l<r.length;l++){var u=r[l];if(null!=u.selfUser){if(s.length>0)for(d=0;d<s.length;d++){var c=t[s[d]];n[s[d]]=c,u.selfUser.initVideo(s[d],c)}if(a.length>0)for(var d=0;d<a.length;d++)delete n[a[d]],u.selfUser.deleteVideo(a[d])}}}var d=function(){this.accessToken,this.cameraMap={},this.microphoneMap={},this.speakerMap={},this.checkMicrophoneId=null,this.checkMicrophoneName=null,this.checkAudioStream=null,this.checkVideoStream=null,this.mcuClusterRouteParams=null;var e=new log4javascript.BrowserConsoleAppender;e.setThreshold(log4javascript.Level.ERROR),l(e)};return d.prototype.getVersion=function(){return"cn.tee3.avd-2.4.0.0"},d.prototype.getBrowserDetect=function(){return(new n).detect},d.prototype.checkBrowserSupport=function(){return(new n).checkBrowserSupport()},d.prototype.checkBrowserPluginSupport=function(){return(new n).checkBrowserPluginSupport()},d.prototype.setLog=function(e,t){var r;e==Appender.alert?r=new log4javascript.AlertAppender:e==Appender.inpage?r=new log4javascript.InPageAppender:e==Appender.popup?r=new log4javascript.PopUpAppender:e==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),t==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):t==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):t==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):t==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):t==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):t==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):t==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):t==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),l(r)},d.prototype.setVideoCoding=function(e){videoCoding=e},d.prototype.getVideoCoding=function(){return videoCoding},d.prototype.getResolutionEnum=function(){var e=when.defer();return e.resolve(Resolution),e.promise},d.prototype.setMcuClusterRouteParams=function(e){this.mcuClusterRouteParams=e},d.prototype.init=function(e,o){var i=when.defer();if(log.info("AVDEngine init begin"),!o||!e){var s=new r(ErrorConstant.avdEngine_init_failed);return i.reject(s),i.promise}browserDetect=new n;var a=new t;return this.accessToken=o.replace(/%3D%3D/g,"=="),this.accessToken=this.accessToken.replace(/%3d%3d/g,"=="),a.getServerinfo(e,o).then(function(){i.resolve()}).otherwise(function(e){if(e)i.reject(e);else{var t=new r(ErrorConstant.avdEngine_init_failed);i.reject(t)}}),i.promise},d.prototype.initWithOEM=function(e,t){var o=when.defer();if(log.info("AVDEngine OEM  init begin"),"qiniu.com"!=t){var i=new r(ErrorConstant.oemname_notfound);o.reject(i)}else browserDetect=new n,mcuRestServerUrl=e,roomServerUrl=e,is_cluster=!0,o.resolve();return o.promise},d.prototype.obtainRoom=function(t){return null==(room=a(t))&&((room=new e(t)).avdEngine=this,rooms.push(room)),room},d.prototype.getAllDevices=function(){var e=when.defer();if(void 0!==navigator.mediaDevices)"chrome"!=webrtcDetectedBrowser&&"Internet Explorer"!=webrtcDetectedBrowser&&"firefox"!=webrtcDetectedBrowser||navigator.mediaDevices.enumerateDevices().then(function(t){e.resolve(t)});else if("undefined"!=typeof MediaStreamTrack)"chrome"!=webrtcDetectedBrowser&&"Internet Explorer"!=webrtcDetectedBrowser&&"firefox"!=webrtcDetectedBrowser||MediaStreamTrack.getSources(function(t){e.resolve(t)});else{var t=new r(ErrorConstant.not_support_mediaStreamTrack);e.reject(t)}return e.promise},d.prototype.initDevice=function(){var e=when.defer(),t=this;return log.info("initDevice:Camera and Microphone begin"),this.getAllDevices().then(function(r){for(var n={},o=0,i={},s=0,a={},l=0,u=0;u!=r.length;++u){var c=r[u],d=c.deviceId||c.id;"videoinput"===c.kind||"video"===c.kind?(o+=1,n[d]=c.label||"camera"+o):"audioinput"===c.kind||"audio"===c.kind?(s+=1,i[d]=c.label||"microphone"+s):"audiooutput"===c.kind&&(l+=1,a[d]=c.label||"speaker"+l)}t.cameraMap=n,log.info("initDevice Camera finish!cameraMap:"+n),t.microphoneMap=i;for(var p in i){var f=i[p];t.checkMicrophoneId=p,t.checkMicrophoneName=f;break}log.info("initDevice Microphone finish!microphoneMap:"+i),t.speakerMap=a,e.resolve(1)}).otherwise(function(t){if(t)e.reject(t);else{var n=new r(ErrorConstant.avdEngine_init_failed);e.reject(n)}}),e.promise},d.prototype.refreshDevice=function(){var e=when.defer(),t=this,r=[];for(key in t.microphoneMap)r.push(key);var n=[];for(key in t.cameraMap)n.push(key);return"chrome"!=webrtcDetectedBrowser&&"Internet Explorer"!=webrtcDetectedBrowser||this.getAllDevices().then(function(e){for(var o={},i=0,s={},a=0,l={},d=0,p=0;p!=e.length;++p){var f=e[p],h=f.deviceId||f.id;"videoinput"===f.kind||"video"===f.kind?(i+=1,o[h]=f.label||"camera"+i):"audioinput"===f.kind||"audio"===f.kind?(a+=1,s[h]=f.label||"microphone"+a):"audiooutput"===f.kind&&(d+=1,l[h]=f.label||"speaker"+d)}c(n,o,this.rooms,t.cameraMap);for(var m in s){var g=s[m];t.checkMicrophoneId=m,t.checkMicrophoneName=g;break}u(r,s,this.rooms,t.microphoneMap),t.speakerMap=l}).otherwise(function(e){log.info("get device error!error code:"+e.code+"; error message:"+e.message)}),"firefox"==webrtcDetectedBrowser&&captureUserMedia({audio:!0,video:!0},function(e){getAllAudioVideoDevices(function(e){for(var o={},i=0,s=0;s!=e.audioInputDevices.length;++s){var a=e.audioInputDevices[s];i+=1,o[a.id]=a.label||"microphone"+i}u(r,o,this.rooms,t.microphoneMap);for(var l={},d=0,s=0;s!=e.videoInputDevices.length;++s){var p=e.videoInputDevices[s];d+=1,l[p.id]=p.label||"camera"+d}c(n,l,this.rooms,t.cameraMap)},function(e){})},function(e){}),setTimeout(function(){e.resolve()},2e3),e.promise},d.prototype.setRecordingMicrophone=function(e){var t=room.selfUser.audio;if(null==t){n=this.microphoneMap[e];room.selfUser.initAudio(e,n)}else if(e!=t.id)if(t.status==StreamStatus.init){room.selfUser.deleteAudio(t.id);n=this.microphoneMap[e];room.selfUser.initAudio(e,n)}else if(t.status==StreamStatus.published){var r=t.element;t.closeMicrophone(),room.selfUser.deleteAudio(t.id);var n=this.microphoneMap[e];room.selfUser.initAudio(e,n),room.selfUser.audio.openMicrophone(r)}},d.prototype.getDeviceObject=function(){var e=when.defer();return log.info("getDeviceObject begin"),this.getAllDevices().then(function(t){for(var r={video:null,audio:null,speaker:null},n={},o=0,i={},s=0,a={},l=0,u=0;u!=t.length;++u){var c=t[u],d=c.deviceId||c.id;"videoinput"===c.kind||"video"===c.kind?(o+=1,n[d]=c.label||"camera"+o):"audioinput"===c.kind||"audio"===c.kind?(s+=1,i[d]=c.label||"microphone"+s):"audiooutput"===c.kind&&(l+=1,a[d]=c.label||"speaker"+l)}r.video=n,r.audio=i,r.speaker=a,e.resolve(r)}).otherwise(function(t){e.reject(t)}),e.promise},d.prototype.checkDevice=function(){var e=when.defer();return this.getAllDevices().then(function(t){for(var r={video:!1,audio:!1,speaker:!1},n=0;n!=t.length;++n){var o=t[n];o.deviceId||o.id;"videoinput"===o.kind||"video"===o.kind?r.video=!0:"audioinput"===o.kind||"audio"===o.kind?r.audio=!0:"audiooutput"===o.kind&&(r.speaker=!0)}e.resolve(r)}).otherwise(function(t){e.reject(t)}),e.promise},d.prototype.checkOpenVideo=function(e,t,r){var n=when.defer(),o=this,i={video:!0,audio:!1};if(i.video={mandatory:{},optional:[]},e&&(i.video.mandatory.sourceId=e),t){var s=Resolution[t];i.video.mandatory.minWidth=s.width,i.video.mandatory.minHeight=s.height,i.video.mandatory.maxWidth=s.width,i.video.mandatory.maxHeight=s.height}r&&("string"==typeof r&&(r=Number(r)),i.video.mandatory.minFrameRate=r,i.video.mandatory.maxFrameRate=r);try{getUserMedia(i,function(e){o.checkVideoStream=e,n.resolve(e)},function(e){var t,r=ModuleBase.use(ModulesEnum.error);t=new r("PermissionDeniedError"==e.name?ErrorConstant.navigatorUserMediaError_permissionDenied:"ConstraintNotSatisfiedError"==e.name?ErrorConstant.navigatorUserMediaError_constraintNotSatisfied:"TrackStartError"==e.name?ErrorConstant.navigatorUserMediaError_trackStartError:ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)})}catch(e){var a=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n.reject(a)}return n.promise},d.prototype.checkOpenAudio=function(e){var t=when.defer(),r=this,n={video:!1,audio:!0};e&&(n.audio={mandatory:{},optional:[]},n.audio.mandatory.sourceId=e);try{getUserMedia(n,function(e){r.checkAudioStream=e,t.resolve(e)},function(e){var r,n=ModuleBase.use(ModulesEnum.error);r=new n("PermissionDeniedError"==e.name?ErrorConstant.navigatorUserMediaError_permissionDenied:"ConstraintNotSatisfiedError"==e.name?ErrorConstant.navigatorUserMediaError_constraintNotSatisfied:"TrackStartError"==e.name?ErrorConstant.navigatorUserMediaError_trackStartError:ErrorConstant.navigatorUserMediaError_unknown),t.reject(r)})}catch(e){var o=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);t.reject(o)}return t.promise},d.prototype.checkCloseVideo=function(){this.checkVideoStream&&this.checkVideoStream.getTracks().forEach(function(e){e.stop()}),this.checkVideoStream=null},d.prototype.checkCloseAudio=function(){this.checkAudioStream&&this.checkAudioStream.getTracks().forEach(function(e){e.stop()}),this.checkAudioStream=null},d.prototype.obtainRecord=function(e){return new o(e)},d.prototype.obtainLive=function(e){return new i(e)},d.prototype.obtainOutgoing=function(e){return new s(e)},d}),ModuleBase.define("Room",["SignalFactory","RestServer","MasterServer","P2PServer","User","Error"],function(e,t,r,n,o,s){function a(e){log.info("============openReqSend(websocket)===========");var t=when.defer();return room.p2pServer=new n,room.masterServer=new r(e),room.masterServer.openReqSend(),room.addCallback(EngineCallback.room_join_success,function(e){t.resolve(e)}),room.addCallback(EngineCallback.room_join_error,function(e){t.reject(e)}),t.promise}var l=function(e){this.id=e,this.roomTocken=null,this.signalTocken=null,this.pingTimeout,this.pingInterval,this.pingCountTime=0,this.pingIntervalId=null,this.pingTimeoutId=null,this.webocketStatusIntervalId=null,this.roomInfo=null,this.status=RoomStatus.opening,this.appData={},this.selfUser=null,this.participants=[],this.muteSpeakerFlag=!1,this.avdEngine=null,this.masterServer=null,this.p2pServer=null,this.cmdProtobufCoded=null,this.traceablePeerConnection=null,this.traceableP2PPeerConnection=null,this.eventEmitter=new EventEmitter,this.iceUfragLocal,this.icePwdLocal,this.iceUfragLocal2,this.icePwdLocal2,this.fingerPrint,this.iceUfrag,this.icePwd,this.setup,this.sdp=null,this.iceUfragForFirefox,this.icePwdForFirefox,this.sdpForFirefox=null,this.connectionInfoCollector=null,this.audioLevel=null,this.baselineReconnectionTime,this.reconnectionTime,this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!1,this.toMCUReconnectionPC=null,this.toMCUReconnectionPCForFirefox=null,this.pubVideos=[],this.pubAudios=[],this.pubScreens=[],this.baselineJoinTime=null,this.joinTimeoutIntervalId=null,this.joinTimeout=1e4,this.joinTimeoutState=!1,this.audioSsrc2user={},this.localFirefoxSDP,this.localFirefoxSecondSDP,this.fakeVideoStreams=[],this.fakeAudioStreams=[],this.localVideoMsids=0,this.localAudioMsids=0,this.localAddFakeVideoStreams=[],this.localAddFakeAudioStreams=[],this.videoSsrc=null,this.audioSsrc=null};return l.prototype.join=function(e,r,n,o){var i=when.defer();if(is_cluster?(new t).getMcu(room.id,room.avdEngine.accessToken).then(function(){room.doJoin(e,r,n,o,i)}).otherwise(function(e){i.reject(e)}):room.doJoin(e,r,n,o,i),!room.isMcu()){var a=doFsCheck(FTConstant.p2p,s);if(null!=a)return i.reject(a),i.promise}return i.promise},l.prototype.joinWithOEM=function(e,r,n,o,i){var s=when.defer();return(new t).getMcuWithOEM(room.id,i).then(function(){room.doJoin(e,r,n,o,s)}).otherwise(function(e){s.reject(e)}),s.promise},l.prototype.doJoin=function(t,r,n,i,l){if(null==t||""==t){var u=new s(ErrorConstant.userId_required);l.reject(u)}else null==room.baselineJoinTime&&(room.baselineJoinTime=new Date),room.joinTimeoutIntervalId=setInterval(function(){if(new Date-room.baselineJoinTime>=room.joinTimeout){room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null),room.joinTimeoutState=!0,log.error("登陆加会超时："+ErrorConstant.join_room_timeout.code);var e=new s(ErrorConstant.join_room_timeout);l.reject(e)}},500),this.selfUser=new o(t,r,n,i),(new e).getDataChannel(SignalType.websocket).connect().then(a).then(function(e){log.debug("==========doJoin websokcet(one) success========"),e.joinTimeoutIntervalId&&(clearInterval(e.joinTimeoutIntervalId),e.joinTimeoutIntervalId=null,e.baselineJoinTime=null),l.resolve(e)}).otherwise(function(e){log.debug("==========doJoin websokcet(one) error========"),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),l.reject(e)});room.addCallback(EngineCallback.room_join_websocket_reconnection_success,function(e){a(e).then(function(e){log.debug("==========doJoin websokcet(reconnection) success========"),e.joinTimeoutIntervalId&&(clearInterval(e.joinTimeoutIntervalId),e.joinTimeoutIntervalId=null,e.baselineJoinTime=null),l.resolve(e)}).otherwise(function(e){log.debug("==========doJoin websokcet(reconnection) error========"),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),l.reject(e)})})},l.prototype.reJoin=function(){log.info("reJoin room  Operation！");var t=when.defer();return room.traceablePeerConnection.close(this.toMCUReconnectionPC),this.toMCUReconnectionPC=null,"firefox"==webrtcDetectedBrowser&&(room.traceablePeerConnection.close(this.toMCUReconnectionPCForFirefox),this.toMCUReconnectionPCForFirefox=null),room.webocketStatusIntervalId=setInterval(function(){room.masterServer.signalingChannel.readyState==WebSocket.CLOSED&&(clearInterval(room.webocketStatusIntervalId),room.webocketStatusIntervalId=null,(new e).getDataChannel(SignalType.websocket).connect().then(a).then(function(e){room.pingTimeout=e.pingTimeout,room.pingInterval=e.pingInterval,room.signalTocken=e.signalTocken,room.masterServer=e.masterServer,t.resolve(room)}).otherwise(function(e){t.reject(e)}))},500),t.promise},l.prototype.reconnectionHandle=function(){var t=new Date;0==this.reconnectionCount&&(this.baselineReconnectionTime=t),t-this.baselineReconnectionTime>this.pingTimeout?(this.reconnectionState=!1,this.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],this.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed)):(this.reconnectionState=!0,this.reconnectionCount+=1,log.info("与服务器第"+this.reconnectionCount+"次重连。"),(new e).getDataChannel(SignalType.websocket).connect().then(function(e){log.debug("=========reconnectionHandle(),websocket.connect() success======="),null!=room.joinTimeoutIntervalId?(log.debug("=========加会时,websocket重连成功======="),room.reconnectionState=!1,room.reconnectionCount=0,room.eventEmitter.emit(EngineCallback.room_join_websocket_reconnection_success,e)):(log.debug("=========房间网络科动时,websocket重连成功======="),room.masterServer.signalingChannel=e,room.masterServer.openReqReconnectionSend())}))},l.prototype.getRoomId=function(){return room.roomInfo.room_id},l.prototype.getRoomTopic=function(){return room.roomInfo.topic},l.prototype.getOwnerId=function(){return room.roomInfo.owner_id},l.prototype.isMcu=function(){var e=!0;if(null==room.roomInfo)return e;var t=room.roomInfo.room_mode;return 3!=t&&4!=t||(e=!1),e},l.prototype.getMaxAudio=function(){return room.roomInfo.max_audio},l.prototype.getMaxVideo=function(){return room.roomInfo.max_video},l.prototype.getMaxAttendee=function(){return room.roomInfo.attendee_max},l.prototype.getUsableVideo=function(){var e=this.getMaxVideo()-this.pubVideos.length;return e<0&&(e=0),e},l.prototype.getUsableAudio=function(){var e=this.getMaxAudio()-this.pubAudios.length;return e<0&&(e=0),e},l.prototype.updateRoomStatus=function(e){this.status=e},l.prototype.getRoomStatus=function(){return this.status},l.prototype.getHost=function(){for(var e=0;e!=this.participants.length;++e){var t=this.participants[e];if(1==t.role)return t}},l.prototype.getSelfUser=function(){return room.selfUser},l.prototype.getSelfUserId=function(){return room.selfUser.id},l.prototype.getParticipants=function(){return this.participants},l.prototype.getUser=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.id==e){t=n;break}}return t},l.prototype.hasUser=function(e){for(var t=!1,r=0;r<this.participants.length;r++)if(this.participants[r].id==e){t=!0;break}return t},l.prototype.getPublishedCameraCount=function(){return this.pubVideos.length},l.prototype.getPublishedCamera=function(){return this.pubVideos},l.prototype.getPublishedScreenCount=function(){return this.pubScreens.length},l.prototype.getPublishedScreen=function(){return this.pubScreens},l.prototype.addUser=function(e){this.hasUser(e.id)||this.participants.push(e)},l.prototype.removeUser=function(e){null!=this.participants&&this.participants.length>0&&arrayUtil.objectSplice(this.participants,e)},l.prototype.getUserByNodeId=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.nodeId==e){t=n;break}}return t},l.prototype.getNodeId=function(e){var t=null,r=this.getUser(e);return null!=r&&(t=r.nodeId),t},l.prototype.getUserId=function(e){var t=null,r=this.getUserByNodeId(e);return null!=r&&(t=r.id),t},l.prototype.sendPublicMessage=function(e){var t=when.defer(),r=doFsCheck(FTConstant.chat,s);return null==r?(this.masterServer.sendMessage(e),t.resolve()):t.reject(r),t.promise},l.prototype.sendPrivateMessage=function(e,t){var r=when.defer(),n=doFsCheck(FTConstant.chat,s);return null==n?(this.masterServer.sendMessage(e,t),r.resolve()):r.reject(n),r.promise},l.prototype.sendPublicData=function(e){var t=when.defer(),r=doFsCheck(FTConstant.datachannel,s);return null==r?(this.masterServer.sendData(e),t.resolve()):t.reject(r),t.promise},l.prototype.sendPrivateData=function(e,t){var r=when.defer(),n=doFsCheck(FTConstant.datachannel,s);return null==n?(this.masterServer.sendData(e,t),r.resolve()):r.reject(n),r.promise},l.prototype.updateAppData=function(e,t){this.appData[e]=t,this.masterServer.roomDataInfo(e,t)},l.prototype.getAppData=function(e){return void 0===e||null==e||""==e?this.appData:this.appData[e]},l.prototype.setCameraResolutionOrFrameRate=function(e,t,r){var n=when.defer();if(parseInt(t)>640&&null!=(i=doFsCheck(FTConstant.video_hd,s)))return n.reject(i),n.promise;var o=room.selfUser.getVideo(e);if(null!=o){if("string"==typeof r&&(r=Number(r)),o.resolution!=Resolution[t]||o.frameRate!=r)if(null!=o.stream)if(o.status==StreamStatus.none||o.status==StreamStatus.init)o.stream=null,o.setResolution(t),o.setFrameRate(r),n.resolve();else{i=new s(ErrorConstant.closeVideo_before_operation_warnings);n.reject(i)}else o.setResolution(t),o.setFrameRate(r),n.resolve()}else{var i=new s(ErrorConstant.cameraId_does_not_exist);n.reject(i)}return n.promise},l.prototype.setCameraResolutionWHOrFrameRate=function(e,t,r,n){var o=when.defer();if(parseInt(t)>640&&null!=(a=doFsCheck(FTConstant.video_hd,s)))return o.reject(a),o.promise;var i=room.selfUser.getVideo(e);if(null!=i){if("string"==typeof n&&(n=Number(n)),void 0===i.resolution)i.setResolutionWH(t,r),i.setFrameRate(n),o.resolve();else if(i.resolution.width!=t||i.resolution.height!=r||i.frameRate!=n)if(null!=i.stream)if(i.status==StreamStatus.none||i.status==StreamStatus.init)i.stream=null,i.setResolutionWH(t,r),i.setFrameRate(n),o.resolve();else{a=new s(ErrorConstant.closeVideo_before_operation_warnings);o.reject(a)}else i.setResolutionWH(t,r),i.setFrameRate(n),o.resolve()}else{var a=new s(ErrorConstant.cameraId_does_not_exist);o.reject(a)}return o.promise},l.prototype.muteSpeaker=function(){this.muteSpeakerFlag=!0,this.participants.forEach(function(e){if(e.id!=room.selfUser.id){var t=e.audio.stream;if(null!=t){var r=t.getAudioTracks();for(i=0;i<r.length;i++)r[i].enabled=!1}}})},l.prototype.unmuteSpeaker=function(){this.muteSpeakerFlag=!1,this.participants.forEach(function(e){if(e.id!=room.selfUser.id){var t=e.audio.stream;if(null!=t){var r=t.getAudioTracks();for(i=0;i<r.length;i++)r[i].enabled=!0}}})},l.prototype.ismuteSpeaker=function(){return this.muteSpeakerFlag},l.prototype.kickoffUser=function(e,t){this.masterServer.userIndiction(e,t)},l.prototype.leave=function(e,t){var r=when.defer(),n=room.selfUser.videos;if(null!=n&&n.length>0)for(key in n){var o=n[key];o.status==StreamStatus.published&&(o.unpreview(),o.unpublish())}var i=room.selfUser.audio;null!=i&&i.status==StreamStatus.published&&i.closeMicrophone();var s=room.selfUser.screen;null!=s&&s.status==StreamStatus.published&&s.unpublish(),null!=this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=null),null!=this.pingTimeoutId&&(clearInterval(this.pingTimeoutId),this.pingTimeoutId=null),null!=this.selfUser&&(null!=this.selfUser.toMCUPC&&this.selfUser.toMCUPC.close(),null!=this.selfUser.toMCUPCForFirefox&&"firefox"==webrtcDetectedBrowser&&this.selfUser.toMCUPCForFirefox.close());var a=this;return setTimeout(function(){a.masterServer.userMsg(e,t),null!=room&&(room=null),r.resolve()},1e3),r.promise},l.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},l.prototype.composePDUDeviceId=function(e,t){return e+"_"+t},l.prototype.splitPDUDeviceId=function(e){return e.split("_")[1]},l.prototype.splitUserId=function(e){return e.split("_")[0]},l.prototype.calInitVideoBitrate=function(e,t){var r=e*t,n=Math.sqrt(r),o=Math.log10(r),i=Math.log10(n),s=o*n/Math.pow(i,2)/10;return 2*parseInt(8*s)},l.prototype.sendAnnotation=function(e,t,r,n,o,i,s,a,l){log.info("send Annotation ========="),this.masterServer.sendAnnotationMessage(e,t,r,n,o,i,s,a,l)},l.prototype.initFakeVideoStream=function(e){for(var t=0;t<e;t++)getFakeVideoStream(function(e){room.fakeVideoStreams.push(e)})},l.prototype.initFakeAudioStream=function(e){for(var t=0;t<e;t++)getFakeAudioStream(function(e){room.fakeAudioStreams.push(e)})},l});var remoteSDPInit;"firefox"==webrtcDetectedBrowser?remoteSDPInit=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendonly","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass","m=video 1 UDP/TLS/RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=sendonly","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","a=fmtp:121 profile-level-id=42e01f;level-asymmetry-allowed=1","a=fmtp:120 max-fs=12288;max-fr=60","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_1","a=rtcp-fb:120 nack","a=rtcp-fb:120 ccm fir","a=fmtp:120 x-google-max-bitrate=8000; x-google-min-bitrate=30; x-google-start-bitrate=645","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=rtpmap:121 VP9/90000","a=rtpmap:126 H264/90000","a=setup:actpass",""].join("\r\n"):webrtcDetectedVersion<57?(remoteSDPInit="v=0\r\n",remoteSDPInit+="o=- 0 0 IN IP4 127.0.0.1\r\n",remoteSDPInit+="s=-\r\n",remoteSDPInit+="t=0 0\r\n",remoteSDPInit+="a=group:BUNDLE video audio\r\n",remoteSDPInit+="a=msid-semantic: WMS\r\n",remoteSDPInit+="m=audio 1 RTP/SAVPF 103 102 111 0 8 9\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:audio\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:111 opus/48000/2\r\n",remoteSDPInit+="a=rtcp-fb:111 transport-cc\r\n",remoteSDPInit+="a=fmtp:111 minptime=10;useinbandfec=1\r\n",remoteSDPInit+="a=rtpmap:102 ILBC/8000\r\n",remoteSDPInit+="a=rtpmap:103 ISAC/16000\r\n",remoteSDPInit+="a=rtpmap:0 PCMU/8000\r\n",remoteSDPInit+="a=rtpmap:8 PCMA/8000\r\n",remoteSDPInit+="a=rtpmap:9 G722/8000\r\n",remoteSDPInit+="a=rtpmap:126 telephone-event/8000\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="m=video 9 RTP/SAVPF 100 101 107\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:video\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:100 VP8/90000\r\n",remoteSDPInit+="a=rtcp-fb:100 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:100 nack\r\n",remoteSDPInit+="a=rtcp-fb:100 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:100 goog-remb\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="a=fmtp:100 x-google-max-bitrate=8000; x-google-min-bitrate=30; x-google-start-bitrate=645\r\n",remoteSDPInit+="a=rtpmap:101 VP9/90000\r\n",remoteSDPInit+="a=rtcp-fb:101 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:101 nack\r\n",remoteSDPInit+="a=rtcp-fb:101 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:101 goog-remb\r\n",remoteSDPInit+="a=rtpmap:107 H264/90000\r\n",remoteSDPInit+="a=rtcp-fb:107 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:107 nack\r\n",remoteSDPInit+="a=rtcp-fb:107 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:107 goog-remb\r\n",remoteSDPInit+="a=rtcp-fb:107 transport-cc\r\n",remoteSDPInit+="a=fmtp:107 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\n"):(remoteSDPInit="v=0\r\n",remoteSDPInit+="o=- 0 0 IN IP4 127.0.0.1\r\n",remoteSDPInit+="s=-\r\n",remoteSDPInit+="t=0 0\r\n",remoteSDPInit+="a=group:BUNDLE video audio\r\n",remoteSDPInit+="a=msid-semantic: WMS\r\n",remoteSDPInit+="m=audio 1 RTP/SAVPF 103 102 111 0 8 9\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:audio\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:111 opus/48000/2\r\n",remoteSDPInit+="a=rtcp-fb:111 transport-cc\r\n",remoteSDPInit+="a=fmtp:111 minptime=10;useinbandfec=1\r\n",remoteSDPInit+="a=rtpmap:102 ILBC/8000\r\n",remoteSDPInit+="a=rtpmap:103 ISAC/16000\r\n",remoteSDPInit+="a=rtpmap:0 PCMU/8000\r\n",remoteSDPInit+="a=rtpmap:8 PCMA/8000\r\n",remoteSDPInit+="a=rtpmap:9 G722/8000\r\n",remoteSDPInit+="a=rtpmap:126 telephone-event/8000\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="m=video 9 RTP/SAVPF 96 98 100\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:video\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:96 VP8/90000\r\n",remoteSDPInit+="a=rtcp-fb:96 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:96 nack\r\n",remoteSDPInit+="a=rtcp-fb:96 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:96 goog-remb\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="a=fmtp:96 x-google-max-bitrate=8000; x-google-min-bitrate=30; x-google-start-bitrate=645\r\n",remoteSDPInit+="a=rtpmap:98 VP9/90000\r\n",remoteSDPInit+="a=rtcp-fb:98 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:98 nack\r\n",remoteSDPInit+="a=rtcp-fb:98 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:98 goog-remb\r\n",remoteSDPInit+="a=rtpmap:100 H264/90000\r\n",remoteSDPInit+="a=rtcp-fb:100 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:100 nack\r\n",remoteSDPInit+="a=rtcp-fb:100 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:100 goog-remb\r\n",remoteSDPInit+="a=rtcp-fb:100 transport-cc\r\n",remoteSDPInit+="a=fmtp:100 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\n"),sdpLines=function(e){return e.split("\r\n").filter(function(e){return e.length>0})},sdpMline=function(e){for(var t=e.substr(2).split(" "),r={media:t[0],port:t[1],proto:t[2],formats:[]},n=3;n<t.length;n++)t[n]&&r.formats.push(t[n]);return r},findLineInFirefox=function(e,t,r){for(var n=e.length,o=0;o<t.length;o++)if(t[o].substr(0,n)===e)return t[o];if(!r)return!1;for(var i=0;i<r.length;i++)if(r[i].substr(0,n)===e)return r[i];return!1},findLinesInFirefox=function(e,t,r){for(var n=[],o=e.length,i=0;i<t.length;i++)t[i].substr(0,o)===e&&n.push(t[i]);if(n.length||!r)return n;for(var s=0;s<r.length;s++)r[s].substr(0,o)===e&&n.push(r[s]);return n},rtpmap=function(e){var t=e.substr(9).split(" "),r={id:t.shift()};return t=t[0].split("/"),r.name=t[0],r.clockrate=t[1],r.channels=3==t.length?t[2]:"1",r},sctpmap=function(e){var t=e.substr(10).split(" ");return{number:t.shift(),protocol:t.shift(),streams:t.shift()}},fmtp=function(e){for(var t,r,n,o=e.substr(e.indexOf(" ")+1).split(";"),i=[],s=0;s<o.length;s++)r=(t=o[s].split("="))[0].trim(),n=t[1],r&&n?i.push({key:r,value:n}):r&&i.push({key:"",value:r});return i},crypto=function(e){var t=e.substr(9).split(" ");return{tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")}},fingerprint=function(e){var t=e.substr(14).split(" ");return{hash:t[0],value:t[1]}},extmap=function(e){var t=e.substr(9).split(" "),r={},n=t.shift(),o=n.indexOf("/");return o>=0?(r.id=n.substr(0,o),r.senders=n.substr(o+1)):(r.id=n,r.senders="sendrecv"),r.uri=t.shift()||"",r},rtcpfb=function(e){var t=e.substr(10).split(" "),r={};return r.id=t.shift(),r.type=t.shift(),"trr-int"===r.type?r.value=t.shift():r.subtype=t.shift()||"",r.parameters=t,r},sdpCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},n=8;n<t.length;n+=2)"raddr"===t[n]?r.relAddr=t[n+1]:"rport"===t[n]?r.relPort=t[n+1]:"generation"===t[n]?r.generation=t[n+1]:"tcptype"===t[n]&&(r.tcpType=t[n+1]);return r.network="1",r},sourceGroups=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].substr(13).split(" ");t.push({semantics:n.shift(),sources:n})}return t},sources=function(e){for(var t=[],r={},n=0;n<e.length;n++){var o=e[n].substr(7).split(" "),i=o.shift();if(!r[i]){var s={ssrc:i,parameters:[]};t.push(s),r[i]=s}var a=(o=o.join(" ").split(":")).shift(),l=o.join(":")||null;r[i].parameters.push({key:a,value:l})}return t},groups=function(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n].substr(8).split(" "),r.push({semantics:t.shift(),contents:t});return r},msidSemantics=function(e){for(var t,r=[],n=0;n<e.length;n++)t="firefox"==webrtcDetectedBrowser?e[n].substr(16).split(" "):e[n].substr(17).split(" "),r.push({semantics:t.shift(),contents:t});return r},bandwidth=function(e){var t=e.substr(2).split(":"),r={};return r.type=t.shift(),r.bandwidth=t.shift(),r};var remoteSDPFirfox_audio=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendonly","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass",""].join("\r\n"),remoteSDPFirefox_video=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=video 1 RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=sendonly","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","a=fmtp:121 profile-level-id=42e01f;level-asymmetry-allowed=1","a=fmtp:120 max-fs=12288;max-fr=60","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_1","a=rtcp-fb:120 nack","a=rtcp-fb:120 ccm fir","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=rtpmap:121 VP9/90000","a=rtpmap:126 H264/90000","a=setup:actpass",""].join("\r\n"),remoteSDPFirefox_video_add=["m=video 1 RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=rtcp:1 IN IP4 0.0.0.0","a=ice-ufrag:e8cf35cf","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=fingerprint:sha-256 FF:8A:0A:40:A4:EF:3D:4C:B1:6E:12:DB:FE:0B:69:B6:D3:7B:40:50:CE:A9:BA","a=setup:actpass","a=sendrecv","a=mid:sdparta_x","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=fmtp:120 max-fs=12288;max-fr=60","a=rtcp-fb:120 nack","a=rtcp-fb:120 nack pli","a=rtcp-fb:120 ccm fir","a=rtpmap:121 VP9/90000","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtpmap:126 H264/90000","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1\r\n","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir",""].join("\r\n"),remoteSDPFirefox_audio_add=["m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendrecv","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass",""].join("\r\n"),SENDERS={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}},idCounter=Math.random();_setIdCounter=function(e){idCounter=e},toSessionJSON=function(e,t){var r,n=t.creators||[],o=t.role||"initiator",i=t.direction||"outgoing",s=e.split("\r\nm=");for(r=1;r<s.length;r++)s[r]="m="+s[r],r!==s.length-1&&(s[r]+="\r\n");var a=s.shift()+"\r\n",l=sdpLines(a),u={},c=[];for(r=0;r<s.length;r++)c.push(toMediaJSON(s[r],a,{role:o,direction:i,creator:n[r]||"initiator"}));u.contents=c;var d=findLinesInFirefox("a=group:",l);d.length&&(u.groups=groups(d));var p=findLinesInFirefox("a=msid-semantic:",l);return p.length&&(u.msidSemantics=msidSemantics(p)),u},toMediaJSON=function(e,t,r){var n=r.creator||"initiator",o=r.role||"initiator",i=r.direction||"outgoing",s=sdpLines(e),a=sdpLines(t),l=sdpMline(s[0]),u={creator:n,role:o,direction:i,name:l.media,description:{descType:"rtp",media:l.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==l.media&&(u.description={descType:"datachannel"},u.transport.sctp=[]);var c=u.description,d=u.transport,p=findLineInFirefox("a=mid:",s);if(p&&(u.name=p.substr(6)),findLineInFirefox("a=sendrecv",s,a)?u.senders="both":findLineInFirefox("a=sendonly",s,a)?u.senders=SENDERS[o][i].sendonly:findLineInFirefox("a=recvonly",s,a)?u.senders=SENDERS[o][i].recvonly:findLineInFirefox("a=inactive",s,a)&&(u.senders="none"),"rtp"==c.descType){var f=findLineInFirefox("b=",s);f&&(c.bandwidth=f(f));var h=findLineInFirefox("a=msid:",s);if(h.length){var m=h.substr(7).split(" "),g={};g.msid=h,g.streamId=m[0],g.trackId=m[1],c.msid=g}var v=findLineInFirefox("a=ssrc:",s);v&&(c.ssrc=v.substr(7).split(" ")[0]),findLinesInFirefox("a=rtpmap:",s).forEach(function(e){var t=rtpmap(e);t.parameters=[],t.feedback=[],findLinesInFirefox("a=fmtp:"+t.id,s).forEach(function(e){t.parameters=fmtp(e)}),findLinesInFirefox("a=rtcp-fb:"+t.id,s).forEach(function(e){t.feedback.push(rtcpfb(e))}),c.payloads.push(t)}),findLinesInFirefox("a=crypto:",s,a).forEach(function(e){c.encryption.push(crypto(e))}),findLineInFirefox("a=rtcp-mux",s)&&(c.mux=!0),findLinesInFirefox("a=rtcp-fb:*",s).forEach(function(e){c.feedback.push(rtcpfb(e))}),findLinesInFirefox("a=extmap:",s).forEach(function(e){var t=extmap(e);t.senders=SENDERS[o][i][t.senders],c.headerExtensions.push(t)});var y=findLinesInFirefox("a=ssrc-group:",s);c.sourceGroups=sourceGroups(y||[]);var b=findLinesInFirefox("a=ssrc:",s);c.sources=sources(b||[]),findLineInFirefox("a=x-google-flag:conference",s,a)&&(c.googConferenceFlag=!0)}var S=findLinesInFirefox("a=fingerprint:",s,a),w=findLineInFirefox("a=setup:",s,a);S.forEach(function(e){var t=fingerprint(e);w&&(t.setup=w.substr(8)),d.fingerprints.push(t)});var E=findLineInFirefox("a=ice-ufrag:",s,a),C=findLineInFirefox("a=ice-pwd:",s,a);return E&&C&&(d.ufrag=E.substr(12),d.pwd=C.substr(10),d.candidates=[],findLinesInFirefox("a=candidate:",s,a).forEach(function(e){d.candidates.push(toCandidateJSON(e))})),"datachannel"==c.descType&&findLinesInFirefox("a=sctpmap:",s).forEach(function(e){var t=sctpmap(e);d.sctp.push(t)}),u},toCandidateJSON=function(e){var t=sdpCandidate(e.split("\r\n")[0]);return t.id=(idCounter++).toString(36).substr(0,12),t},toSessionSDP=function(e,t){t.role,t.direction;var r=["v=0","o=- "+(t.sid||e.sid||Date.now())+" "+(t.time||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"];return(e.groups||[]).forEach(function(e){r.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),(e.msidSemantics||[]).forEach(function(e){navigator.mozGetUserMedia?r.push("a=msid-semantic:"+e.semantics+" "+e.contents.join(" ")):r.push("a=msid-semantic: "+e.semantics+" "+e.contents.join(" "))}),(e.contents||[]).forEach(function(e){r.push(toMediaSDP(e,t))}),r.join("\r\n")+"\r\n"},toMediaSDP=function(e,t){var r=[],n=t.role||"initiator",o=t.direction||"outgoing",i=e.description,s=e.transport,a=i.payloads||[],l=s&&s.fingerprints||[],u=[];if("datachannel"==i.descType?(u.push("application"),u.push("1"),u.push("DTLS/SCTP"),s.sctp&&s.sctp.forEach(function(e){u.push(e.number)})):(u.push(i.media),u.push("1"),i.encryption&&i.encryption.length>0||l.length>0?u.push("RTP/SAVPF"):u.push("RTP/AVPF"),a.forEach(function(e){u.push(e.id)})),r.push("m="+u.join(" ")),r.push("c=IN IP4 0.0.0.0"),i.bandwidth&&i.bandwidth.type&&i.bandwidth.bandwidth&&r.push("b="+i.bandwidth.type+":"+i.bandwidth.bandwidth),"rtp"==i.descType&&r.push("a=rtcp:1 IN IP4 0.0.0.0"),s){s.ufrag&&r.push("a=ice-ufrag:"+s.ufrag),s.pwd&&r.push("a=ice-pwd:"+s.pwd);l.forEach(function(e){r.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&r.push("a=setup:"+e.setup)}),s.sctp&&s.sctp.forEach(function(e){r.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}return"rtp"==i.descType&&r.push("a="+(SENDERS[n][o][e.senders]||"sendrecv")),r.push("a=mid:"+e.name),i.msid&&r.push(i.msid.msid),i.mux&&r.push("a=rtcp-mux"),(i.encryption||[]).forEach(function(e){r.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),i.googConferenceFlag&&r.push("a=x-google-flag:conference"),a.forEach(function(e){var t="a=rtpmap:"+e.id+" "+e.name+"/"+e.clockrate;if(e.channels&&"1"!=e.channels&&(t+="/"+e.channels),r.push(t),e.parameters&&e.parameters.length){var n=["a=fmtp:"+e.id],o=[];e.parameters.forEach(function(e){o.push((e.key?e.key+"=":"")+e.value)}),n.push(o.join(";")),r.push(n.join(" "))}e.feedback&&e.feedback.forEach(function(t){"trr-int"===t.type?r.push("a=rtcp-fb:"+e.id+" trr-int "+t.value?t.value:"0"):r.push("a=rtcp-fb:"+e.id+" "+t.type+(t.subtype?" "+t.subtype:""))})}),i.feedback&&i.feedback.forEach(function(e){"trr-int"===e.type?r.push((e.value,e.value)):r.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(i.headerExtensions||[]).forEach(function(e){r.push("a=extmap:"+e.id+(e.senders?"/"+SENDERS[n][o][e.senders]:"")+" "+e.uri)}),(i.sourceGroups||[]).forEach(function(e){r.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(i.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var n=e.parameters[t];r.push("a=ssrc:"+(e.ssrc||i.ssrc)+" "+n.key+(n.value?":"+n.value:""))}}),(s.candidates||[]).forEach(function(e){r.push(toCandidateSDP(e))}),r.join("\r\n")},toCandidateSDP=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"srflx"!==r&&"prflx"!==r&&"relay"!==r||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")},ModuleBase.define("TraceableWebsocket",["MessageManager","Error"],function(e,t){var r=function(){};return r.prototype.connect=function(){var r=when.defer();try{var n="ws://";"https:"==document.location.protocol&&(n="wss://");var o=n+roomServerUrl+"/ws";log.debug("=====websocket url==="+o);var i=new WebSocket(o);i.binaryType="arraybuffer",i.readyState==WebSocket.CONNECTING&&log.info("WebSocket连接正在建立..."),i.onopen=function(){i.readyState==WebSocket.OPEN&&log.info("WebSocket连接已打开!"),r.resolve(i)},i.onmessage=function(t){(new e).OnWebSocketMessage(t.data)},i.onclose=function(e){i.readyState==WebSocket.CLOSED&&(log.info("WebSocket连接已关闭!"),null==room||room.reconnectionOpenRep402||room.reconnectionState||room.selfUser.mulLanding||room.joinTimeoutState||(log.info("=========onclose(), WebSocket开始重连=========="),room.masterServer&&room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.reconnectionHandle()))},i.onerror=function(e){log.info("WebSocket连接发生错误！"),null!=room&&room.reconnectionCount>0&&!room.joinTimeoutState&&(log.info("=========onerror(), WebSocket开始重连=========="),setTimeout(function(){room.reconnectionHandle()},3e3))}}catch(e){log.info("websocket Operation  failed. with exception:"+e);var s=new t(ErrorConstant.websock_catch_exception);r.reject(s)}return r.promise},r}),ModuleBase.define("TraceablePeerConnection",["Error"],function(e){function t(e,t,r,n,o){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=n,i.para4=o,i}function r(e,t,r,n){var o;room.traceablePeerConnection.getToMCUPeerConnection().addStream(r),room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(i){i.sdp=updateSDPIceUfrag(i.sdp,room.iceUfrag),i.sdp=updateSDPIcePwd(i.sdp,room.icePwd),i.sdp=a(i.sdp);var c=null;if("video"==e){var f=room.splitPDUDeviceId(t),h=room.selfUser.getVideo(f).resolution;h||((h={}).width=640,h.height=480);var m=room.calInitVideoBitrate(h.width,h.height);if(c="a=fmtp:96 x-google-max-bitrate=8000; x-google-min-bitrate=30; x-google-start-bitrate="+m,videoCoding==VideoCodingType.H264?c="firefox"==webrtcDetectedBrowser?c.replace("a=fmtp:96","a=fmtp:126"):webrtcDetectedVersion<57?c.replace("a=fmtp:96","a=fmtp:107"):c.replace("a=fmtp:96","a=fmtp:100"):videoCoding==VideoCodingType.VP8?"firefox"==webrtcDetectedBrowser?c=c.replace("a=fmtp:96","a=fmtp:120"):webrtcDetectedVersion<57&&(c=c.replace("a=fmtp:96","a=fmtp:100")):c="firefox"==webrtcDetectedBrowser?c.replace("a=fmtp:96","a=fmtp:121"):webrtcDetectedVersion<57?c.replace("a=fmtp:96","a=fmtp:101"):c.replace("a=fmtp:96","a=fmtp:98"),i.sdp.indexOf("x-google-start-bitrate")>-1){for(var g=i.sdp.split("\r\n"),v=[],y=0;y<g.length;y++)g[y].indexOf("x-google-start-bitrate")>-1?v.push(c):v.push(g[y]);i.sdp=v.join("\r\n")}else i.sdp=i.sdp+c+"\r\n"}var b,S,w,E;if("firefox"==webrtcDetectedBrowser){var C;if("video"==e){for(var P=room.localAddFakeVideoStreams,y=0;y<P.length;y++)P[y];C=s(C=getSdpSsrc(i.sdp,"video",r.id),r.id),log.debug("addSdp(),new add video sdp:"+C),b=room.selfUser.videoSdpSsrc,room.selfUser.videoSdpSsrc=C}else"audio"==e?(C=getSdpSsrc(i.sdp,"audio",r.id),log.debug("addSdp(),new add audio sdp:"+C),S=room.selfUser.audioSdpSsrc,room.selfUser.audioSdpSsrc=C):"screen"==e&&(C=s(C=getSdpSsrc(i.sdp,"video",r.id),r.id),log.debug("addSdp(),new add screen sdp:"+C),w=room.selfUser.screenSdpSsrc,room.selfUser.screenSdpSsrc=C);E=C}else{var T=new SdpSerializer(i.sdp);"video"==e?(E=T._inner.video.ssrcStr,E=s(E,r.id),log.debug("addSdp(),new add video sdp:"+E),b=room.selfUser.videoSdpSsrc,room.selfUser.videoSdpSsrc=E):"audio"==e?(E=T._inner.audio.ssrcStr,log.debug("addSdp(),new add audio sdp:"+E),S=room.selfUser.audioSdpSsrc,room.selfUser.audioSdpSsrc=E):"screen"==e&&(E=T._inner.video.ssrcStr,E=s(E,r.id),log.debug("addSdp(),new add screen sdp:"+E),w=room.selfUser.screenSdpSsrc,room.selfUser.screenSdpSsrc=E)}room.masterServer.pubRoomResourceMsg(e,r.id,E,t,n),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(t){t==n&&("firefox"==webrtcDetectedBrowser&&(o=getSDPSenders(i.sdp),room.localFirefoxSDP=i.sdp),log.debug("addSdp(),  local sessionDescription:"+i.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(i,d,p),setTimeout(function(){var t={};if(t.sdp=room.sdp,t.type="answer",t.sdp=l(t.sdp),"firefox"==webrtcDetectedBrowser){if("video"==e){var r=checkLocalMsids(i.sdp,"video")-checkRemoteMsids(t.sdp,"video"),n=checkSdpContents(i.sdp,"video"),s=checkSdpContents(t.sdp,"video"),a=n-s;if(r>0&&a>0){t.sdp+=remoteSDPFirefox_video_add;f=s+1;t.sdp=t.sdp.replace("sdparta_x","sdparta_"+f),t.sdp=addGroupContents(t.sdp,r),t.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(t.sdp,room.fingerPrint,room.setup,room.iceUfrag,room.icePwd)}}else if("audio"==e){var r=checkLocalMsids(i.sdp,"audio")-checkRemoteMsids(t.sdp,"audio"),d=checkSdpContents(i.sdp,"audio"),p=checkSdpContents(t.sdp,"audio"),a=d-p;if(r>0&&a>0){t.sdp+=remoteSDPFirefox_audio_add;var f=p+1;t.sdp=t.sdp.replace("sdparta_x","sdparta_"+f),t.sdp=addGroupContents(t.sdp,r),t.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(t.sdp,room.fingerPrint,room.setup,room.iceUfrag,room.icePwd)}}t.sdp=setSDPSenders(t.sdp,o);var h=100;videoCoding==VideoCodingType.VP8||(videoCoding==VideoCodingType.VP9?h=101:videoCoding==VideoCodingType.H264&&(h=107)),t.sdp=u(t.sdp,h,E)}if("video"==e){for(var m=t.sdp.split("\r\n"),g=[],v=0;v<m.length;v++)m[v].indexOf("x-google-start-bitrate")>-1?g.push(c):g.push(m[v]);t.sdp=g.join("\r\n")}room.sdp=t.sdp,log.debug("addSdp(), remote sessionDescription:"+t.sdp);var y=new RTCSessionDescription(t);room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(y,function(){},function(e){log.error(e)})},200))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(t,o){o==n&&(room.traceablePeerConnection.getToMCUPeerConnection().removeStream(r),"video"==e?room.selfUser.videoSdpSsrc=b:"audio"==e?room.selfUser.audioSdpSsrc=S:"screen"==e&&(room.selfUser.screenSdpSsrc=w))})},c,this.constraints)}function n(e,t,r){var n=r.stream.stream_name,o=r.stream.sdp;if(null==o||""==o)return!1;o=o.replace(/^\n+|\n+$/g,"");var i,s=new SdpSerializer(room.sdp);if(1==t){for(var u=[],d=o.split("\r\n"),f=0;f<d.length;f++){v=d[f];u.push(v)}if("video"==e){f=0;null!=s._inner.video.ssrc&&s._inner.video.ssrc.length>0&&(f=s._inner.video.ssrc.length),s.video.track(f).set(u)}else if("audio"==e){f=0;null!=s._inner.audio.ssrc&&s._inner.audio.ssrc.length>0&&(f=s._inner.audio.ssrc.length),log.info("add ssrc and user relation, use sdp:"+u[0]);var h=u[0].split(" ")[0].split(":")[1];(m=room.getUserByNodeId(r.owner_id))&&(room.audioSsrc2user[h]=m),s.audio.track(f).set(u)}else if("screen"==e){f=0;null!=s._inner.video.ssrc&&s._inner.video.ssrc.length>0&&(f=s._inner.video.ssrc.length),s.video.track(f).set(u)}(i=g=s.deserialize()).indexOf("msid-semantic: WMS "+n)>0||(i=i.replace("WMS","WMS "+n)),room.sdp=i}else if(0==t){if("audio"==e){log.info("remove ssrc and user relation");for(key in room.audioSsrc2user)try{var m=room.audioSsrc2user[key];if(m&&m.nodeId==r.owner_id){delete room.audioSsrc2userNodeId[key];break}}catch(e){}}for(var g=room.sdp,d=o.split("\r\n"),f=0;f<d.length;f++){var v=d[f]+"\r\n";g=g.replace(v,"")}g.indexOf(n)>0&&(g=g.replace(n,"")),i=g,room.sdp=i}var y={};y.sdp=i,y.type="answer",y.sdp=l(y.sdp);var b=new RTCSessionDescription(y);room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),e.sdp=a(e.sdp),log.debug("updateSdp(), local sessionDescription:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e,function(){log.debug("updateSdp(), remote sessionDescription:"+y.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(b,function(){room.masterServer.subRoomResourceMsg(t,r)},function(e){log.error(e)})},p)},c,this.constraints)}function o(e,t,r){var n;log.debug("pc2 for fireofox, update handle "+r.stream.stream_name);var o=r.stream.stream_name,i=r.stream.sdp;if(null==i||""==i)return!1;i=i.replace(/^\n+|\n+$/g,"");var s;if(1==t)log.debug("pc2 for fireofox, update type 11."),"video"==e?s=addSdpSsrc(room.sdpForFirefox,i,"video"):"audio"==e?s=addSdpSsrc(room.sdpForFirefox,i,"audio"):"screen"==e&&(s=addSdpSsrc(room.sdpForFirefox,i,"video"));else if(0==t){log.debug("pc2 for fireofox, update type 00.");for(var d=room.sdpForFirefox,f=i.split("\r\n"),h=0;h<f.length;h++){var m=f[h]+"\r\n";d=d.replace(m,"")}d.indexOf(o)>0&&(d=d.replace(o,"")),s=d}var g={};if(g.sdp=s,g.type="answer",g.sdp=l(g.sdp),1==t)if("video"==e){room.fakeVideoStreams.length<20&&room.initFakeVideoStream(15);var v=checkRemoteMsids(g.sdp,"video")-room.localVideoMsids,y=checkSdpContents(room.localFirefoxSecondSDP,"video"),b=checkSdpContents(g.sdp,"video")-y;if(v>0&&b>0)for(h=0;h<v;h++){w=room.fakeVideoStreams.shift();room.localAddFakeVideoStreams.push(w),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().addStream(w),room.localVideoMsids+=1}}else if("audio"==e){room.fakeAudioStreams.length<20&&room.initFakeAudioStream(15);var v=checkRemoteMsids(g.sdp,"audio")-room.localAudioMsids,S=checkSdpContents(room.localFirefoxSecondSDP,"audio"),b=checkSdpContents(g.sdp,"audio")-S;if(v>0&&b>0)for(h=0;h<v;h++){var w=room.fakeAudioStreams.shift();room.localAddFakeAudioStreams.push(w),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().addStream(w),room.localAudioMsids+=1}}room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().createOffer(function(e){e.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e.sdp,null,null,room.iceUfragForFirefox,room.icePwd),e.sdp=a(e.sdp),n=getSDPSenders(e.sdp),room.localFirefoxSecondSDP=e.sdp,log.debug("updateSdpForFirefox(), pc2 for fireofox, local sessionDescription:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().setLocalDescription(e,function(){g.sdp=setSDPSenders(g.sdp,n);var e=r.stream.payload;log.debug("payload == "+e),g.sdp=u(g.sdp,e,i),room.sdpForFirefox=g.sdp,log.debug("updateSdpForFirefox(), pc2 for fireofox, remote sessionDescription:"+g.sdp);var o=new RTCSessionDescription(g);room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().setRemoteDescription(o,function(){room.masterServer.subRoomResourceMsg(t,r)},function(e){log.error(e)})},p)},c,this.constraints)}function i(e,t,r){var n;"firefox"==webrtcDetectedBrowser?firefoxRemoveStream(room.traceablePeerConnection.getToMCUPeerConnection(),r):room.traceablePeerConnection.getToMCUPeerConnection().removeStream(r);room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(o){o.sdp=updateSDPIceUfrag(o.sdp,room.iceUfrag),o.sdp=updateSDPIcePwd(o.sdp,room.icePwd),o.sdp=a(o.sdp);var i={};i.sdp=room.sdp,i.type="answer",i.sdp=l(i.sdp),"firefox"==webrtcDetectedBrowser&&(n=getSDPSenders(o.sdp),room.localFirefoxSDP=o.sdp),log.debug("reduceSdp(), local sessionDescription:"+o.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(o,d,p),"firefox"==webrtcDetectedBrowser&&(i.sdp=setSDPSenders(i.sdp,n)),log.debug("reduceSdp(), remote sessionDescription:"+i.sdp);var s=new RTCSessionDescription(i);room.masterServer.unpubRoomResourceMsg(e,r.id,t),setTimeout(function(){room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(s,function(){},function(e){log.error(e)})},200)},c,this.constraints)}function s(e,t){var r=e,n=r.split("\r\n");if(n.length>9){var o="";if(n[4].indexOf(t)>0)for(i=0;i<9;i++)""==o?o=n[i]:o+="\r\n"+n[i];else for(var i=9;i<18;i++)""==o?o=n[i]:o+="\r\n"+n[i];return o}return r}function a(e){if(null==e||""==e)return e;var t=e;return t=t.replace(/a=sendonly/g,"a=recvonly"),t=t.replace(/a=inactive/g,"a=recvonly")}function l(e){if(null==e||""==e)return e;var t=e;return navigator.mozGetUserMedia&&(t=t.replace(/a=sendrecv/g,"a=sendonly")),"firefox"==webrtcDetectedBrowser?t=(t=(t=t.replace(/a=group:BUNDLE audio video/g,"a=group:BUNDLE sdparta_0 sdparta_1")).replace(/a=mid:audio/g,"a=mid:sdparta_0")).replace(/a=mid:video/g,"a=mid:sdparta_1"):videoCoding==VideoCodingType.VP8?t=(t=(t=(t=t.replace("m=video 9 RTP/SAVPF 101 100 107","m=video 9 RTP/SAVPF 100 101 107")).replace("m=video 9 RTP/SAVPF 107 100 101","m=video 9 RTP/SAVPF 100 101 107")).replace("m=video 9 RTP/SAVPF 98 96 100","m=video 9 RTP/SAVPF 96 98 100")).replace("m=video 9 RTP/SAVPF 100 98 96","m=video 9 RTP/SAVPF 96 98 100"):videoCoding==VideoCodingType.VP9?t=(t=t.replace("m=video 9 RTP/SAVPF 100 101 107","m=video 9 RTP/SAVPF 101 100 107")).replace("m=video 9 RTP/SAVPF 96 98 100","m=video 9 RTP/SAVPF 98 96 100"):videoCoding==VideoCodingType.H264&&(t=(t=t.replace("m=video 9 RTP/SAVPF 100 101 107","m=video 9 RTP/SAVPF 107 100 101")).replace("m=video 9 RTP/SAVPF 96 98 100","m=video 9 RTP/SAVPF 100 98 96")),t}function u(e,t,r){for(var n=e.split("m=video"),o=n[0],i=r.split("\r\n"),s=1;s<n.length;s++){var a="m=video"+n[s];a.indexOf(i[0])>-1&&(107==t||120==t?a=a.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 126 121 120"):101==t&&(a=a.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 121 120 126"))),o+=a}return o}function c(e){log.error("onCreateSessionDescriptionError(),Failed to add local description: "+e.toString())}function d(){}function p(e){log.error("onSetSessionDescriptionError(),Failed to add local description: "+e.toString())}var f=function(){iceServers&&iceServers.length>0?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};f.prototype.getToMCUPeerConnection=function(){return room.reconnectionCount>0?(null==room.toMCUReconnectionPC&&(room.toMCUReconnectionPC=this.createMCUPeerConnection()),room.toMCUReconnectionPC):(null==room.selfUser.toMCUPC&&(room.selfUser.toMCUPC=this.createMCUPeerConnection()),room.selfUser.toMCUPC)},f.prototype.createMCUPeerConnection=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnection(e),e},f.prototype.handleMCUPeerConnection=function(e){var t=when.defer();return e.msgQueue=[],e.forLog=!1,e.onicecandidate=function(e){},e.onopen=function(){},e.onaddstream=function(e){if("default"!==e.stream.id){if(log.debug("onaddstream(), remote stream added:"+e.stream.id),e.stream.getVideoTracks().length>0){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(),MCU stream type: video");var n=(u=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);if(d=room.traceablePeerConnection.isContainsReconnectionSub(n.id,room.selfUser.reconnectionSubVideoIds)){var o=n.element;attachMediaStream(o,e.stream),o.play();var i=room.selfUser.reconnectionSubVideoIds.indexOf(n.id);i>-1&&room.selfUser.reconnectionSubVideoIds.splice(i,1)}else u.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,u.id,u.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), MCU  stream type: screen");var s=(u=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);if(d=room.traceablePeerConnection.isContainsReconnectionSub(s.id,room.selfUser.reconnectionSubScreenIds)){var a=s.element;attachMediaStream(a,e.stream),a.play();var l=room.selfUser.reconnectionSubScreenIds.indexOf(s.id);l>-1&&room.selfUser.reconnectionSubScreenIds.splice(l,1)}else u.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,u.id,u.name,r.resource_id)}}else if(e.stream.getAudioTracks().length>0){log.debug("onaddstream(),MCU stream type: audio");var t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],u=room.selfUser.getUserByAudioStreamLabel(e.stream.id),c=u.getAudio(t.resource_id);c.stream=e.stream;var d=room.traceablePeerConnection.isContainsReconnectionSub(c.id,room.selfUser.reconnectionSubAudioIds);if(d){var p=c.element;attachMediaStream(p,e.stream),p.play();var f=room.selfUser.reconnectionSubAudioIds.indexOf(c.id);f>-1&&room.selfUser.reconnectionSubAudioIds.splice(f,1)}else u.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,u.id,u.name)}}else log.info("recvonly remote stream ignored:"+e.stream+" - "+e.stream.id)},e.onremovestream=function(e){log.debug("onremovestream(),MCU stream lable:"+e.stream.id);var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.getUserByVideoStreamLabel(e.stream.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var n=room.selfUser.subScreenStream2ResourceInfo[e.stream.id],o=room.selfUser.getUserByScreenStreamLabel(e.stream.id);null!=o&&(delete room.selfUser.subScreenStream2ResourceInfo[e.stream.id],o.eventEmitter.emit(UserCallback.unsubscrible_screen_result,o.id,o.name,n.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],s=room.selfUser.getUserByAudioStreamLabel(e.stream.id);null!=s&&(s.getAudio(i.resource_id).stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.stream.id],s.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,s.id,s.name))},e.ondatachannel=function(e){},e.oniceconnectionstatechange=function(r){var n=r.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),MCU iceConnectionState :"+n),n){case"disconnected":break;case"failed":log.error("Create MCU PeerConnection  failed. "),t.reject("Create MCU PeerConnection  failed. ");break;case"completed":room.audioLevel=new AudioLevel(e,500),room.connectionInfoCollector=new ConnectionInfoCollector(e,1e3),room.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed)}},e.onsignalingstatechange=function(t){log.debug("onsignalingstatechange(), MCU signalingState :"+t.target.signalingState),"stable"==t.target.signalingState&&0==e.forLog&&(e.forLog=!0,e.intervalSet(e))},e.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},e.processSignalingMessage=function(e){if("stable"==e.signalingState&&e.msgQueue.length>0){var t=e.msgQueue.shift();log.debug("MCU 操作对列:"+t.operationType),"add"==t.operationType?r(t.para1,t.para2,t.para3,t.para4):"update"==t.operationType?n(t.para1,t.para2,t.para3):"reduce"==t.operationType&&i(t.para1,t.para2,t.para3)}},t.promise},f.prototype.getToMCUPeerConnectionForFirefox=function(){return room.reconnectionCount>0?(null==room.toMCUReconnectionPCForFirefox&&(room.toMCUReconnectionPCForFirefox=this.createMCUPeerConnectionForFirefox()),room.toMCUReconnectionPCForFirefox):(null==room.selfUser.toMCUPCForFirefox&&(room.selfUser.toMCUPCForFirefox=this.createMCUPeerConnectionForFirefox()),room.selfUser.toMCUPCForFirefox)},f.prototype.createMCUPeerConnectionForFirefox=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnectionForFirefox(e),e},f.prototype.handleMCUPeerConnectionForFirefox=function(e){e.msgQueue=[],e.forLog=!1,e.onaddstream=function(e){if("default"!==e.stream.id){if(log.debug("pc2 for fireofox, remote stream added:"+e.stream.id),e.stream.getVideoTracks().length>0){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(),pc2 for fireofox, MCU stream type: video");var n=(u=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);if(d=room.traceablePeerConnection.isContainsReconnectionSub(n.id,room.selfUser.reconnectionSubVideoIds)){var o=n.element;attachMediaStream(o,e.stream),o.play();var i=room.selfUser.reconnectionSubVideoIds.indexOf(n.id);i>-1&&room.selfUser.reconnectionSubVideoIds.splice(i,1)}else u.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,u.id,u.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), pc2 for fireofox, MCU  stream type: screen");var s=(u=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);if(d=room.traceablePeerConnection.isContainsReconnectionSub(s.id,room.selfUser.reconnectionSubScreenIds)){var a=s.element;attachMediaStream(a,e.stream),a.play();var l=room.selfUser.reconnectionSubScreenIds.indexOf(s.id);l>-1&&room.selfUser.reconnectionSubScreenIds.splice(l,1)}else u.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,u.id,u.name,r.resource_id)}}else if(e.stream.getAudioTracks().length>0){log.debug("onaddstream(),pc2 for fireofox, MCU stream type: audio");var t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],u=room.selfUser.getUserByAudioStreamLabel(e.stream.id),c=u.getAudio(t.resource_id);c.stream=e.stream;var d=room.traceablePeerConnection.isContainsReconnectionSub(c.id,room.selfUser.reconnectionSubAudioIds);if(d){var p=c.element;attachMediaStream(p,e.stream),p.play();var f=room.selfUser.reconnectionSubAudioIds.indexOf(c.id);f>-1&&room.selfUser.reconnectionSubAudioIds.splice(f,1)}else u.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,u.id,u.name)}}else log.info("pc2 for fireofox, recvonly remote stream ignored:"+e.stream+" - "+e.stream.id)},e.onremovestream=function(e){log.debug("onremovestream(),pc2 for fireofox, MCU stream label:"+e.stream.id);var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.getUserByVideoStreamLabel(e.stream.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var n=room.selfUser.subScreenStream2ResourceInfo[e.stream.id],o=room.selfUser.getUserByScreenStreamLabel(e.stream.id);null!=o&&(delete room.selfUser.subScreenStream2ResourceInfo[e.stream.id],o.eventEmitter.emit(UserCallback.unsubscrible_screen_result,o.id,o.name,n.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],s=room.selfUser.getUserByAudioStreamLabel(e.stream.id);null!=s&&(s.getAudio(i.resource_id).stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.stream.id],s.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,s.id,s.name))},e.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(), pc2 for fireofox, MCU iceConnectionState :"+t),t){case"disconnected":break;case"failed":log.error("Create MCU Second PeerConnection failed For Firefox.")}},e.onsignalingstatechange=function(t){log.debug("onsignalingstatechange(), pc2 for fireofox, MCU signalingState :"+t.target.signalingState),"stable"==t.target.signalingState&&0==e.forLog&&(e.forLog=!0,e.intervalSet(e))},e.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},e.processSignalingMessage=function(e){if("stable"==e.signalingState&&e.msgQueue.length>0){var t=e.msgQueue.shift();log.debug("MCU 操作对列, pc2 for firefox:"+t.operationType),o(t.para1,t.para2,t.para3)}}},f.prototype.close=function(e){e&&"closed"!=e.signalingState&&e.close()},f.prototype.getInviteRoomReq1ByFirefox=function(){var e=when.defer(),t=!1,r=!1;this.getToMCUPeerConnection().createOffer(function(e){var r=e.sdp,n=preferLineSdp(r,"a=","ice-ufrag");if(null!=n&&n.length>0)for(o=0;o<n.length;o++){i=n[o];log.debug("==========local ice-ufrag======="+i);s=i.split(":");room.iceUfragLocal=s[1];break}if(null!=(n=preferLineSdp(r,"a=","ice-pwd"))&&n.length>0)for(var o=0;o<n.length;o++){var i=n[o];log.debug("=================local ice-pw============="+i);var s=i.split(":");room.icePwdLocal=s[1];break}t=!0},function(e){},this.constraints),this.getToMCUPeerConnectionForFirefox().createOffer(function(e){var t=e.sdp,n=preferLineSdp(t,"a=","ice-ufrag");if(null!=n&&n.length>0)for(o=0;o<n.length;o++){i=n[o];log.debug("==========local ice-ufrag 2======="+i);s=i.split(":");room.iceUfragLocal2=s[1];break}if(null!=(n=preferLineSdp(t,"a=","ice-pwd"))&&n.length>0)for(var o=0;o<n.length;o++){var i=n[o];log.debug("=================local ice-pw 2============="+i);var s=i.split(":");room.icePwdLocal2=s[1];break}r=!0},function(e){},this.constraints);var n=setInterval(function(){t&&r&&(clearInterval(n),e.resolve())},300);return e.promise},f.prototype.doSetLocalDescription=function(){var e=when.defer(),t=this;return t.getToMCUPeerConnection().createOffer(function(r){r.sdp=updateSDPIceUfrag(r.sdp,room.iceUfrag),r.sdp=updateSDPIcePwd(r.sdp,room.icePwd),r.sdp=a(r.sdp),log.debug("doSetLocalDescription(), local sessionDescription:"+r.sdp),"firefox"==webrtcDetectedBrowser&&(room.localFirefoxSDP=r.sdp),t.getToMCUPeerConnection().setLocalDescription(r,function(){log.info("doSetLocalDescription(), set local sessionDescription success"),e.resolve()},function(e){log.error("doSetLocalDescription(), set local sessionDescription error: "+e.toString())})},function(e){log.error("doSetLocalDescription(), createOffer error:"+e.toString())},this.constraints),e.promise},f.prototype.doSetRemoteDescription=function(){sdp=updateSDPFingerPrint(remoteSDPInit,room.fingerPrint),sdp=updateSDPIceUfrag(sdp,room.iceUfrag),sdp=updateSDPIcePwd(sdp,room.icePwd),sdp=updateSDPSetup(sdp,room.setup),room.sdp=sdp;var e={};e.sdp=room.sdp,e.type="answer",e.sdp=l(e.sdp),log.debug("doSetRemoteDescription ,remote  sessionDescription:"+e.sdp);var t=new RTCSessionDescription(e);room.sdp=e.sdp;this.getToMCUPeerConnection().setRemoteDescription(t,function(){if(log.info("doSetRemoteDescription(), set remote sessionDescription success"),setRemoteDescriptionSuccess=!0,"firefox"!=webrtcDetectedBrowser&&null!=addIcecandidateList&&addIcecandidateList.length>0){for(var e=0;e<addIcecandidateList.length;e++){var t=addIcecandidateList[e];room.masterServer.setAddIcecandidate(t)}addIcecandidateList=[]}if("firefox"==webrtcDetectedBrowser){room.initFakeVideoStream(30),room.initFakeAudioStream(30)}},function(e){log.error("doSetRemoteDescription(), setRemoteDescription error:"+e)})},f.prototype.doSetLocalDescriptionForFirefox=function(){var e=when.defer(),t=this;return t.getToMCUPeerConnectionForFirefox().createOffer(function(r){r.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(r.sdp,null,null,room.iceUfragForFirefox,room.icePwd),r.sdp=a(r.sdp),log.debug("doSetLocalDescription(), pc2 for fireofox, local sessionDescription:"+r.sdp),room.localFirefoxSecondSDP=r.sdp,t.getToMCUPeerConnectionForFirefox().setLocalDescription(r,function(){log.info("doSetLocalDescription(), pc2 for fireofox, set local sessionDescription success"),e.resolve()},function(e){log.error("doSetLocalDescription(), pc2 for fireofox, set local sessionDescription error: "+e.toString())})},function(e){log.error("doSetLocalDescription(), pc2 for fireofox, createOffer error:"+e.toString())},this.constraints),e.promise},f.prototype.doSetRemoteDescriptionForFirefox=function(){sdp=updateSDPFingerPrint(remoteSDPInit,room.fingerPrint),sdp=updateSDPIceUfrag(sdp,room.iceUfragForFirefox),sdp=updateSDPIcePwd(sdp,room.icePwd),sdp=updateSDPSetup(sdp,room.setup),room.sdpForFirefox=sdp;var e={};e.sdp=room.sdpForFirefox,e.type="answer",e.sdp=l(e.sdp),log.debug("doSetRemoteDescription , pc2 for fireofox, remote  sessionDescription:"+e.sdp);var t=new RTCSessionDescription(e);room.sdpForFirefox=e.sdp,this.getToMCUPeerConnectionForFirefox().setRemoteDescription(t,function(){if(log.info("doSetRemoteDescription(), pc2 for fireofox, set remote sessionDescription success"),setRemoteDescriptionSuccessForFirefox=!0,null!=addIcecandidateList&&addIcecandidateList.length>0){for(var e=0;e<addIcecandidateList.length;e++){var t=addIcecandidateList[e];room.masterServer.setAddIcecandidate(t)}addIcecandidateList=[]}room.initFakeVideoStream(30),room.initFakeAudioStream(30)},function(e){log.error("doSetRemoteDescription(), pc2 for fireofox, setRemoteDescription error:"+e)})},f.prototype.doAddIceCandidate=function(e){var t="";e.candidate.indexOf("=")>-1&&(t=e.candidate.split("=")[1]);var r="audio",n="video";navigator.mozGetUserMedia&&(r="sdparta_0",n="sdparta_1");var o=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:r,candidate:t});this.getToMCUPeerConnection().addIceCandidate(o,h,m);var i=new RTCIceCandidate({sdpMLineIndex:1,sdpMid:n,candidate:t});this.getToMCUPeerConnection().addIceCandidate(i,h,m),"firefox"==webrtcDetectedBrowser&&(this.getToMCUPeerConnectionForFirefox().addIceCandidate(o,h,m),this.getToMCUPeerConnectionForFirefox().addIceCandidate(i,h,m))},f.prototype.addSdp=function(e,r,n,o){this.getToMCUPeerConnection().msgQueue.unshift(t("add",e,r,n,o))},f.prototype.updateSdp=function(e,r,n){"firefox"==webrtcDetectedBrowser?this.getToMCUPeerConnectionForFirefox().msgQueue.unshift(t("update",e,r,n)):this.getToMCUPeerConnection().msgQueue.unshift(t("update",e,r,n))},f.prototype.reduceSdp=function(e,r,n){this.getToMCUPeerConnection().msgQueue.unshift(t("reduce",e,r,n))},f.prototype.isContainsReconnectionSub=function(e,t){var r=!1;if(null!=t&&t.length>0)for(var n=0;n<t.length;n++)if(e==t[n]){r=!0;break}return r};var h=function(){},m=function(e){log.error("onAddIceCandidateError(),Failed to add remote candidate: "+e.toString())};return f}),ModuleBase.define("TraceableP2PPeerConnection",["Error"],function(e){function t(){}function r(){}function n(e,t){var r=e,n=r.split("\r\n");if(n.length>9){var o="";if(n[4].indexOf(t)>0)for(i=0;i<9;i++)""==o?o=n[i]:o+="\r\n"+n[i];else for(var i=9;i<18;i++)""==o?o=n[i]:o+="\r\n"+n[i];return o}return r}function o(e,t,r,n,o){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=n,i.para4=o,i}function i(e){if("default"!=e.id){var t=room.selfUser.subVideoStream2ResourceInfo[e.id],r=room.selfUser.getUserByVideoStreamLabel(e.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var n=room.selfUser.subScreenStream2ResourceInfo[e.id],o=room.selfUser.getUserByScreenStreamLabel(e.id);null!=o&&(delete room.selfUser.subScreenStream2ResourceInfo[e.id],o.eventEmitter.emit(UserCallback.unsubscrible_screen_result,o.id,o.name,n.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.id],s=room.selfUser.getUserByAudioStreamLabel(e.id);null!=s&&(s.getAudio(i.resource_id).stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.id],s.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,s.id,s.name))}}var s=function(){iceServers&&iceServers.length>0?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};s.prototype.getToP2PPeerConnection=function(e){var t=room.selfUser.toP2PPCs[e];return null==t&&(t=this.createP2PPeerConnection(e),room.selfUser.toP2PPCs[e]=t,room.selfUser.nodeId<e&&this.sendOfferP2P(t,e)),t},s.prototype.createP2PPeerConnection=function(e){var t=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleP2PPeerConnection(e,t),t},s.prototype.sendOfferP2P=function(e,n,o){var i=this.constraints;i.iceRestart=1==o;var s=this;e.createOffer(function(o){log.debug("sendOfferP2P(): P2P  local sessionDescription:"+o.sdp),e.setLocalDescription(o,t,r),room.masterServer.sendOfferP2P(o.sdp,n),s.constraints.iceRestart=!1},function(e){},i)},s.prototype.setRemoteP2P=function(e){var n={};n.sdp=e.sdp,n.type="offer";var o=new RTCSessionDescription(n);room.sdp=n.sdp,log.debug("setRemoteP2P(): P2P  session Description:"+n.sdp);var i=this.getToP2PPeerConnection(e.node_id);i.setRemoteDescription(o,function(){log.info("setRemoteP2P(): P2P  Set remote session description success."),i.createAnswer(function(n){log.debug("setRemoteP2P(): createAnswer  P2P  local sessionDescription:"+n.sdp),i.setLocalDescription(n,t,r),room.masterServer.setRemoteP2P(n.sdp,e.node_id)},function(e){log.error("setRemoteP2P(): createAnswer  P2P  local sessionDescription false.event:"+e)},this.constraints)},function(e){log.error("setRemoteP2P(): P2P  Set remote session description false.event:"+e)})},s.prototype.setAnswerP2P=function(e){var t={};t.sdp=e.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("setAnswerP2P():  P2P  session Description:"+t.sdp),this.getToP2PPeerConnection(e.node_id).setRemoteDescription(r,function(){log.debug("setAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("setAnswerP2P(): P2P  Set remote session description false.event:"+e)})},s.prototype.addIceCandidateP2P=function(e){var t=this.getToP2PPeerConnection(e.node_id);log.debug("addIceCandidateP2P(), P2P candidate:"+e.candidate);var r=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid,candidate:e.candidate});t.addIceCandidate(r,l,u)},s.prototype.addStreamP2P=function(e){var t=this.getToP2PPeerConnection(e.sub_node_id),r=e.info.resource_id;if(1==e.info.stream.type){var n=room.splitPDUDeviceId(r),o=room.selfUser.getVideo(n).stream;null!=o&&(t.addStream(o),room.selfUser.subMyVideosP2P.push(e.sub_node_id))}else if(2==e.info.stream.type){var n=room.splitPDUDeviceId(r),i=room.selfUser.getAudio(n).stream;null!=i&&(t.addStream(i),room.selfUser.subMyAudiosP2P.push(e.sub_node_id))}else if(3==e.info.stream.type){var n=room.splitPDUDeviceId(r),s=room.selfUser.getScreen(n).stream;null!=s&&(t.addStream(s),room.selfUser.subMyScreensP2P.push(e.sub_node_id))}},s.prototype.sendSubSdpOfferP2P=function(e,t){var r;"offerSub"==e?r=this.getToP2PPeerConnection(t.info.owner_id):"answerSub"==e&&(r=this.getToP2PPeerConnection(t.sub_node_id)),r.msgQueue.unshift(o("sub",r,e,t,null))},s.prototype.sendSubSdpAnswerP2P=function(e,o,i,s,l,u){var c=l.stream.sdp,d={};d.sdp=c,d.type="offer";var p=new RTCSessionDescription(d);log.debug("sendSubSdpAnswerP2P(), P2P remote sessionDescription:"+d.sdp),log.debug("sendSubSdpAnswerP2P(): P2P  signalingState: "+o.signalingState),o.setRemoteDescription(p,function(){log.debug("sendSubSdpAnswerP2P(): P2P  Set remote session description success."),room.selfUser.sdpP2PMap[l.owner_id]=c;var s,d=new SdpSerializer(c);"video"==i?(s=n(s=d._inner.video.ssrcStr,l.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add video sdp:"+s),room.selfUser.videoSdpSsrcMapP2PMap[l.owner_id]=s):"audio"==i?(s=d._inner.audio.ssrcStr,log.debug("sendSubSdpAnswerP2P(), new add audio sdp:"+s),room.selfUser.audioSdpSsrcP2PMap[l.owner_id]=s):"desktop"==i&&(s=n(s=d._inner.video.ssrcStr,l.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add screen sdp:"+s),room.selfUser.screenSdpSsrcP2PMap[l.owner_id]=s),o.createAnswer(function(n){log.debug("sendSubSdpAnswerP2P(), P2P local sessionDescription:"+n.sdp),o.setLocalDescription(n,t,r),room.masterServer.sendSubSdpAnswerP2P(e,l,n.sdp,u)},a,this.constraints)},function(e){log.error(e)})},s.prototype.getSubSdpAnswerP2P=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2P(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.sub_node_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2P(): P2P  Set remote session description false.event:"+e)})},s.prototype.getSubSdpAnswerP2PByRep=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2PByRep(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.info.owner_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2PByRep(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2PByRep(): P2P  Set remote session description false.event:"+e)})},s.prototype.removeStreamP2P=function(e,t,r){var n=this.getToP2PPeerConnection(t);"video"==e?null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove video  stream")):"audio"==e?null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove audio  stream")):"screen"==e&&null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove screen  stream"))},s.prototype.sendUnSubSdpOfferP2P=function(e,t,r,n){var i=this.getToP2PPeerConnection(r);null!=i&&"closed"!=i.signalingState&&i.msgQueue.unshift(o("unsub",i,e,t,n))},s.prototype.sendUnSubSdpAnswerP2P=function(e,t,n,o){var i,s=this.getToP2PPeerConnection(n),l={};if("unsubAnswer"==e){var u,c=o.stream.stream_name;"video"==t?u=room.selfUser.videoSdpSsrcMapP2PMap[o.owner_id]:"audio"==t?u=room.selfUser.audioSdpSsrcP2PMap[o.owner_id]:"screen"==t&&(u=room.selfUser.screenSdpSsrcP2PMap[o.owner_id]);for(var d=room.selfUser.sdpP2PMap[o.owner_id],p=u.split("\r\n"),f=0;f<p.length;f++){var h=p[f]+"\r\n";d=d.replace(h,"")}d.indexOf(c)>0&&(d=d.replace(c,"")),room.selfUser.sdpP2PMap[o.owner_id]=d,l.sdp=d,l.type="offer",i=new RTCSessionDescription(l)}else"unpubAnswer"==e&&(l.sdp=s.remoteDescription.sdp,l.type="offer",i=new RTCSessionDescription(l));log.debug("sendUnSubSdpAnswerP2P(): P2P  Remote sessionDescription:"+i.sdp),s.setRemoteDescription(i,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error(e)}),s.createAnswer(function(e){room.sdp=e.sdp,log.debug("sendUnSubSdpAnswerP2P(): P2P  local sessionDescription:"+room.sdp),s.setLocalDescription(e,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set local session description success.")},r)},a,this.constraints)},s.prototype.handleP2PPeerConnection=function(e,t){var r=when.defer();return t.msgQueue=[],t.forLog=!1,t.nodeId=e,t.onicecandidate=function(t){t.candidate?(log.debug("onicecandidate(),P2P event.candidate.candidate :"+t.candidate.candidate),room.masterServer.sendCandidateMsgP2P(t.candidate,e)):log.debug("P2P  End of candidates.")},t.onopen=function(){},t.onaddstream=function(e){if(log.debug("onaddstream(), P2P  stream id:"+e.stream.id),"default"!=e.stream.id)if(e.stream.getVideoTracks().length>0){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(), P2P  stream type: video");(n=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);n.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,n.id,n.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), P2P  stream type: screen");(n=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);n.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,n.id,n.name,r.resource_id)}}else if(e.stream.getAudioTracks().length>0){log.debug("onaddstream(), P2P  stream type: audio");var t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],n=room.selfUser.getUserByAudioStreamLabel(e.stream.id);n.getAudio(t.resource_id).stream=e.stream,n.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,n.id,n.name)}},t.onremovestream=function(e){i(e.stream)},t.ondatachannel=function(e){},t.oniceconnectionstatechange=function(e){var r=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),P2P iceConnectionState :"+r),r){case"disconnected":room.isMcu()||room.selfUser.nodeId<t.nodeId&&(log.debug("=======PeerConnection reconnection，send off.  self user nodeId:"+room.selfUser.nodeId+" ----\x3e download user nodeId:"+t.nodeId),room.traceableP2PPeerConnection.sendOfferP2P(t,t.nodeId,!0))}},t.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), P2P signalingState :"+e.target.signalingState),"stable"==e.target.signalingState&&0==t.forLog&&(t.forLog=!0,t.intervalSet(t))},t.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},t.processSignalingMessage=function(e){if("stable"==e.signalingState&&e.msgQueue.length>0){var t=e.msgQueue.shift();log.debug("P2P 操作对列:"+t.operationType),"sub"==t.operationType?room.traceableP2PPeerConnection.sendSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4):"unsub"==t.operationType&&room.traceableP2PPeerConnection.sendUnSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4)}},r.promise},s.prototype.sendSubSdpOfferP2PHandle=function(e,n,o){e.createOffer(function(i){log.debug("sendSubSdpOfferP2P():  P2P  local sessionDescription:"+i.sdp),room.sdp=i.sdp,e.setLocalDescription(i,t,r),room.masterServer.sendSubSdpOfferP2P(o,i.sdp,n)},a,this.constraints)},s.prototype.sendUnSubSdpOfferP2PHandle=function(e,t,n,o){e.createOffer(function(s){log.debug("sendUnSubSdpOfferP2PHandle(): P2P  local sessionDescription:"+s.sdp),e.setLocalDescription(s,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set local session description success.");var r={};if("unpubOffer"==t){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unpubOffer"),r.sdp=e.remoteDescription.sdp,r.type="answer";var s=new RTCSessionDescription(r)}else if("unsubOffer"==t){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unsubOffer");var a,l=e.remoteDescription.sdp,u=new SdpSerializer(l);"video"==n?a=u._inner.video.ssrcStr:"audio"==n?a=u._inner.audio.ssrcStr:"screen"==n&&(a=u._inner.video.ssrcStr);for(var c=a.split("\r\n"),d=0;d<c.length;d++){var p=c[d]+"\r\n";l=l.replace(p,"")}var f=o.stream.stream_name;l.indexOf(f)>0&&(l=l.replace(f,"")),r.sdp=l,r.type="answer",s=new RTCSessionDescription(r)}log.debug("sendUnSubSdpOfferP2PHandle(): P2P  remote  sessionDescription:"+r.sdp),e.setRemoteDescription(s,function(){if(log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description success."),"unsubOffer"==t){var r=e.getRemoteStreams();if(r.length>0)for(d=0;d<r.length;d++){var n=r[d];"default"!=n.id&&(n.onremovetrack=function(e){i(n)})}}},function(e){log.error("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description false.event:"+e)})},r)},a,this.constraints)};var a=function(){},l=function(){},u=function(e){log.error("onAddIceCandidateError(),Failed to add remote  P2P  candidate: "+e.toString())};return s}),ModuleBase.define("SignalFactory",["TraceableWebsocket"],function(e){var t=function(){};return t.prototype.getDataChannel=function(t){var r;switch(t){case SignalType.websocket:r=new e}return r},t}),ModuleBase.define("MessageManager",["CmdProtobufCoded","User","Error"],function(e,t,r){function n(e,t){var r=room.getUserByNodeId(e),n=new Object,o=new Date;return o.setMinutes(o.getMinutes()+o.getTimezoneOffset()),n.timestamp=o.getTime(),n.fromId=r.id,n.fromName=r.name,n.message=t,n}var o=function(){};return o.prototype.OnWebSocketMessage=function(o){var i;null==room.cmdProtobufCoded?(i=new e,room.cmdProtobufCoded=i):i=room.cmdProtobufCoded;var s=i.getRoomPduTypeEnum(),a=i.getMediaTypeEnum(),l=i.getResourceStatusEnum(),u=i.getResourceOptEnum(),c=i.decodePacket(o);switch(c.type){case s.OPEN_REP:var d=i.decodeBody(o);if(0==d.result)log.info("======openRep.result：0=========="),room.reconnectionState?(log.debug("======OPEN_REP：重连成功======="),room.reconnectionState=!1,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle()):(log.debug("======OPEN_REP：连接成功======="),room.pingInterval=d.ping_interval,room.pingTimeout=d.ping_timeout,room.signalTocken=d.signal_tocken,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle(),room.masterServer.inviteRoomReqSend()),room.reconnectionOpenRep402=!1,room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected);else if(402==d.result)log.info("======openRep.result：402=========="),room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed);else{log.info("OPEN_REP,openRep.result: "+d.result+",openRep.description:"+d.description),room.reconnectionState=!1;y=new r(d.result,d.description);room.eventEmitter.emit(EngineCallback.room_join_error,y)}break;case s.PONG:room.pingCountTime=0;break;case s.INVITE_ROOM_REP1:var p=i.decodeBody(o);if(0==p.result){if(room.fingerPrint=p.finger_print,room.setup=p.setup,"firefox"==webrtcDetectedBrowser){var f=p.ice_ufrag.split(":"),h=p.ice_pwd.split(":");room.iceUfrag=f[0],room.icePwd=h[0],room.iceUfragForFirefox=f[1],room.icePwdForFirefox=h[1]}else room.iceUfrag=p.ice_ufrag,room.icePwd=p.ice_pwd;if(room.roomTocken=p.room_tocken,room.roomInfo=p.room_info,room.masterServer.sendOffer(),0==room.reconnectionCount){room.selfUser.nodeId=p.node_id,room.selfUser.role=1,null!=p.role&&(room.selfUser.role=p.role);g=room.avdEngine.cameraMap;for(var m in g){v=g[m];room.selfUser.initVideo(m,v)}null!=room.avdEngine.checkMicrophoneId&&room.selfUser.initAudio(room.avdEngine.checkMicrophoneId,room.avdEngine.checkMicrophoneName),room.selfUser.initScreen(),room.addUser(room.selfUser),log.info("join room  Success! your nodeId:"+room.selfUser.nodeId+"; roomId:"+room.id)}else{var g=room.avdEngine.cameraMap;for(var m in g){var v=g[m];room.selfUser.initVideo(m,v)}null!=room.avdEngine.checkMicrophoneId&&room.selfUser.initAudio(room.avdEngine.checkMicrophoneId,room.avdEngine.checkMicrophoneName),room.selfUser.initScreen(),room.selfUser.reconnectionSubVideoIds=room.selfUser.subVideoIds.slice(0),room.selfUser.reconnectionSubAudioIds=room.selfUser.subAudioIds.slice(0),room.selfUser.reconnectionSubScreenIds=room.selfUser.subScreenIds.slice(0),room.selfUser.reconnectionUsers.push(room.selfUser),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected),log.info("reconnection,join room  Success!"),room.traceablePeerConnection.close(room.selfUser.toMCUPC),room.selfUser.toMCUPC=room.toMCUReconnectionPC,"firefox"==webrtcDetectedBrowser&&(room.traceablePeerConnection.close(room.selfUser.toMCUPCForFirefox),room.selfUser.toMCUPCForFirefox=room.toMCUReconnectionPCForFirefox),setTimeout(function(){for(var e in room.selfUser.videos){var t=room.selfUser.videos[e];if(t.status==StreamStatus.published){var r=t.stream.clone();t.stream=r,t.publish()}}var n=room.selfUser.screen;null!=n&&n.status==StreamStatus.published&&n.publish();var o=room.selfUser.audio;null!=o&&o.status==StreamStatus.published&&o.openMicrophone()},2e3),setTimeout(function(){var e=arrayUtil.chajiObject(room.participants,room.selfUser.reconnectionUsers);if(null!=e&&e.length>0)for(var t=0;t<e.length;t++){var r=e[t],n=room.getUserByNodeId(r);null!=n&&(room.removeUser(n.id),room.eventEmitter.emit(RoomCallback.user_leave_notify,1,null,n))}room.reconnectionCount=0,room.selfUser.reconnectionUsers=[]},2e4)}room.eventEmitter.emit(EngineCallback.room_join_success,room);break}log.info("INVITE_ROOM_REP1,inviteRoomRep1.result: "+p.result+",inviteRoomRep1.description:"+p.description);var y=new r(p.result,p.description);room.eventEmitter.emit(EngineCallback.room_join_error,y);break;case s.CANDIDATE_MSG1:ce=i.decodeBody(o);log.info("mcu send  CANDIDATE_MSG1:"+ce.candidate),"firefox"==webrtcDetectedBrowser?setRemoteDescriptionSuccess&&setRemoteDescriptionSuccessForFirefox?room.masterServer.setAddIcecandidate(ce):addIcecandidateList.push(ce):setRemoteDescriptionSuccess?room.masterServer.setAddIcecandidate(ce):addIcecandidateList.push(ce);break;case s.ROOM_RESOURCE_INFOS:var b=i.decodeBody(o).resource_infos;for(var m in b)switch((q=b[m]).stream.type){case a.video:log.info("accept video  JOIN_REP(PUB_ROOM_RESOURCE): "+q.owner_id+"------\x3e"+room.selfUser.nodeId),(O=room.traceablePeerConnection.isContainsReconnectionSub(q.resource_id,room.selfUser.subVideoIds))?((z=(Z=room.getUserByNodeId(q.owner_id)).getVideo(q.resource_id)).resourceInfo=q,z.subscrible()):(null==(z=(Z=room.getUserByNodeId(q.owner_id)).getVideo(q.resource_id))&&(z=Z.createVideo(q.resource_id,"")),z.resourceInfo=q,z.ownerId=Z.id,room.pubVideos.push(z),(D=[]).push(z),Z.eventEmitter.emit(UserCallback.camera_status_notify,z.status,z.id,z.name,Z.id),Z.eventEmitter.emit(UserCallback.publish_camera_notify,D));break;case a.audio:log.info("accept audio  JOIN_REP(PUB_ROOM_RESOURCE): "+q.owner_id+"------\x3e"+room.selfUser.nodeId),(O=room.traceablePeerConnection.isContainsReconnectionSub(q.resource_id,room.selfUser.subAudioIds))?room.masterServer.audioSubscribleHandle(q):(null==(X=(Z=room.getUserByNodeId(q.owner_id)).getAudio(q.resource_id))&&(X=Z.createAudio(q.resource_id,"")),X.resourceInfo=q,room.pubAudios.push(X),room.selfUser.subAudioStream2ResourceInfo[q.stream.stream_name]=q,room.selfUser.subAudioIds.push(X.id),room.masterServer.audioSubscribleHandle(q),Z.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,Z.id));break;case a.desktop:log.info("accept desktop  JOIN_REP(PUB_ROOM_RESOURCE): "+q.owner_id+"------\x3e"+room.selfUser.nodeId),(O=room.traceablePeerConnection.isContainsReconnectionSub(q.resource_id,room.selfUser.subScreenIds))?((H=(Z=room.getUserByNodeId(q.owner_id)).getScreen(q.resource_id)).resourceInfo=q,H.subscrible()):(null==(H=(Z=room.getUserByNodeId(q.owner_id)).getScreen(q.resource_id))&&(H=Z.createScreen(q.resource_id,"")),H.resourceInfo=q,H.ownerId=Z.id,room.pubScreens.push(H),(N=[]).push(H),Z.eventEmitter.emit(UserCallback.screen_status_notify,H.status,H.id,H.name,Z.id),Z.eventEmitter.emit(UserCallback.publish_screen_notify,N))}break;case s.USER_INFO_MSG:log.debug("messageManager: roomPduType.USER_INFO_MSG");var S=i.decodeBody(o);if(null==S)return;var w=[];S.user.forEach(function(e){var r=new t(e.user_id,e.user_name,null,null);r.nodeId=e.node_id,r.role=e.role,r.data=e.user_data,room.reconnectionCount>0&&room.selfUser.reconnectionUsers.push(r),e.webcams.forEach(function(e){var t=r.createVideo(e.id,e.name);t.status=e.status,t.cameraType=e.ctype,t.level=e.level,t.description=e.description}),e.speakers.forEach(function(e){r.createAudio(e.id,e.name).status=e.status}),e.desktops.forEach(function(e){var t=r.createScreen(e.id,e.name);t.status=e.status,t.level=e.level,t.description=e.description}),room.hasUser(r.id)||(room.addUser(r),w.push(r)),room.isMcu()||room.p2pServer.createP2PPeerConnection(r.nodeId)}),room.eventEmitter.emit(RoomCallback.user_join_notify,w);break;case s.ADD_WEBCAM_MSG:log.debug("messageManager: roomPduType.ADD_WEBCAM_MSG");var E=i.decodeBody(o);if(Z=room.getUserByNodeId(E.node_id)){var C=E.webcam;(z=Z.createVideo(C.id,C.name)).status=C.status,z.cameraType=C.ctype,z.level=C.level,z.description=C.description,Z.eventEmitter.emit(UserCallback.camera_status_notify,C.status,C.id,C.name,Z.id)}break;case s.ADD_SPEAKER_MSG:log.debug("messageManager: roomPduType.ADD_SPEAKER_MSG");var P=i.decodeBody(o);if(Z=room.getUserByNodeId(P.node_id)){var T=P.speaker;(X=Z.createAudio(T.id,T.name)).status=T.status,Z.eventEmitter.emit(UserCallback.microphone_status_notify,T.status,T.id,T.name,Z.id)}break;case s.ADD_DESKTOP_MSG:log.debug("messageManager: roomPduType.ADD_DESKTOP_MSG");var I=i.decodeBody(o);if(Z=room.getUserByNodeId(I.node_id)){var R=I.desktop;(H=Z.createScreen(R.id,R.name)).status=R.status,H.level=R.level,H.description=R.description,Z.eventEmitter.emit(UserCallback.screen_status_notify,R.status,R.id,R.name,Z.id)}break;case s.REMOVE_WEBCAM_MSG:var _=i.decodeBody(o),x=(Z=room.getUserByNodeId(_.node_id)).getVideo(_.resource_id);Z.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,x.id,x.name,Z.id),arrayUtil.objectSplice(Z.videos,_.resource_id);break;case s.REMOVE_SPEAKER_MSG:var M=i.decodeBody(o);(Z=room.getUserByNodeId(M.node_id)).eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,Z.audio.id,Z.audio.name,Z.id),Z.audio.id==M.resource_id&&(Z.audio=null);break;case s.REMOVE_DESKTOP_MSG:var U=i.decodeBody(o);(Z=room.getUserByNodeId(U.node_id)).eventEmitter.emit(UserCallback.screen_status_notify,StreamStatus.none,Z.screen.id,Z.screen.name,Z.id),Z.screen.id==U.resource_id&&(Z.screen=null);break;case s.UPDATE_SPEAKER_MSG:var A=i.decodeBody(o);(X=(Z=room.getUserByNodeId(A.node_id)).getAudio(A.resource_id)).status=A.speaker.status,Z.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,Z.id);break;case s.UPDATE_WEBCAM_MSG:var L=i.decodeBody(o);(z=(Z=room.getUserByNodeId(L.node_id)).getVideo(L.resource_id)).level=L.webcam.level,z.description=L.webcam.description,Z.eventEmitter.emit(UserCallback.camera_data_notify,z.level,z.description,z.id,z.name,Z.id);break;case s.UPDATE_DESKTOP_MSG:var k=i.decodeBody(o);(H=(Z=room.getUserByNodeId(k.node_id)).getScreen(k.resource_id)).level=k.desktop.level,H.description=k.desktop.description,Z.eventEmitter.emit(UserCallback.screen_data_notify,H.level,H.description,H.id,H.name,Z.id);break;case s.PUB_ROOM_RESOURCE_MSG:if((q=i.decodeBody(o).info).stream.type==a.video)if(log.info("accept video  PUB_ROOM_RESOURCE_MSG: "+q.owner_id+"------\x3e"+room.selfUser.nodeId),O=room.traceablePeerConnection.isContainsReconnectionSub(q.resource_id,room.selfUser.reconnectionSubVideoIds))(z=(Z=room.getUserByNodeId(q.owner_id)).getVideo(q.resource_id)).resourceInfo=q,z.subscrible();else{var D=[];null==(z=(Z=room.getUserByNodeId(q.owner_id)).getVideo(q.resource_id))&&(z=Z.createVideo(q.resource_id,"")),z.resourceInfo=q,z.status=StreamStatus.published,z.ownerId=Z.id,D.push(z),room.pubVideos.push(z),Z.eventEmitter.emit(UserCallback.camera_status_notify,z.status,z.id,z.name,Z.id),Z.eventEmitter.emit(UserCallback.publish_camera_notify,D)}else if(q.stream.type==a.audio)log.info("accept audio  PUB_ROOM_RESOURCE_MSG: "+q.owner_id+"------\x3e"+room.selfUser.nodeId),null==(X=(Z=room.getUserByNodeId(q.owner_id)).getAudio(q.resource_id))&&(X=Z.createAudio(q.resource_id,"")),X.resourceInfo=q,X.status=StreamStatus.published,room.pubAudios.push(X),Z.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,Z.id),room.selfUser.subAudioStream2ResourceInfo[q.stream.stream_name]=q,room.selfUser.subAudioIds.push(X.id),room.masterServer.audioSubscribleHandle(q);else if(q.stream.type==a.desktop){log.info("accept screen  PUB_ROOM_RESOURCE_MSG: "+q.owner_id+"------\x3e"+room.selfUser.nodeId);var O=room.traceablePeerConnection.isContainsReconnectionSub(q.resource_id,room.selfUser.reconnectionSubScreenIds);if(O)(H=(Z=room.getUserByNodeId(q.owner_id)).getScreen(q.resource_id)).resourceInfo=q,H.subscrible();else{var N=[];null==(H=(Z=room.getUserByNodeId(q.owner_id)).getScreen(q.resource_id))&&(H=Z.createScreen(q.resource_id,"")),H.resourceInfo=q,H.status=StreamStatus.published,H.ownerId=Z.id,N.push(H),room.pubScreens.push(H),Z.eventEmitter.emit(UserCallback.screen_status_notify,H.status,H.id,H.name,Z.id),Z.eventEmitter.emit(UserCallback.publish_screen_notify,N)}}break;case s.PUB_ROOM_RESOURCE_MSG_REP:var F=i.decodeBody(o),B=F.id,j=F.result,V=F.description;if(0==j)room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_success,B);else{log.info("pubRoomResourceMsgRep.result: "+j+",pubRoomResourceMsgRep.description:"+V);var W=new r(j,V);room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_error,W,B)}break;case s.UNPUB_ROOM_RESOURCE_MSG:var q=i.decodeBody(o).info;if(q.stream.type==a.video)log.info("accept video  UNPUB_ROOM_RESOURCE_MSG: "+q.owner_id+"------\x3e"+room.selfUser.nodeId),(z=(Z=room.getUserByNodeId(q.owner_id)).getVideo(q.resource_id)).status=l.init,Z.eventEmitter.emit(UserCallback.camera_status_notify,z.status,z.id,z.name,Z.id),Z.eventEmitter.emit(UserCallback.unpublish_camera_notify,z),arrayUtil.objectSplice(room.pubVideos,q.resource_id);else if(q.stream.type==a.audio)log.info("accept audio  UNPUB_ROOM_RESOURCE_MSG: "+q.owner_id+"------\x3e"+room.selfUser.nodeId),(X=(Z=room.getUserByNodeId(q.owner_id)).getAudio(q.resource_id)).status=l.init,Z.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,Z.id),arrayUtil.baseSplice(room.selfUser.subAudioIds,this.id),room.masterServer.audioUnsubscribleHandle(q),arrayUtil.objectSplice(room.pubAudios,q.resource_id);else if(q.stream.type==a.desktop){log.info("accept screen  UNPUB_ROOM_RESOURCE_MSG: "+q.owner_id+"------\x3e"+room.selfUser.nodeId);var H=(Z=room.getUserByNodeId(q.owner_id)).getScreen(q.resource_id);H.status=l.init,Z.eventEmitter.emit(UserCallback.screen_status_notify,H.status,H.id,H.name,Z.id),Z.eventEmitter.emit(UserCallback.unpublish_screen_notify,H),arrayUtil.objectSplice(room.pubScreens,q.resource_id)}break;case s.VIDEO_INDICTION:var G=i.decodeBody(o),Y=room.splitPDUDeviceId(G.resource_id),z=room.selfUser.getVideo(Y);G.opt==u.pub?z.publish():G.opt==u.unpub&&z.unpublish();break;case s.AUDIO_INDICTION:var G=i.decodeBody(o),$=room.splitPDUDeviceId(G.resource_id),X=room.selfUser.getAudio($);G.opt==u.pub?X.openMicrophone():G.opt==u.unpub&&X.closeMicrophone();break;case s.PUBLIC_TEXT_MSG:var K=i.decodeBody(o),J=n(c.src,K.content);room.eventEmitter.emit(RoomCallback.public_message,J);break;case s.PRIVATE_TEXT_MSG:var K=i.decodeBody(o),J=n(c.src,K.content);room.eventEmitter.emit(RoomCallback.private_message,J);break;case s.PUBLIC_DATA:var Q=i.decodeBody(o),Z=room.getUserByNodeId(c.src);room.eventEmitter.emit(RoomCallback.public_data,Q.content.toArrayBuffer(),Z.id);break;case s.PRIVATE_DATA:var Q=i.decodeBody(o),Z=room.getUserByNodeId(c.src);room.eventEmitter.emit(RoomCallback.private_data,Q.content.toArrayBuffer(),Z.id);break;case s.UPDATE_USER_DATA_MSG:var ee=i.decodeBody(o);(Z=room.getUserByNodeId(ee.node_id)).data=ee.user_data,room.eventEmitter.emit(RoomCallback.user_data_notify,ee.user_data,Z.id);break;case s.ROOM_DATA_INFO:var te=i.decodeBody(o);room.eventEmitter.emit(RoomCallback.app_data_notify,te.kvs);var re=te.kvs;if(null!=re)for(var ne=0;ne!=re.length;++ne){var oe=re[ne];room.appData[oe.key]=oe.value}break;case s.USER_INDICTION:var ie=i.decodeBody(o);if(ie.type==s.USER_MSG){var se=i.decodeUserMsg(ie.body),ae=room.getUserId(ie.operator_id);room.eventEmitter.emit(RoomCallback.leave_indication,se.reason,ae);room.leave(se.reason,!0)}break;case s.USER_MSG:se=i.decodeBody(o);if(null!=(Z=room.getUserByNodeId(se.node_id))){if(null!=Z.videos&&Z.videos.length>0)for(var m in Z.videos){z=Z.videos[m];null!=room.pubVideos&&room.pubVideos.length>0&&arrayUtil.objectSplice(room.pubVideos,z.id),null!=room.selfUser.subVideoIds&&room.selfUser.subVideoIds.length>0&&arrayUtil.baseSplice(room.selfUser.subVideoIds,z.id)}return null!=Z.audio&&(null!=room.pubAudios&&room.pubAudios.length>0&&arrayUtil.objectSplice(room.pubAudios,Z.audio.id),null!=room.selfUser.subAudioIds&&room.selfUser.subAudioIds.length>0&&arrayUtil.baseSplice(room.selfUser.subAudioIds,Z.audio.id)),null!=Z.screen&&(null!=room.pubScreens&&room.pubScreens.length>0&&arrayUtil.objectSplice(room.pubScreens,Z.screen.id),null!=room.selfUser.subScreenIds&&room.selfUser.subScreenIds.length>0&&arrayUtil.baseSplice(room.selfUser.subScreenIds,Z.screen.id)),room.removeUser(Z.id),void room.eventEmitter.emit(RoomCallback.user_leave_notify,se.opt,se.reason,Z)}null!=room.selfUser&&se.node_id==room.selfUser.nodeId&&(room.selfUser.mulLanding=!0,room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.leave_indication,ErrorConstant.mulLanding_error.message,room.selfUser.id));break;case s.OFFER_REQ:log.debug("P2P acception Offer,send answer");var le=i.decodeBody(o);room.traceableP2PPeerConnection.setRemoteP2P(le);break;case s.OFFER_REP:log.debug("P2P acception OFFER_REP");var ue=i.decodeBody(o);room.traceableP2PPeerConnection.setAnswerP2P(ue);break;case s.CANDIDATE_MSG:log.debug("P2P acception candidate,send candidate");var ce=i.decodeBody(o);room.traceableP2PPeerConnection.addIceCandidateP2P(ce);break;case s.SUB_ROOM_RESOURCE_REQ:log.debug("P2P acception SUB_ROOM_RESOURCE_REQ");var de=i.decodeBody(o);if(room.selfUser.nodeId>de.sub_node_id){room.traceableP2PPeerConnection.addStreamP2P(de);var pe=de.info,fe=room.traceableP2PPeerConnection.getToP2PPeerConnection(de.sub_node_id);pe.stream.type==a.video?(log.info("accept video P2P SUB_ROOM_RESOURCE_REQ: "+de.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subVideoStream2ResourceInfo[pe.stream.stream_name]=pe,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",fe,"video",1,pe,de.sub_node_id)):pe.stream.type==a.audio?(log.info("accept audio P2P SUB_ROOM_RESOURCE_REQ: "+de.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subAudioStream2ResourceInfo[pe.stream.stream_name]=pe,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",fe,"audio",1,pe,de.sub_node_id)):pe.stream.type==a.desktop&&(log.info("accept desktop P2P  SUB_ROOM_RESOURCE_REQ: "+de.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subScreenStream2ResourceInfo[pe.stream.stream_name]=pe,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",fe,"desktop",1,pe,de.sub_node_id))}else room.traceableP2PPeerConnection.addStreamP2P(de),room.traceableP2PPeerConnection.sendSubSdpOfferP2P("answerSub",de);break;case s.SUB_ROOM_RESOURCE_REP:log.debug("P2P acception SUB_ROOM_RESOURCE_REP, TO sub");var he=i.decodeBody(o);if(room.selfUser.nodeId>he.info.owner_id){var pe=he.info,fe=room.traceableP2PPeerConnection.getToP2PPeerConnection(pe.owner_id);pe.stream.type==a.video?(room.selfUser.subVideoStream2ResourceInfo[pe.stream.stream_name]=pe,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",fe,"video",1,pe,pe.owner_id)):pe.stream.type==a.audio?(room.selfUser.subAudioStream2ResourceInfo[pe.stream.stream_name]=pe,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",fe,"audio",1,pe,pe.owner_id)):pe.stream.type==a.desktop&&(room.selfUser.subScreenStream2ResourceInfo[pe.stream.stream_name]=pe,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",fe,"desktop",1,pe,pe.owner_id))}else room.traceableP2PPeerConnection.getSubSdpAnswerP2PByRep(he);break;case s.SUB_ROOM_RESOURCE_MSG:log.debug("P2P acception SUB_ROOM_RESOURCE_MSG");var me=i.decodeBody(o);room.traceableP2PPeerConnection.getSubSdpAnswerP2P(me);break;case s.ANNOTATION_MSG:log.debug("acception ANNOTATION_MSG")}},o}),ModuleBase.define("User",["Video","Audio","Screen","Error"],function(e,t,r,n){var o=function(e,t,r,n){this.id=e,this.name=t,this.data=r,this.password=n,this.nodeId=null,this.role=null,this.videos=[],this.audio,this.screen,this.toMCUPC,this.toMCUPCForFirefox,this.mulLanding=!1,this.eventEmitter=new EventEmitter,this.videoSdpSsrc,this.audioSdpSsrc,this.screenSdpSsrc,this.subVideoStream2ResourceInfo={},this.subAudioStream2ResourceInfo={},this.subScreenStream2ResourceInfo={},this.subVideoIds=[],this.subAudioIds=[],this.subScreenIds=[],this.reconnectionSubVideoIds=null,this.reconnectionSubAudioIds=null,this.reconnectionSubScreenIds=null,this.reconnectionUsers=[],this.toP2PPCs={},this.sdpP2PMap={},this.videoSdpSsrcMapP2PMap={},this.audioSdpSsrcP2PMap={},this.screenSdpSsrcP2PMap={},this.subMyVideosP2P=[],this.subMyAudiosP2P=[],this.subMyScreensP2P=[]};return o.prototype.createVideo=function(t,r){var n=new e(t,r);return this.videos.push(n),n},o.prototype.createAudio=function(e,r){var n=new t(e,r);return this.audio=n,n},o.prototype.createScreen=function(e,t){var n=new r(e,t);return this.screen=n,n},o.prototype.initScreen=function(){var e="screen-"+this.id,t=this.name+"-screen",r=this.createScreen(e,t);r.level=0,r.description="",this.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,this.id);var n=room.composePDUDeviceId(this.id,e);room.masterServer.addScreenMsg(n,r)},o.prototype.initVideo=function(e,t){var r=this.createVideo(e,t);r.cameraType=CameraType.unknown,r.level=0,r.description="",this.eventEmitter.emit(UserCallback.camera_status_notify,r.status,r.id,r.name,this.id);var n=room.composePDUDeviceId(this.id,e);room.masterServer.addWebcamMsg(n,r)},o.prototype.deleteVideo=function(e){var t=this.getVideo(e);if(null!=t){t.status==StreamStatus.opened?t.unpreview():t.status==StreamStatus.published&&t.unpublish(),arrayUtil.objectSplice(this.videos,e),this.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,t.id,t.name,this.id);var r=room.composePDUDeviceId(this.id,e);room.masterServer.removeWebcamMsg(r)}},o.prototype.initAudio=function(e,t){var r=this.createAudio(e,t);room.avdEngine.checkAudioId=e,room.avdEngine.checkAudioName=t,this.eventEmitter.emit(UserCallback.microphone_status_notify,r.status,r.id,r.name,this.id);var n=room.composePDUDeviceId(this.id,e);room.masterServer.addSpeakerMsg(n,r)},o.prototype.deleteAudio=function(e){var t=this.getAudio(e);if(null!=t){t.status==StreamStatus.published&&video.closeMicrophone(),this.audio=null,this.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,t.id,t.name,this.id);var r=room.composePDUDeviceId(this.id,e);room.masterServer.removeSpeakerMsg(r)}},o.prototype.getVideo=function(e){for(var t=null,r=0;r<this.videos.length;r++){var n=this.videos[r];if(n.id==e){t=n;break}}return t},o.prototype.getScreen=function(e){void 0===e&&(e="screen-"+this.id);var t=null;return null!=this.screen&&this.screen.id==e&&(t=this.screen),t},o.prototype.getAudio=function(e){var t=null;return null!=this.audio&&this.audio.id==e&&(t=this.audio),t},o.prototype.openCameraAndMicrophone=function(e,t,r,o){var i=when.defer(),s=this;return null!=e&&null==t?e.publish():null==e&&null!=t?t.openMicrophone():null!=e&&null!=t&&obtainUserMedia(t,e,function(n){var a=getRandomNum(1,3e3);e.status=StreamStatus.opened,e.stream=n.videoStream;var l=room.composePDUDeviceId(s.id,e.id);room.masterServer.videoPublishHandle(l,e.stream,a),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(t){t==a&&(e.element=r,attachMediaStream(r,n.videoStream),e.status=StreamStatus.published,room.pubVideos.push(e),s.eventEmitter.emit(UserCallback.camera_status_notify,e.status,e.id,e.name,s.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==a&&i.reject(e)});var u=getRandomNum(30001,6e3);t.state=StreamStatus.opened,t.stream=n.audioStream;var c=room.composePDUDeviceId(s.id,t.id);room.masterServer.audioPublishHandle(c,t.stream,u),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==u&&(t.element=o,attachMediaStream(o,n.audioStream),t.status=StreamStatus.published,room.pubAudios.push(t),s.eventEmitter.emit(UserCallback.microphone_status_notify,t.status,t.id,t.name,s.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==u&&i.reject(e)})},function(e){var t=new n(ErrorConstant.failed_access_localMedia);i.reject(t)}),i.promise},o.prototype.remotecmdPublishCamera=function(e){var t=room.splitUserId(e.id),r=room.getNodeId(t);room.masterServer.videoIndiction(!0,e.id,r)},o.prototype.remotecmdUnpublishCamera=function(e){var t=room.splitUserId(e),r=room.getNodeId(t);room.masterServer.videoIndiction(!1,e,r)},o.prototype.remotecmdOpenMicrophone=function(e){var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction(!0,t.audio.id,r)},o.prototype.remotecmdCloseMicrophone=function(e){var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction(!1,t.audio.id,r)},o.prototype.updateUserData=function(e){this.data=e,room.masterServer.updateUserDataMsg(e)},o.prototype.getUserData=function(e){if(void 0===e||null==e||""==e)return this.data;var t=room.getUser(e);return null!=t?t.data:void 0},o.prototype.attachVideoElementMediaStream=function(e,t){if(null!=t){var r=this.subVideoStream2ResourceInfo[t.id];this.getUserByVideoStreamLabel(t.id).getVideo(r.resource_id).element=e}attachMediaStream(e,t)},o.prototype.attachScreenElementMediaStream=function(e,t){if(null!=t){var r=this.subScreenStream2ResourceInfo[t.id];this.getUserByScreenStreamLabel(t.id).getScreen(r.resource_id).element=e}attachMediaStream(e,t)},o.prototype.attachAudioElementMediaStream=function(e,t){if(null!=t){var r=this.subAudioStream2ResourceInfo[t.id];this.getUserByAudioStreamLabel(t.id).getAudio(r.resource_id).element=e}attachMediaStream(e,t)},o.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},o.prototype.getUserByVideoStreamLabel=function(e){var t=this.subVideoStream2ResourceInfo[e];if(null!=t){var r=t.owner_id;return room.getUserByNodeId(r)}return null},o.prototype.getUserByAudioStreamLabel=function(e){var t=this.subAudioStream2ResourceInfo[e];if(null!=t){var r=t.owner_id;return room.getUserByNodeId(r)}return null},o.prototype.getUserByScreenStreamLabel=function(e){var t=this.subScreenStream2ResourceInfo[e];if(null!=t){var r=t.owner_id;return room.getUserByNodeId(r)}return null},o}),ModuleBase.define("Record",["RecordRestServer","Error"],function(e,t){var r=function(t){this.restServerURI=t,this.recordRestServer=new e,this.recordInfo={name:"",tag:"",roomId:"",userId:"",audioType:RecordEnum.AudioType.singleuser,videoType:RecordEnum.VideoType.mainflow,fileType:RecordEnum.FileType.mp4}};return r.prototype.createUserRecord=function(e,r){var n=when.defer();if(!r){o=new t(ErrorConstant.params_require);return n.reject(o),n.promise}if(""==r.roomId){o=new t(ErrorConstant.roomId_required);return n.reject(o),n.promise}if(""==r.userId){var o=new t(ErrorConstant.userId_required);return n.reject(o),n.promise}return this.recordRestServer.createUserRecord(this.restServerURI,e,r).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)}),n.promise},r.prototype.stopRecord=function(e,t){var r=when.defer();return this.recordRestServer.stopRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r.prototype.getRecord=function(e,t){var r=when.defer();return this.recordRestServer.getRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r.prototype.deleteRecord=function(e,t){var r=when.defer();return this.recordRestServer.deleteRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r.prototype.findRecords=function(e,t,r,n){var o=when.defer();return this.recordRestServer.findRecords(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},r}),ModuleBase.define("RecordRestServer",["Error"],function(e){var t=function(){};return t.prototype.createUserRecord=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/record/createUserRecord?accessToken="+r+"&callback=?";return console.log(i),$.ajax({type:"post",url:i,dataType:"jsonp",data:n,timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/record/createUserRecord) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.stopRecord=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/record/stop?id="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/record/stop) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.getRecord=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/record/getRecord?id="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/record/getRecord) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.deleteRecord=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/record/delete?id="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/record/delete) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.findRecords=function(t,r,n,o,i){var s=when.defer(),a=document.location.protocol+"//"+t+"/avd/api/record/findRecords?begin="+n+"&count="+o+"&filter="+i+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:a,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)s.resolve(t.data);else{var r=new e(t.result,t.err);s.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/record/findRecords) errorCode:"+t.status+",errorMsg:"+t.statusText);var o=new e(t.status,t.statusText);s.reject(o)}}),s.promise},t}),ModuleBase.define("Live",["LiveRestServer","Error"],function(e,t){var r=function(t){this.restServerURI=t,this.liveRestServer=new e,this.liveInfo={name:"",tag:"",roomId:"",userId:"",audioType:LiveEnum.AudioType.singleuser,videoType:LiveEnum.VideoType.mainflow,publishurl:"",rtmpurl:"",hlsurl:""}};return r.prototype.createUserLive=function(e,r){var n=when.defer();if(!r){o=new t(ErrorConstant.params_require);return n.reject(o),n.promise}if(""==r.roomId){o=new t(ErrorConstant.roomId_required);return n.reject(o),n.promise}if(""==r.userId){var o=new t(ErrorConstant.userId_required);return n.reject(o),n.promise}return this.liveRestServer.createUserLive(this.restServerURI,e,r).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)}),n.promise},r.prototype.stopLive=function(e,t){var r=when.defer();return this.liveRestServer.stopLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r.prototype.getLive=function(e,t){var r=when.defer();return this.liveRestServer.getLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r.prototype.deleteLive=function(e,t){var r=when.defer();return this.liveRestServer.deleteLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r.prototype.findLives=function(e,t,r,n){var o=when.defer();return this.liveRestServer.findLives(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},r}),ModuleBase.define("LiveRestServer",["Error"],function(e){var t=function(){};return t.prototype.createUserLive=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/live/createUserLive?accessToken="+r+"&callback=?";return console.log(i),$.ajax({type:"post",url:i,dataType:"jsonp",data:n,timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/live/createUserLive) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.stopLive=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/live/stop?id="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/live/stop) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.getLive=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/live/getLive?id="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/live/getLive) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.deleteLive=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/live/delete?id="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/live/delete) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t.prototype.findLives=function(t,r,n,o,i){var s=when.defer(),a=document.location.protocol+"//"+t+"/avd/api/live/findLives?begin="+n+"&count="+o+"&filter="+i+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:a,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)s.resolve(t.data);else{var r=new e(t.result,t.err);s.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/live/findLives) errorCode:"+t.status+",errorMsg:"+t.statusText);var o=new e(t.status,t.statusText);s.reject(o)}}),s.promise},t}),ModuleBase.define("Outgoing",["OutgoingRestServer","Error"],function(e,t){var r=function(t){this.restServerURI=t,this.outgoingRestServer=new e};return r.prototype.createOutgoingUser=function(e,r,n,o,i,s,a){var l=when.defer();if(""==r){u=new t(ErrorConstant.roomId_required);return l.reject(u),l.promise}if(""==n){u=new t(ErrorConstant.userId_required);return l.reject(u),l.promise}if(""==i){var u=new t(ErrorConstant.userAddress_require);return l.reject(u),l.promise}return this.outgoingRestServer.createOutgoingUser(this.restServerURI,e,r,n,o,i,s,a).then(function(e){l.resolve(e)}).otherwise(function(e){l.reject(e)}),l.promise},r.prototype.destroyOutgoingUser=function(e,t,r,n){var o=when.defer();return this.outgoingRestServer.destroyOutgoingUser(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},r.prototype.getOutgoingUsers=function(e,t){var r=when.defer();return this.outgoingRestServer.getOutgoingUsers(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},r}),ModuleBase.define("OutgoingRestServer",["Error"],function(e){var t=function(){};return t.prototype.createOutgoingUser=function(t,r,n,o,i,s,a,l){var u=when.defer(),c=document.location.protocol+"//"+t+"/avd/api/outgoing/createOutgoingUser?accessToken="+r+"&roomId="+n+"&userId="+o+"&userName="+i+"&userAddress="+s+"&userData="+a+"&options="+l+"&callback=?";return console.log(c),$.ajax({type:"get",url:c,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)u.resolve(t.data);else{var r=new e(t.result,t.err);u.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/outgoing/createOutgoingUser) errorCode:"+t.status+",errorMsg:"+t.statusText);var o=new e(t.status,t.statusText);u.reject(o)}}),u.promise},t.prototype.destroyOutgoingUser=function(t,r,n,o,i){var s=when.defer(),a=document.location.protocol+"//"+t+"/avd/api/outgoing/destroyOutgoingUser?roomId="+n+"&userAddress="+o+"&userId="+i+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:a,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)s.resolve(t.data);else{var r=new e(t.result,t.err);s.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/outgoing/destroyOutgoingUser) errorCode:"+t.status+",errorMsg:"+t.statusText);var o=new e(t.status,t.statusText);s.reject(o)}}),s.promise},t.prototype.getOutgoingUsers=function(t,r,n){var o=when.defer(),i=document.location.protocol+"//"+t+"/avd/api/outgoing/getOutgoingUsers?roomId="+n+"&accessToken="+r+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(t){if(t&&0==t.result)o.resolve(t.data);else{var r=new e(t.result,t.err);o.reject(r)}},error:function(t,r,n){log.info("ajax (/avd/api/outgoing/getOutgoingUsers) errorCode:"+t.status+",errorMsg:"+t.statusText);var i=new e(t.status,t.statusText);o.reject(i)}}),o.promise},t});